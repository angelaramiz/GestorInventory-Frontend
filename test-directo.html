<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Directo de Bridges</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .log { background: #f0f0f0; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .info { background: #e3f2fd; color: #1565c0; }
        .warning { background: #fff3e0; color: #ef6c00; }
        button { padding: 10px 20px; margin: 10px 5px; background: #2196f3; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #1976d2; }
    </style>
</head>
<body>
    <h1>üß™ Test Directo de Bridges y Servicios</h1>
    <p>Prueba directa de importaci√≥n de m√≥dulos para detectar errores espec√≠ficos.</p>
    
    <button onclick="testBridges()">üîß Probar Bridges</button>
    <button onclick="testServices()">‚öôÔ∏è Probar Servicios</button>
    <button onclick="testBoth()">üöÄ Probar Todo</button>
    <button onclick="clearLogs()">üóëÔ∏è Limpiar</button>
    
    <div id="output"></div>

    <!-- Importar bridges directamente -->
    <script type="module">
        let output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `[${new Date().toISOString()}] ${message}`;
            output.appendChild(div);
            console.log(message);
            // Auto-scroll
            output.scrollTop = output.scrollHeight;
        }

        // Variables globales para los m√≥dulos
        let bridgeModules = {};
        let serviceModules = {};

        async function importModule(path, name) {
            try {
                log(`üì¶ Importando ${name} desde ${path}...`, 'info');
                const module = await import(path);
                log(`‚úÖ ${name} importado correctamente`, 'success');
                log(`   ‚Ä¢ Exports: ${Object.keys(module).join(', ')}`, 'info');
                return module;
            } catch (error) {
                log(`‚ùå Error importando ${name}: ${error.message}`, 'error');
                if (error.stack) {
                    log(`   ‚Ä¢ Stack: ${error.stack.split('\\n')[0]}`, 'warning');
                }
                return null;
            }
        }

        window.testBridges = async function() {
            log('üîß === PRUEBA DE BRIDGES ===', 'info');
            
            const bridges = [
                { path: './js/db-operations-bridge.js', name: 'DB Operations Bridge' },
                { path: './js/product-operations-bridge.js', name: 'Product Operations Bridge' },
                { path: './js/scanner-bridge.js', name: 'Scanner Bridge' },
                { path: './js/configuraciones-bridge.js', name: 'Configuraciones Bridge' },
                { path: './js/tabla-productos-bridge.js', name: 'Tabla Productos Bridge' }
            ];

            for (const bridge of bridges) {
                const module = await importModule(bridge.path, bridge.name);
                if (module) {
                    bridgeModules[bridge.name] = module;
                }
            }
            
            log(`üéØ Bridges cargados: ${Object.keys(bridgeModules).length}/${bridges.length}`, 'info');
        };

        window.testServices = async function() {
            log('‚öôÔ∏è === PRUEBA DE SERVICIOS ===', 'info');
            
            const services = [
                { path: './src/core/services/ServiceManager.js', name: 'Service Manager' },
                { path: './src/core/services/DatabaseService.js', name: 'Database Service' },
                { path: './src/core/services/ProductService.js', name: 'Product Service' },
                { path: './src/core/services/ScannerService.js', name: 'Scanner Service' }
            ];

            for (const service of services) {
                const module = await importModule(service.path, service.name);
                if (module) {
                    serviceModules[service.name] = module;
                }
            }
            
            log(`üéØ Servicios cargados: ${Object.keys(serviceModules).length}/${services.length}`, 'info');
        };

        window.testBoth = async function() {
            output.innerHTML = '';
            log('üöÄ === PRUEBA COMPLETA ===', 'info');
            await testBridges();
            log('', 'info');
            await testServices();
            log('', 'info');
            
            // Resumen final
            const totalBridges = 5;
            const totalServices = 4;
            const loadedBridges = Object.keys(bridgeModules).length;
            const loadedServices = Object.keys(serviceModules).length;
            
            log('üìä === RESUMEN FINAL ===', 'info');
            log(`Bridges: ${loadedBridges}/${totalBridges} ${loadedBridges === totalBridges ? '‚úÖ' : '‚ùå'}`, loadedBridges === totalBridges ? 'success' : 'error');
            log(`Servicios: ${loadedServices}/${totalServices} ${loadedServices === totalServices ? '‚úÖ' : '‚ùå'}`, loadedServices === totalServices ? 'success' : 'error');
            
            if (loadedBridges === totalBridges && loadedServices === totalServices) {
                log('üéâ ¬°TODO FUNCIONA CORRECTAMENTE!', 'success');
                log('La migraci√≥n est√° completa y operativa.', 'success');
            } else {
                log('‚ö†Ô∏è Hay algunos problemas que necesitan atenci√≥n.', 'warning');
            }
        };

        window.clearLogs = function() {
            output.innerHTML = '';
        };

        // Log inicial
        log('üí° Test directo cargado. Use los botones para probar los m√≥dulos.', 'info');
    </script>
</body>
</html>
