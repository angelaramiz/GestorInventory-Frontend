<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Nuevo Producto - Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Agregar Nuevo Producto</h1>

    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Agregar Nuevo Producto</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Pestañas -->
        <div class="mb-6 mt-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-individual"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button active">
                        Producto Individual
                    </button>
                    <button id="tab-tabla"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Agregado por Tabla
                    </button>
                    <button id="tab-csv"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Carga por CSV
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenido de Pestañas -->

        <!-- Pestaña Individual (formulario original) -->
        <div id="content-individual" class="tab-content">
            <form id="formAgregarProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo">
                        Código/PLU:
                    </label>
                    <div class="flex">
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            placeholder="Codigo" id="codigoAgregar" type="text" required>
                        <button type="button" id="escanearBtnAgregar"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                            Escanear Código
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nombre">
                        Nombre:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="nombre" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="categoria">
                        Categoría:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="categoria" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="marca">
                        Marca/Proveedor:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="marca" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="marca">
                        Unidad:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="unidad" type="text" required>
                </div>

                <!-- Campo para producto primario (aparece solo cuando unidad es Kg) -->
                <div id="producto-primario-container" class="mb-4" style="display: none;">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-3">
                        <div class="flex items-center mb-2">
                            <svg class="w-5 h-5 text-yellow-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                    clip-rule="evenodd"></path>
                            </svg>
                            <span class="text-yellow-800 font-medium text-sm">Nota importante:</span>
                        </div>
                        <p class="text-yellow-700 text-sm">
                            Si el producto es un subproducto y cuenta con un producto primario,
                            ingresa el código del producto primario en el campo de abajo.
                        </p>
                    </div>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="producto-primario">
                        Código del Producto Primario (opcional):
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="producto-primario" type="text" placeholder="Codigo del Producto Primario">
                </div>
                <div class="flex items-center justify-between">
                    <button
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="submit">
                        Agregar Producto
                    </button>
                </div>
            </form>
        </div>

        <!-- Pestaña Tabla (nueva funcionalidad) -->
        <div id="content-tabla" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <!-- Sección Producto Primario -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">Producto Primario</h3>

                    <!-- Campo código producto primario -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo-primario">
                            Código de Producto Primario:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            placeholder="Ingrese código del producto primario" id="codigo-primario" type="text"
                            required>
                    </div>

                    <!-- Información del producto primario -->
                    <div id="info-producto-primario" class="grid grid-cols-1 md:grid-cols-2 gap-4"
                        style="display: none;">
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Nombre:</label>
                            <input id="primario-nombre"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Categoría:</label>
                            <input id="primario-categoria"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Marca/Proveedor:</label>
                            <input id="primario-marca"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Unidad:</label>
                            <input id="primario-unidad"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                    </div>
                </div>

                <!-- Sección Subproductos -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">Subproductos</h3>
                        <button id="agregar-fila-btn"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                            style="display: none;">
                            + Agregar Nueva Fila
                        </button>
                    </div>

                    <div id="subproductos-container" class="space-y-4">
                        <!-- Las filas de subproductos se generarán dinámicamente -->
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="flex justify-between items-center pt-6 border-t">
                    <button id="limpiar-tabla-btn"
                        class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                        Limpiar Todo
                    </button>
                    <button id="guardar-tabla-btn"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
                        style="display: none;">
                        Guardar Tabla de Productos
                    </button>
                </div>
            </div>
        </div>


        <!-- Pestaña CSV -->
        <div id="content-csv" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Carga Masiva por CSV</h3>
                <form id="csv-upload-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">Selecciona archivo
                            CSV:</label>
                        <input type="file" id="csvFile" accept=".csv"
                            class="block w-full text-sm text-gray-700 border border-gray-300 rounded py-2 px-3"
                            required />
                    </div>
                    <button type="submit"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Cargar y
                        Previsualizar</button>
                </form>
                <div id="csv-preview" class="mt-6" style="display:none;">
                    <h4 class="text-lg font-semibold mb-2">Vista previa de datos</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200" id="csv-table"></table>
                    </div>
                    <button id="csv-upload-confirm"
                        class="mt-4 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Subir al
                        sistema</button>
                </div>
                <div id="csv-error" class="mt-4 text-red-600 font-semibold"></div>
            </div>
        </div>

        <div id="mensaje" class="mt-4"></div>

        <div id="scanner-container-agregar" class="mt-4" style="display: none;">
            <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
            <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script type="module" src="../js/ui/tabla-productos.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            // Reemplazar cada guión (-) con 6 ceros (000000)
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;

            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);

                // Solo actualizar si hay diferencia (para evitar bucles infinitos)
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;

                    // Ajustar posición del cursor
                    // Si se agregaron caracteres, mover el cursor proporcionalmente
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            // También aplicar en blur para asegurar conversión final
            input.addEventListener('blur', function (e) {
                const valorConvertido = convertirGuionACeros(e.target.value);
                e.target.value = valorConvertido;
            });
        }

        // Hacer la función disponible globalmente para tabla-productos.js
        window.aplicarConversionCodigoAInput = aplicarConversionCodigo;

        // Script para pestañas
        document.addEventListener('DOMContentLoaded', function () {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            function switchTab(targetTab) {
                // Remover clase activa de todos los botones
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });

                // Ocultar todo el contenido
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });

                // Activar pestaña seleccionada
                const activeButton = document.getElementById(`tab-${targetTab}`);
                activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');

                // Mostrar contenido correspondiente
                document.getElementById(`content-${targetTab}`).style.display = 'block';
            }

            // Event listeners para los botones de pestañas
            document.getElementById('tab-individual').addEventListener('click', () => switchTab('individual'));
            document.getElementById('tab-tabla').addEventListener('click', () => switchTab('tabla'));
            document.getElementById('tab-csv').addEventListener('click', () => switchTab('csv'));
            // CSV: Lógica de carga y validación
            const csvForm = document.getElementById('csv-upload-form');
            const csvFileInput = document.getElementById('csvFile');
            const csvPreview = document.getElementById('csv-preview');
            const csvTable = document.getElementById('csv-table');
            const csvError = document.getElementById('csv-error');
            const csvUploadConfirm = document.getElementById('csv-upload-confirm');
            let csvData = [];

            function parseCSV(text) {
                const lines = text.trim().split(/\r?\n/);
                const headers = lines[0].split(',').map(h => h.trim());
                const rows = lines.slice(1).map(line => {
                    // Soporta campos con comas entre comillas
                    const regex = /(?:"([^"]*)")|([^,]+)/g;
                    let match, arr = [];
                    let i = 0;
                    while ((match = regex.exec(line)) !== null) {
                        arr.push(match[1] !== undefined ? match[1] : match[2]);
                        i++;
                    }
                    // Si no hay comillas, fallback split normal
                    if (arr.length === 0) arr = line.split(',');
                    return arr.map(x => x ? x.trim() : '');
                });
                return { headers, rows };
            }

            function validateHeaders(headers) {
                const required = ['Codigo', 'Nombre', 'Categoria', 'Marca', 'Unidad'];
                return required.every(h => headers.includes(h));
            }

            csvForm.addEventListener('submit', function (e) {
                e.preventDefault();
                csvError.textContent = '';
                csvPreview.style.display = 'none';
                csvTable.innerHTML = '';
                csvData = [];
                const file = csvFileInput.files[0];
                if (!file) {
                    csvError.textContent = 'Selecciona un archivo CSV.';
                    return;
                }
                const reader = new FileReader();
                reader.onload = function (evt) {
                    const text = evt.target.result;
                    const { headers, rows } = parseCSV(text);
                    if (!validateHeaders(headers)) {
                        csvError.textContent = 'El archivo debe contener los campos: Codigo, Nombre, Categoria, Marca y Unidad.';
                        return;
                    }
                    // Mostrar tabla
                    let html = '<thead><tr>' + headers.map(h => `<th class="px-2 py-1 border">${h}</th>`).join('') + '</tr></thead><tbody>';
                    rows.forEach(row => {
                        html += '<tr>' + row.map(cell => `<td class="px-2 py-1 border">${cell}</td>`).join('') + '</tr>';
                    });
                    html += '</tbody>';
                    csvTable.innerHTML = html;
                    csvPreview.style.display = 'block';
                    csvData = rows.map(row => {
                        let obj = {};
                        headers.forEach((h, i) => obj[h] = row[i]);
                        return obj;
                    });
                };
                reader.readAsText(file);
            });

            csvUploadConfirm.addEventListener('click', function () {
                if (!csvData.length) {
                    csvError.textContent = 'No hay datos para subir.';
                    return;
                }
                // Lógica real para subir a Supabase, omitiendo los que ya existen y agregando usuario_id
                (async () => {
                    try {
                        if (!window.getSupabase) throw new Error('No se encontró getSupabase.');
                        const supabase = await window.getSupabase();
                        // Obtener usuario_id y categoria_id de localStorage
                        const userId = localStorage.getItem('usuario_id');
                        const categoriaId = localStorage.getItem('categoria_id');
                        if (!userId) throw new Error('No se pudo obtener el usuario autenticado.');
                        if (!categoriaId) throw new Error('No se pudo obtener la categoría del usuario.');
                        // 1. Obtener todos los códigos existentes en Supabase
                        const { data: existentes, error: errorExist } = await supabase.from('productos').select('codigo');
                        if (errorExist) throw errorExist;
                        const codigosExistentes = new Set((existentes || []).map(p => p.codigo));
                        // 2. Filtrar productos nuevos
                        const nuevos = csvData.filter(prod => !codigosExistentes.has(prod.Codigo));
                        let omitidos = csvData.length - nuevos.length;
                        // 3. Insertar los nuevos
                        let insertados = 0;
                        if (nuevos.length > 0) {
                            // Mapear campos a los nombres de la tabla e incluir usuario_id y categoria_id
                            const productosInsertar = nuevos.map(prod => ({
                                codigo: prod.Codigo,
                                nombre: prod.Nombre,
                                categoria: prod.Categoria,
                                marca: prod.Marca,
                                unidad: prod.Unidad,
                                usuario_id: userId,
                                categoria_id: categoriaId
                            }));
                            const { error: errorInsert } = await supabase.from('productos').insert(productosInsertar);
                            if (errorInsert) throw errorInsert;
                            insertados = productosInsertar.length;
                        }
                        Swal.fire({
                            icon: 'success',
                            title: 'Carga completada',
                            html: `<b>${insertados}</b> productos agregados.<br><b>${omitidos}</b> productos ya existían y fueron omitidos.`
                        });
                        csvPreview.style.display = 'none';
                        csvTable.innerHTML = '';
                        csvData = [];
                    } catch (err) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error al subir productos',
                            text: err.message || err
                        });
                    }
                })();
            });

            // Aplicar conversión de guión a ceros en campos de código
            // Pestaña Individual
            const codigoIndividual = document.getElementById('codigoAgregar');
            const productoPrimarioIndividual = document.getElementById('producto-primario');

            aplicarConversionCodigo(codigoIndividual);
            aplicarConversionCodigo(productoPrimarioIndividual);

            // Pestaña Tabla
            const codigoPrimarioTabla = document.getElementById('codigo-primario');
            aplicarConversionCodigo(codigoPrimarioTabla);

            // Para los subproductos en la tabla (se aplicará dinámicamente cuando se creen)

            // Inicializar funcionalidad de tabla directamente aquí como backup
            setTimeout(() => {
                try {
                    const limpiarBtn = document.getElementById('limpiar-tabla-btn');
                    if (limpiarBtn) {
                        limpiarBtn.addEventListener('click', function () {
                            console.log('Click en limpiar tabla');
                            if (confirm('¿Está seguro de que desea limpiar todos los datos?')) {
                                document.getElementById('codigo-primario').value = '';
                                document.getElementById('info-producto-primario').style.display = 'none';
                                document.getElementById('subproductos-container').innerHTML = '';
                                document.getElementById('agregar-fila-btn').style.display = 'none';
                                document.getElementById('guardar-tabla-btn').style.display = 'none';
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error en backup de inicialización:', error);
                }
            }, 1000);

            // Script original para mostrar/ocultar el campo de producto primario
            const unidadInput = document.getElementById('unidad');
            const productoPrimarioContainer = document.getElementById('producto-primario-container');
            const form = document.getElementById('formAgregarProducto');

            function toggleProductoPrimario() {
                if (unidadInput && productoPrimarioContainer) {
                    const unidad = unidadInput.value.toLowerCase().trim();
                    if (unidad === 'kg') {
                        productoPrimarioContainer.style.display = 'block';
                    } else {
                        productoPrimarioContainer.style.display = 'none';
                        // Limpiar el campo si se oculta
                        const productoPrimarioInput = document.getElementById('producto-primario');
                        if (productoPrimarioInput) {
                            productoPrimarioInput.value = '';
                        }
                    }
                }
            }

            // Agregar event listener al campo unidad
            if (unidadInput) {
                unidadInput.addEventListener('input', toggleProductoPrimario);
                unidadInput.addEventListener('change', toggleProductoPrimario);
            }

            // Ocultar el campo cuando se resetee el formulario
            if (form) {
                form.addEventListener('reset', function () {
                    setTimeout(() => {
                        if (productoPrimarioContainer) {
                            productoPrimarioContainer.style.display = 'none';
                        }
                    }, 10); // Pequeño delay para asegurar que el reset se complete
                });
            }
        });
    </script>
    <style>
        .tab-button.active {
            border-color: #3b82f6;
            color: #2563eb;
        }

        .subproducto-row {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            background-color: #f9fafb;
        }

        .campo-readonly {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }

        .producto-existente {
            background-color: #dcfce7;
            border-color: #16a34a;
        }

        .producto-nuevo {
            background-color: #fef3c7;
            border-color: #d97706;
        }
    </style>
</body>

</html>
<!DOCTYPE html>    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesti�n de Archivos - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css" />
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css" />
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Gesti�n de Archivos</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">
                Cerrar
            </button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <div id="archivos" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Gesti�n de Archivos</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Men�
        </button>

        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">
                    Cargar Archivo CSV:
                </label>
                <input type="file" id="csvFile" accept=".csv"
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />
                <div class="mb-4">
                    <button id="descargarCSV"
                        class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                        Exportar Datos a CSV
                    </button>
                </div>
                <div class="mb-4">
                    <button id="resetearBaseDatos"
                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                        Resetear Base de Datos
                    </button>
                </div>
            </div>
        </div>

        <button class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded" id="sync-down-btn">
            Sincronizar en Bajada
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4">Base de Datos Actual</h2>
        <div class="overflow-x-auto">
            <table class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">C�digo</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categor�a</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Unidad</th>
                    </tr>
                </thead>
                <tbody id="databaseBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const menuToggle = document.getElementById("menuToggle");
            const sideMenu = document.getElementById("sideMenu");
            const closeMenu = document.getElementById("closeMenu");
            const menuRoutes = document.getElementById("menuRoutes");

            const routes = [
                { name: "Consulta de Producto", path: "./consulta.html" },
                { name: "Editar Producto", path: "./editar.html" },
                { name: "Inventario", path: "./inventario.html" },
                { name: "Reporte para Inventario", path: "./report.html" },
                { name: "Agregar Productos", path: "./agregar.html" }
            ];

            routes.forEach((route) => {
                const li = document.createElement("li");
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            menuToggle.addEventListener("click", () => {
                sideMenu.classList.remove("-translate-x-full");
            });

            closeMenu.addEventListener("click", () => {
                sideMenu.classList.add("-translate-x-full");
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraciones - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    <script src="../js/utils/theme-debug.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Configuraciones del Sistema</h1>
        <div class="flex items-center space-x-4">
            <span id="userInfo" class="text-sm font-medium"></span>
        </div>
    </header>

    <div class="container mx-auto mt-8 p-4">
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar al Dashboard</a>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Configuraciones de Usuario -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    Configuraciones de Usuario
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cambiar Contrase�a</label>
                        <button id="changePasswordBtn"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Cambiar Contrase�a
                        </button>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Informaci�n del Perfil</label>
                        <div id="profileInfo" class="bg-gray-50 p-4 rounded border">
                            <!-- Se llenar� din�micamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraciones del Sistema -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Configuraciones del Sistema
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tema de la Aplicaci�n</label>
                        <select id="themeSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="light">Claro</option>
                            <option value="dark">Oscuro</option>
                            <option value="auto">Autom�tico</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Idioma</label>
                        <select id="languageSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="es">Espa�ol</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Google Services -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                        </path>
                    </svg>
                    Credenciales de Google
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Drive API Key</label>
                        <div class="relative">
                            <input type="password" id="googleDriveApiKey"
                                class="w-full border border-gray-300 rounded px-3 py-2 pr-12"
                                placeholder="Ingresa tu API Key de Google Drive">
                            <button type="button" id="toggleDriveKey"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Necesaria para acceder a Google Drive desde la aplicaci�n
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Sheets API Key</label>
                        <div class="relative">
                            <input type="password" id="googleSheetsApiKey"
                                class="w-full border border-gray-300 rounded px-3 py-2 pr-12"
                                placeholder="Ingresa tu API Key de Google Sheets">
                            <button type="button" id="toggleSheetsKey"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Necesaria para integraci�n con Google Sheets</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ID de Google Sheets</label>
                        <input type="text" id="googleSheetsId" class="w-full border border-gray-300 rounded px-3 py-2"
                            placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                        <p class="text-xs text-gray-500 mt-1">ID de la hoja de c�lculo de Google donde se sincronizar�n
                            los datos</p>
                    </div>

                    <div class="flex space-x-2">
                        <button id="testGoogleConnection"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Probar Conexi�n
                        </button>
                        <button id="saveGoogleCredentials"
                            class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                            Guardar Credenciales
                        </button>
                        <button id="clearGoogleCredentials"
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                            Limpiar
                        </button>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mt-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">
                                    <strong>Informaci�n:</strong> Para obtener las API Keys, visita la
                                    <a href="https://console.developers.google.com/" target="_blank"
                                        class="underline hover:text-blue-800">
                                        Google Cloud Console
                                    </a> y habilita las APIs de Google Drive y Google Sheets.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Sincronizaci�n -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                        </path>
                    </svg>
                    Sincronizaci�n
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sincronizaci�n Autom�tica</label>
                        <div class="flex items-center">
                            <input type="checkbox" id="autoSyncEnabled" class="mr-2">
                            <span>Habilitar sincronizaci�n autom�tica</span>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Intervalo de Sincronizaci�n
                            (minutos)</label>
                        <input type="number" id="syncInterval" class="border border-gray-300 rounded px-3 py-2 w-full"
                            min="1" max="60" value="5">
                    </div>

                    <div class="flex space-x-2">
                        <button id="manualSyncBtn"
                            class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                            Sincronizar Ahora
                        </button>
                        <button id="resetSyncBtn"
                            class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">
                            Resetear Configuraci�n
                        </button>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Notificaciones -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-5 5v-5zM7 7h10v10H7V7z"></path>
                    </svg>
                    Notificaciones
                </h2>

                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="browserNotifications" class="mr-2">
                        <span>Notificaciones del navegador</span>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="soundNotifications" class="mr-2">
                        <span>Notificaciones sonoras</span>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="lowStockAlerts" class="mr-2">
                        <span>Alertas de stock bajo</span>
                    </div>
                </div>
            </div>

            <!-- Informaci�n del Sistema -->
            <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Informaci�n del Sistema
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">Versi�n de la Aplicaci�n</h3>
                        <p id="appVersion" class="text-lg">1.0.0</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">Estado de Conexi�n</h3>
                        <p id="connectionStatus" class="text-lg">Conectado</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">�ltima Sincronizaci�n</h3>
                        <p id="lastSync" class="text-lg">--</p>
                    </div>
                </div>

                <div class="mt-4 flex space-x-2">
                    <button id="exportConfigBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Exportar Configuraci�n
                    </button>
                    <button id="importConfigBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Importar Configuraci�n
                    </button>
                    <input type="file" id="importConfigFile" accept=".json" class="hidden">
                </div>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/configuraciones.js"></script>
</body>

</html>
<<<<<<< HEAD=======<!DOCTYPE html>
    <html lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Confirmaci�n de Correo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
        <link href="../librer�as/tailwind.min.css" rel="stylesheet">
        <link href="../css/styles.css" rel="stylesheet">
        <script src="../js/utils/theme-manager.js"></script>
        <script src="../js/ui/theme-toggle.js"></script>
    </head>

    <body class="bg-gray-100 flex items-center justify-center h-screen">
        <div class="container mx-auto p-6 max-w-md bg-white shadow-md rounded-lg text-center">
            <h1 id="statusTitle" class="text-2xl font-bold mb-4 text-blue-600">Verificando tu correo...</h1>
            <p id="statusMessage" class="text-gray-700 mb-6">Por favor, espera un momento mientras procesamos tu
                confirmaci�n.</p>
            <p id="detailsMessage" class="text-gray-600 mb-4"></p>
            <a href="../index.html"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-2 inline-block">
                Ir al Inicio de Sesi�n
            </a>
        </div>
        <script src="../js/ui/mobile-optimizer.js"></script>
        <script type="module">
            import { supabase } from '../js/auth/auth.js';

            const statusTitleEl = document.getElementById('statusTitle');
            const statusMessageEl = document.getElementById('statusMessage');
            const detailsMessageEl = document.getElementById('detailsMessage');

            // Supabase maneja la confirmaci�n del token en el backend antes de redirigir aqu�.
            // Esta p�gina muestra el resultado basado en los par�metros de la URL o el estado de la sesi�n.

            const urlParams = new URLSearchParams(window.location.search);
            const errorDescription = urlParams.get('error_description');
            // const errorCode = urlParams.get('error'); // Podr�as usarlo para errores m�s espec�ficos

            if (errorDescription) {
                statusTitleEl.textContent = 'Error en la Confirmaci�n';
                statusTitleEl.classList.remove('text-blue-600', 'text-green-600');
                statusTitleEl.classList.add('text-red-600');
                statusMessageEl.textContent = 'No pudimos confirmar tu direcci�n de correo electr�nico.';
                detailsMessageEl.textContent = `Detalles: ${decodeURIComponent(errorDescription)}`;
                detailsMessageEl.classList.add('text-red-500');
            } else {
                // Si no hay error en la URL, la confirmaci�n fue procesada por Supabase.
                // Esto puede significar que el correo se confirm� ahora o ya estaba confirmado.
                statusTitleEl.textContent = '¡Correo Verificado!';
                statusTitleEl.classList.remove('text-blue-600', 'text-red-600');
                statusTitleEl.classList.add('text-green-600');
                statusMessageEl.textContent = 'Tu direcci�n de correo electr�nico ha sido verificada exitosamente.';
                detailsMessageEl.textContent = 'Ya puedes cerrar esta ventana e iniciar sesi�n.';

                // onAuthStateChange puede dar feedback adicional si la confirmaci�n tambi�n inicia sesi�n.
                supabase.auth.onAuthStateChange((event, session) => {
                    if (event === 'SIGNED_IN' && session) {
                        detailsMessageEl.textContent = 'Has iniciado sesi�n autom�ticamente. ¡Bienvenido!';
                    } else if (event === 'USER_UPDATED' && session?.user?.email_confirmed_at) {
                        // El correo est� confirmado, el mensaje por defecto ya es apropiado.
                        // Puedes a�adir algo m�s si es necesario.
                    }
                });
            }
        </script>
    </body>

    </html>
    >>>>>>> 1e3239b (feat: A�adir enlace para recuperaci�n de contrase�a en la p�gina de inicio de sesi�n y mejorar
    mensajes de confirmaci�n de correo)
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Producto - Sistema de Gestión de Productos</title>
    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <!-- Cambiamos Quagga por Html5QrCode -->
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../librerías/sweetalert2@11.js"></script>
    <!-- Añadir JsBarcode para códigos de barra -->
    <script src="../librerías/JsBarcode.all.min.js"></script>
    <!-- Añadir jsPDF para generación de PDFs -->
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Consulta de Producto</h1>

    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="consulta" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Consulta de Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">Menú</button>

        <!-- Sistema de pestañas -->
        <div class="mb-4 mt-4">
            <nav class="flex border-b">
                <button id="tab-busqueda" class="tab-button border-b-2 border-blue-500 text-blue-600 px-4 py-2 font-semibold">Búsqueda</button>
                <button id="tab-relaciones" class="tab-button border-b-2 border-transparent text-gray-500 px-4 py-2 font-semibold">Relaciones</button>
            </nav>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-busqueda" class="tab-content">
            <form id="formConsultaProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoConsulta">Código/PLU:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoConsulta" type="text">
                        <button type="button" id="escanearBtnConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear Código de Barras</button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreConsulta">Nombre:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="nombreConsulta" type="text">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaConsulta">Categoría:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="categoriaConsulta" type="text">
                </div>
                <div class="flex items-center justify-between">
                    <button id="buscarConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">Buscar Producto</button>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
        </div>
        <div id="content-relaciones" class="tab-content" style="display:none;">
            <form id="formRelaciones" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoRelacion">Código del producto:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoRelacion" type="text" placeholder="Escanea o ingresa el código o últimos 4 dígitos">
                        <button type="button" id="escanearBtnRelacion" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear</button>
                        <button type="button" id="buscarRelacion" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Buscar Relación</button>
                    </div>
                </div>
            </form>
            <div id="relaciones" class="mt-4"></div>
        </div>

        <!-- Modificamos el contenedor del escáner -->
        <!-- En plantillas/consulta.html -->
        <div id="scanner-container-consulta" class="mt-4" style="display: none;">
            <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
            <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
        </div>

        <!-- Div to hold the barcode -->
        <div id="barcodeContainer" class="mt-4"></div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Búsqueda relacional de productos con pestañas
        document.addEventListener('DOMContentLoaded', function() {
            const codigoConsulta = document.getElementById('codigoConsulta');
            aplicarConversionCodigo(codigoConsulta);
            // Para la pestaña de relaciones
            const codigoRelacion = document.getElementById('codigoRelacion');
            if (codigoRelacion) aplicarConversionCodigo(codigoRelacion);

            // Tabs
            const tabBusqueda = document.getElementById('tab-busqueda');
            const tabRelaciones = document.getElementById('tab-relaciones');
            const contentBusqueda = document.getElementById('content-busqueda');
            const contentRelaciones = document.getElementById('content-relaciones');
            const relacionesDiv = document.getElementById('relaciones');
            let ultimoProducto = null;

            function switchTab(tab) {
                if (tab === 'busqueda') {
                    tabBusqueda.classList.add('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.remove('border-transparent', 'text-gray-500');
                    tabRelaciones.classList.remove('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'block';
                    contentRelaciones.style.display = 'none';
                } else {
                    if (tabRelaciones.disabled) return; // No cambiar si está deshabilitada
                    tabRelaciones.classList.add('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.remove('border-transparent', 'text-gray-500');
                    tabBusqueda.classList.remove('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'none';
                    contentRelaciones.style.display = 'block';
                }
            }
            tabBusqueda.addEventListener('click', () => switchTab('busqueda'));
            tabRelaciones.addEventListener('click', () => switchTab('relaciones'));
            switchTab('busqueda');

            const buscarBtn = document.getElementById('buscarConsulta');
            const resultadosDiv = document.getElementById('resultados');

            buscarBtn.addEventListener('click', async function() {
                resultadosDiv.innerHTML = '';
                ultimoProducto = null;
                const codigoInput = document.getElementById('codigoConsulta').value.trim();
                const nombre = document.getElementById('nombreConsulta').value.trim();
                const categoria = document.getElementById('categoriaConsulta').value.trim();

                // Buscar primero en IndexedDB para obtener el código completo
                function buscarEnIndexedDB(codigo, nombre, categoria) {
                    return new Promise((resolve, reject) => {
                        if (!window.indexedDB) {
                            resolve(null);
                            return;
                        }
                        const request = window.indexedDB.open('InventarioDB', 1);
                        request.onerror = function() { resolve(null); };
                        request.onsuccess = function(event) {
                            const db = event.target.result;
                            const tx = db.transaction(['productos'], 'readonly');
                            const store = tx.objectStore('productos');
                            const allReq = store.getAll();
                            allReq.onsuccess = function(e) {
                                const productos = e.target.result || [];
                                let encontrados = [];
                                if (codigo) {
                                    if (codigo.length === 4) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo.endsWith(codigo));
                                    } else if (codigo.length === 13) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    } else {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    }
                                } else if (nombre || categoria) {
                                    encontrados = productos.filter(p => {
                                        let match = true;
                                        if (nombre) match = match && p.nombre && p.nombre.toLowerCase().includes(nombre.toLowerCase());
                                        if (categoria) match = match && p.categoria && p.categoria.toLowerCase().includes(categoria.toLowerCase());
                                        return match;
                                    });
                                }
                                resolve(encontrados);
                            };
                            allReq.onerror = function() { resolve(null); };
                        };
                    });
                }

                const productosLocal = await buscarEnIndexedDB(codigoInput, nombre, categoria);
                if (!productosLocal || productosLocal.length === 0) {
                    resultadosDiv.innerHTML = '<div class="text-red-600 font-semibold">No se encontraron productos en el dispositivo.</div>';
                    return;
                }

                // Mostrar resultados principales
                productosLocal.forEach((producto, idx) => {
                    let html = `<div class="bg-white rounded shadow p-4 mb-4">
                        <h3 class="text-xl font-bold mb-2">${producto.nombre}</h3>
                        <div><b>Código:</b> ${producto.codigo}</div>
                        <div><b>Categoría:</b> ${producto.categoria}</div>
                        <div><b>Marca:</b> ${producto.marca}</div>
                        <div><b>Unidad:</b> ${producto.unidad}</div>
                    </div>`;
                    resultadosDiv.innerHTML += html;
                    if (idx === 0) ultimoProducto = producto;
                });
            });

            // Lógica independiente para la pestaña de relaciones
            const buscarRelacionBtn = document.getElementById('buscarRelacion');
            if (buscarRelacionBtn) {
                buscarRelacionBtn.addEventListener('click', async function() {
                    relacionesDiv.innerHTML = '';
                    let codigo = document.getElementById('codigoRelacion').value.trim();
                    if (!codigo) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Ingresa un código para buscar relaciones.</div>';
                        return;
                    }
                    // Permitir búsqueda por últimos 4 dígitos
                    if (codigo.length === 4) {
                        // Buscar en Supabase todos los productos cuyo substring(2,5) sea igual a esos 4 dígitos
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        // Traer todos los códigos y filtrar en JS (por compatibilidad universal)
                        const { data: productosTodos } = await supabase.from('productos').select('codigo');
                        const productos4 = (productosTodos || []).filter(p => typeof p.codigo === 'string' && p.codigo.length >= 5 && p.codigo.substring(1,5) === codigo);
                        if (productos4.length > 0) {
                            if (productos4.length > 1) {
                                relacionesDiv.innerHTML = `<div class='mb-2'>Se encontraron varios productos con los dígitos 2-5 <b>${codigo}</b>:</div>`;
                                productos4.forEach(p => {
                                    relacionesDiv.innerHTML += `<button class='bg-blue-100 hover:bg-blue-300 text-blue-800 px-2 py-1 rounded m-1' onclick='document.getElementById("codigoRelacion").value="${p.codigo}";document.getElementById("buscarRelacion").click();return false;'>${p.codigo}</button>`;
                                });
                                return;
                            } else {
                                codigo = productos4[0].codigo;
                                document.getElementById('codigoRelacion').value = codigo;
                            }
                        } else {
                            relacionesDiv.innerHTML = `<div class='text-red-600'>No se encontró ningún producto con los dígitos 2-5 igual a <b>${codigo}</b>.</div>`;
                            return;
                        }
                    }
                    relacionesDiv.innerHTML = '<div class="text-gray-500">Buscando relaciones...</div>';
                    try {
                        const { obtenerRelacionesProductosSupabase, buscarRelacionProducto } = await import('../js/relaciones-productos.js');
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        const relaciones = await obtenerRelacionesProductosSupabase();
                        const resultado = buscarRelacionProducto(codigo, relaciones);
                        // Buscar info del producto consultado
                        let relHtml = `<div class="bg-white rounded shadow p-4 mb-4">
                            <h3 class="text-lg font-bold mb-2">Relaciones para: <span class='font-mono'>${codigo}</span></h3>`;
                        const { data: productoInfo } = await supabase.from('productos').select('*').eq('codigo', codigo);
                        if (productoInfo && productoInfo.length > 0) {
                            const p = productoInfo[0];
                            relHtml += `<div class='mb-2 text-sm text-gray-700'>${p.nombre} | ${p.unidad || ''} | ${p.categoria || ''} | ${p.marca || ''}</div>`;
                        }
                        // Si es principal, mostrar subproductos
                        if (resultado.tipo === 'principal' && resultado.subproductos.length > 0) {
                            // Buscar info de subproductos
                            const { data: subproductosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos);
                            relHtml += `<div class="mt-2"><b>Subproductos relacionados:</b>
                            <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                            resultado.subproductos.forEach(subCodigo => {
                                const sub = subproductosInfo ? subproductosInfo.find(p => p.codigo === subCodigo) : null;
                                if (sub) {
                                    relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                } else {
                                    relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                }
                            });
                            relHtml += '</tbody></table></div>';
                        }
                        // Si es subproducto, mostrar principal y hermanos
                        if (resultado.tipo === 'subproducto' && resultado.principal) {
                            // Buscar info del principal
                            const { data: principalArr } = await supabase.from('productos').select('*').eq('codigo', resultado.principal);
                            if (principalArr && principalArr.length > 0) {
                                const principal = principalArr[0];
                                relHtml += `<div class="mt-4"><b>Producto principal:</b>
                                    <div class="bg-gray-50 rounded p-2 mt-1">
                                        <b>${principal.nombre}</b> (Código: ${principal.codigo})<br>
                                        Categoría: ${principal.categoria} | Marca: ${principal.marca} | Unidad: ${principal.unidad}
                                    </div>
                                </div>`;
                            } else {
                                relHtml += `<div class="mt-4"><b>Producto principal:</b> <span class='text-gray-400'>${resultado.principal} (No encontrado)</span></div>`;
                            }
                            // Mostrar hermanos (otros subproductos)
                            if (resultado.subproductos.length > 1) {
                                const { data: hermanosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos.filter(c => c !== codigo));
                                relHtml += `<div class="mt-2"><b>Otros subproductos relacionados:</b>
                                <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                                resultado.subproductos.forEach(subCodigo => {
                                    if (subCodigo === codigo) return;
                                    const sub = hermanosInfo ? hermanosInfo.find(p => p.codigo === subCodigo) : null;
                                    if (sub) {
                                        relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                    } else {
                                        relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                    }
                                });
                                relHtml += '</tbody></table></div>';
                            }
                        }
                        if (resultado.tipo === 'ninguno') {
                            relHtml += '<div class="mt-2 text-gray-400">Este producto no tiene relaciones registradas.</div>';
                        }
                        relHtml += '</div>';
                        relacionesDiv.innerHTML = relHtml;
                    } catch (e) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Error al consultar relaciones: ' + (e.message || e) + '</div>';
                    }
                });
            }

            // El manejo del botón de escanear ya lo realiza `main.js` (evitamos listeners duplicados).
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#">
    <title>Editar Producto - Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <script src="../librerías/html5-qrcode.min.js"></script>
    <link rel="stylesheet" href="../librerías/tailwind.min.css" />
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">

    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Editar Producto</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Editar Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Pestañas -->
        <div class="mb-6 mt-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-editar-individual"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button active">
                        Edición Individual
                    </button>
                    <button id="tab-editar-tabla"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Edición por Tabla
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-editar-individual" class="tab-content">
            <form id="formEditarProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoEditar">
                        Código/PLU:
                    </label>
                    <div class="flex">
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="codigoEditar" type="text" required />
                        <button type="button" id="escanearBtnEditar"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                            Escanear Código de Barras
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <button id="buscarEditar"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="button">
                        Buscar
                    </button>
                </div>
                <div id="formularioEdicion" style="display: none">
                    <!-- Campo de código editable -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo">
                            Código
                        </label>
                        <input type="text" id="codigoEditado"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreEditar">
                            Nombre:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="nombreEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaEditar">
                            Categoría:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="categoriaEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="marcaEditar">
                            Marca/Proveedor:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="marcaEditar" type="text" required />
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="unidadEditar">
                            Unidad:
                        </label>
                        <input type="text" id="unidadEditar"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="flex items-center justify-between">
                        <button id="guardarCambios"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Guardar Cambios
                        </button>
                        <button id="eliminarProducto"
                            class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Eliminar Producto
                        </button>
                    </div>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
            <div id="scanner-container-editar" class="mt-4" style="display: none">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>
        </div>

        <!-- Pestaña Edición por Tabla -->
        <div id="content-editar-tabla" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Edición por Tabla</h3>
                <form id="formBuscarTabla" class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoBuscarTabla">
                        Buscar por Código de Producto Primario o Subproducto:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="codigoBuscarTabla" type="text" placeholder="Ej: 1234 o 201670000004" required />
                    <button type="submit"
                        class="mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Buscar</button>
                </form>
                <div id="tabla-edicion-resultados"></div>
                <div id="tabla-edicion-resultados"></div>
                <script type="module">
                    import { db, inicializarDB } from '../js/db-operations.js';
                    import { obtenerRelacionesProductosSupabase, buscarRelacionProducto } from '../js/relaciones-productos.js';
                    // Exponer para main.js si se requiere (opcional)
                    window.obtenerRelacionesProductosSupabase = obtenerRelacionesProductosSupabase;
                    window.buscarRelacionProducto = buscarRelacionProducto;

                    // Lógica de búsqueda y edición en tabla
                    document.getElementById('formBuscarTabla').addEventListener('submit', function (e) {
                        e.preventDefault();
                        const codigo = document.getElementById('codigoBuscarTabla').value.trim();
                        const resultadosDiv = document.getElementById('tabla-edicion-resultados');
                        resultadosDiv.innerHTML = `<div class='text-gray-600'>Sincronizando productos y relaciones...</div>`;

                        (async () => {
                            console.log('[DEBUG] db antes de inicializar:', db);
                            let dbReady = db;
                            if (!dbReady) {
                                resultadosDiv.innerHTML = `<div class='text-gray-600'>Inicializando base de datos local...</div>`;
                                try {
                                    await inicializarDB();
                                } catch (err) {
                                    console.error('[DEBUG] Error al inicializarDB:', err);
                                }
                                dbReady = db;
                                console.log('[DEBUG] db después de inicializar:', dbReady);
                            }
                            if (!dbReady) {
                                console.error('[DEBUG] IndexedDB sigue sin inicializar tras inicializarDB.');
                                resultadosDiv.innerHTML = `<div class='text-red-600'>IndexedDB no inicializado.</div>`;
                                return;
                            }
                            // 1. Sincronizar productos desde Supabase a IndexedDB y obtener relaciones
                            Promise.all([
                                importarProductosSupabaseAIndexedDB(dbReady),
                                obtenerRelacionesProductosSupabase()
                            ]).then(([_, relaciones]) => {
                                // 2. Buscar relación en el Map
                                const relacion = buscarRelacionProducto(codigo, relaciones);
                                // 3. Buscar detalles de productos en IndexedDB
                                buscarProductosRelacionadosConMap(dbReady, codigo, relacion, resultadosDiv);
                            }).catch(err => {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al sincronizar: ${err.message || err}`;
                            });
                        })();

                        // --- Función para importar productos de Supabase a IndexedDB ---
                        async function importarProductosSupabaseAIndexedDB(dbInstance) {
                            if (!window.getSupabase) throw new Error('No se encontró getSupabase.');
                            const supabase = await window.getSupabase();
                            const { data: productos, error } = await supabase.from('productos').select('*');
                            if (error) throw error;
                            if (!dbInstance) throw new Error('IndexedDB no inicializado');
                            return new Promise((resolve, reject) => {
                                const transaction = dbInstance.transaction(['productos'], 'readwrite');
                                const objectStore = transaction.objectStore('productos');
                                const clearReq = objectStore.clear();
                                clearReq.onsuccess = function () {
                                    productos.forEach(prod => {
                                        const p = {
                                            codigo: prod.codigo,
                                            nombre: prod.nombre,
                                            categoria: prod.categoria,
                                            marca: prod.marca,
                                            unidad: prod.unidad
                                        };
                                        objectStore.put(p);
                                    });
                                    transaction.oncomplete = resolve;
                                    transaction.onerror = reject;
                                };
                                clearReq.onerror = reject;
                            });
                        }

                        // --- Función para buscar productos relacionados usando el Map de relaciones ---
                        function buscarProductosRelacionadosConMap(dbInstance, codigo, relacion, resultadosDiv) {
                            const transaction = dbInstance.transaction(['productos'], 'readonly');
                            const objectStore = transaction.objectStore('productos');
                            const getAllReq = objectStore.getAll();
                            getAllReq.onsuccess = function (e) {
                                const productos = e.target.result;
                                // Buscar producto exacto (por código completo o 4 dígitos)
                                let producto = productos.find(p => p.codigo === codigo || p.codigo.endsWith(codigo));
                                if (!producto) {
                                    resultadosDiv.innerHTML = `<div class='text-red-600'>No se encontró el producto <b>${codigo}</b>.</div>`;
                                    return;
                                }
                                // Buscar principal y subproductos según el Map
                                let productoPrincipal = null;
                                let subproductos = [];
                                if (relacion.tipo === 'principal') {
                                    productoPrincipal = producto;
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                } else if (relacion.tipo === 'subproducto') {
                                    productoPrincipal = productos.find(p => p.codigo === relacion.principal);
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                }
                                // Mostrar resultados
                                let html = '';
                                // Producto encontrado (si es principal, mostrar botón editar principal)
                                html += `<div class='mb-4'><b>Producto encontrado:</b><br>${producto.codigo} - ${producto.nombre} (${producto.categoria})<br>Marca: ${producto.marca} | Unidad: ${producto.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${producto.codigo}'>Editar</button></div>`;
                                // Si hay producto principal distinto, mostrarlo con botón editar
                                if (productoPrincipal && productoPrincipal.codigo !== producto.codigo) {
                                    html += `<div class='mb-4'><b>Producto Principal:</b><br>${productoPrincipal.codigo} - ${productoPrincipal.nombre} (${productoPrincipal.categoria})<br>Marca: ${productoPrincipal.marca} | Unidad: ${productoPrincipal.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${productoPrincipal.codigo}'>Editar</button></div>`;
                                }
                                if (subproductos.length > 0) {
                                    html += `<div class='mb-2'><b>Subproductos relacionados:</b> <button id='expand-relacionados' class='ml-2 px-2 py-1 bg-blue-200 rounded'>Ver relacionados</button></div><ul class='mb-4' id='lista-relacionados' style='display:none;'>`;
                                    subproductos.forEach(sp => {
                                        html += `<li class='mb-1'>${sp.codigo} - ${sp.nombre} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${sp.codigo}'>Editar</button></li>`;
                                    });
                                    html += '</ul>';
                                }
                                resultadosDiv.innerHTML = html;
                                // Botón para expandir/collapse relacionados
                                const expandBtn = resultadosDiv.querySelector('#expand-relacionados');
                                const listaRelacionados = resultadosDiv.querySelector('#lista-relacionados');
                                if (expandBtn && listaRelacionados) {
                                    expandBtn.addEventListener('click', () => {
                                        listaRelacionados.style.display = listaRelacionados.style.display === 'none' ? 'block' : 'none';
                                        expandBtn.textContent = listaRelacionados.style.display === 'none' ? 'Ver relacionados' : 'Ocultar relacionados';
                                    });
                                }
                                // Agregar listeners a los botones de edición
                                resultadosDiv.querySelectorAll('.edit-btn').forEach(btn => {
                                    btn.addEventListener('click', function () {
                                        const codigoEditar = btn.dataset.codigo;
                                        // Buscar el producto en la lista de productos
                                        const prod = productos.find(p => p.codigo === codigoEditar);
                                        if (!prod) {
                                            Swal.fire('Error', 'No se encontró el producto en la base local.', 'error');
                                            return;
                                        }
                                        // Rellenar el formulario de edición individual
                                        document.getElementById('codigoEditar').value = prod.codigo;
                                        document.getElementById('codigoEditado').value = prod.codigo;
                                        document.getElementById('nombreEditar').value = prod.nombre;
                                        document.getElementById('categoriaEditar').value = prod.categoria;
                                        document.getElementById('marcaEditar').value = prod.marca;
                                        document.getElementById('unidadEditar').value = prod.unidad;
                                        // Mostrar el formulario de edición si está oculto
                                        document.getElementById('formularioEdicion').style.display = '';
                                        // Cambiar a la pestaña de Edición Individual
                                        const tabButtons = document.querySelectorAll('.tab-button');
                                        const tabContents = document.querySelectorAll('.tab-content');
                                        tabButtons.forEach(btn => {
                                            btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                                            btn.classList.add('border-transparent', 'text-gray-500');
                                        });
                                        tabContents.forEach(content => {
                                            content.style.display = 'none';
                                        });
                                        document.getElementById('tab-editar-individual').classList.add('active', 'border-blue-500', 'text-blue-600');
                                        document.getElementById('tab-editar-individual').classList.remove('border-transparent', 'text-gray-500');
                                        document.getElementById('content-editar-individual').style.display = 'block';
                                        // Scroll al formulario de edición
                                        document.getElementById('formEditarProducto').scrollIntoView({ behavior: 'smooth' });
                                    });
                                });
                            };
                            getAllReq.onerror = function () {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al buscar productos en IndexedDB.</div>`;
                            };
                        }
                    });
                </script>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Pestañas
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            function switchTab(targetTab) {
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });
                const activeButton = document.getElementById(`tab-${targetTab}`);
                activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');
                document.getElementById(`content-${targetTab}`).style.display = 'block';
            }
            document.getElementById('tab-editar-individual').addEventListener('click', () => switchTab('editar-individual'));
            document.getElementById('tab-editar-tabla').addEventListener('click', () => switchTab('editar-tabla'));

            // Aplicar conversión de guión a ceros en campos de código
            const codigoEditar = document.getElementById('codigoEditar');
            const codigoEditado = document.getElementById('codigoEditado');
            const codigoBuscarTabla = document.getElementById('codigoBuscarTabla');
            aplicarConversionCodigo(codigoEditar);
            aplicarConversionCodigo(codigoEditado);
            aplicarConversionCodigo(codigoBuscarTabla);


        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link href="../librerías/tailwind.min.css" rel="stylesheet">
    <script src="../librerías/sweetalert2@11.js"></script>
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Inventario</h1>
        <div class="flex items-center space-x-4">
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="inventario" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6 dark-theme-title">Inventario</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Nuevo div para mostrar la ubicación actual -->
        <div class="mb-4 p-4 bg-white shadow-md rounded">
            <h2 class="text-xl font-bold mb-2">Ubicación Actual: <span id="ubicacionActual"></span></h2>
            <button id="cambiarUbicacion" class="bg-yellow-500 text-white px-4 py-2">Cambiar Ubicación</button>
        </div>

        <!-- Pestañas principales de inventario -->
        <div class="mb-6">
            <div class="flex border-b bg-white shadow-sm rounded-t-lg">
                <button id="tabInventarioManual"
                    class="px-6 py-3 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500 font-semibold">
                    📦 Inventario Manual
                </button>
                <button id="tabLotesAvanzado"
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300 font-semibold">
                    🚀 Inventario por Lotes Avanzado
                </button>
            </div>
        </div>

        <!-- Contenido de Inventario Manual -->
        <div id="contenidoInventarioManual" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <!-- Formulario de búsqueda de inventario -->
            <div class="mb-4">
                <label for="codigo" class="block mb-2">Código/PLU:</label>
                <div class="flex">
                    <input type="text" id="codigo" class="border p-2 w-full">
                    <button id="escanearBtn" class="bg-blue-500 text-white px-4 py-2 ml-2">Escanear Código</button>
                </div>
            </div>

            <div class="mb-4">
                <label for="nombreInventario" class="block mb-2">Nombre:</label>
                <input type="text" id="nombreInventario" class="border p-2 w-full">
            </div>

            <div class="mb-4">
                <label for="marcaInventario" class="block mb-2">Marca:</label>
                <input type="text" id="marcaInventario" class="border p-2 w-full">
            </div>

            <button id="buscarInventario" class="bg-green-500 text-white px-4 py-2 mb-4">Buscar Producto</button>

            <div id="resultadosInventario" class="mt-4" style="display: none;">
                <!-- Los resultados de la búsqueda se mostrarán aquí -->
            </div>

            <div id="datosInventario" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
                <!-- Pestañas para productos tipo Kg -->
                <div id="tabsContainer" class="mb-6" style="display: none;">
                    <div class="flex border-b">
                        <button id="tabInventario"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            Inventario Normal
                        </button>
                        <button id="tabLotes"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            Lotes
                        </button>
                    </div>
                </div>

                <!-- Formulario de inventario normal -->
                <div id="formularioInventarioNormal">
                    <div class="mb-4">
                        <label for="codigoProductoInventario" class="block mb-2">Codigo del Producto:</label>
                        <input type="text" id="codigoProductoInventario" class="border p-2 w-full" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="nombreProductoInventario" class="block mb-2">Nombre del Producto:</label>
                        <input type="text" id="nombreProductoInventario" class="border p-2 w-full" readonly>
                    </div>

                    <div class="mb-4">
                        <label for="unidadProducto" class="block mb-2">Unidad:</label>
                        <input type="text" id="unidadProducto" class="border p-2 w-full" readonly>
                        <!-- Mostrar la unidad como texto -->
                    </div>

                    <div class="mb-4">
                        <label for="cantidad" class="block mb-2">Cantidad:</label>
                        <input type="number" id="cantidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-4">
                        <label for="fechaCaducidad" class="block mb-2">Fecha de Caducidad:</label>
                        <input type="date" id="fechaCaducidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-6">
                        <label for="comentarios" class="block mb-2">Comentarios:</label>
                        <textarea id="comentarios" class="border p-2 w-full"></textarea>
                    </div>

                    <div id="botonguardar" class="flex items-center justify-between">
                        <button id="guardarInventario" class="bg-blue-500 text-white px-4 py-2">Guardar
                            Inventario</button>
                    </div>
                    <div id="botonmodificar" class="flex items-center justify-between" style="display: none;">
                        <button id="modificarInventario" class="bg-blue-500 text-white px-4 py-2">Modificar
                            Inventario</button>
                    </div>
                </div>

                <!-- Formulario de escaneo por lotes para productos Kg -->
                <div id="formularioLotes" style="display: none;">
                    <div class="bg-blue-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-bold mb-3 text-blue-800">Información del Producto</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Código:</label>
                                <span id="codigoProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre:</label>
                                <span id="nombreProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Unidad:</label>
                                <span id="unidadProductoLotes" class="text-sm font-semibold text-green-600">Kg</span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoría:</label>
                                <span id="categoriaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Marca:</label>
                                <span id="marcaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label for="precioKilo" class="block text-sm font-medium text-gray-700 mb-2">Precio por Kilo
                            ($):</label>
                        <input type="number" id="precioKilo" step="0.01" min="0"
                            class="border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Ingrese el precio por kilogramo">
                    </div>

                    <div class="text-center">
                        <button id="iniciarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            📱 Iniciar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>

            <div id="mensaje" class="mt-4"></div>

            <div id="scanner-container-inventario" class="mt-4" style="display: none;">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>

            <button id="generarHojaInventario" class="bg-purple-500 text-white px-4 py-2 mt-4">Generar Hoja de
                Inventario</button>
        </div>

        <!-- Contenido de Inventario por Lotes Avanzado -->
        <div id="contenidoLotesAvanzado" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
            <!-- Panel de alerta y configuración -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-yellow-800">Inventario por Lotes Avanzado</h3>
                        <div class="mt-2 text-sm text-yellow-700">
                            <ul class="list-disc list-inside space-y-1">
                                <li>Solo se pueden contar productos con unidad tipo <strong>Kg</strong></li>
                                <li>El escaneo será automático sin necesidad de búsqueda previa</li>
                                <li>Se extraerán automáticamente PLU, peso y precio desde códigos CODE128</li>
                                <li>Los productos se agruparán por productos primarios y subproductos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel de configuración -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-4 text-gray-800">⚙️ Configuración de Escaneo</h3>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="confirmarProductosSimilares"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                        <label for="confirmarProductosSimilares" class="text-sm font-medium text-gray-700">
                            Mostrar ventana de confirmación para productos similares
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="agruparAutomaticamente"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="agruparAutomaticamente" class="text-sm font-medium text-gray-700">
                            Agrupar automáticamente productos con el mismo PLU
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="sonidoConfirmacion"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="sonidoConfirmacion" class="text-sm font-medium text-gray-700">
                            Reproducir sonido de confirmación al escanear
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="relacionarProductos"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="relacionarProductos" class="text-sm font-medium text-gray-700">
                            Relacionar productos (buscar en productos_subproductos)
                        </label>
                    </div>
                </div>
            </div>

            <!-- Botón para iniciar escaneo -->
            <div class="text-center mb-6">
                <button id="iniciarEscaneoLotesAvanzado"
                    class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform hover:scale-105 transition duration-200">
                    🚀 Iniciar Escaneo por Lotes Avanzado
                </button>
            </div>

            <!-- Área de resultados de productos escaneados -->
            <div id="resultadosLotesAvanzado" class="hidden">
                <h3 class="text-lg font-bold mb-4 text-gray-800">📊 Productos Escaneados</h3>
                <div id="contenedorProductosPrimarios" class="space-y-4">
                    <!-- Las tarjetas de productos primarios se mostrarán aquí -->
                </div>

                <!-- Botón para guardar inventario -->
                <div class="text-center mt-6">
                    <button id="guardarInventarioLotesAvanzado"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled>
                        💾 Guardar Inventario
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes Avanzado -->
        <div id="modalEscaneoLotesAvanzado"
            class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
            <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-5xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-900">🚀 Escaneo por Lotes Avanzado</h3>
                        <button id="cerrarModalLotesAvanzado" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscanerAvanzado"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListadoAvanzado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Productos Escaneados (<span id="contadorProductosAvanzado">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscanerAvanzado" class="mb-4">
                        <div id="scanner-container-lotes-avanzado" class="mb-4">
                            <div id="reader-lotes-avanzado" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="accionEscaneoLotesAvanzado"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-bold"
                                style="user-select:none;">
                                Activar escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListadoAvanzado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Nombre</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio/Kg</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Tipo</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoProductosAvanzado">
                                    <!-- Los productos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total productos: <span id="totalProductosAvanzado" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotalAvanzado" class="font-bold">0.000 Kg</span> |
                            Productos primarios: <span id="totalProductosPrimarios" class="font-bold">0</span>
                        </div>
                        <button id="finalizarEscaneoLotesAvanzado"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes Avanzado
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Edición de Producto de Lote -->
        <div id="modalEdicionProductoLote" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 10000;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-md shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">✏️ Editar Producto Escaneado</h3>
                        <button onclick="cerrarModalEdicionProducto()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Información del producto -->
                    <div class="mb-4 p-3 bg-gray-50 rounded">
                        <p class="text-sm"><strong>Producto:</strong> <span id="editProductoNombre" class="font-medium"></span></p>
                        <p class="text-sm"><strong>Código:</strong> <span id="editProductoCodigo" class="font-mono"></span></p>
                        <p class="text-sm"><strong>PLU:</strong> <span id="editProductoPLU" class="font-mono"></span></p>
                        <input type="hidden" id="editProductoId">
                    </div>

                    <!-- Campos editables -->
                    <div class="space-y-4">
                        <!-- Precio por Kilo -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                💰 Precio por Kilo ($)
                            </label>
                            <input type="number" id="editPrecioKilo" step="0.01" min="0.01"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el precio por kilo era diferente al momento de crear la etiqueta
                            </p>
                        </div>

                        <!-- Peso -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                ⚖️ Peso (Kg)
                            </label>
                            <input type="number" id="editPeso" step="0.001" min="0.001"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.000">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el peso calculado no es correcto (recalcula precio automáticamente)
                            </p>
                        </div>

                        <!-- Precio de Porción (solo lectura, se actualiza automáticamente) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                🏷️ Precio de Porción ($)
                            </label>
                            <input type="number" id="editPrecioPorcion" step="0.01" min="0.01" readonly
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                ℹ️ Se calcula automáticamente: Precio/Kg × Peso
                            </p>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="cerrarModalEdicionProducto()"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button onclick="guardarEdicionProducto()"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            💾 Guardar Cambios
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Información de Producto -->
        <div id="modalInfoProducto" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 9999;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">📋 Información del Producto</h3>
                        <button id="cerrarModalInfoProducto" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Contenido del modal -->
                    <div id="contenidoInfoProducto">
                        <!-- Se llenará dinámicamente -->
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button id="cancelarInfoProducto"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button id="guardarInfoProducto"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            Guardar Info
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes (original) -->
        <div id="modalEscaneoLotes" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
            style="display: none;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">Escaneo por Lotes</h3>
                        <button id="cerrarModalLotes" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscaner"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Códigos Escaneados (<span id="contadorCodigos">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscaner" class="mb-4">
                        <div id="scanner-container-lotes" class="mb-4">
                            <div id="reader-lotes" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="pararEscaneoLotes"
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                                Pausar Escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código Completo</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoCodigosEscaneados">
                                    <!-- Los códigos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total de códigos: <span id="totalCodigos" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotal" class="font-bold">0.00 Kg</span> |
                            Valor total porciones: <span id="precioTotalGeneral" class="font-bold">$0.00</span>
                        </div>
                        <button id="finalizarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- tabla de productos en inventario -->
    <div>
        <button id="sync-inventario-down-btn"
            class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Inventario desde Supabase
        </button>
        <button id="sincronizarManual" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Ahora
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4"> Productos en Inventario </h2>
        <div class="overflow-x-auto">
            <table id="estructura-plantilla" class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">Código</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categoría</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Tipo de Cantidad</th>
                        <th class="py-3 px-6 text-left">Cantidad</th>
                        <th class="py-3 px-6 text-left">Fecha de Caducidad</th>
                        <th class="py-3 px-6 text-left">Comentarios</th>
                        <th class="py-3 px-6 text-left">ubicacion</th>
                    </tr>
                </thead>
                <tbody id="estructuraPlantillaBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/scanner/lotes-avanzado.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;

            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);

                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;

                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversión a los campos de código cuando se cargue la página
        document.addEventListener('DOMContentLoaded', function () {
            const codigo = document.getElementById('codigo');
            const codigoProductoInventario = document.getElementById('codigoProductoInventario');

            aplicarConversionCodigo(codigo);
            // Note: codigoProductoInventario es readonly, pero aplicamos por si acaso
            aplicarConversionCodigo(codigoProductoInventario);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Sistema de Gestión de Productos</h1>
        <div class="flex items-center space-x-4">
            <!-- Indicador de estado del backend -->
            <div id="backendStatus" class="px-3 py-1 rounded-full text-sm font-semibold" 
                 title="Estado de conexión con el backend"
                 style="background-color: #fbbf24; color: #78350f;">
                ⏳ Verificando...
            </div>
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t dark-theme-sidebar-footer">
            <button id="logoutBtn" class="w-full bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded dark-theme-button">
                Cerrar Sesión
            </button>
        </div>
    </div>

    <a href="../index.html" class="text-blue-500 hover:underline mb-4 inline-block dark-theme-link">← Regresar</a>
    <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200 dark-theme-menu-toggle">
        Menú
    </button>

    <main class="container mx-auto mt-8">
        <section id="dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div id="consulta" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Consulta de Producto</h2>
                <p class="mb-4 dark-theme-card-text">Busca productos en la base de datos por diferentes criterios.</p>
                <a id="consultaLink" href="./consulta.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Consulta
                    Producto</a>
            </div>

            <div id="editar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Editar Producto</h2>
                <p class="mb-4 dark-theme-card-text">Edita los atributos de los productos existentes en la base de
                    datos.</p>
                <a id="editarLink" href="./editar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Editar
                    Producto</a>
            </div>

            <div id="inventario" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona el inventario de productos con datos adicionales.</p>
                <a id="inventarioLink" href="./inventario.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Inventario</a>
            </div>

            <div id="reporte" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Reporte para Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Genera reportes detallados del inventario de productos.</p>
                <a id="reporteLink" href="./report.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Reporte
                    para Inventario</a>
            </div>

            <div id="agregar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Agregar Productos</h2>
                <p class="mb-4 dark-theme-card-text">Escanea y agrega nuevos productos a la base de datos.</p>
                <a id="agregarLink" href="./agregar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Agregar
                    Productos</a>
            </div>

            <div id="archivos" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Administración de Archivos</h2>
                <p class="mb-4 dark-theme-card-text">Sube o descarga archivos CSV para la base de datos.</p>
                <a id="archivosLink" href="./archivos.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Archivos</a>
            </div>

            <div id="configuraciones" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Configuraciones</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona las configuraciones del sistema, perfil de usuario y
                    preferencias.</p>
                <a id="configuracionesLink" href="./configuraciones.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Configuraciones</a>
            </div>
        </section>
    </main>

    <footer class="bg-blue-600 text-white p-4 mt-8 dark-theme-footer">
        <p class="text-center dark-theme-footer-text">&copy; 2024 Sistema de Gestión de Productos. Todos los derechos
            reservados.</p>
    </footer>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>    <script type="module">
        import { backendStatusMonitor } from '../js/backend-status.js';
        
        // Monitorear estado del backend
        document.addEventListener('DOMContentLoaded', () => {
            const backendStatusEl = document.getElementById('backendStatus');
            
            // Escuchar cambios de estado del backend
            window.addEventListener('backendStatusChanged', (event) => {
                const { available } = event.detail;
                
                if (available) {
                    backendStatusEl.textContent = '🟢 Backend activo';
                    backendStatusEl.style.backgroundColor = '#dcfce7'; // green-100
                    backendStatusEl.style.color = '#166534'; // green-800
                } else {
                    backendStatusEl.textContent = '🔴 Backend no disponible';
                    backendStatusEl.style.backgroundColor = '#fee2e2'; // red-100
                    backendStatusEl.style.color = '#991b1b'; // red-900
                    
                    // Mostrar alerta una sola vez
                    if (!window.backendDownNotified) {
                        setTimeout(() => {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Backend no disponible',
                                text: 'La aplicación funcionará en modo offline. Los cambios se sincronizarán cuando el servidor esté disponible.',
                                allowOutsideClick: false,
                                didOpen: (modal) => {
                                    // Cerrar automáticamente después de 5 segundos
                                    setTimeout(() => {
                                        Swal.close();
                                    }, 5000);
                                }
                            });
                        }, 500);
                        window.backendDownNotified = true;
                    }
                }
            });
            
            // Iniciar monitoreo (cada 30 segundos)
            backendStatusMonitor.startMonitoring(30);
        });
    </script>
    <script type="module">
        import { cerrarSesion } from '../js/auth/auth.js';
        
        // Manejar botón de logout
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    const { value: rememberUser } = await Swal.fire({
                        title: 'Cerrar Sesión',
                        text: '¿Deseas que se recuerde tu usuario para el próximo login?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Sí, recordar usuario',
                        cancelButtonText: 'No, no recordar',
                        allowOutsideClick: false
                    });
                    
                    // Si cancela, no hace nada
                    if (rememberUser === undefined) return;
                    
                    // Llamar función de logout
                    await cerrarSesion(rememberUser === true);
                });
            }
        });
    </script>    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menuToggle');
            const sideMenu = document.getElementById('sideMenu');
            const closeMenu = document.getElementById('closeMenu');
            const menuRoutes = document.getElementById('menuRoutes');
            const routes = [
                { name: 'Consulta de Producto', path: './consulta.html' },
                { name: 'Editar Producto', path: './editar.html' },
                { name: 'Inventario', path: './inventario.html' },
                { name: 'Registro de Entradas', path: './registro-entradas.html' },
                { name: 'Reporte para Inventario', path: './report.html' },
                { name: 'Agregar Productos', path: './agregar.html' },
                { name: 'Administración de Archivos', path: './archivos.html' },
                { name: 'Configuraciones', path: './configuraciones.html' }
            ];

            // Generar las rutas dinámicamente
            routes.forEach(route => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline dark-theme-nav-link">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            // Mostrar el menú
            menuToggle.addEventListener('click', () => {
                sideMenu.classList.remove('-translate-x-full');
            });

            // Ocultar el menú
            closeMenu.addEventListener('click', () => {
                sideMenu.classList.add('-translate-x-full');
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Entradas</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-green-600 text-white p-4 flex justify-between items-center shadow-lg">
        <div class="flex items-center space-x-3">
            <div class="p-2 bg-green-700 rounded-lg">
                📦
            </div>
            <h1 class="text-3xl font-bold tracking-wide">Registro de Entradas</h1>
        </div>
        <div class="flex items-center space-x-6">
            <div id="conexionStatus" class="text-sm flex items-center space-x-2 bg-green-700 px-3 py-1 rounded-full">
                <span class="status-indicator status-success"></span>
                <span>Conectado</span>
            </div>
            <div id="clockDisplay" class="text-sm font-mono bg-green-700 px-3 py-1 rounded-full"></div>
            <div class="text-sm bg-green-700 px-3 py-1 rounded-full">
                <span id="totalEntradas">0</span> entradas registradas
            </div>
        </div>
    </header>
    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform z-50">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>
    <div class="container mx-auto mt-8 p-4">
        <div class="mb-6 flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center space-x-4">
                <h1 class="text-4xl font-bold text-gray-800 flex items-center">
                    📦 Registro de Entradas
                    <span class="ml-3 text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                        Sistema de Gesti�n
                    </span>
                </h1>
            </div>
            <div class="flex items-center space-x-3">
                <a href="./main.html"
                    class="text-green-600 hover:text-green-800 hover:underline font-medium flex items-center space-x-2 transition-colors">
                    <span>←</span>
                    <span>Regresar al Men� Principal</span>
                </a>
                <button id="menuToggle"
                    class="bg-white text-green-600 px-4 py-2 rounded-lg hover:bg-green-50 border-2 border-green-600 font-semibold transition-all hover:shadow-md">
                    📋 Men� de Navegaci�n
                </button>
            </div>
        </div> <!-- Secci�n de b�squeda de productos -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                🔍 Buscar Producto
                <span id="searchStatus" class="ml-3 text-sm"></span>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="ultimaBusqueda"></span>
                </div>
            </h2>

            <div class="grid md:grid-cols-3 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ Buscar por C�digo:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaCodigo"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese c�digo del producto">
                        <button id="buscarPorCodigo"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnCodigoText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 Buscar por Nombre:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaNombre"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese nombre del producto">
                        <button id="buscarPorNombre"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnNombreText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 Buscar por Marca:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaMarca"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese marca del producto">
                        <button id="buscarPorMarca"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnMarcaText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-center">
                <button id="escanearBtn"
                    class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                    <span>📷</span>
                    <span>Escanear C�digo de Barras</span>
                </button>
            </div>

            <!-- Mensaje de b�squeda reciente -->
            <div id="busquedaReciente" class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 rounded"
                style="display: none;">
                <p class="text-sm text-blue-700">
                    <strong>B�squeda reciente:</strong> <span id="textoUltimaBusqueda"></span>
                </p>
            </div>
        </div> <!-- Formulario de datos del producto y entrada -->
        <div id="productForm"
            class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover"
            style="display: none;">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                📦 Datos del Producto
                <div id="productLoadingIndicator" class="ml-3" style="display: none;">
                    <div
                        class="inline-block w-4 h-4 border-2 border-green-500 border-t-transparent rounded-full animate-spin">
                    </div>
                    <span class="ml-2">Cargando informaci�n...</span>
                </div>
                <div class="ml-auto">
                    <span class="text-sm text-gray-500 bg-green-100 px-3 py-1 rounded-full">
                        Producto encontrado ✅
                    </span>
                </div>
            </h2>

            <div id="productInfo"
                class="grid md:grid-cols-2 gap-6 mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border-2 border-green-200 shadow-inner">
                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="codigoProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">C�digo del Producto:</span>
                        </label>
                        <input type="text" id="codigoProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-mono text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="nombreProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📝 <span class="ml-2">Nombre del Producto:</span>
                        </label>
                        <input type="text" id="nombreProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-semibold text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="marcaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏢 <span class="ml-2">Marca:</span>
                        </label>
                        <input type="text" id="marcaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="categoriaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📂 <span class="ml-2">Categor�a:</span>
                        </label>
                        <input type="text" id="categoriaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="unidadProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📏 <span class="ml-2">Unidad de Medida:</span>
                        </label>
                        <input type="text" id="unidadProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <!-- Informaci�n adicional del stock actual -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="text-sm font-semibold text-blue-700 mb-2">📊 Stock Actual</h4>
                        <div class="text-2xl font-bold text-blue-600" id="stockActual">--</div>
                        <div class="text-xs text-blue-500">unidades disponibles</div>
                    </div>
                </div>
            </div>
            <div class="border-t-2 border-gray-200 pt-8">
                <h3 class="text-lg font-semibold mb-6 text-green-600 flex items-center">
                    📝 Datos de la Entrada
                    <span class="ml-3 text-sm text-gray-500 bg-yellow-100 px-3 py-1 rounded-full">
                        * Campos obligatorios
                    </span>
                    <div class="ml-auto text-sm text-gray-400">
                        <span id="fechaActual"></span>
                    </div>
                </h3>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="transform transition-all hover:scale-105">
                        <label for="cantidadEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📊 <span class="ml-2">Cantidad Recibida *:</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="cantidadEntrada"
                                class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg font-semibold"
                                min="0.01" step="0.01" required placeholder="0.00">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <span id="unidadMedida">unidades</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">Ingrese la cantidad exacta recibida</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="fechaEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📅 <span class="ml-2">Fecha de Entrada *:</span>
                        </label>
                        <input type="date" id="fechaEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg"
                            required>
                        <div class="text-xs text-gray-500 mt-1">Fecha en que se recibi� el producto</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="loteEntrada" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">N�mero de Lote:</span>
                        </label>
                        <input type="text" id="loteEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                            placeholder="Opcional">
                        <div class="text-xs text-gray-500 mt-1">N�mero de lote del proveedor</div>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="comentariosEntrada"
                        class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        💬 <span class="ml-2">Comentarios y Observaciones:</span>
                    </label>
                    <textarea id="comentariosEntrada"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                        rows="4"
                        placeholder="Informaci�n adicional: estado del producto, observaciones del proveedor, condiciones especiales..."></textarea>
                </div>

                <div class="flex justify-between items-center bg-gray-50 p-4 rounded-lg">
                    <button id="limpiarFormulario"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>🗑️</span>
                        <span>Limpiar Formulario</span>
                    </button>
                    <button id="registrarEntrada"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnRegistrarText">✅ Registrar Entrada</span>
                    </button>
                </div>

                <!-- Resumen de la entrada -->
                <div id="resumenEntrada" class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded"
                    style="display: none;">
                    <h4 class="font-semibold text-blue-700 mb-2">📋 Resumen de la Entrada:</h4>
                    <div id="textoResumen" class="text-sm text-blue-600"></div>
                </div>
            </div>
        </div> <!-- Filtros y controles -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-blue-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-blue-600 flex items-center">
                🔧 Filtros y Controles del Sistema
                <div id="syncStatus" class="ml-3 text-sm"></div>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="estadoSistema" class="bg-green-100 text-green-700 px-3 py-1 rounded-full">
                        Sistema Operativo
                    </span>
                </div>
            </h2>

            <div class="grid md:grid-cols-4 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="filtroCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ <span class="ml-2">Filtrar por C�digo:</span>
                    </label>
                    <input type="text" id="filtroCodigo"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="C�digo del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 <span class="ml-2">Filtrar por Nombre:</span>
                    </label>
                    <input type="text" id="filtroNombre"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Nombre del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 <span class="ml-2">Filtrar por Marca:</span>
                    </label>
                    <input type="text" id="filtroMarca"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Marca del producto...">
                </div>

                <div class="flex items-end space-x-2">
                    <button id="filtrarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🔍</span>
                        <span>Filtrar</span>
                    </button>
                    <button id="limpiarFiltros"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🗑️</span>
                        <span>Limpiar</span>
                    </button>
                </div>
            </div>

            <!-- Filtros de fecha -->
            <div class="grid md:grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-lg">
                <div>
                    <label for="fechaDesde" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Desde:</span>
                    </label>
                    <input type="date" id="fechaDesde"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div>
                    <label for="fechaHasta" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Hasta:</span>
                    </label>
                    <input type="date" id="fechaHasta"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div class="flex items-end">
                    <button id="filtrarPorFecha"
                        class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all w-full">
                        📊 Filtrar por Fechas
                    </button>
                </div>
            </div>

            <div class="flex flex-wrap gap-4 justify-between items-center">
                <div class="flex flex-wrap gap-3">
                    <button id="sincronizarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnSincText">🔄 Sincronizar con Servidor</span>
                    </button>
                    <button id="generarReporte"
                        class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-3 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>📊</span>
                        <span>Generar Reporte CSV</span>
                    </button>
                    <button id="autoRefresh"
                        class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white px-6 py-3 rounded-lg hover:from-indigo-600 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>⚡</span>
                        <span>Auto-actualizaci�n: OFF</span>
                    </button>
                </div>

                <div class="flex items-center space-x-3 text-sm text-gray-600">
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">�ltima sincronizaci�n:</span>
                        <span id="ultimaSync">--:--</span>
                    </div>
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">Estado:</span>
                        <span id="estadoConexion" class="text-green-600">Conectado</span>
                    </div>
                </div>
            </div>
        </div> <!-- Tabla de entradas -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-purple-500 card-hover">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-purple-600 flex items-center">
                        📋 Historial de Entradas del Sistema
                        <div id="tableLoadingIndicator" class="ml-3" style="display: none;">
                            <div
                                class="inline-block w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin">
                            </div>
                            <span class="ml-2 text-sm">Actualizando datos...</span>
                        </div>
                    </h2>
                    <div class="flex items-center space-x-4 mt-2">
                        <p id="contadorEntradas" class="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                            Total: 0 entradas registradas
                        </p>
                        <div class="text-sm text-gray-500">
                            <span id="rangoFechas">Mostrando todas las entradas</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="refreshTable"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Actualizar tabla">
                        <span>🔄</span>
                        <span class="hidden md:inline">Actualizar</span>
                    </button>
                    <button id="exportVisible"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Exportar datos visibles">
                        <span>📥</span>
                        <span class="hidden md:inline">Exportar</span>
                    </button>
                    <button id="expandirTabla"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Expandir/Contraer tabla">
                        <span>⛶</span>
                        <span class="hidden md:inline">Expandir</span>
                    </button>
                </div>
            </div>

            <!-- Barra de b�squeda r�pida -->
            <div class="mb-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <input type="text" id="busquedaRapida"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                        placeholder="🔍 B�squeda r�pida en la tabla...">
                    <select id="ordenarPor"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="fecha-desc">M�s reciente primero</option>
                        <option value="fecha-asc">M�s antiguo primero</option>
                        <option value="cantidad-desc">Mayor cantidad primero</option>
                        <option value="cantidad-asc">Menor cantidad primero</option>
                        <option value="nombre-asc">Nombre A-Z</option>
                        <option value="nombre-desc">Nombre Z-A</option>
                    </select>
                </div>
                <div class="text-sm text-gray-500">
                    <span id="resultadosBusqueda"></span>
                </div>
            </div>

            <div class="overflow-x-auto shadow-lg rounded-lg">
                <table class="min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg">
                    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('codigo')">
                                <div class="flex items-center space-x-1">
                                    <span>🏷️ C�digo</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('nombre')">
                                <div class="flex items-center space-x-1">
                                    <span>📝 Nombre</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('marca')">
                                <div class="flex items-center space-x-1">
                                    <span>🏢 Marca</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('categoria')">
                                <div class="flex items-center space-x-1">
                                    <span>📂 Categor�a</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('unidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📏 Unidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('cantidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📊 Cantidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('fecha')">
                                <div class="flex items-center space-x-1">
                                    <span>📅 Fecha</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                                💬 Comentarios
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ⚙️ Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tablaEntradasBody" class="bg-white divide-y divide-gray-200">
                        <!-- Las entradas se cargar�n din�micamente aqu� -->
                        <tr class="text-center text-gray-500 bg-gray-50">
                            <td colspan="9" class="px-6 py-8">
                                <div class="flex flex-col items-center space-y-3">
                                    <div class="text-4xl">📦</div>
                                    <div class="text-lg font-medium">No hay entradas registradas</div>
                                    <div class="text-sm">Las entradas aparecer�n aqu� cuando se registren productos
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginaci�n -->
            <div class="mt-6 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-600">Mostrar:</span>
                    <select id="registrosPorPagina" class="border border-gray-200 rounded p-1 text-sm">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="text-sm text-gray-600">registros por p�gina</span>
                </div>
                <div id="paginacion" class="flex items-center space-x-2">
                    <!-- Los controles de paginaci�n se generar�n din�micamente -->
                </div>
            </div>
        </div> <!-- Scanner container -->
        <div id="scanner-container"
            class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 backdrop-blur-sm"
            style="display: none;">
            <div
                class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl border-4 border-green-500 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        📷 <span class="ml-2">Esc�ner de C�digo de Barras</span>
                    </h3>
                    <button id="cerrarEscaner"
                        class="text-red-500 hover:text-red-700 text-2xl font-bold transition-colors transform hover:scale-110">
                        ✕
                    </button>
                </div>

                <div class="mb-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                    <p class="text-sm text-blue-700">
                        <strong>Instrucciones:</strong> Coloque el c�digo de barras dentro del marco verde.
                        El esc�ner detectar� autom�ticamente el c�digo.
                    </p>
                </div>

                <div id="reader" class="w-full mb-6 rounded-lg overflow-hidden border-4 border-green-200 shadow-lg">
                </div>

                <div class="flex space-x-3">
                    <button id="detenerEscaner"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 w-full transition-all transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2">
                        <span>🛑</span>
                        <span>Detener Esc�ner</span>
                    </button>
                </div>

                <!-- Estado del esc�ner -->
                <div id="estadoEscaner" class="mt-4 text-center text-sm text-gray-600">
                    <div class="flex items-center justify-center space-x-2">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span>Esc�ner activo - Listo para escanear</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../librer�as/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script src="../js/utils/extension-conflict-detector.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script type="module" src="../js/core/registro-entradas-operations.js"></script>
    <script type="module">
        import { inicializarRegistroEntradas } from '../js/registro-entradas-operations.js';
        import { inicializarDB } from '../js/db-operations.js';
        import { toggleEscaner } from '../js/scanner.js';        // Inicializar cuando el DOM est� cargado
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Inicializar base de datos principal
                await inicializarDB();

                // Inicializar p�gina de registro de entradas
                await inicializarRegistroEntradas();

                // Configurar esc�ner
                const escanearBtn = document.getElementById('escanearBtn');
                if (escanearBtn) {
                    escanearBtn.addEventListener('click', () => {
                        toggleEscaner('busquedaCodigo', 'scanner-container');
                    });
                }

                const cerrarEscaner = document.getElementById('cerrarEscaner');
                const detenerEscaner = document.getElementById('detenerEscaner');

                if (cerrarEscaner) {
                    cerrarEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                if (detenerEscaner) {
                    detenerEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                // Inicializar funcionalidades din�micas
                initializeDynamicFeatures();

                console.log('P�gina de registro de entradas inicializada correctamente');

            } catch (error) {
                console.error('Error al inicializar p�gina de registro de entradas:', error);
            }
        });        // Funcionalidades din�micas
        function initializeDynamicFeatures() {
            // Reloj en tiempo real
            updateClock();
            setInterval(updateClock, 1000);

            // Estado de conexi�n
            updateConnectionStatus();
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);

            // Auto-actualizaci�n
            setupAutoRefresh();

            // Efectos de carga
            setupLoadingEffects();

            // Animaciones de entrada
            setupEntranceAnimations();

            // Notificaciones din�micas
            setupDynamicNotifications();

            // Configurar fecha actual
            setupCurrentDate();

            // B�squeda r�pida en tabla
            setupQuickSearch();

            // Autocompletado
            setupAutoComplete();

            // Atajos de teclado
            setupKeyboardShortcuts();

            // Validaciones en tiempo real
            setupRealTimeValidation();
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            const clockDisplay = document.getElementById('clockDisplay');
            if (clockDisplay) {
                clockDisplay.innerHTML = `${timeString}<br><span class="text-xs">${dateString}</span>`;
            }

            // Actualizar fecha actual en el resumen
            const fechaActual = document.getElementById('fechaActual');
            if (fechaActual) {
                fechaActual.textContent = `Hoy: ${dateString}`;
            }
        }

        function updateConnectionStatus() {
            const statusElement = document.getElementById('conexionStatus');
            const estadoConexion = document.getElementById('estadoConexion');

            if (statusElement || estadoConexion) {
                const isOnline = navigator.onLine;
                const status = isOnline
                    ? '<span class="status-indicator status-success"></span>Conectado'
                    : '<span class="status-indicator status-error"></span>Sin conexi�n';

                if (statusElement) statusElement.innerHTML = status;
                if (estadoConexion) {
                    estadoConexion.textContent = isOnline ? 'Conectado' : 'Sin conexi�n';
                    estadoConexion.className = isOnline ? 'text-green-600' : 'text-red-600';
                }

                // Actualizar estado del sistema
                const estadoSistema = document.getElementById('estadoSistema');
                if (estadoSistema) {
                    if (isOnline) {
                        estadoSistema.className = 'bg-green-100 text-green-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Operativo';
                    } else {
                        estadoSistema.className = 'bg-red-100 text-red-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Offline';
                    }
                }
            }
        }

        function setupCurrentDate() {
            const fechaEntrada = document.getElementById('fechaEntrada');
            if (fechaEntrada && !fechaEntrada.value) {
                const today = new Date().toISOString().split('T')[0];
                fechaEntrada.value = today;
            }
        }

        function setupQuickSearch() {
            const busquedaRapida = document.getElementById('busquedaRapida');
            if (busquedaRapida) {
                busquedaRapida.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#tablaEntradasBody tr');
                    let visibleCount = 0;

                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        const isVisible = text.includes(searchTerm);
                        row.style.display = isVisible ? '' : 'none';
                        if (isVisible && !row.classList.contains('text-center')) visibleCount++;
                    });

                    // Actualizar contador de resultados
                    const resultados = document.getElementById('resultadosBusqueda');
                    if (resultados) {
                        resultados.textContent = searchTerm ?
                            `${visibleCount} resultado${visibleCount !== 1 ? 's' : ''} encontrado${visibleCount !== 1 ? 's' : ''}` :
                            '';
                    }
                });
            }
        }

        function setupAutoComplete() {
            // Autocompletado para campos de b�squeda
            const campos = ['busquedaCodigo', 'busquedaNombre', 'busquedaMarca'];
            campos.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.addEventListener('input', debounce((e) => {
                        // Aqu� se implementar�a la l�gica de autocompletado
                        showAutoCompleteHint(campo, e.target.value);
                    }, 300));
                }
            });
        }

        function showAutoCompleteHint(element, value) {
            if (value.length < 2) return;

            // Simular sugerencias (en producci�n vendr�a de la base de datos)
            const hints = ['Producto A', 'Producto B', 'Marca X', 'Marca Y'];
            const matchingHints = hints.filter(hint =>
                hint.toLowerCase().includes(value.toLowerCase())
            );

            // Mostrar hint visual
            if (matchingHints.length > 0) {
                element.title = `Sugerencia: ${matchingHints[0]}`;
                element.style.borderColor = '#10B981';
            } else {
                element.title = '';
                element.style.borderColor = '';
            }
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl + F para buscar
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    const busquedaRapida = document.getElementById('busquedaRapida');
                    if (busquedaRapida) {
                        busquedaRapida.focus();
                        busquedaRapida.select();
                    }
                }

                // Ctrl + S para sincronizar
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    const sincBtn = document.getElementById('sincronizarEntradas');
                    if (sincBtn) sincBtn.click();
                }

                // Ctrl + R para actualizar tabla
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    const refreshBtn = document.getElementById('refreshTable');
                    if (refreshBtn) refreshBtn.click();
                }

                // ESC para cerrar modales
                if (e.key === 'Escape') {
                    const scanner = document.getElementById('scanner-container');
                    if (scanner && scanner.style.display !== 'none') {
                        scanner.style.display = 'none';
                    }
                }
            });
        }

        function setupRealTimeValidation() {
            const cantidadInput = document.getElementById('cantidadEntrada');
            if (cantidadInput) {
                cantidadInput.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    const isValid = value > 0;

                    if (isValid) {
                        e.target.classList.remove('border-red-500');
                        e.target.classList.add('border-green-500');
                        updateEntryPreview();
                    } else {
                        e.target.classList.remove('border-green-500');
                        e.target.classList.add('border-red-500');
                    }
                });
            }

            // Validaci�n de fecha
            const fechaInput = document.getElementById('fechaEntrada');
            if (fechaInput) {
                fechaInput.addEventListener('change', (e) => {
                    const selectedDate = new Date(e.target.value);
                    const today = new Date();
                    const maxDate = new Date();
                    maxDate.setDate(today.getDate() + 30); // M�ximo 30 d�as en el futuro

                    if (selectedDate > maxDate) {
                        e.target.classList.add('border-yellow-500');
                        showToast('⚠️ La fecha seleccionada est� muy lejos en el futuro', 'warning');
                    } else {
                        e.target.classList.remove('border-yellow-500');
                        updateEntryPreview();
                    }
                });
            }
        }

        function updateEntryPreview() {
            const codigo = document.getElementById('codigoProducto')?.value;
            const nombre = document.getElementById('nombreProducto')?.value;
            const cantidad = document.getElementById('cantidadEntrada')?.value;
            const fecha = document.getElementById('fechaEntrada')?.value;
            const unidad = document.getElementById('unidadProducto')?.value;

            if (codigo && nombre && cantidad && fecha) {
                const resumen = document.getElementById('resumenEntrada');
                const textoResumen = document.getElementById('textoResumen');

                if (resumen && textoResumen) {
                    textoResumen.innerHTML = `
                        <strong>${nombre}</strong> (${codigo})<br>
                        Cantidad: <strong>${cantidad} ${unidad || 'unidades'}</strong><br>
                        Fecha: <strong>${new Date(fecha).toLocaleDateString('es-ES')}</strong>
                    `;
                    resumen.style.display = 'block';
                }
            }
        }

        // Funci�n auxiliar para debounce
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Funci�n para mostrar mensajes toast
        function showToast(message, type = 'info') {
            // Implementaci�n simple de toast
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-500' :
                    type === 'warning' ? 'bg-yellow-500' :
                        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                } text-white`;
            toast.textContent = message;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Funci�n para ordenar tabla
        function sortTable(column) {
            console.log(`Ordenando por: ${column}`);
            // Aqu� se implementar�a la l�gica de ordenamiento
        } function setupAutoRefresh() {
            let autoRefreshEnabled = false;
            let autoRefreshInterval;

            const autoRefreshBtn = document.getElementById('autoRefresh');
            if (autoRefreshBtn) {
                autoRefreshBtn.addEventListener('click', () => {
                    autoRefreshEnabled = !autoRefreshEnabled;

                    if (autoRefreshEnabled) {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: ON</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');

                        autoRefreshInterval = setInterval(() => {
                            refreshTableData();
                            updateLastSyncTime();
                        }, 30000); // Cada 30 segundos

                        showToast('✅ Auto-actualizaci�n activada', 'success');
                    } else {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: OFF</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');

                        if (autoRefreshInterval) {
                            clearInterval(autoRefreshInterval);
                        }
                        showToast('⏸️ Auto-actualizaci�n desactivada', 'info');
                    }
                });
            }
        }

        function updateLastSyncTime() {
            const ultimaSync = document.getElementById('ultimaSync');
            if (ultimaSync) {
                const now = new Date();
                ultimaSync.textContent = now.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function setupLoadingEffects() {
            // Interceptar clicks en botones de b�squeda
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        const textId = btnId.replace('buscar', 'btn') + 'Text';
                        showButtonLoading(btn, textId, '🔍 Buscando...');

                        // Simular b�squeda exitosa
                        setTimeout(() => {
                            hideButtonLoading(btn, textId, '🔍 Buscar');
                            updateSearchHistory(btnId);
                        }, 2000);
                    });
                }
            });

            // Interceptar registro de entrada
            const registrarBtn = document.getElementById('registrarEntrada');
            if (registrarBtn) {
                registrarBtn.addEventListener('click', () => {
                    showButtonLoading(registrarBtn, 'btnRegistrarText', '⏳ Registrando entrada...');

                    setTimeout(() => {
                        hideButtonLoading(registrarBtn, 'btnRegistrarText', '✅ Registrar Entrada');
                        showToast('✅ Entrada registrada exitosamente', 'success');
                        updateEntryCounter();
                    }, 3000);
                });
            }

            // Interceptar sincronizaci�n
            const sincBtn = document.getElementById('sincronizarEntradas');
            if (sincBtn) {
                sincBtn.addEventListener('click', () => {
                    showButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizando con servidor...');

                    setTimeout(() => {
                        hideButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizar con Servidor');
                        showToast('✅ Sincronizaci�n completada', 'success');
                        updateLastSyncTime();
                    }, 4000);
                });
            }

            // Interceptar actualizaci�n de tabla
            const refreshBtn = document.getElementById('refreshTable');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    const indicator = document.getElementById('tableLoadingIndicator');
                    if (indicator) {
                        indicator.style.display = 'block';
                        setTimeout(() => {
                            indicator.style.display = 'none';
                            showToast('🔄 Tabla actualizada', 'info');
                        }, 2000);
                    }
                });
            }
        }

        function updateSearchHistory(searchType) {
            const busquedaReciente = document.getElementById('busquedaReciente');
            const textoUltimaBusqueda = document.getElementById('textoUltimaBusqueda');

            if (busquedaReciente && textoUltimaBusqueda) {
                const tipoTexto = {
                    'buscarPorCodigo': 'B�squeda por c�digo',
                    'buscarPorNombre': 'B�squeda por nombre',
                    'buscarPorMarca': 'B�squeda por marca'
                };

                const now = new Date().toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                textoUltimaBusqueda.textContent = `${tipoTexto[searchType]} a las ${now}`;
                busquedaReciente.style.display = 'block';

                // Ocultar despu�s de 10 segundos
                setTimeout(() => {
                    busquedaReciente.style.display = 'none';
                }, 10000);
            }
        }

        function updateEntryCounter() {
            const contador = document.getElementById('contadorEntradas');
            const totalEntradas = document.getElementById('totalEntradas');

            if (contador) {
                const currentCount = parseInt(contador.textContent.match(/\d+/) || [0])[0];
                const newCount = currentCount + 1;
                contador.textContent = `Total: ${newCount} entradas registradas`;

                // Animaci�n del contador
                contador.classList.add('animate-pulse');
                setTimeout(() => {
                    contador.classList.remove('animate-pulse');
                }, 1000);
            }

            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                totalEntradas.textContent = currentCount + 1;
            }
        }

        function showButtonLoading(button, textElementId = null, loadingText = 'Cargando...') {
            button.disabled = true;
            button.classList.add('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
                }
            } else {
                button.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
            }
        }

        function hideButtonLoading(button, textElementId = null, originalText = 'Buscar') {
            button.disabled = false;
            button.classList.remove('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.textContent = originalText;
                }
            } else {
                button.textContent = originalText;
            }
        } function setupEntranceAnimations() {
            // Animar elementos cuando aparecen
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-fade-in-up');

                        // A�adir un peque�o retraso para elementos consecutivos
                        const siblings = Array.from(entry.target.parentElement.children);
                        const index = siblings.indexOf(entry.target);
                        entry.target.style.animationDelay = `${index * 0.1}s`;
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            // Observar todas las tarjetas
            document.querySelectorAll('.card-hover').forEach(card => {
                observer.observe(card);
            });

            // Animaciones para botones al hacer hover
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('mouseenter', () => {
                    if (!button.disabled) {
                        button.style.transform = 'translateY(-2px)';
                        button.style.boxShadow = '0 10px 25px rgba(0,0,0,0.2)';
                    }
                });

                button.addEventListener('mouseleave', () => {
                    button.style.transform = 'translateY(0)';
                    button.style.boxShadow = '';
                });
            });

            // Animaci�n de aparecer para modales
            const scanner = document.getElementById('scanner-container');
            if (scanner) {
                const originalDisplay = scanner.style.display;
                scanner.addEventListener('click', (e) => {
                    if (e.target === scanner) {
                        // Cerrar al hacer click fuera del modal
                        hideModal(scanner);
                    }
                });
            }
        }

        function showModal(modal) {
            modal.style.display = 'flex';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.transition = 'all 0.3s ease';
                modal.style.opacity = '1';
                modal.style.transform = 'scale(1)';
            }, 10);
        }

        function hideModal(modal) {
            modal.style.transition = 'all 0.3s ease';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function setupDynamicNotifications() {
            // Mostrar formulario solo cuando se selecciona un producto
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        setTimeout(() => {
                            const productForm = document.getElementById('productForm');
                            const codigoProducto = document.getElementById('codigoProducto');

                            if (productForm && codigoProducto && codigoProducto.value) {
                                // Mostrar formulario con animaci�n
                                productForm.style.display = 'block';
                                productForm.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });

                                // Animaci�n de aparici�n
                                productForm.style.opacity = '0';
                                productForm.style.transform = 'translateY(30px)';

                                setTimeout(() => {
                                    productForm.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                                    productForm.style.opacity = '1';
                                    productForm.style.transform = 'translateY(0)';

                                    // Destacar el formulario brevemente
                                    productForm.classList.add('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    setTimeout(() => {
                                        productForm.classList.remove('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    }, 2000);
                                }, 100);

                                // Actualizar stock actual (simulado)
                                updateStockDisplay();

                                // Focus en el primer campo editable
                                const cantidadInput = document.getElementById('cantidadEntrada');
                                if (cantidadInput) {
                                    setTimeout(() => cantidadInput.focus(), 800);
                                }
                            }
                        }, 500);
                    });
                }
            });

            // Feedback visual en inputs con animaciones mejoradas
            document.querySelectorAll('input, textarea, select').forEach(input => {
                input.addEventListener('focus', (e) => {
                    e.target.style.transform = 'scale(1.02)';
                    e.target.style.transition = 'transform 0.2s ease';

                    // A�adir indicador de foco
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '#10B981';
                        label.style.transform = 'scale(1.05)';
                        label.style.transition = 'all 0.2s ease';
                    }
                });

                input.addEventListener('blur', (e) => {
                    e.target.style.transform = 'scale(1)';

                    // Restaurar label
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '';
                        label.style.transform = 'scale(1)';
                    }
                });

                // Validaci�n visual en tiempo real
                if (input.type === 'number') {
                    input.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        if (value > 0) {
                            e.target.style.borderColor = '#10B981';
                            e.target.style.backgroundColor = '#F0FDF4';
                        } else if (e.target.value) {
                            e.target.style.borderColor = '#EF4444';
                            e.target.style.backgroundColor = '#FEF2F2';
                        } else {
                            e.target.style.borderColor = '';
                            e.target.style.backgroundColor = '';
                        }
                    });
                }
            });

            // Animaciones para las filas de la tabla
            setupTableRowAnimations();

            // Notificaciones de estado del sistema
            setupSystemStatusNotifications();
        }

        function updateStockDisplay() {
            const stockActual = document.getElementById('stockActual');
            if (stockActual) {
                // Simular datos de stock
                const stock = Math.floor(Math.random() * 500) + 10;
                stockActual.textContent = stock;

                // Animaci�n del contador
                stockActual.style.transform = 'scale(1.2)';
                stockActual.style.transition = 'transform 0.3s ease';

                setTimeout(() => {
                    stockActual.style.transform = 'scale(1)';
                }, 300);

                // Color basado en el stock
                if (stock < 50) {
                    stockActual.className = 'text-2xl font-bold text-red-600';
                    stockActual.parentElement.className = 'bg-red-50 p-4 rounded-lg border border-red-200';
                } else if (stock < 100) {
                    stockActual.className = 'text-2xl font-bold text-yellow-600';
                    stockActual.parentElement.className = 'bg-yellow-50 p-4 rounded-lg border border-yellow-200';
                } else {
                    stockActual.className = 'text-2xl font-bold text-green-600';
                    stockActual.parentElement.className = 'bg-green-50 p-4 rounded-lg border border-green-200';
                }
            }
        }

        function setupTableRowAnimations() {
            // Observador para filas de tabla
            const tableObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeName === 'TR' && !node.classList.contains('text-center')) {
                                // Animar nueva fila
                                node.style.opacity = '0';
                                node.style.transform = 'translateX(-20px)';

                                setTimeout(() => {
                                    node.style.transition = 'all 0.5s ease';
                                    node.style.opacity = '1';
                                    node.style.transform = 'translateX(0)';
                                }, 100);

                                // Efectos hover mejorados
                                node.addEventListener('mouseenter', () => {
                                    node.style.backgroundColor = '#F0FDF4';
                                    node.style.transform = 'scale(1.01)';
                                    node.style.transition = 'all 0.2s ease';
                                    node.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
                                });

                                node.addEventListener('mouseleave', () => {
                                    node.style.backgroundColor = '';
                                    node.style.transform = 'scale(1)';
                                    node.style.boxShadow = '';
                                });
                            }
                        });
                    }
                });
            });

            const tableBody = document.getElementById('tablaEntradasBody');
            if (tableBody) {
                tableObserver.observe(tableBody, { childList: true });
            }
        }

        function setupSystemStatusNotifications() {
            // Notificaciones peri�dicas de estado
            setInterval(() => {
                if (Math.random() < 0.1) { // 10% de probabilidad cada minuto
                    const messages = [
                        '✅ Sistema funcionando correctamente',
                        '📊 Base de datos sincronizada',
                        '🔄 Datos actualizados autom�ticamente',
                        '📈 Rendimiento �ptimo del sistema'
                    ];

                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    showToast(randomMessage, 'success');
                }
            }, 60000); // Cada minuto
        } function refreshTableData() {
            const indicator = document.getElementById('tableLoadingIndicator');
            if (indicator) {
                indicator.style.display = 'block';

                // Simular carga de datos
                setTimeout(() => {
                    indicator.style.display = 'none';
                    updateLastSyncTime();

                    // Actualizar contador si hay datos
                    const tbody = document.getElementById('tablaEntradasBody');
                    if (tbody) {
                        const rows = tbody.querySelectorAll('tr:not(.text-center)');
                        const contador = document.getElementById('contadorEntradas');
                        if (contador) {
                            contador.textContent = `Total: ${rows.length} entradas registradas`;
                        }
                    }
                }, 2000);
            }

            console.log('Actualizando datos de la tabla...');
        }

        // Efectos adicionales para las filas de la tabla
        function addTableRowEffects() {
            document.querySelectorAll('#tablaEntradasBody tr:not(.text-center)').forEach(row => {
                // Eliminar eventos anteriores para evitar duplicados
                row.removeEventListener('mouseenter', handleRowHover);
                row.removeEventListener('mouseleave', handleRowLeave);

                // A�adir nuevos eventos
                row.addEventListener('mouseenter', handleRowHover);
                row.addEventListener('mouseleave', handleRowLeave);
            });
        }

        function handleRowHover(e) {
            e.target.style.backgroundColor = '#F0FDF4';
            e.target.style.transform = 'scale(1.01)';
            e.target.style.transition = 'all 0.2s ease';
            e.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        }

        function handleRowLeave(e) {
            e.target.style.backgroundColor = '';
            e.target.style.transform = 'scale(1)';
            e.target.style.boxShadow = '';
        }

        // Inicializar mejoras adicionales al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                addTableRowEffects();
                initializeAdditionalFeatures();
            }, 1000);
        });

        // Caracter�sticas adicionales
        function initializeAdditionalFeatures() {
            // Configurar filtros de fecha inteligentes
            setupIntelligentDateFilters();

            // Configurar exportaci�n mejorada
            setupEnhancedExport();

            // Configurar modo expandido de tabla
            setupTableExpandMode();

            // Configurar estad�sticas en tiempo real
            setupRealTimeStats();
        }

        function setupIntelligentDateFilters() {
            const filtrarPorFecha = document.getElementById('filtrarPorFecha');
            if (filtrarPorFecha) {
                filtrarPorFecha.addEventListener('click', () => {
                    const fechaDesde = document.getElementById('fechaDesde').value;
                    const fechaHasta = document.getElementById('fechaHasta').value;

                    if (fechaDesde && fechaHasta) {
                        const rangoFechas = document.getElementById('rangoFechas');
                        if (rangoFechas) {
                            const desde = new Date(fechaDesde).toLocaleDateString('es-ES');
                            const hasta = new Date(fechaHasta).toLocaleDateString('es-ES');
                            rangoFechas.textContent = `Mostrando entradas del ${desde} al ${hasta}`;
                        }
                        showToast(`📅 Filtro aplicado: ${fechaDesde} a ${fechaHasta}`, 'info');
                    } else {
                        showToast('⚠️ Seleccione ambas fechas para filtrar', 'warning');
                    }
                });
            }
        }

        function setupEnhancedExport() {
            const exportBtn = document.getElementById('exportVisible');
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    showToast('📥 Preparando exportaci�n...', 'info');

                    setTimeout(() => {
                        showToast('✅ Datos exportados exitosamente', 'success');
                    }, 2000);
                });
            }
        }

        function setupTableExpandMode() {
            const expandBtn = document.getElementById('expandirTabla');
            let isExpanded = false;

            if (expandBtn) {
                expandBtn.addEventListener('click', () => {
                    const tableContainer = expandBtn.closest('.bg-white');

                    if (!isExpanded) {
                        tableContainer.classList.add('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Contraer</span>';
                        isExpanded = true;
                        showToast('⛶ Tabla expandida', 'info');
                    } else {
                        tableContainer.classList.remove('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Expandir</span>';
                        isExpanded = false;
                        showToast('⛶ Tabla contra�da', 'info');
                    }
                });
            }
        }

        function setupRealTimeStats() {
            // Actualizar estad�sticas cada 30 segundos
            setInterval(() => {
                updateSystemStats();
            }, 30000);

            // Actualizaci�n inicial
            updateSystemStats();
        }

        function updateSystemStats() {
            // Simular actualizaci�n de estad�sticas
            const totalEntradas = document.getElementById('totalEntradas');
            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                if (Math.random() < 0.3) { // 30% de probabilidad de incremento
                    totalEntradas.textContent = currentCount + Math.floor(Math.random() * 3) + 1;
                }
            }
        }

        // CSS para animaciones adicionales
        const additionalStyles = `
            <style>
                .animate-fade-in-up {
                    animation: fadeInUp 0.6s ease-out forwards;
                }
                
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(30px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .status-indicator {
                    display: inline-block;
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    margin-right: 6px;
                }
                
                .status-success {
                    background-color: #10B981;
                    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
                }
                
                .status-error {
                    background-color: #EF4444;
                    box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
                }
                
                .card-hover {
                    transition: all 0.3s ease;
                }
                
                .card-hover:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                }
                
                .loading-spinner {
                    border: 2px solid #f3f3f3;
                    border-top: 2px solid #3498db;
                    border-radius: 50%;
                    width: 16px;
                    height: 16px;
                    animation: spin 1s linear infinite;
                }
                
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                
                /* Efectos de hover mejorados */
                button:not(:disabled):hover {
                    transform: translateY(-1px) !important;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                }
                
                input:focus, textarea:focus, select:focus {
                    transform: scale(1.01);
                    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
                }
                
                /* Animaciones para modales */
                .modal-enter {
                    animation: modalEnter 0.3s ease-out forwards;
                }
                
                @keyframes modalEnter {
                    from {
                        opacity: 0;
                        transform: scale(0.9);
                    }
                    to {
                        opacity: 1;
                        transform: scale(1);
                    }
                }
                
                /* Efectos de tabla mejorados */
                table th {
                    position: relative;
                    overflow: hidden;
                }
                
                table th:hover::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    animation: shimmer 1.5s ease-in-out;
                }
                
                @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
            </style>
        `;

        // A�adir estilos al head
        document.head.insertAdjacentHTML('beforeend', additionalStyles);

        // Llamar despu�s de cargar datos en la tabla
        window.addEventListener('load', () => {
            setTimeout(addTableRowEffects, 1000);
        });

        // Funci�n para convertir gui�n a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Funci�n para aplicar la conversi�n a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversi�n a los campos de c�digo cuando se cargue la p�gina
        document.addEventListener('DOMContentLoaded', function() {
            const busquedaCodigo = document.getElementById('busquedaCodigo');
            const codigoProducto = document.getElementById('codigoProducto');
            const filtroCodigo = document.getElementById('filtroCodigo');
            
            aplicarConversionCodigo(busquedaCodigo);
            aplicarConversionCodigo(codigoProducto);
            aplicarConversionCodigo(filtroCodigo);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Preconteo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <script src="../librer�as/JsBarcode.all.min.js"></script>
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>

    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    </script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-xl font-bold">Reporte de Preconteo</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <nav class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-xl font-bold">GestorInventory</h1>
            <a href="./main.html" class="hover:underline">Regresar</a>
            <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
                Men�
            </button>
        </div>
    </nav>

    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold text-center mb-6">Generador de Reportes de Preconteo</h1>

        <div class="mb-6 bg-white p-4 rounded shadow">
            <div class="mb-4">
                <label class="block font-semibold mb-2">Selecciona una o varias �reas:</label>
                <div id="areasContainer" class="grid grid-cols-2 md:grid-cols-3 gap-2 border rounded p-3">
                    <!-- Las �reas se cargar�n din�micamente como checkboxes -->
                    <div class="flex items-center">
                        <input type="checkbox" id="area-todas" value="todas" class="areaCheckbox mr-2" checked>
                        <label for="area-todas">Todas las �reas</label>
                    </div>
                </div>
                <div class="mt-2 text-right">
                    <button id="aplicarFiltroBtn" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">
                        Aplicar filtro
                    </button>
                </div>
            </div>

            <div id="loadingIndicator" class="hidden">
                <div class="flex items-center justify-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                    <span class="ml-2">Cargando productos...</span>
                </div>
            </div>

            <div id="productosList" class="mt-4">
                <h2 class="text-xl font-semibold mb-2">Lista de productos:</h2>
                <ul id="productosContainer" class="list-decimal pl-6 space-y-1">
                    <!-- Los productos se cargar�n din�micamente -->
                </ul>
            </div>
        </div>

        <div class="text-center">
            <button id="generarReporteBtn"
                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded">
                GENERAR REPORTE DE PRECONTEO
            </button>
        </div>

        <!-- Contenedor invisible para generar c�digos de barras -->
        <div id="barcodeContainer" class="hidden"></div>
    </div>

    <!-- Cargar nuestro script principal despu�s de asegurarnos que las dependencias est�n cargadas -->
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/reports/rep.js"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Recuperar Contraseña</h1>
            
            <form id="formPasswordReset" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Correo Electrónico</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="tu@email.com"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Enviar Enlace de Recuperación
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Recordaste tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restablecer Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Restablecer Contraseña</h1>
            
            <form id="formResetPassword" class="space-y-4">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Nueva Contraseña</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Ingresa tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-300 mb-2">Confirmar Contraseña</label>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        name="confirmPassword" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Confirma tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Restablecer Contraseña
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Ya tienes tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }

        // Manejar reset de contraseña
        document.addEventListener('DOMContentLoaded', async () => {
            const formResetPassword = document.getElementById('formResetPassword');
            
            if (formResetPassword) {
                formResetPassword.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    // Validar que las contraseñas coincidan
                    if (password !== confirmPassword) {
                        alert('Las contraseñas no coinciden');
                        return;
                    }
                    
                    // Validar longitud mínima
                    if (password.length < 6) {
                        alert('La contraseña debe tener al menos 6 caracteres');
                        return;
                    }

                    try {
                        // Obtener el hash del enlace de reseteo de la URL
                        const hash = window.location.hash;
                        
                        if (!hash) {
                            alert('Enlace de recuperación inválido');
                            return;
                        }

                        // Esperar a que Supabase esté disponible
                        let attempts = 0;
                        while (!window.supabase && attempts < 50) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }

                        if (!window.supabase) {
                            alert('Error: No se pudo cargar Supabase');
                            return;
                        }

                        const { error } = await window.supabase.auth.updateUser({
                            password: password
                        });

                        if (error) {
                            alert('Error al actualizar contraseña: ' + error.message);
                            return;
                        }

                        alert('Contraseña actualizada correctamente');
                        window.location.href = '../index.html';
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al restablecer contraseña');
                    }
                });
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesti�n de Archivos - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css" />
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css" />
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Gesti�n de Archivos</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">
                Cerrar
            </button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <div id="archivos" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Gesti�n de Archivos</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Men�
        </button>

        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">
                    Cargar Archivo CSV:
                </label>
                <input type="file" id="csvFile" accept=".csv"
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />
                <div class="mb-4">
                    <button id="descargarCSV"
                        class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                        Exportar Datos a CSV
                    </button>
                </div>
                <div class="mb-4">
                    <button id="resetearBaseDatos"
                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                        Resetear Base de Datos
                    </button>
                </div>
            </div>
        </div>

        <button class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded" id="sync-down-btn">
            Sincronizar en Bajada
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4">Base de Datos Actual</h2>
        <div class="overflow-x-auto">
            <table class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">C�digo</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categor�a</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Unidad</th>
                    </tr>
                </thead>
                <tbody id="databaseBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const menuToggle = document.getElementById("menuToggle");
            const sideMenu = document.getElementById("sideMenu");
            const closeMenu = document.getElementById("closeMenu");
            const menuRoutes = document.getElementById("menuRoutes");

            const routes = [
                { name: "Consulta de Producto", path: "./consulta.html" },
                { name: "Editar Producto", path: "./editar.html" },
                { name: "Inventario", path: "./inventario.html" },
                { name: "Reporte para Inventario", path: "./report.html" },
                { name: "Agregar Productos", path: "./agregar.html" }
            ];

            routes.forEach((route) => {
                const li = document.createElement("li");
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            menuToggle.addEventListener("click", () => {
                sideMenu.classList.remove("-translate-x-full");
            });

            closeMenu.addEventListener("click", () => {
                sideMenu.classList.add("-translate-x-full");
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Nuevo Producto - Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Agregar Nuevo Producto</h1>

    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Agregar Nuevo Producto</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Pestañas -->
        <div class="mb-6 mt-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-individual"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button active">
                        Producto Individual
                    </button>
                    <button id="tab-tabla"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Agregado por Tabla
                    </button>
                    <button id="tab-csv"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Carga por CSV
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenido de Pestañas -->

        <!-- Pestaña Individual (formulario original) -->
        <div id="content-individual" class="tab-content">
            <form id="formAgregarProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo">
                        Código/PLU:
                    </label>
                    <div class="flex">
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            placeholder="Codigo" id="codigoAgregar" type="text" required>
                        <button type="button" id="escanearBtnAgregar"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                            Escanear Código
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nombre">
                        Nombre:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="nombre" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="categoria">
                        Categoría:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="categoria" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="marca">
                        Marca/Proveedor:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="marca" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="marca">
                        Unidad:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="unidad" type="text" required>
                </div>

                <!-- Campo para producto primario (aparece solo cuando unidad es Kg) -->
                <div id="producto-primario-container" class="mb-4" style="display: none;">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-3">
                        <div class="flex items-center mb-2">
                            <svg class="w-5 h-5 text-yellow-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                    clip-rule="evenodd"></path>
                            </svg>
                            <span class="text-yellow-800 font-medium text-sm">Nota importante:</span>
                        </div>
                        <p class="text-yellow-700 text-sm">
                            Si el producto es un subproducto y cuenta con un producto primario,
                            ingresa el código del producto primario en el campo de abajo.
                        </p>
                    </div>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="producto-primario">
                        Código del Producto Primario (opcional):
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="producto-primario" type="text" placeholder="Codigo del Producto Primario">
                </div>
                <div class="flex items-center justify-between">
                    <button
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="submit">
                        Agregar Producto
                    </button>
                </div>
            </form>
        </div>

        <!-- Pestaña Tabla (nueva funcionalidad) -->
        <div id="content-tabla" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <!-- Sección Producto Primario -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">Producto Primario</h3>

                    <!-- Campo código producto primario -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo-primario">
                            Código de Producto Primario:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            placeholder="Ingrese código del producto primario" id="codigo-primario" type="text"
                            required>
                    </div>

                    <!-- Información del producto primario -->
                    <div id="info-producto-primario" class="grid grid-cols-1 md:grid-cols-2 gap-4"
                        style="display: none;">
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Nombre:</label>
                            <input id="primario-nombre"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Categoría:</label>
                            <input id="primario-categoria"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Marca/Proveedor:</label>
                            <input id="primario-marca"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Unidad:</label>
                            <input id="primario-unidad"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                    </div>
                </div>

                <!-- Sección Subproductos -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">Subproductos</h3>
                        <button id="agregar-fila-btn"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                            style="display: none;">
                            + Agregar Nueva Fila
                        </button>
                    </div>

                    <div id="subproductos-container" class="space-y-4">
                        <!-- Las filas de subproductos se generarán dinámicamente -->
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="flex justify-between items-center pt-6 border-t">
                    <button id="limpiar-tabla-btn"
                        class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                        Limpiar Todo
                    </button>
                    <button id="guardar-tabla-btn"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
                        style="display: none;">
                        Guardar Tabla de Productos
                    </button>
                </div>
            </div>
        </div>


        <!-- Pestaña CSV -->
        <div id="content-csv" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Carga Masiva por CSV</h3>
                <form id="csv-upload-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">Selecciona archivo
                            CSV:</label>
                        <input type="file" id="csvFile" accept=".csv"
                            class="block w-full text-sm text-gray-700 border border-gray-300 rounded py-2 px-3"
                            required />
                    </div>
                    <button type="submit"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Cargar y
                        Previsualizar</button>
                </form>
                <div id="csv-preview" class="mt-6" style="display:none;">
                    <h4 class="text-lg font-semibold mb-2">Vista previa de datos</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200" id="csv-table"></table>
                    </div>
                    <button id="csv-upload-confirm"
                        class="mt-4 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Subir al
                        sistema</button>
                </div>
                <div id="csv-error" class="mt-4 text-red-600 font-semibold"></div>
            </div>
        </div>

        <div id="mensaje" class="mt-4"></div>

        <div id="scanner-container-agregar" class="mt-4" style="display: none;">
            <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
            <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script type="module" src="../js/ui/tabla-productos.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            // Reemplazar cada guión (-) con 6 ceros (000000)
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;

            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);

                // Solo actualizar si hay diferencia (para evitar bucles infinitos)
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;

                    // Ajustar posición del cursor
                    // Si se agregaron caracteres, mover el cursor proporcionalmente
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            // También aplicar en blur para asegurar conversión final
            input.addEventListener('blur', function (e) {
                const valorConvertido = convertirGuionACeros(e.target.value);
                e.target.value = valorConvertido;
            });
        }

        // Hacer la función disponible globalmente para tabla-productos.js
        window.aplicarConversionCodigoAInput = aplicarConversionCodigo;

        // Script para pestañas
        document.addEventListener('DOMContentLoaded', function () {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            function switchTab(targetTab) {
                // Remover clase activa de todos los botones
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });

                // Ocultar todo el contenido
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });

                // Activar pestaña seleccionada
                const activeButton = document.getElementById(`tab-${targetTab}`);
                activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');

                // Mostrar contenido correspondiente
                document.getElementById(`content-${targetTab}`).style.display = 'block';
            }

            // Event listeners para los botones de pestañas
            document.getElementById('tab-individual').addEventListener('click', () => switchTab('individual'));
            document.getElementById('tab-tabla').addEventListener('click', () => switchTab('tabla'));
            document.getElementById('tab-csv').addEventListener('click', () => switchTab('csv'));
            // CSV: Lógica de carga y validación
            const csvForm = document.getElementById('csv-upload-form');
            const csvFileInput = document.getElementById('csvFile');
            const csvPreview = document.getElementById('csv-preview');
            const csvTable = document.getElementById('csv-table');
            const csvError = document.getElementById('csv-error');
            const csvUploadConfirm = document.getElementById('csv-upload-confirm');
            let csvData = [];

            function parseCSV(text) {
                const lines = text.trim().split(/\r?\n/);
                const headers = lines[0].split(',').map(h => h.trim());
                const rows = lines.slice(1).map(line => {
                    // Soporta campos con comas entre comillas
                    const regex = /(?:"([^"]*)")|([^,]+)/g;
                    let match, arr = [];
                    let i = 0;
                    while ((match = regex.exec(line)) !== null) {
                        arr.push(match[1] !== undefined ? match[1] : match[2]);
                        i++;
                    }
                    // Si no hay comillas, fallback split normal
                    if (arr.length === 0) arr = line.split(',');
                    return arr.map(x => x ? x.trim() : '');
                });
                return { headers, rows };
            }

            function validateHeaders(headers) {
                const required = ['Codigo', 'Nombre', 'Categoria', 'Marca', 'Unidad'];
                return required.every(h => headers.includes(h));
            }

            csvForm.addEventListener('submit', function (e) {
                e.preventDefault();
                csvError.textContent = '';
                csvPreview.style.display = 'none';
                csvTable.innerHTML = '';
                csvData = [];
                const file = csvFileInput.files[0];
                if (!file) {
                    csvError.textContent = 'Selecciona un archivo CSV.';
                    return;
                }
                const reader = new FileReader();
                reader.onload = function (evt) {
                    const text = evt.target.result;
                    const { headers, rows } = parseCSV(text);
                    if (!validateHeaders(headers)) {
                        csvError.textContent = 'El archivo debe contener los campos: Codigo, Nombre, Categoria, Marca y Unidad.';
                        return;
                    }
                    // Mostrar tabla
                    let html = '<thead><tr>' + headers.map(h => `<th class="px-2 py-1 border">${h}</th>`).join('') + '</tr></thead><tbody>';
                    rows.forEach(row => {
                        html += '<tr>' + row.map(cell => `<td class="px-2 py-1 border">${cell}</td>`).join('') + '</tr>';
                    });
                    html += '</tbody>';
                    csvTable.innerHTML = html;
                    csvPreview.style.display = 'block';
                    csvData = rows.map(row => {
                        let obj = {};
                        headers.forEach((h, i) => obj[h] = row[i]);
                        return obj;
                    });
                };
                reader.readAsText(file);
            });

            csvUploadConfirm.addEventListener('click', function () {
                if (!csvData.length) {
                    csvError.textContent = 'No hay datos para subir.';
                    return;
                }
                // Lógica real para subir a Supabase, omitiendo los que ya existen y agregando usuario_id
                (async () => {
                    try {
                        if (!window.getSupabase) throw new Error('No se encontró getSupabase.');
                        const supabase = await window.getSupabase();
                        // Obtener usuario_id y categoria_id de localStorage
                        const userId = localStorage.getItem('usuario_id');
                        const categoriaId = localStorage.getItem('categoria_id');
                        if (!userId) throw new Error('No se pudo obtener el usuario autenticado.');
                        if (!categoriaId) throw new Error('No se pudo obtener la categoría del usuario.');
                        // 1. Obtener todos los códigos existentes en Supabase
                        const { data: existentes, error: errorExist } = await supabase.from('productos').select('codigo');
                        if (errorExist) throw errorExist;
                        const codigosExistentes = new Set((existentes || []).map(p => p.codigo));
                        // 2. Filtrar productos nuevos
                        const nuevos = csvData.filter(prod => !codigosExistentes.has(prod.Codigo));
                        let omitidos = csvData.length - nuevos.length;
                        // 3. Insertar los nuevos
                        let insertados = 0;
                        if (nuevos.length > 0) {
                            // Mapear campos a los nombres de la tabla e incluir usuario_id y categoria_id
                            const productosInsertar = nuevos.map(prod => ({
                                codigo: prod.Codigo,
                                nombre: prod.Nombre,
                                categoria: prod.Categoria,
                                marca: prod.Marca,
                                unidad: prod.Unidad,
                                usuario_id: userId,
                                categoria_id: categoriaId
                            }));
                            const { error: errorInsert } = await supabase.from('productos').insert(productosInsertar);
                            if (errorInsert) throw errorInsert;
                            insertados = productosInsertar.length;
                        }
                        Swal.fire({
                            icon: 'success',
                            title: 'Carga completada',
                            html: `<b>${insertados}</b> productos agregados.<br><b>${omitidos}</b> productos ya existían y fueron omitidos.`
                        });
                        csvPreview.style.display = 'none';
                        csvTable.innerHTML = '';
                        csvData = [];
                    } catch (err) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error al subir productos',
                            text: err.message || err
                        });
                    }
                })();
            });

            // Aplicar conversión de guión a ceros en campos de código
            // Pestaña Individual
            const codigoIndividual = document.getElementById('codigoAgregar');
            const productoPrimarioIndividual = document.getElementById('producto-primario');

            aplicarConversionCodigo(codigoIndividual);
            aplicarConversionCodigo(productoPrimarioIndividual);

            // Pestaña Tabla
            const codigoPrimarioTabla = document.getElementById('codigo-primario');
            aplicarConversionCodigo(codigoPrimarioTabla);

            // Para los subproductos en la tabla (se aplicará dinámicamente cuando se creen)

            // Inicializar funcionalidad de tabla directamente aquí como backup
            setTimeout(() => {
                try {
                    const limpiarBtn = document.getElementById('limpiar-tabla-btn');
                    if (limpiarBtn) {
                        limpiarBtn.addEventListener('click', function () {
                            console.log('Click en limpiar tabla');
                            if (confirm('¿Está seguro de que desea limpiar todos los datos?')) {
                                document.getElementById('codigo-primario').value = '';
                                document.getElementById('info-producto-primario').style.display = 'none';
                                document.getElementById('subproductos-container').innerHTML = '';
                                document.getElementById('agregar-fila-btn').style.display = 'none';
                                document.getElementById('guardar-tabla-btn').style.display = 'none';
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error en backup de inicialización:', error);
                }
            }, 1000);

            // Script original para mostrar/ocultar el campo de producto primario
            const unidadInput = document.getElementById('unidad');
            const productoPrimarioContainer = document.getElementById('producto-primario-container');
            const form = document.getElementById('formAgregarProducto');

            function toggleProductoPrimario() {
                if (unidadInput && productoPrimarioContainer) {
                    const unidad = unidadInput.value.toLowerCase().trim();
                    if (unidad === 'kg') {
                        productoPrimarioContainer.style.display = 'block';
                    } else {
                        productoPrimarioContainer.style.display = 'none';
                        // Limpiar el campo si se oculta
                        const productoPrimarioInput = document.getElementById('producto-primario');
                        if (productoPrimarioInput) {
                            productoPrimarioInput.value = '';
                        }
                    }
                }
            }

            // Agregar event listener al campo unidad
            if (unidadInput) {
                unidadInput.addEventListener('input', toggleProductoPrimario);
                unidadInput.addEventListener('change', toggleProductoPrimario);
            }

            // Ocultar el campo cuando se resetee el formulario
            if (form) {
                form.addEventListener('reset', function () {
                    setTimeout(() => {
                        if (productoPrimarioContainer) {
                            productoPrimarioContainer.style.display = 'none';
                        }
                    }, 10); // Pequeño delay para asegurar que el reset se complete
                });
            }
        });
    </script>
    <style>
        .tab-button.active {
            border-color: #3b82f6;
            color: #2563eb;
        }

        .subproducto-row {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            background-color: #f9fafb;
        }

        .campo-readonly {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }

        .producto-existente {
            background-color: #dcfce7;
            border-color: #16a34a;
        }

        .producto-nuevo {
            background-color: #fef3c7;
            border-color: #d97706;
        }
    </style>
</body>

</html>
<!DOCTYPE html>    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesti�n de Archivos - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css" />
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css" />
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Gesti�n de Archivos</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">
                Cerrar
            </button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <div id="archivos" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Gesti�n de Archivos</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Men�
        </button>

        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">
                    Cargar Archivo CSV:
                </label>
                <input type="file" id="csvFile" accept=".csv"
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />
                <div class="mb-4">
                    <button id="descargarCSV"
                        class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                        Exportar Datos a CSV
                    </button>
                </div>
                <div class="mb-4">
                    <button id="resetearBaseDatos"
                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                        Resetear Base de Datos
                    </button>
                </div>
            </div>
        </div>

        <button class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded" id="sync-down-btn">
            Sincronizar en Bajada
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4">Base de Datos Actual</h2>
        <div class="overflow-x-auto">
            <table class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">C�digo</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categor�a</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Unidad</th>
                    </tr>
                </thead>
                <tbody id="databaseBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const menuToggle = document.getElementById("menuToggle");
            const sideMenu = document.getElementById("sideMenu");
            const closeMenu = document.getElementById("closeMenu");
            const menuRoutes = document.getElementById("menuRoutes");

            const routes = [
                { name: "Consulta de Producto", path: "./consulta.html" },
                { name: "Editar Producto", path: "./editar.html" },
                { name: "Inventario", path: "./inventario.html" },
                { name: "Reporte para Inventario", path: "./report.html" },
                { name: "Agregar Productos", path: "./agregar.html" }
            ];

            routes.forEach((route) => {
                const li = document.createElement("li");
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            menuToggle.addEventListener("click", () => {
                sideMenu.classList.remove("-translate-x-full");
            });

            closeMenu.addEventListener("click", () => {
                sideMenu.classList.add("-translate-x-full");
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraciones - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    <script src="../js/utils/theme-debug.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Configuraciones del Sistema</h1>
        <div class="flex items-center space-x-4">
            <span id="userInfo" class="text-sm font-medium"></span>
        </div>
    </header>

    <div class="container mx-auto mt-8 p-4">
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar al Dashboard</a>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Configuraciones de Usuario -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    Configuraciones de Usuario
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cambiar Contrase�a</label>
                        <button id="changePasswordBtn"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Cambiar Contrase�a
                        </button>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Informaci�n del Perfil</label>
                        <div id="profileInfo" class="bg-gray-50 p-4 rounded border">
                            <!-- Se llenar� din�micamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraciones del Sistema -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Configuraciones del Sistema
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tema de la Aplicaci�n</label>
                        <select id="themeSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="light">Claro</option>
                            <option value="dark">Oscuro</option>
                            <option value="auto">Autom�tico</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Idioma</label>
                        <select id="languageSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="es">Espa�ol</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Google Services -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                        </path>
                    </svg>
                    Credenciales de Google
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Drive API Key</label>
                        <div class="relative">
                            <input type="password" id="googleDriveApiKey"
                                class="w-full border border-gray-300 rounded px-3 py-2 pr-12"
                                placeholder="Ingresa tu API Key de Google Drive">
                            <button type="button" id="toggleDriveKey"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Necesaria para acceder a Google Drive desde la aplicaci�n
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Sheets API Key</label>
                        <div class="relative">
                            <input type="password" id="googleSheetsApiKey"
                                class="w-full border border-gray-300 rounded px-3 py-2 pr-12"
                                placeholder="Ingresa tu API Key de Google Sheets">
                            <button type="button" id="toggleSheetsKey"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Necesaria para integraci�n con Google Sheets</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ID de Google Sheets</label>
                        <input type="text" id="googleSheetsId" class="w-full border border-gray-300 rounded px-3 py-2"
                            placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                        <p class="text-xs text-gray-500 mt-1">ID de la hoja de c�lculo de Google donde se sincronizar�n
                            los datos</p>
                    </div>

                    <div class="flex space-x-2">
                        <button id="testGoogleConnection"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Probar Conexi�n
                        </button>
                        <button id="saveGoogleCredentials"
                            class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                            Guardar Credenciales
                        </button>
                        <button id="clearGoogleCredentials"
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                            Limpiar
                        </button>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mt-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">
                                    <strong>Informaci�n:</strong> Para obtener las API Keys, visita la
                                    <a href="https://console.developers.google.com/" target="_blank"
                                        class="underline hover:text-blue-800">
                                        Google Cloud Console
                                    </a> y habilita las APIs de Google Drive y Google Sheets.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Sincronizaci�n -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                        </path>
                    </svg>
                    Sincronizaci�n
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sincronizaci�n Autom�tica</label>
                        <div class="flex items-center">
                            <input type="checkbox" id="autoSyncEnabled" class="mr-2">
                            <span>Habilitar sincronizaci�n autom�tica</span>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Intervalo de Sincronizaci�n
                            (minutos)</label>
                        <input type="number" id="syncInterval" class="border border-gray-300 rounded px-3 py-2 w-full"
                            min="1" max="60" value="5">
                    </div>

                    <div class="flex space-x-2">
                        <button id="manualSyncBtn"
                            class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                            Sincronizar Ahora
                        </button>
                        <button id="resetSyncBtn"
                            class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">
                            Resetear Configuraci�n
                        </button>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Notificaciones -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-5 5v-5zM7 7h10v10H7V7z"></path>
                    </svg>
                    Notificaciones
                </h2>

                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="browserNotifications" class="mr-2">
                        <span>Notificaciones del navegador</span>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="soundNotifications" class="mr-2">
                        <span>Notificaciones sonoras</span>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="lowStockAlerts" class="mr-2">
                        <span>Alertas de stock bajo</span>
                    </div>
                </div>
            </div>

            <!-- Informaci�n del Sistema -->
            <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Informaci�n del Sistema
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">Versi�n de la Aplicaci�n</h3>
                        <p id="appVersion" class="text-lg">1.0.0</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">Estado de Conexi�n</h3>
                        <p id="connectionStatus" class="text-lg">Conectado</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">�ltima Sincronizaci�n</h3>
                        <p id="lastSync" class="text-lg">--</p>
                    </div>
                </div>

                <div class="mt-4 flex space-x-2">
                    <button id="exportConfigBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Exportar Configuraci�n
                    </button>
                    <button id="importConfigBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Importar Configuraci�n
                    </button>
                    <input type="file" id="importConfigFile" accept=".json" class="hidden">
                </div>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/configuraciones.js"></script>
</body>

</html>
<<<<<<< HEAD=======<!DOCTYPE html>
    <html lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Confirmaci�n de Correo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
        <link href="../librer�as/tailwind.min.css" rel="stylesheet">
        <link href="../css/styles.css" rel="stylesheet">
        <script src="../js/utils/theme-manager.js"></script>
        <script src="../js/ui/theme-toggle.js"></script>
    </head>

    <body class="bg-gray-100 flex items-center justify-center h-screen">
        <div class="container mx-auto p-6 max-w-md bg-white shadow-md rounded-lg text-center">
            <h1 id="statusTitle" class="text-2xl font-bold mb-4 text-blue-600">Verificando tu correo...</h1>
            <p id="statusMessage" class="text-gray-700 mb-6">Por favor, espera un momento mientras procesamos tu
                confirmaci�n.</p>
            <p id="detailsMessage" class="text-gray-600 mb-4"></p>
            <a href="../index.html"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-2 inline-block">
                Ir al Inicio de Sesi�n
            </a>
        </div>
        <script src="../js/ui/mobile-optimizer.js"></script>
        <script type="module">
            import { supabase } from '../js/auth/auth.js';

            const statusTitleEl = document.getElementById('statusTitle');
            const statusMessageEl = document.getElementById('statusMessage');
            const detailsMessageEl = document.getElementById('detailsMessage');

            // Supabase maneja la confirmaci�n del token en el backend antes de redirigir aqu�.
            // Esta p�gina muestra el resultado basado en los par�metros de la URL o el estado de la sesi�n.

            const urlParams = new URLSearchParams(window.location.search);
            const errorDescription = urlParams.get('error_description');
            // const errorCode = urlParams.get('error'); // Podr�as usarlo para errores m�s espec�ficos

            if (errorDescription) {
                statusTitleEl.textContent = 'Error en la Confirmaci�n';
                statusTitleEl.classList.remove('text-blue-600', 'text-green-600');
                statusTitleEl.classList.add('text-red-600');
                statusMessageEl.textContent = 'No pudimos confirmar tu direcci�n de correo electr�nico.';
                detailsMessageEl.textContent = `Detalles: ${decodeURIComponent(errorDescription)}`;
                detailsMessageEl.classList.add('text-red-500');
            } else {
                // Si no hay error en la URL, la confirmaci�n fue procesada por Supabase.
                // Esto puede significar que el correo se confirm� ahora o ya estaba confirmado.
                statusTitleEl.textContent = '¡Correo Verificado!';
                statusTitleEl.classList.remove('text-blue-600', 'text-red-600');
                statusTitleEl.classList.add('text-green-600');
                statusMessageEl.textContent = 'Tu direcci�n de correo electr�nico ha sido verificada exitosamente.';
                detailsMessageEl.textContent = 'Ya puedes cerrar esta ventana e iniciar sesi�n.';

                // onAuthStateChange puede dar feedback adicional si la confirmaci�n tambi�n inicia sesi�n.
                supabase.auth.onAuthStateChange((event, session) => {
                    if (event === 'SIGNED_IN' && session) {
                        detailsMessageEl.textContent = 'Has iniciado sesi�n autom�ticamente. ¡Bienvenido!';
                    } else if (event === 'USER_UPDATED' && session?.user?.email_confirmed_at) {
                        // El correo est� confirmado, el mensaje por defecto ya es apropiado.
                        // Puedes a�adir algo m�s si es necesario.
                    }
                });
            }
        </script>
    </body>

    </html>
    >>>>>>> 1e3239b (feat: A�adir enlace para recuperaci�n de contrase�a en la p�gina de inicio de sesi�n y mejorar
    mensajes de confirmaci�n de correo)
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Producto - Sistema de Gestión de Productos</title>
    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <!-- Cambiamos Quagga por Html5QrCode -->
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../librerías/sweetalert2@11.js"></script>
    <!-- Añadir JsBarcode para códigos de barra -->
    <script src="../librerías/JsBarcode.all.min.js"></script>
    <!-- Añadir jsPDF para generación de PDFs -->
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Consulta de Producto</h1>

    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="consulta" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Consulta de Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">Menú</button>

        <!-- Sistema de pestañas -->
        <div class="mb-4 mt-4">
            <nav class="flex border-b">
                <button id="tab-busqueda" class="tab-button border-b-2 border-blue-500 text-blue-600 px-4 py-2 font-semibold">Búsqueda</button>
                <button id="tab-relaciones" class="tab-button border-b-2 border-transparent text-gray-500 px-4 py-2 font-semibold">Relaciones</button>
            </nav>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-busqueda" class="tab-content">
            <form id="formConsultaProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoConsulta">Código/PLU:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoConsulta" type="text">
                        <button type="button" id="escanearBtnConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear Código de Barras</button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreConsulta">Nombre:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="nombreConsulta" type="text">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaConsulta">Categoría:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="categoriaConsulta" type="text">
                </div>
                <div class="flex items-center justify-between">
                    <button id="buscarConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">Buscar Producto</button>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
        </div>
        <div id="content-relaciones" class="tab-content" style="display:none;">
            <form id="formRelaciones" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoRelacion">Código del producto:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoRelacion" type="text" placeholder="Escanea o ingresa el código o últimos 4 dígitos">
                        <button type="button" id="escanearBtnRelacion" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear</button>
                        <button type="button" id="buscarRelacion" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Buscar Relación</button>
                    </div>
                </div>
            </form>
            <div id="relaciones" class="mt-4"></div>
        </div>

        <!-- Modificamos el contenedor del escáner -->
        <!-- En plantillas/consulta.html -->
        <div id="scanner-container-consulta" class="mt-4" style="display: none;">
            <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
            <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
        </div>

        <!-- Div to hold the barcode -->
        <div id="barcodeContainer" class="mt-4"></div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Búsqueda relacional de productos con pestañas
        document.addEventListener('DOMContentLoaded', function() {
            const codigoConsulta = document.getElementById('codigoConsulta');
            aplicarConversionCodigo(codigoConsulta);
            // Para la pestaña de relaciones
            const codigoRelacion = document.getElementById('codigoRelacion');
            if (codigoRelacion) aplicarConversionCodigo(codigoRelacion);

            // Tabs
            const tabBusqueda = document.getElementById('tab-busqueda');
            const tabRelaciones = document.getElementById('tab-relaciones');
            const contentBusqueda = document.getElementById('content-busqueda');
            const contentRelaciones = document.getElementById('content-relaciones');
            const relacionesDiv = document.getElementById('relaciones');
            let ultimoProducto = null;

            function switchTab(tab) {
                if (tab === 'busqueda') {
                    tabBusqueda.classList.add('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.remove('border-transparent', 'text-gray-500');
                    tabRelaciones.classList.remove('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'block';
                    contentRelaciones.style.display = 'none';
                } else {
                    if (tabRelaciones.disabled) return; // No cambiar si está deshabilitada
                    tabRelaciones.classList.add('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.remove('border-transparent', 'text-gray-500');
                    tabBusqueda.classList.remove('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'none';
                    contentRelaciones.style.display = 'block';
                }
            }
            tabBusqueda.addEventListener('click', () => switchTab('busqueda'));
            tabRelaciones.addEventListener('click', () => switchTab('relaciones'));
            switchTab('busqueda');

            const buscarBtn = document.getElementById('buscarConsulta');
            const resultadosDiv = document.getElementById('resultados');

            buscarBtn.addEventListener('click', async function() {
                resultadosDiv.innerHTML = '';
                ultimoProducto = null;
                const codigoInput = document.getElementById('codigoConsulta').value.trim();
                const nombre = document.getElementById('nombreConsulta').value.trim();
                const categoria = document.getElementById('categoriaConsulta').value.trim();

                // Buscar primero en IndexedDB para obtener el código completo
                function buscarEnIndexedDB(codigo, nombre, categoria) {
                    return new Promise((resolve, reject) => {
                        if (!window.indexedDB) {
                            resolve(null);
                            return;
                        }
                        const request = window.indexedDB.open('InventarioDB', 1);
                        request.onerror = function() { resolve(null); };
                        request.onsuccess = function(event) {
                            const db = event.target.result;
                            const tx = db.transaction(['productos'], 'readonly');
                            const store = tx.objectStore('productos');
                            const allReq = store.getAll();
                            allReq.onsuccess = function(e) {
                                const productos = e.target.result || [];
                                let encontrados = [];
                                if (codigo) {
                                    if (codigo.length === 4) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo.endsWith(codigo));
                                    } else if (codigo.length === 13) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    } else {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    }
                                } else if (nombre || categoria) {
                                    encontrados = productos.filter(p => {
                                        let match = true;
                                        if (nombre) match = match && p.nombre && p.nombre.toLowerCase().includes(nombre.toLowerCase());
                                        if (categoria) match = match && p.categoria && p.categoria.toLowerCase().includes(categoria.toLowerCase());
                                        return match;
                                    });
                                }
                                resolve(encontrados);
                            };
                            allReq.onerror = function() { resolve(null); };
                        };
                    });
                }

                const productosLocal = await buscarEnIndexedDB(codigoInput, nombre, categoria);
                if (!productosLocal || productosLocal.length === 0) {
                    resultadosDiv.innerHTML = '<div class="text-red-600 font-semibold">No se encontraron productos en el dispositivo.</div>';
                    return;
                }

                // Mostrar resultados principales
                productosLocal.forEach((producto, idx) => {
                    let html = `<div class="bg-white rounded shadow p-4 mb-4">
                        <h3 class="text-xl font-bold mb-2">${producto.nombre}</h3>
                        <div><b>Código:</b> ${producto.codigo}</div>
                        <div><b>Categoría:</b> ${producto.categoria}</div>
                        <div><b>Marca:</b> ${producto.marca}</div>
                        <div><b>Unidad:</b> ${producto.unidad}</div>
                    </div>`;
                    resultadosDiv.innerHTML += html;
                    if (idx === 0) ultimoProducto = producto;
                });
            });

            // Lógica independiente para la pestaña de relaciones
            const buscarRelacionBtn = document.getElementById('buscarRelacion');
            if (buscarRelacionBtn) {
                buscarRelacionBtn.addEventListener('click', async function() {
                    relacionesDiv.innerHTML = '';
                    let codigo = document.getElementById('codigoRelacion').value.trim();
                    if (!codigo) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Ingresa un código para buscar relaciones.</div>';
                        return;
                    }
                    // Permitir búsqueda por últimos 4 dígitos
                    if (codigo.length === 4) {
                        // Buscar en Supabase todos los productos cuyo substring(2,5) sea igual a esos 4 dígitos
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        // Traer todos los códigos y filtrar en JS (por compatibilidad universal)
                        const { data: productosTodos } = await supabase.from('productos').select('codigo');
                        const productos4 = (productosTodos || []).filter(p => typeof p.codigo === 'string' && p.codigo.length >= 5 && p.codigo.substring(1,5) === codigo);
                        if (productos4.length > 0) {
                            if (productos4.length > 1) {
                                relacionesDiv.innerHTML = `<div class='mb-2'>Se encontraron varios productos con los dígitos 2-5 <b>${codigo}</b>:</div>`;
                                productos4.forEach(p => {
                                    relacionesDiv.innerHTML += `<button class='bg-blue-100 hover:bg-blue-300 text-blue-800 px-2 py-1 rounded m-1' onclick='document.getElementById("codigoRelacion").value="${p.codigo}";document.getElementById("buscarRelacion").click();return false;'>${p.codigo}</button>`;
                                });
                                return;
                            } else {
                                codigo = productos4[0].codigo;
                                document.getElementById('codigoRelacion').value = codigo;
                            }
                        } else {
                            relacionesDiv.innerHTML = `<div class='text-red-600'>No se encontró ningún producto con los dígitos 2-5 igual a <b>${codigo}</b>.</div>`;
                            return;
                        }
                    }
                    relacionesDiv.innerHTML = '<div class="text-gray-500">Buscando relaciones...</div>';
                    try {
                        const { obtenerRelacionesProductosSupabase, buscarRelacionProducto } = await import('../js/relaciones-productos.js');
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        const relaciones = await obtenerRelacionesProductosSupabase();
                        const resultado = buscarRelacionProducto(codigo, relaciones);
                        // Buscar info del producto consultado
                        let relHtml = `<div class="bg-white rounded shadow p-4 mb-4">
                            <h3 class="text-lg font-bold mb-2">Relaciones para: <span class='font-mono'>${codigo}</span></h3>`;
                        const { data: productoInfo } = await supabase.from('productos').select('*').eq('codigo', codigo);
                        if (productoInfo && productoInfo.length > 0) {
                            const p = productoInfo[0];
                            relHtml += `<div class='mb-2 text-sm text-gray-700'>${p.nombre} | ${p.unidad || ''} | ${p.categoria || ''} | ${p.marca || ''}</div>`;
                        }
                        // Si es principal, mostrar subproductos
                        if (resultado.tipo === 'principal' && resultado.subproductos.length > 0) {
                            // Buscar info de subproductos
                            const { data: subproductosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos);
                            relHtml += `<div class="mt-2"><b>Subproductos relacionados:</b>
                            <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                            resultado.subproductos.forEach(subCodigo => {
                                const sub = subproductosInfo ? subproductosInfo.find(p => p.codigo === subCodigo) : null;
                                if (sub) {
                                    relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                } else {
                                    relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                }
                            });
                            relHtml += '</tbody></table></div>';
                        }
                        // Si es subproducto, mostrar principal y hermanos
                        if (resultado.tipo === 'subproducto' && resultado.principal) {
                            // Buscar info del principal
                            const { data: principalArr } = await supabase.from('productos').select('*').eq('codigo', resultado.principal);
                            if (principalArr && principalArr.length > 0) {
                                const principal = principalArr[0];
                                relHtml += `<div class="mt-4"><b>Producto principal:</b>
                                    <div class="bg-gray-50 rounded p-2 mt-1">
                                        <b>${principal.nombre}</b> (Código: ${principal.codigo})<br>
                                        Categoría: ${principal.categoria} | Marca: ${principal.marca} | Unidad: ${principal.unidad}
                                    </div>
                                </div>`;
                            } else {
                                relHtml += `<div class="mt-4"><b>Producto principal:</b> <span class='text-gray-400'>${resultado.principal} (No encontrado)</span></div>`;
                            }
                            // Mostrar hermanos (otros subproductos)
                            if (resultado.subproductos.length > 1) {
                                const { data: hermanosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos.filter(c => c !== codigo));
                                relHtml += `<div class="mt-2"><b>Otros subproductos relacionados:</b>
                                <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                                resultado.subproductos.forEach(subCodigo => {
                                    if (subCodigo === codigo) return;
                                    const sub = hermanosInfo ? hermanosInfo.find(p => p.codigo === subCodigo) : null;
                                    if (sub) {
                                        relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                    } else {
                                        relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                    }
                                });
                                relHtml += '</tbody></table></div>';
                            }
                        }
                        if (resultado.tipo === 'ninguno') {
                            relHtml += '<div class="mt-2 text-gray-400">Este producto no tiene relaciones registradas.</div>';
                        }
                        relHtml += '</div>';
                        relacionesDiv.innerHTML = relHtml;
                    } catch (e) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Error al consultar relaciones: ' + (e.message || e) + '</div>';
                    }
                });
            }

            // El manejo del botón de escanear ya lo realiza `main.js` (evitamos listeners duplicados).
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#">
    <title>Editar Producto - Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <script src="../librerías/html5-qrcode.min.js"></script>
    <link rel="stylesheet" href="../librerías/tailwind.min.css" />
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">

    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Editar Producto</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Editar Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Pestañas -->
        <div class="mb-6 mt-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-editar-individual"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button active">
                        Edición Individual
                    </button>
                    <button id="tab-editar-tabla"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Edición por Tabla
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-editar-individual" class="tab-content">
            <form id="formEditarProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoEditar">
                        Código/PLU:
                    </label>
                    <div class="flex">
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="codigoEditar" type="text" required />
                        <button type="button" id="escanearBtnEditar"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                            Escanear Código de Barras
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <button id="buscarEditar"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="button">
                        Buscar
                    </button>
                </div>
                <div id="formularioEdicion" style="display: none">
                    <!-- Campo de código editable -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo">
                            Código
                        </label>
                        <input type="text" id="codigoEditado"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreEditar">
                            Nombre:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="nombreEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaEditar">
                            Categoría:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="categoriaEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="marcaEditar">
                            Marca/Proveedor:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="marcaEditar" type="text" required />
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="unidadEditar">
                            Unidad:
                        </label>
                        <input type="text" id="unidadEditar"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="flex items-center justify-between">
                        <button id="guardarCambios"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Guardar Cambios
                        </button>
                        <button id="eliminarProducto"
                            class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Eliminar Producto
                        </button>
                    </div>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
            <div id="scanner-container-editar" class="mt-4" style="display: none">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>
        </div>

        <!-- Pestaña Edición por Tabla -->
        <div id="content-editar-tabla" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Edición por Tabla</h3>
                <form id="formBuscarTabla" class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoBuscarTabla">
                        Buscar por Código de Producto Primario o Subproducto:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="codigoBuscarTabla" type="text" placeholder="Ej: 1234 o 201670000004" required />
                    <button type="submit"
                        class="mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Buscar</button>
                </form>
                <div id="tabla-edicion-resultados"></div>
                <div id="tabla-edicion-resultados"></div>
                <script type="module">
                    import { db, inicializarDB } from '../js/db-operations.js';
                    import { obtenerRelacionesProductosSupabase, buscarRelacionProducto } from '../js/relaciones-productos.js';
                    // Exponer para main.js si se requiere (opcional)
                    window.obtenerRelacionesProductosSupabase = obtenerRelacionesProductosSupabase;
                    window.buscarRelacionProducto = buscarRelacionProducto;

                    // Lógica de búsqueda y edición en tabla
                    document.getElementById('formBuscarTabla').addEventListener('submit', function (e) {
                        e.preventDefault();
                        const codigo = document.getElementById('codigoBuscarTabla').value.trim();
                        const resultadosDiv = document.getElementById('tabla-edicion-resultados');
                        resultadosDiv.innerHTML = `<div class='text-gray-600'>Sincronizando productos y relaciones...</div>`;

                        (async () => {
                            console.log('[DEBUG] db antes de inicializar:', db);
                            let dbReady = db;
                            if (!dbReady) {
                                resultadosDiv.innerHTML = `<div class='text-gray-600'>Inicializando base de datos local...</div>`;
                                try {
                                    await inicializarDB();
                                } catch (err) {
                                    console.error('[DEBUG] Error al inicializarDB:', err);
                                }
                                dbReady = db;
                                console.log('[DEBUG] db después de inicializar:', dbReady);
                            }
                            if (!dbReady) {
                                console.error('[DEBUG] IndexedDB sigue sin inicializar tras inicializarDB.');
                                resultadosDiv.innerHTML = `<div class='text-red-600'>IndexedDB no inicializado.</div>`;
                                return;
                            }
                            // 1. Sincronizar productos desde Supabase a IndexedDB y obtener relaciones
                            Promise.all([
                                importarProductosSupabaseAIndexedDB(dbReady),
                                obtenerRelacionesProductosSupabase()
                            ]).then(([_, relaciones]) => {
                                // 2. Buscar relación en el Map
                                const relacion = buscarRelacionProducto(codigo, relaciones);
                                // 3. Buscar detalles de productos en IndexedDB
                                buscarProductosRelacionadosConMap(dbReady, codigo, relacion, resultadosDiv);
                            }).catch(err => {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al sincronizar: ${err.message || err}`;
                            });
                        })();

                        // --- Función para importar productos de Supabase a IndexedDB ---
                        async function importarProductosSupabaseAIndexedDB(dbInstance) {
                            if (!window.getSupabase) throw new Error('No se encontró getSupabase.');
                            const supabase = await window.getSupabase();
                            const { data: productos, error } = await supabase.from('productos').select('*');
                            if (error) throw error;
                            if (!dbInstance) throw new Error('IndexedDB no inicializado');
                            return new Promise((resolve, reject) => {
                                const transaction = dbInstance.transaction(['productos'], 'readwrite');
                                const objectStore = transaction.objectStore('productos');
                                const clearReq = objectStore.clear();
                                clearReq.onsuccess = function () {
                                    productos.forEach(prod => {
                                        const p = {
                                            codigo: prod.codigo,
                                            nombre: prod.nombre,
                                            categoria: prod.categoria,
                                            marca: prod.marca,
                                            unidad: prod.unidad
                                        };
                                        objectStore.put(p);
                                    });
                                    transaction.oncomplete = resolve;
                                    transaction.onerror = reject;
                                };
                                clearReq.onerror = reject;
                            });
                        }

                        // --- Función para buscar productos relacionados usando el Map de relaciones ---
                        function buscarProductosRelacionadosConMap(dbInstance, codigo, relacion, resultadosDiv) {
                            const transaction = dbInstance.transaction(['productos'], 'readonly');
                            const objectStore = transaction.objectStore('productos');
                            const getAllReq = objectStore.getAll();
                            getAllReq.onsuccess = function (e) {
                                const productos = e.target.result;
                                // Buscar producto exacto (por código completo o 4 dígitos)
                                let producto = productos.find(p => p.codigo === codigo || p.codigo.endsWith(codigo));
                                if (!producto) {
                                    resultadosDiv.innerHTML = `<div class='text-red-600'>No se encontró el producto <b>${codigo}</b>.</div>`;
                                    return;
                                }
                                // Buscar principal y subproductos según el Map
                                let productoPrincipal = null;
                                let subproductos = [];
                                if (relacion.tipo === 'principal') {
                                    productoPrincipal = producto;
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                } else if (relacion.tipo === 'subproducto') {
                                    productoPrincipal = productos.find(p => p.codigo === relacion.principal);
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                }
                                // Mostrar resultados
                                let html = '';
                                // Producto encontrado (si es principal, mostrar botón editar principal)
                                html += `<div class='mb-4'><b>Producto encontrado:</b><br>${producto.codigo} - ${producto.nombre} (${producto.categoria})<br>Marca: ${producto.marca} | Unidad: ${producto.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${producto.codigo}'>Editar</button></div>`;
                                // Si hay producto principal distinto, mostrarlo con botón editar
                                if (productoPrincipal && productoPrincipal.codigo !== producto.codigo) {
                                    html += `<div class='mb-4'><b>Producto Principal:</b><br>${productoPrincipal.codigo} - ${productoPrincipal.nombre} (${productoPrincipal.categoria})<br>Marca: ${productoPrincipal.marca} | Unidad: ${productoPrincipal.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${productoPrincipal.codigo}'>Editar</button></div>`;
                                }
                                if (subproductos.length > 0) {
                                    html += `<div class='mb-2'><b>Subproductos relacionados:</b> <button id='expand-relacionados' class='ml-2 px-2 py-1 bg-blue-200 rounded'>Ver relacionados</button></div><ul class='mb-4' id='lista-relacionados' style='display:none;'>`;
                                    subproductos.forEach(sp => {
                                        html += `<li class='mb-1'>${sp.codigo} - ${sp.nombre} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${sp.codigo}'>Editar</button></li>`;
                                    });
                                    html += '</ul>';
                                }
                                resultadosDiv.innerHTML = html;
                                // Botón para expandir/collapse relacionados
                                const expandBtn = resultadosDiv.querySelector('#expand-relacionados');
                                const listaRelacionados = resultadosDiv.querySelector('#lista-relacionados');
                                if (expandBtn && listaRelacionados) {
                                    expandBtn.addEventListener('click', () => {
                                        listaRelacionados.style.display = listaRelacionados.style.display === 'none' ? 'block' : 'none';
                                        expandBtn.textContent = listaRelacionados.style.display === 'none' ? 'Ver relacionados' : 'Ocultar relacionados';
                                    });
                                }
                                // Agregar listeners a los botones de edición
                                resultadosDiv.querySelectorAll('.edit-btn').forEach(btn => {
                                    btn.addEventListener('click', function () {
                                        const codigoEditar = btn.dataset.codigo;
                                        // Buscar el producto en la lista de productos
                                        const prod = productos.find(p => p.codigo === codigoEditar);
                                        if (!prod) {
                                            Swal.fire('Error', 'No se encontró el producto en la base local.', 'error');
                                            return;
                                        }
                                        // Rellenar el formulario de edición individual
                                        document.getElementById('codigoEditar').value = prod.codigo;
                                        document.getElementById('codigoEditado').value = prod.codigo;
                                        document.getElementById('nombreEditar').value = prod.nombre;
                                        document.getElementById('categoriaEditar').value = prod.categoria;
                                        document.getElementById('marcaEditar').value = prod.marca;
                                        document.getElementById('unidadEditar').value = prod.unidad;
                                        // Mostrar el formulario de edición si está oculto
                                        document.getElementById('formularioEdicion').style.display = '';
                                        // Cambiar a la pestaña de Edición Individual
                                        const tabButtons = document.querySelectorAll('.tab-button');
                                        const tabContents = document.querySelectorAll('.tab-content');
                                        tabButtons.forEach(btn => {
                                            btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                                            btn.classList.add('border-transparent', 'text-gray-500');
                                        });
                                        tabContents.forEach(content => {
                                            content.style.display = 'none';
                                        });
                                        document.getElementById('tab-editar-individual').classList.add('active', 'border-blue-500', 'text-blue-600');
                                        document.getElementById('tab-editar-individual').classList.remove('border-transparent', 'text-gray-500');
                                        document.getElementById('content-editar-individual').style.display = 'block';
                                        // Scroll al formulario de edición
                                        document.getElementById('formEditarProducto').scrollIntoView({ behavior: 'smooth' });
                                    });
                                });
                            };
                            getAllReq.onerror = function () {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al buscar productos en IndexedDB.</div>`;
                            };
                        }
                    });
                </script>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Pestañas
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            function switchTab(targetTab) {
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });
                const activeButton = document.getElementById(`tab-${targetTab}`);
                activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');
                document.getElementById(`content-${targetTab}`).style.display = 'block';
            }
            document.getElementById('tab-editar-individual').addEventListener('click', () => switchTab('editar-individual'));
            document.getElementById('tab-editar-tabla').addEventListener('click', () => switchTab('editar-tabla'));

            // Aplicar conversión de guión a ceros en campos de código
            const codigoEditar = document.getElementById('codigoEditar');
            const codigoEditado = document.getElementById('codigoEditado');
            const codigoBuscarTabla = document.getElementById('codigoBuscarTabla');
            aplicarConversionCodigo(codigoEditar);
            aplicarConversionCodigo(codigoEditado);
            aplicarConversionCodigo(codigoBuscarTabla);


        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link href="../librerías/tailwind.min.css" rel="stylesheet">
    <script src="../librerías/sweetalert2@11.js"></script>
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Inventario</h1>
        <div class="flex items-center space-x-4">
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="inventario" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6 dark-theme-title">Inventario</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Nuevo div para mostrar la ubicación actual -->
        <div class="mb-4 p-4 bg-white shadow-md rounded">
            <h2 class="text-xl font-bold mb-2">Ubicación Actual: <span id="ubicacionActual"></span></h2>
            <button id="cambiarUbicacion" class="bg-yellow-500 text-white px-4 py-2">Cambiar Ubicación</button>
        </div>

        <!-- Pestañas principales de inventario -->
        <div class="mb-6">
            <div class="flex border-b bg-white shadow-sm rounded-t-lg">
                <button id="tabInventarioManual"
                    class="px-6 py-3 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500 font-semibold">
                    📦 Inventario Manual
                </button>
                <button id="tabLotesAvanzado"
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300 font-semibold">
                    🚀 Inventario por Lotes Avanzado
                </button>
            </div>
        </div>

        <!-- Contenido de Inventario Manual -->
        <div id="contenidoInventarioManual" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <!-- Formulario de búsqueda de inventario -->
            <div class="mb-4">
                <label for="codigo" class="block mb-2">Código/PLU:</label>
                <div class="flex">
                    <input type="text" id="codigo" class="border p-2 w-full">
                    <button id="escanearBtn" class="bg-blue-500 text-white px-4 py-2 ml-2">Escanear Código</button>
                </div>
            </div>

            <div class="mb-4">
                <label for="nombreInventario" class="block mb-2">Nombre:</label>
                <input type="text" id="nombreInventario" class="border p-2 w-full">
            </div>

            <div class="mb-4">
                <label for="marcaInventario" class="block mb-2">Marca:</label>
                <input type="text" id="marcaInventario" class="border p-2 w-full">
            </div>

            <button id="buscarInventario" class="bg-green-500 text-white px-4 py-2 mb-4">Buscar Producto</button>

            <div id="resultadosInventario" class="mt-4" style="display: none;">
                <!-- Los resultados de la búsqueda se mostrarán aquí -->
            </div>

            <div id="datosInventario" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
                <!-- Pestañas para productos tipo Kg -->
                <div id="tabsContainer" class="mb-6" style="display: none;">
                    <div class="flex border-b">
                        <button id="tabInventario"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            Inventario Normal
                        </button>
                        <button id="tabLotes"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            Lotes
                        </button>
                    </div>
                </div>

                <!-- Formulario de inventario normal -->
                <div id="formularioInventarioNormal">
                    <div class="mb-4">
                        <label for="codigoProductoInventario" class="block mb-2">Codigo del Producto:</label>
                        <input type="text" id="codigoProductoInventario" class="border p-2 w-full" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="nombreProductoInventario" class="block mb-2">Nombre del Producto:</label>
                        <input type="text" id="nombreProductoInventario" class="border p-2 w-full" readonly>
                    </div>

                    <div class="mb-4">
                        <label for="unidadProducto" class="block mb-2">Unidad:</label>
                        <input type="text" id="unidadProducto" class="border p-2 w-full" readonly>
                        <!-- Mostrar la unidad como texto -->
                    </div>

                    <div class="mb-4">
                        <label for="cantidad" class="block mb-2">Cantidad:</label>
                        <input type="number" id="cantidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-4">
                        <label for="fechaCaducidad" class="block mb-2">Fecha de Caducidad:</label>
                        <input type="date" id="fechaCaducidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-6">
                        <label for="comentarios" class="block mb-2">Comentarios:</label>
                        <textarea id="comentarios" class="border p-2 w-full"></textarea>
                    </div>

                    <div id="botonguardar" class="flex items-center justify-between">
                        <button id="guardarInventario" class="bg-blue-500 text-white px-4 py-2">Guardar
                            Inventario</button>
                    </div>
                    <div id="botonmodificar" class="flex items-center justify-between" style="display: none;">
                        <button id="modificarInventario" class="bg-blue-500 text-white px-4 py-2">Modificar
                            Inventario</button>
                    </div>
                </div>

                <!-- Formulario de escaneo por lotes para productos Kg -->
                <div id="formularioLotes" style="display: none;">
                    <div class="bg-blue-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-bold mb-3 text-blue-800">Información del Producto</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Código:</label>
                                <span id="codigoProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre:</label>
                                <span id="nombreProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Unidad:</label>
                                <span id="unidadProductoLotes" class="text-sm font-semibold text-green-600">Kg</span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoría:</label>
                                <span id="categoriaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Marca:</label>
                                <span id="marcaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label for="precioKilo" class="block text-sm font-medium text-gray-700 mb-2">Precio por Kilo
                            ($):</label>
                        <input type="number" id="precioKilo" step="0.01" min="0"
                            class="border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Ingrese el precio por kilogramo">
                    </div>

                    <div class="text-center">
                        <button id="iniciarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            📱 Iniciar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>

            <div id="mensaje" class="mt-4"></div>

            <div id="scanner-container-inventario" class="mt-4" style="display: none;">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>

            <button id="generarHojaInventario" class="bg-purple-500 text-white px-4 py-2 mt-4">Generar Hoja de
                Inventario</button>
        </div>

        <!-- Contenido de Inventario por Lotes Avanzado -->
        <div id="contenidoLotesAvanzado" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
            <!-- Panel de alerta y configuración -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-yellow-800">Inventario por Lotes Avanzado</h3>
                        <div class="mt-2 text-sm text-yellow-700">
                            <ul class="list-disc list-inside space-y-1">
                                <li>Solo se pueden contar productos con unidad tipo <strong>Kg</strong></li>
                                <li>El escaneo será automático sin necesidad de búsqueda previa</li>
                                <li>Se extraerán automáticamente PLU, peso y precio desde códigos CODE128</li>
                                <li>Los productos se agruparán por productos primarios y subproductos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel de configuración -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-4 text-gray-800">⚙️ Configuración de Escaneo</h3>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="confirmarProductosSimilares"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                        <label for="confirmarProductosSimilares" class="text-sm font-medium text-gray-700">
                            Mostrar ventana de confirmación para productos similares
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="agruparAutomaticamente"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="agruparAutomaticamente" class="text-sm font-medium text-gray-700">
                            Agrupar automáticamente productos con el mismo PLU
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="sonidoConfirmacion"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="sonidoConfirmacion" class="text-sm font-medium text-gray-700">
                            Reproducir sonido de confirmación al escanear
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="relacionarProductos"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="relacionarProductos" class="text-sm font-medium text-gray-700">
                            Relacionar productos (buscar en productos_subproductos)
                        </label>
                    </div>
                </div>
            </div>

            <!-- Botón para iniciar escaneo -->
            <div class="text-center mb-6">
                <button id="iniciarEscaneoLotesAvanzado"
                    class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform hover:scale-105 transition duration-200">
                    🚀 Iniciar Escaneo por Lotes Avanzado
                </button>
            </div>

            <!-- Área de resultados de productos escaneados -->
            <div id="resultadosLotesAvanzado" class="hidden">
                <h3 class="text-lg font-bold mb-4 text-gray-800">📊 Productos Escaneados</h3>
                <div id="contenedorProductosPrimarios" class="space-y-4">
                    <!-- Las tarjetas de productos primarios se mostrarán aquí -->
                </div>

                <!-- Botón para guardar inventario -->
                <div class="text-center mt-6">
                    <button id="guardarInventarioLotesAvanzado"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled>
                        💾 Guardar Inventario
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes Avanzado -->
        <div id="modalEscaneoLotesAvanzado"
            class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
            <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-5xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-900">🚀 Escaneo por Lotes Avanzado</h3>
                        <button id="cerrarModalLotesAvanzado" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscanerAvanzado"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListadoAvanzado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Productos Escaneados (<span id="contadorProductosAvanzado">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscanerAvanzado" class="mb-4">
                        <div id="scanner-container-lotes-avanzado" class="mb-4">
                            <div id="reader-lotes-avanzado" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="accionEscaneoLotesAvanzado"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-bold"
                                style="user-select:none;">
                                Activar escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListadoAvanzado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Nombre</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio/Kg</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Tipo</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoProductosAvanzado">
                                    <!-- Los productos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total productos: <span id="totalProductosAvanzado" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotalAvanzado" class="font-bold">0.000 Kg</span> |
                            Productos primarios: <span id="totalProductosPrimarios" class="font-bold">0</span>
                        </div>
                        <button id="finalizarEscaneoLotesAvanzado"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes Avanzado
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Edición de Producto de Lote -->
        <div id="modalEdicionProductoLote" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 10000;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-md shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">✏️ Editar Producto Escaneado</h3>
                        <button onclick="cerrarModalEdicionProducto()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Información del producto -->
                    <div class="mb-4 p-3 bg-gray-50 rounded">
                        <p class="text-sm"><strong>Producto:</strong> <span id="editProductoNombre" class="font-medium"></span></p>
                        <p class="text-sm"><strong>Código:</strong> <span id="editProductoCodigo" class="font-mono"></span></p>
                        <p class="text-sm"><strong>PLU:</strong> <span id="editProductoPLU" class="font-mono"></span></p>
                        <input type="hidden" id="editProductoId">
                    </div>

                    <!-- Campos editables -->
                    <div class="space-y-4">
                        <!-- Precio por Kilo -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                💰 Precio por Kilo ($)
                            </label>
                            <input type="number" id="editPrecioKilo" step="0.01" min="0.01"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el precio por kilo era diferente al momento de crear la etiqueta
                            </p>
                        </div>

                        <!-- Peso -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                ⚖️ Peso (Kg)
                            </label>
                            <input type="number" id="editPeso" step="0.001" min="0.001"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.000">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el peso calculado no es correcto (recalcula precio automáticamente)
                            </p>
                        </div>

                        <!-- Precio de Porción (solo lectura, se actualiza automáticamente) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                🏷️ Precio de Porción ($)
                            </label>
                            <input type="number" id="editPrecioPorcion" step="0.01" min="0.01" readonly
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                ℹ️ Se calcula automáticamente: Precio/Kg × Peso
                            </p>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="cerrarModalEdicionProducto()"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button onclick="guardarEdicionProducto()"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            💾 Guardar Cambios
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Información de Producto -->
        <div id="modalInfoProducto" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 9999;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">📋 Información del Producto</h3>
                        <button id="cerrarModalInfoProducto" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Contenido del modal -->
                    <div id="contenidoInfoProducto">
                        <!-- Se llenará dinámicamente -->
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button id="cancelarInfoProducto"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button id="guardarInfoProducto"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            Guardar Info
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes (original) -->
        <div id="modalEscaneoLotes" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
            style="display: none;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">Escaneo por Lotes</h3>
                        <button id="cerrarModalLotes" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscaner"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Códigos Escaneados (<span id="contadorCodigos">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscaner" class="mb-4">
                        <div id="scanner-container-lotes" class="mb-4">
                            <div id="reader-lotes" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="pararEscaneoLotes"
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                                Pausar Escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código Completo</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoCodigosEscaneados">
                                    <!-- Los códigos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total de códigos: <span id="totalCodigos" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotal" class="font-bold">0.00 Kg</span> |
                            Valor total porciones: <span id="precioTotalGeneral" class="font-bold">$0.00</span>
                        </div>
                        <button id="finalizarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- tabla de productos en inventario -->
    <div>
        <button id="sync-inventario-down-btn"
            class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Inventario desde Supabase
        </button>
        <button id="sincronizarManual" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Ahora
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4"> Productos en Inventario </h2>
        <div class="overflow-x-auto">
            <table id="estructura-plantilla" class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">Código</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categoría</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Tipo de Cantidad</th>
                        <th class="py-3 px-6 text-left">Cantidad</th>
                        <th class="py-3 px-6 text-left">Fecha de Caducidad</th>
                        <th class="py-3 px-6 text-left">Comentarios</th>
                        <th class="py-3 px-6 text-left">ubicacion</th>
                    </tr>
                </thead>
                <tbody id="estructuraPlantillaBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/scanner/lotes-avanzado.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;

            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);

                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;

                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversión a los campos de código cuando se cargue la página
        document.addEventListener('DOMContentLoaded', function () {
            const codigo = document.getElementById('codigo');
            const codigoProductoInventario = document.getElementById('codigoProductoInventario');

            aplicarConversionCodigo(codigo);
            // Note: codigoProductoInventario es readonly, pero aplicamos por si acaso
            aplicarConversionCodigo(codigoProductoInventario);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Sistema de Gestión de Productos</h1>
        <div class="flex items-center space-x-4">
            <!-- Indicador de estado del backend -->
            <div id="backendStatus" class="px-3 py-1 rounded-full text-sm font-semibold" 
                 title="Estado de conexión con el backend"
                 style="background-color: #fbbf24; color: #78350f;">
                ⏳ Verificando...
            </div>
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t dark-theme-sidebar-footer">
            <button id="logoutBtn" class="w-full bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded dark-theme-button">
                Cerrar Sesión
            </button>
        </div>
    </div>

    <a href="../index.html" class="text-blue-500 hover:underline mb-4 inline-block dark-theme-link">← Regresar</a>
    <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200 dark-theme-menu-toggle">
        Menú
    </button>

    <main class="container mx-auto mt-8">
        <section id="dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div id="consulta" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Consulta de Producto</h2>
                <p class="mb-4 dark-theme-card-text">Busca productos en la base de datos por diferentes criterios.</p>
                <a id="consultaLink" href="./consulta.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Consulta
                    Producto</a>
            </div>

            <div id="editar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Editar Producto</h2>
                <p class="mb-4 dark-theme-card-text">Edita los atributos de los productos existentes en la base de
                    datos.</p>
                <a id="editarLink" href="./editar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Editar
                    Producto</a>
            </div>

            <div id="inventario" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona el inventario de productos con datos adicionales.</p>
                <a id="inventarioLink" href="./inventario.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Inventario</a>
            </div>

            <div id="reporte" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Reporte para Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Genera reportes detallados del inventario de productos.</p>
                <a id="reporteLink" href="./report.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Reporte
                    para Inventario</a>
            </div>

            <div id="agregar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Agregar Productos</h2>
                <p class="mb-4 dark-theme-card-text">Escanea y agrega nuevos productos a la base de datos.</p>
                <a id="agregarLink" href="./agregar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Agregar
                    Productos</a>
            </div>

            <div id="archivos" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Administración de Archivos</h2>
                <p class="mb-4 dark-theme-card-text">Sube o descarga archivos CSV para la base de datos.</p>
                <a id="archivosLink" href="./archivos.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Archivos</a>
            </div>

            <div id="configuraciones" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Configuraciones</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona las configuraciones del sistema, perfil de usuario y
                    preferencias.</p>
                <a id="configuracionesLink" href="./configuraciones.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Configuraciones</a>
            </div>
        </section>
    </main>

    <footer class="bg-blue-600 text-white p-4 mt-8 dark-theme-footer">
        <p class="text-center dark-theme-footer-text">&copy; 2024 Sistema de Gestión de Productos. Todos los derechos
            reservados.</p>
    </footer>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>    <script type="module">
        import { backendStatusMonitor } from '../js/backend-status.js';
        
        // Monitorear estado del backend
        document.addEventListener('DOMContentLoaded', () => {
            const backendStatusEl = document.getElementById('backendStatus');
            
            // Escuchar cambios de estado del backend
            window.addEventListener('backendStatusChanged', (event) => {
                const { available } = event.detail;
                
                if (available) {
                    backendStatusEl.textContent = '🟢 Backend activo';
                    backendStatusEl.style.backgroundColor = '#dcfce7'; // green-100
                    backendStatusEl.style.color = '#166534'; // green-800
                } else {
                    backendStatusEl.textContent = '🔴 Backend no disponible';
                    backendStatusEl.style.backgroundColor = '#fee2e2'; // red-100
                    backendStatusEl.style.color = '#991b1b'; // red-900
                    
                    // Mostrar alerta una sola vez
                    if (!window.backendDownNotified) {
                        setTimeout(() => {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Backend no disponible',
                                text: 'La aplicación funcionará en modo offline. Los cambios se sincronizarán cuando el servidor esté disponible.',
                                allowOutsideClick: false,
                                didOpen: (modal) => {
                                    // Cerrar automáticamente después de 5 segundos
                                    setTimeout(() => {
                                        Swal.close();
                                    }, 5000);
                                }
                            });
                        }, 500);
                        window.backendDownNotified = true;
                    }
                }
            });
            
            // Iniciar monitoreo (cada 30 segundos)
            backendStatusMonitor.startMonitoring(30);
        });
    </script>
    <script type="module">
        import { cerrarSesion } from '../js/auth/auth.js';
        
        // Manejar botón de logout
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    const { value: rememberUser } = await Swal.fire({
                        title: 'Cerrar Sesión',
                        text: '¿Deseas que se recuerde tu usuario para el próximo login?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Sí, recordar usuario',
                        cancelButtonText: 'No, no recordar',
                        allowOutsideClick: false
                    });
                    
                    // Si cancela, no hace nada
                    if (rememberUser === undefined) return;
                    
                    // Llamar función de logout
                    await cerrarSesion(rememberUser === true);
                });
            }
        });
    </script>    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menuToggle');
            const sideMenu = document.getElementById('sideMenu');
            const closeMenu = document.getElementById('closeMenu');
            const menuRoutes = document.getElementById('menuRoutes');
            const routes = [
                { name: 'Consulta de Producto', path: './consulta.html' },
                { name: 'Editar Producto', path: './editar.html' },
                { name: 'Inventario', path: './inventario.html' },
                { name: 'Registro de Entradas', path: './registro-entradas.html' },
                { name: 'Reporte para Inventario', path: './report.html' },
                { name: 'Agregar Productos', path: './agregar.html' },
                { name: 'Administración de Archivos', path: './archivos.html' },
                { name: 'Configuraciones', path: './configuraciones.html' }
            ];

            // Generar las rutas dinámicamente
            routes.forEach(route => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline dark-theme-nav-link">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            // Mostrar el menú
            menuToggle.addEventListener('click', () => {
                sideMenu.classList.remove('-translate-x-full');
            });

            // Ocultar el menú
            closeMenu.addEventListener('click', () => {
                sideMenu.classList.add('-translate-x-full');
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Entradas</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-green-600 text-white p-4 flex justify-between items-center shadow-lg">
        <div class="flex items-center space-x-3">
            <div class="p-2 bg-green-700 rounded-lg">
                📦
            </div>
            <h1 class="text-3xl font-bold tracking-wide">Registro de Entradas</h1>
        </div>
        <div class="flex items-center space-x-6">
            <div id="conexionStatus" class="text-sm flex items-center space-x-2 bg-green-700 px-3 py-1 rounded-full">
                <span class="status-indicator status-success"></span>
                <span>Conectado</span>
            </div>
            <div id="clockDisplay" class="text-sm font-mono bg-green-700 px-3 py-1 rounded-full"></div>
            <div class="text-sm bg-green-700 px-3 py-1 rounded-full">
                <span id="totalEntradas">0</span> entradas registradas
            </div>
        </div>
    </header>
    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform z-50">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>
    <div class="container mx-auto mt-8 p-4">
        <div class="mb-6 flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center space-x-4">
                <h1 class="text-4xl font-bold text-gray-800 flex items-center">
                    📦 Registro de Entradas
                    <span class="ml-3 text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                        Sistema de Gesti�n
                    </span>
                </h1>
            </div>
            <div class="flex items-center space-x-3">
                <a href="./main.html"
                    class="text-green-600 hover:text-green-800 hover:underline font-medium flex items-center space-x-2 transition-colors">
                    <span>←</span>
                    <span>Regresar al Men� Principal</span>
                </a>
                <button id="menuToggle"
                    class="bg-white text-green-600 px-4 py-2 rounded-lg hover:bg-green-50 border-2 border-green-600 font-semibold transition-all hover:shadow-md">
                    📋 Men� de Navegaci�n
                </button>
            </div>
        </div> <!-- Secci�n de b�squeda de productos -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                🔍 Buscar Producto
                <span id="searchStatus" class="ml-3 text-sm"></span>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="ultimaBusqueda"></span>
                </div>
            </h2>

            <div class="grid md:grid-cols-3 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ Buscar por C�digo:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaCodigo"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese c�digo del producto">
                        <button id="buscarPorCodigo"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnCodigoText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 Buscar por Nombre:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaNombre"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese nombre del producto">
                        <button id="buscarPorNombre"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnNombreText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 Buscar por Marca:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaMarca"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese marca del producto">
                        <button id="buscarPorMarca"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnMarcaText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-center">
                <button id="escanearBtn"
                    class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                    <span>📷</span>
                    <span>Escanear C�digo de Barras</span>
                </button>
            </div>

            <!-- Mensaje de b�squeda reciente -->
            <div id="busquedaReciente" class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 rounded"
                style="display: none;">
                <p class="text-sm text-blue-700">
                    <strong>B�squeda reciente:</strong> <span id="textoUltimaBusqueda"></span>
                </p>
            </div>
        </div> <!-- Formulario de datos del producto y entrada -->
        <div id="productForm"
            class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover"
            style="display: none;">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                📦 Datos del Producto
                <div id="productLoadingIndicator" class="ml-3" style="display: none;">
                    <div
                        class="inline-block w-4 h-4 border-2 border-green-500 border-t-transparent rounded-full animate-spin">
                    </div>
                    <span class="ml-2">Cargando informaci�n...</span>
                </div>
                <div class="ml-auto">
                    <span class="text-sm text-gray-500 bg-green-100 px-3 py-1 rounded-full">
                        Producto encontrado ✅
                    </span>
                </div>
            </h2>

            <div id="productInfo"
                class="grid md:grid-cols-2 gap-6 mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border-2 border-green-200 shadow-inner">
                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="codigoProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">C�digo del Producto:</span>
                        </label>
                        <input type="text" id="codigoProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-mono text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="nombreProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📝 <span class="ml-2">Nombre del Producto:</span>
                        </label>
                        <input type="text" id="nombreProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-semibold text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="marcaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏢 <span class="ml-2">Marca:</span>
                        </label>
                        <input type="text" id="marcaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="categoriaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📂 <span class="ml-2">Categor�a:</span>
                        </label>
                        <input type="text" id="categoriaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="unidadProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📏 <span class="ml-2">Unidad de Medida:</span>
                        </label>
                        <input type="text" id="unidadProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <!-- Informaci�n adicional del stock actual -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="text-sm font-semibold text-blue-700 mb-2">📊 Stock Actual</h4>
                        <div class="text-2xl font-bold text-blue-600" id="stockActual">--</div>
                        <div class="text-xs text-blue-500">unidades disponibles</div>
                    </div>
                </div>
            </div>
            <div class="border-t-2 border-gray-200 pt-8">
                <h3 class="text-lg font-semibold mb-6 text-green-600 flex items-center">
                    📝 Datos de la Entrada
                    <span class="ml-3 text-sm text-gray-500 bg-yellow-100 px-3 py-1 rounded-full">
                        * Campos obligatorios
                    </span>
                    <div class="ml-auto text-sm text-gray-400">
                        <span id="fechaActual"></span>
                    </div>
                </h3>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="transform transition-all hover:scale-105">
                        <label for="cantidadEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📊 <span class="ml-2">Cantidad Recibida *:</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="cantidadEntrada"
                                class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg font-semibold"
                                min="0.01" step="0.01" required placeholder="0.00">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <span id="unidadMedida">unidades</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">Ingrese la cantidad exacta recibida</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="fechaEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📅 <span class="ml-2">Fecha de Entrada *:</span>
                        </label>
                        <input type="date" id="fechaEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg"
                            required>
                        <div class="text-xs text-gray-500 mt-1">Fecha en que se recibi� el producto</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="loteEntrada" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">N�mero de Lote:</span>
                        </label>
                        <input type="text" id="loteEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                            placeholder="Opcional">
                        <div class="text-xs text-gray-500 mt-1">N�mero de lote del proveedor</div>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="comentariosEntrada"
                        class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        💬 <span class="ml-2">Comentarios y Observaciones:</span>
                    </label>
                    <textarea id="comentariosEntrada"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                        rows="4"
                        placeholder="Informaci�n adicional: estado del producto, observaciones del proveedor, condiciones especiales..."></textarea>
                </div>

                <div class="flex justify-between items-center bg-gray-50 p-4 rounded-lg">
                    <button id="limpiarFormulario"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>🗑️</span>
                        <span>Limpiar Formulario</span>
                    </button>
                    <button id="registrarEntrada"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnRegistrarText">✅ Registrar Entrada</span>
                    </button>
                </div>

                <!-- Resumen de la entrada -->
                <div id="resumenEntrada" class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded"
                    style="display: none;">
                    <h4 class="font-semibold text-blue-700 mb-2">📋 Resumen de la Entrada:</h4>
                    <div id="textoResumen" class="text-sm text-blue-600"></div>
                </div>
            </div>
        </div> <!-- Filtros y controles -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-blue-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-blue-600 flex items-center">
                🔧 Filtros y Controles del Sistema
                <div id="syncStatus" class="ml-3 text-sm"></div>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="estadoSistema" class="bg-green-100 text-green-700 px-3 py-1 rounded-full">
                        Sistema Operativo
                    </span>
                </div>
            </h2>

            <div class="grid md:grid-cols-4 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="filtroCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ <span class="ml-2">Filtrar por C�digo:</span>
                    </label>
                    <input type="text" id="filtroCodigo"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="C�digo del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 <span class="ml-2">Filtrar por Nombre:</span>
                    </label>
                    <input type="text" id="filtroNombre"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Nombre del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 <span class="ml-2">Filtrar por Marca:</span>
                    </label>
                    <input type="text" id="filtroMarca"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Marca del producto...">
                </div>

                <div class="flex items-end space-x-2">
                    <button id="filtrarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🔍</span>
                        <span>Filtrar</span>
                    </button>
                    <button id="limpiarFiltros"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🗑️</span>
                        <span>Limpiar</span>
                    </button>
                </div>
            </div>

            <!-- Filtros de fecha -->
            <div class="grid md:grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-lg">
                <div>
                    <label for="fechaDesde" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Desde:</span>
                    </label>
                    <input type="date" id="fechaDesde"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div>
                    <label for="fechaHasta" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Hasta:</span>
                    </label>
                    <input type="date" id="fechaHasta"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div class="flex items-end">
                    <button id="filtrarPorFecha"
                        class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all w-full">
                        📊 Filtrar por Fechas
                    </button>
                </div>
            </div>

            <div class="flex flex-wrap gap-4 justify-between items-center">
                <div class="flex flex-wrap gap-3">
                    <button id="sincronizarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnSincText">🔄 Sincronizar con Servidor</span>
                    </button>
                    <button id="generarReporte"
                        class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-3 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>📊</span>
                        <span>Generar Reporte CSV</span>
                    </button>
                    <button id="autoRefresh"
                        class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white px-6 py-3 rounded-lg hover:from-indigo-600 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>⚡</span>
                        <span>Auto-actualizaci�n: OFF</span>
                    </button>
                </div>

                <div class="flex items-center space-x-3 text-sm text-gray-600">
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">�ltima sincronizaci�n:</span>
                        <span id="ultimaSync">--:--</span>
                    </div>
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">Estado:</span>
                        <span id="estadoConexion" class="text-green-600">Conectado</span>
                    </div>
                </div>
            </div>
        </div> <!-- Tabla de entradas -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-purple-500 card-hover">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-purple-600 flex items-center">
                        📋 Historial de Entradas del Sistema
                        <div id="tableLoadingIndicator" class="ml-3" style="display: none;">
                            <div
                                class="inline-block w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin">
                            </div>
                            <span class="ml-2 text-sm">Actualizando datos...</span>
                        </div>
                    </h2>
                    <div class="flex items-center space-x-4 mt-2">
                        <p id="contadorEntradas" class="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                            Total: 0 entradas registradas
                        </p>
                        <div class="text-sm text-gray-500">
                            <span id="rangoFechas">Mostrando todas las entradas</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="refreshTable"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Actualizar tabla">
                        <span>🔄</span>
                        <span class="hidden md:inline">Actualizar</span>
                    </button>
                    <button id="exportVisible"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Exportar datos visibles">
                        <span>📥</span>
                        <span class="hidden md:inline">Exportar</span>
                    </button>
                    <button id="expandirTabla"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Expandir/Contraer tabla">
                        <span>⛶</span>
                        <span class="hidden md:inline">Expandir</span>
                    </button>
                </div>
            </div>

            <!-- Barra de b�squeda r�pida -->
            <div class="mb-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <input type="text" id="busquedaRapida"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                        placeholder="🔍 B�squeda r�pida en la tabla...">
                    <select id="ordenarPor"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="fecha-desc">M�s reciente primero</option>
                        <option value="fecha-asc">M�s antiguo primero</option>
                        <option value="cantidad-desc">Mayor cantidad primero</option>
                        <option value="cantidad-asc">Menor cantidad primero</option>
                        <option value="nombre-asc">Nombre A-Z</option>
                        <option value="nombre-desc">Nombre Z-A</option>
                    </select>
                </div>
                <div class="text-sm text-gray-500">
                    <span id="resultadosBusqueda"></span>
                </div>
            </div>

            <div class="overflow-x-auto shadow-lg rounded-lg">
                <table class="min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg">
                    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('codigo')">
                                <div class="flex items-center space-x-1">
                                    <span>🏷️ C�digo</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('nombre')">
                                <div class="flex items-center space-x-1">
                                    <span>📝 Nombre</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('marca')">
                                <div class="flex items-center space-x-1">
                                    <span>🏢 Marca</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('categoria')">
                                <div class="flex items-center space-x-1">
                                    <span>📂 Categor�a</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('unidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📏 Unidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('cantidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📊 Cantidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('fecha')">
                                <div class="flex items-center space-x-1">
                                    <span>📅 Fecha</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                                💬 Comentarios
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ⚙️ Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tablaEntradasBody" class="bg-white divide-y divide-gray-200">
                        <!-- Las entradas se cargar�n din�micamente aqu� -->
                        <tr class="text-center text-gray-500 bg-gray-50">
                            <td colspan="9" class="px-6 py-8">
                                <div class="flex flex-col items-center space-y-3">
                                    <div class="text-4xl">📦</div>
                                    <div class="text-lg font-medium">No hay entradas registradas</div>
                                    <div class="text-sm">Las entradas aparecer�n aqu� cuando se registren productos
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginaci�n -->
            <div class="mt-6 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-600">Mostrar:</span>
                    <select id="registrosPorPagina" class="border border-gray-200 rounded p-1 text-sm">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="text-sm text-gray-600">registros por p�gina</span>
                </div>
                <div id="paginacion" class="flex items-center space-x-2">
                    <!-- Los controles de paginaci�n se generar�n din�micamente -->
                </div>
            </div>
        </div> <!-- Scanner container -->
        <div id="scanner-container"
            class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 backdrop-blur-sm"
            style="display: none;">
            <div
                class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl border-4 border-green-500 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        📷 <span class="ml-2">Esc�ner de C�digo de Barras</span>
                    </h3>
                    <button id="cerrarEscaner"
                        class="text-red-500 hover:text-red-700 text-2xl font-bold transition-colors transform hover:scale-110">
                        ✕
                    </button>
                </div>

                <div class="mb-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                    <p class="text-sm text-blue-700">
                        <strong>Instrucciones:</strong> Coloque el c�digo de barras dentro del marco verde.
                        El esc�ner detectar� autom�ticamente el c�digo.
                    </p>
                </div>

                <div id="reader" class="w-full mb-6 rounded-lg overflow-hidden border-4 border-green-200 shadow-lg">
                </div>

                <div class="flex space-x-3">
                    <button id="detenerEscaner"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 w-full transition-all transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2">
                        <span>🛑</span>
                        <span>Detener Esc�ner</span>
                    </button>
                </div>

                <!-- Estado del esc�ner -->
                <div id="estadoEscaner" class="mt-4 text-center text-sm text-gray-600">
                    <div class="flex items-center justify-center space-x-2">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span>Esc�ner activo - Listo para escanear</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../librer�as/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script src="../js/utils/extension-conflict-detector.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script type="module" src="../js/core/registro-entradas-operations.js"></script>
    <script type="module">
        import { inicializarRegistroEntradas } from '../js/registro-entradas-operations.js';
        import { inicializarDB } from '../js/db-operations.js';
        import { toggleEscaner } from '../js/scanner.js';        // Inicializar cuando el DOM est� cargado
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Inicializar base de datos principal
                await inicializarDB();

                // Inicializar p�gina de registro de entradas
                await inicializarRegistroEntradas();

                // Configurar esc�ner
                const escanearBtn = document.getElementById('escanearBtn');
                if (escanearBtn) {
                    escanearBtn.addEventListener('click', () => {
                        toggleEscaner('busquedaCodigo', 'scanner-container');
                    });
                }

                const cerrarEscaner = document.getElementById('cerrarEscaner');
                const detenerEscaner = document.getElementById('detenerEscaner');

                if (cerrarEscaner) {
                    cerrarEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                if (detenerEscaner) {
                    detenerEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                // Inicializar funcionalidades din�micas
                initializeDynamicFeatures();

                console.log('P�gina de registro de entradas inicializada correctamente');

            } catch (error) {
                console.error('Error al inicializar p�gina de registro de entradas:', error);
            }
        });        // Funcionalidades din�micas
        function initializeDynamicFeatures() {
            // Reloj en tiempo real
            updateClock();
            setInterval(updateClock, 1000);

            // Estado de conexi�n
            updateConnectionStatus();
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);

            // Auto-actualizaci�n
            setupAutoRefresh();

            // Efectos de carga
            setupLoadingEffects();

            // Animaciones de entrada
            setupEntranceAnimations();

            // Notificaciones din�micas
            setupDynamicNotifications();

            // Configurar fecha actual
            setupCurrentDate();

            // B�squeda r�pida en tabla
            setupQuickSearch();

            // Autocompletado
            setupAutoComplete();

            // Atajos de teclado
            setupKeyboardShortcuts();

            // Validaciones en tiempo real
            setupRealTimeValidation();
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            const clockDisplay = document.getElementById('clockDisplay');
            if (clockDisplay) {
                clockDisplay.innerHTML = `${timeString}<br><span class="text-xs">${dateString}</span>`;
            }

            // Actualizar fecha actual en el resumen
            const fechaActual = document.getElementById('fechaActual');
            if (fechaActual) {
                fechaActual.textContent = `Hoy: ${dateString}`;
            }
        }

        function updateConnectionStatus() {
            const statusElement = document.getElementById('conexionStatus');
            const estadoConexion = document.getElementById('estadoConexion');

            if (statusElement || estadoConexion) {
                const isOnline = navigator.onLine;
                const status = isOnline
                    ? '<span class="status-indicator status-success"></span>Conectado'
                    : '<span class="status-indicator status-error"></span>Sin conexi�n';

                if (statusElement) statusElement.innerHTML = status;
                if (estadoConexion) {
                    estadoConexion.textContent = isOnline ? 'Conectado' : 'Sin conexi�n';
                    estadoConexion.className = isOnline ? 'text-green-600' : 'text-red-600';
                }

                // Actualizar estado del sistema
                const estadoSistema = document.getElementById('estadoSistema');
                if (estadoSistema) {
                    if (isOnline) {
                        estadoSistema.className = 'bg-green-100 text-green-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Operativo';
                    } else {
                        estadoSistema.className = 'bg-red-100 text-red-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Offline';
                    }
                }
            }
        }

        function setupCurrentDate() {
            const fechaEntrada = document.getElementById('fechaEntrada');
            if (fechaEntrada && !fechaEntrada.value) {
                const today = new Date().toISOString().split('T')[0];
                fechaEntrada.value = today;
            }
        }

        function setupQuickSearch() {
            const busquedaRapida = document.getElementById('busquedaRapida');
            if (busquedaRapida) {
                busquedaRapida.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#tablaEntradasBody tr');
                    let visibleCount = 0;

                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        const isVisible = text.includes(searchTerm);
                        row.style.display = isVisible ? '' : 'none';
                        if (isVisible && !row.classList.contains('text-center')) visibleCount++;
                    });

                    // Actualizar contador de resultados
                    const resultados = document.getElementById('resultadosBusqueda');
                    if (resultados) {
                        resultados.textContent = searchTerm ?
                            `${visibleCount} resultado${visibleCount !== 1 ? 's' : ''} encontrado${visibleCount !== 1 ? 's' : ''}` :
                            '';
                    }
                });
            }
        }

        function setupAutoComplete() {
            // Autocompletado para campos de b�squeda
            const campos = ['busquedaCodigo', 'busquedaNombre', 'busquedaMarca'];
            campos.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.addEventListener('input', debounce((e) => {
                        // Aqu� se implementar�a la l�gica de autocompletado
                        showAutoCompleteHint(campo, e.target.value);
                    }, 300));
                }
            });
        }

        function showAutoCompleteHint(element, value) {
            if (value.length < 2) return;

            // Simular sugerencias (en producci�n vendr�a de la base de datos)
            const hints = ['Producto A', 'Producto B', 'Marca X', 'Marca Y'];
            const matchingHints = hints.filter(hint =>
                hint.toLowerCase().includes(value.toLowerCase())
            );

            // Mostrar hint visual
            if (matchingHints.length > 0) {
                element.title = `Sugerencia: ${matchingHints[0]}`;
                element.style.borderColor = '#10B981';
            } else {
                element.title = '';
                element.style.borderColor = '';
            }
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl + F para buscar
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    const busquedaRapida = document.getElementById('busquedaRapida');
                    if (busquedaRapida) {
                        busquedaRapida.focus();
                        busquedaRapida.select();
                    }
                }

                // Ctrl + S para sincronizar
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    const sincBtn = document.getElementById('sincronizarEntradas');
                    if (sincBtn) sincBtn.click();
                }

                // Ctrl + R para actualizar tabla
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    const refreshBtn = document.getElementById('refreshTable');
                    if (refreshBtn) refreshBtn.click();
                }

                // ESC para cerrar modales
                if (e.key === 'Escape') {
                    const scanner = document.getElementById('scanner-container');
                    if (scanner && scanner.style.display !== 'none') {
                        scanner.style.display = 'none';
                    }
                }
            });
        }

        function setupRealTimeValidation() {
            const cantidadInput = document.getElementById('cantidadEntrada');
            if (cantidadInput) {
                cantidadInput.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    const isValid = value > 0;

                    if (isValid) {
                        e.target.classList.remove('border-red-500');
                        e.target.classList.add('border-green-500');
                        updateEntryPreview();
                    } else {
                        e.target.classList.remove('border-green-500');
                        e.target.classList.add('border-red-500');
                    }
                });
            }

            // Validaci�n de fecha
            const fechaInput = document.getElementById('fechaEntrada');
            if (fechaInput) {
                fechaInput.addEventListener('change', (e) => {
                    const selectedDate = new Date(e.target.value);
                    const today = new Date();
                    const maxDate = new Date();
                    maxDate.setDate(today.getDate() + 30); // M�ximo 30 d�as en el futuro

                    if (selectedDate > maxDate) {
                        e.target.classList.add('border-yellow-500');
                        showToast('⚠️ La fecha seleccionada est� muy lejos en el futuro', 'warning');
                    } else {
                        e.target.classList.remove('border-yellow-500');
                        updateEntryPreview();
                    }
                });
            }
        }

        function updateEntryPreview() {
            const codigo = document.getElementById('codigoProducto')?.value;
            const nombre = document.getElementById('nombreProducto')?.value;
            const cantidad = document.getElementById('cantidadEntrada')?.value;
            const fecha = document.getElementById('fechaEntrada')?.value;
            const unidad = document.getElementById('unidadProducto')?.value;

            if (codigo && nombre && cantidad && fecha) {
                const resumen = document.getElementById('resumenEntrada');
                const textoResumen = document.getElementById('textoResumen');

                if (resumen && textoResumen) {
                    textoResumen.innerHTML = `
                        <strong>${nombre}</strong> (${codigo})<br>
                        Cantidad: <strong>${cantidad} ${unidad || 'unidades'}</strong><br>
                        Fecha: <strong>${new Date(fecha).toLocaleDateString('es-ES')}</strong>
                    `;
                    resumen.style.display = 'block';
                }
            }
        }

        // Funci�n auxiliar para debounce
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Funci�n para mostrar mensajes toast
        function showToast(message, type = 'info') {
            // Implementaci�n simple de toast
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-500' :
                    type === 'warning' ? 'bg-yellow-500' :
                        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                } text-white`;
            toast.textContent = message;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Funci�n para ordenar tabla
        function sortTable(column) {
            console.log(`Ordenando por: ${column}`);
            // Aqu� se implementar�a la l�gica de ordenamiento
        } function setupAutoRefresh() {
            let autoRefreshEnabled = false;
            let autoRefreshInterval;

            const autoRefreshBtn = document.getElementById('autoRefresh');
            if (autoRefreshBtn) {
                autoRefreshBtn.addEventListener('click', () => {
                    autoRefreshEnabled = !autoRefreshEnabled;

                    if (autoRefreshEnabled) {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: ON</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');

                        autoRefreshInterval = setInterval(() => {
                            refreshTableData();
                            updateLastSyncTime();
                        }, 30000); // Cada 30 segundos

                        showToast('✅ Auto-actualizaci�n activada', 'success');
                    } else {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: OFF</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');

                        if (autoRefreshInterval) {
                            clearInterval(autoRefreshInterval);
                        }
                        showToast('⏸️ Auto-actualizaci�n desactivada', 'info');
                    }
                });
            }
        }

        function updateLastSyncTime() {
            const ultimaSync = document.getElementById('ultimaSync');
            if (ultimaSync) {
                const now = new Date();
                ultimaSync.textContent = now.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function setupLoadingEffects() {
            // Interceptar clicks en botones de b�squeda
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        const textId = btnId.replace('buscar', 'btn') + 'Text';
                        showButtonLoading(btn, textId, '🔍 Buscando...');

                        // Simular b�squeda exitosa
                        setTimeout(() => {
                            hideButtonLoading(btn, textId, '🔍 Buscar');
                            updateSearchHistory(btnId);
                        }, 2000);
                    });
                }
            });

            // Interceptar registro de entrada
            const registrarBtn = document.getElementById('registrarEntrada');
            if (registrarBtn) {
                registrarBtn.addEventListener('click', () => {
                    showButtonLoading(registrarBtn, 'btnRegistrarText', '⏳ Registrando entrada...');

                    setTimeout(() => {
                        hideButtonLoading(registrarBtn, 'btnRegistrarText', '✅ Registrar Entrada');
                        showToast('✅ Entrada registrada exitosamente', 'success');
                        updateEntryCounter();
                    }, 3000);
                });
            }

            // Interceptar sincronizaci�n
            const sincBtn = document.getElementById('sincronizarEntradas');
            if (sincBtn) {
                sincBtn.addEventListener('click', () => {
                    showButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizando con servidor...');

                    setTimeout(() => {
                        hideButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizar con Servidor');
                        showToast('✅ Sincronizaci�n completada', 'success');
                        updateLastSyncTime();
                    }, 4000);
                });
            }

            // Interceptar actualizaci�n de tabla
            const refreshBtn = document.getElementById('refreshTable');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    const indicator = document.getElementById('tableLoadingIndicator');
                    if (indicator) {
                        indicator.style.display = 'block';
                        setTimeout(() => {
                            indicator.style.display = 'none';
                            showToast('🔄 Tabla actualizada', 'info');
                        }, 2000);
                    }
                });
            }
        }

        function updateSearchHistory(searchType) {
            const busquedaReciente = document.getElementById('busquedaReciente');
            const textoUltimaBusqueda = document.getElementById('textoUltimaBusqueda');

            if (busquedaReciente && textoUltimaBusqueda) {
                const tipoTexto = {
                    'buscarPorCodigo': 'B�squeda por c�digo',
                    'buscarPorNombre': 'B�squeda por nombre',
                    'buscarPorMarca': 'B�squeda por marca'
                };

                const now = new Date().toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                textoUltimaBusqueda.textContent = `${tipoTexto[searchType]} a las ${now}`;
                busquedaReciente.style.display = 'block';

                // Ocultar despu�s de 10 segundos
                setTimeout(() => {
                    busquedaReciente.style.display = 'none';
                }, 10000);
            }
        }

        function updateEntryCounter() {
            const contador = document.getElementById('contadorEntradas');
            const totalEntradas = document.getElementById('totalEntradas');

            if (contador) {
                const currentCount = parseInt(contador.textContent.match(/\d+/) || [0])[0];
                const newCount = currentCount + 1;
                contador.textContent = `Total: ${newCount} entradas registradas`;

                // Animaci�n del contador
                contador.classList.add('animate-pulse');
                setTimeout(() => {
                    contador.classList.remove('animate-pulse');
                }, 1000);
            }

            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                totalEntradas.textContent = currentCount + 1;
            }
        }

        function showButtonLoading(button, textElementId = null, loadingText = 'Cargando...') {
            button.disabled = true;
            button.classList.add('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
                }
            } else {
                button.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
            }
        }

        function hideButtonLoading(button, textElementId = null, originalText = 'Buscar') {
            button.disabled = false;
            button.classList.remove('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.textContent = originalText;
                }
            } else {
                button.textContent = originalText;
            }
        } function setupEntranceAnimations() {
            // Animar elementos cuando aparecen
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-fade-in-up');

                        // A�adir un peque�o retraso para elementos consecutivos
                        const siblings = Array.from(entry.target.parentElement.children);
                        const index = siblings.indexOf(entry.target);
                        entry.target.style.animationDelay = `${index * 0.1}s`;
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            // Observar todas las tarjetas
            document.querySelectorAll('.card-hover').forEach(card => {
                observer.observe(card);
            });

            // Animaciones para botones al hacer hover
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('mouseenter', () => {
                    if (!button.disabled) {
                        button.style.transform = 'translateY(-2px)';
                        button.style.boxShadow = '0 10px 25px rgba(0,0,0,0.2)';
                    }
                });

                button.addEventListener('mouseleave', () => {
                    button.style.transform = 'translateY(0)';
                    button.style.boxShadow = '';
                });
            });

            // Animaci�n de aparecer para modales
            const scanner = document.getElementById('scanner-container');
            if (scanner) {
                const originalDisplay = scanner.style.display;
                scanner.addEventListener('click', (e) => {
                    if (e.target === scanner) {
                        // Cerrar al hacer click fuera del modal
                        hideModal(scanner);
                    }
                });
            }
        }

        function showModal(modal) {
            modal.style.display = 'flex';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.transition = 'all 0.3s ease';
                modal.style.opacity = '1';
                modal.style.transform = 'scale(1)';
            }, 10);
        }

        function hideModal(modal) {
            modal.style.transition = 'all 0.3s ease';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function setupDynamicNotifications() {
            // Mostrar formulario solo cuando se selecciona un producto
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        setTimeout(() => {
                            const productForm = document.getElementById('productForm');
                            const codigoProducto = document.getElementById('codigoProducto');

                            if (productForm && codigoProducto && codigoProducto.value) {
                                // Mostrar formulario con animaci�n
                                productForm.style.display = 'block';
                                productForm.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });

                                // Animaci�n de aparici�n
                                productForm.style.opacity = '0';
                                productForm.style.transform = 'translateY(30px)';

                                setTimeout(() => {
                                    productForm.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                                    productForm.style.opacity = '1';
                                    productForm.style.transform = 'translateY(0)';

                                    // Destacar el formulario brevemente
                                    productForm.classList.add('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    setTimeout(() => {
                                        productForm.classList.remove('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    }, 2000);
                                }, 100);

                                // Actualizar stock actual (simulado)
                                updateStockDisplay();

                                // Focus en el primer campo editable
                                const cantidadInput = document.getElementById('cantidadEntrada');
                                if (cantidadInput) {
                                    setTimeout(() => cantidadInput.focus(), 800);
                                }
                            }
                        }, 500);
                    });
                }
            });

            // Feedback visual en inputs con animaciones mejoradas
            document.querySelectorAll('input, textarea, select').forEach(input => {
                input.addEventListener('focus', (e) => {
                    e.target.style.transform = 'scale(1.02)';
                    e.target.style.transition = 'transform 0.2s ease';

                    // A�adir indicador de foco
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '#10B981';
                        label.style.transform = 'scale(1.05)';
                        label.style.transition = 'all 0.2s ease';
                    }
                });

                input.addEventListener('blur', (e) => {
                    e.target.style.transform = 'scale(1)';

                    // Restaurar label
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '';
                        label.style.transform = 'scale(1)';
                    }
                });

                // Validaci�n visual en tiempo real
                if (input.type === 'number') {
                    input.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        if (value > 0) {
                            e.target.style.borderColor = '#10B981';
                            e.target.style.backgroundColor = '#F0FDF4';
                        } else if (e.target.value) {
                            e.target.style.borderColor = '#EF4444';
                            e.target.style.backgroundColor = '#FEF2F2';
                        } else {
                            e.target.style.borderColor = '';
                            e.target.style.backgroundColor = '';
                        }
                    });
                }
            });

            // Animaciones para las filas de la tabla
            setupTableRowAnimations();

            // Notificaciones de estado del sistema
            setupSystemStatusNotifications();
        }

        function updateStockDisplay() {
            const stockActual = document.getElementById('stockActual');
            if (stockActual) {
                // Simular datos de stock
                const stock = Math.floor(Math.random() * 500) + 10;
                stockActual.textContent = stock;

                // Animaci�n del contador
                stockActual.style.transform = 'scale(1.2)';
                stockActual.style.transition = 'transform 0.3s ease';

                setTimeout(() => {
                    stockActual.style.transform = 'scale(1)';
                }, 300);

                // Color basado en el stock
                if (stock < 50) {
                    stockActual.className = 'text-2xl font-bold text-red-600';
                    stockActual.parentElement.className = 'bg-red-50 p-4 rounded-lg border border-red-200';
                } else if (stock < 100) {
                    stockActual.className = 'text-2xl font-bold text-yellow-600';
                    stockActual.parentElement.className = 'bg-yellow-50 p-4 rounded-lg border border-yellow-200';
                } else {
                    stockActual.className = 'text-2xl font-bold text-green-600';
                    stockActual.parentElement.className = 'bg-green-50 p-4 rounded-lg border border-green-200';
                }
            }
        }

        function setupTableRowAnimations() {
            // Observador para filas de tabla
            const tableObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeName === 'TR' && !node.classList.contains('text-center')) {
                                // Animar nueva fila
                                node.style.opacity = '0';
                                node.style.transform = 'translateX(-20px)';

                                setTimeout(() => {
                                    node.style.transition = 'all 0.5s ease';
                                    node.style.opacity = '1';
                                    node.style.transform = 'translateX(0)';
                                }, 100);

                                // Efectos hover mejorados
                                node.addEventListener('mouseenter', () => {
                                    node.style.backgroundColor = '#F0FDF4';
                                    node.style.transform = 'scale(1.01)';
                                    node.style.transition = 'all 0.2s ease';
                                    node.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
                                });

                                node.addEventListener('mouseleave', () => {
                                    node.style.backgroundColor = '';
                                    node.style.transform = 'scale(1)';
                                    node.style.boxShadow = '';
                                });
                            }
                        });
                    }
                });
            });

            const tableBody = document.getElementById('tablaEntradasBody');
            if (tableBody) {
                tableObserver.observe(tableBody, { childList: true });
            }
        }

        function setupSystemStatusNotifications() {
            // Notificaciones peri�dicas de estado
            setInterval(() => {
                if (Math.random() < 0.1) { // 10% de probabilidad cada minuto
                    const messages = [
                        '✅ Sistema funcionando correctamente',
                        '📊 Base de datos sincronizada',
                        '🔄 Datos actualizados autom�ticamente',
                        '📈 Rendimiento �ptimo del sistema'
                    ];

                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    showToast(randomMessage, 'success');
                }
            }, 60000); // Cada minuto
        } function refreshTableData() {
            const indicator = document.getElementById('tableLoadingIndicator');
            if (indicator) {
                indicator.style.display = 'block';

                // Simular carga de datos
                setTimeout(() => {
                    indicator.style.display = 'none';
                    updateLastSyncTime();

                    // Actualizar contador si hay datos
                    const tbody = document.getElementById('tablaEntradasBody');
                    if (tbody) {
                        const rows = tbody.querySelectorAll('tr:not(.text-center)');
                        const contador = document.getElementById('contadorEntradas');
                        if (contador) {
                            contador.textContent = `Total: ${rows.length} entradas registradas`;
                        }
                    }
                }, 2000);
            }

            console.log('Actualizando datos de la tabla...');
        }

        // Efectos adicionales para las filas de la tabla
        function addTableRowEffects() {
            document.querySelectorAll('#tablaEntradasBody tr:not(.text-center)').forEach(row => {
                // Eliminar eventos anteriores para evitar duplicados
                row.removeEventListener('mouseenter', handleRowHover);
                row.removeEventListener('mouseleave', handleRowLeave);

                // A�adir nuevos eventos
                row.addEventListener('mouseenter', handleRowHover);
                row.addEventListener('mouseleave', handleRowLeave);
            });
        }

        function handleRowHover(e) {
            e.target.style.backgroundColor = '#F0FDF4';
            e.target.style.transform = 'scale(1.01)';
            e.target.style.transition = 'all 0.2s ease';
            e.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        }

        function handleRowLeave(e) {
            e.target.style.backgroundColor = '';
            e.target.style.transform = 'scale(1)';
            e.target.style.boxShadow = '';
        }

        // Inicializar mejoras adicionales al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                addTableRowEffects();
                initializeAdditionalFeatures();
            }, 1000);
        });

        // Caracter�sticas adicionales
        function initializeAdditionalFeatures() {
            // Configurar filtros de fecha inteligentes
            setupIntelligentDateFilters();

            // Configurar exportaci�n mejorada
            setupEnhancedExport();

            // Configurar modo expandido de tabla
            setupTableExpandMode();

            // Configurar estad�sticas en tiempo real
            setupRealTimeStats();
        }

        function setupIntelligentDateFilters() {
            const filtrarPorFecha = document.getElementById('filtrarPorFecha');
            if (filtrarPorFecha) {
                filtrarPorFecha.addEventListener('click', () => {
                    const fechaDesde = document.getElementById('fechaDesde').value;
                    const fechaHasta = document.getElementById('fechaHasta').value;

                    if (fechaDesde && fechaHasta) {
                        const rangoFechas = document.getElementById('rangoFechas');
                        if (rangoFechas) {
                            const desde = new Date(fechaDesde).toLocaleDateString('es-ES');
                            const hasta = new Date(fechaHasta).toLocaleDateString('es-ES');
                            rangoFechas.textContent = `Mostrando entradas del ${desde} al ${hasta}`;
                        }
                        showToast(`📅 Filtro aplicado: ${fechaDesde} a ${fechaHasta}`, 'info');
                    } else {
                        showToast('⚠️ Seleccione ambas fechas para filtrar', 'warning');
                    }
                });
            }
        }

        function setupEnhancedExport() {
            const exportBtn = document.getElementById('exportVisible');
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    showToast('📥 Preparando exportaci�n...', 'info');

                    setTimeout(() => {
                        showToast('✅ Datos exportados exitosamente', 'success');
                    }, 2000);
                });
            }
        }

        function setupTableExpandMode() {
            const expandBtn = document.getElementById('expandirTabla');
            let isExpanded = false;

            if (expandBtn) {
                expandBtn.addEventListener('click', () => {
                    const tableContainer = expandBtn.closest('.bg-white');

                    if (!isExpanded) {
                        tableContainer.classList.add('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Contraer</span>';
                        isExpanded = true;
                        showToast('⛶ Tabla expandida', 'info');
                    } else {
                        tableContainer.classList.remove('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Expandir</span>';
                        isExpanded = false;
                        showToast('⛶ Tabla contra�da', 'info');
                    }
                });
            }
        }

        function setupRealTimeStats() {
            // Actualizar estad�sticas cada 30 segundos
            setInterval(() => {
                updateSystemStats();
            }, 30000);

            // Actualizaci�n inicial
            updateSystemStats();
        }

        function updateSystemStats() {
            // Simular actualizaci�n de estad�sticas
            const totalEntradas = document.getElementById('totalEntradas');
            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                if (Math.random() < 0.3) { // 30% de probabilidad de incremento
                    totalEntradas.textContent = currentCount + Math.floor(Math.random() * 3) + 1;
                }
            }
        }

        // CSS para animaciones adicionales
        const additionalStyles = `
            <style>
                .animate-fade-in-up {
                    animation: fadeInUp 0.6s ease-out forwards;
                }
                
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(30px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .status-indicator {
                    display: inline-block;
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    margin-right: 6px;
                }
                
                .status-success {
                    background-color: #10B981;
                    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
                }
                
                .status-error {
                    background-color: #EF4444;
                    box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
                }
                
                .card-hover {
                    transition: all 0.3s ease;
                }
                
                .card-hover:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                }
                
                .loading-spinner {
                    border: 2px solid #f3f3f3;
                    border-top: 2px solid #3498db;
                    border-radius: 50%;
                    width: 16px;
                    height: 16px;
                    animation: spin 1s linear infinite;
                }
                
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                
                /* Efectos de hover mejorados */
                button:not(:disabled):hover {
                    transform: translateY(-1px) !important;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                }
                
                input:focus, textarea:focus, select:focus {
                    transform: scale(1.01);
                    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
                }
                
                /* Animaciones para modales */
                .modal-enter {
                    animation: modalEnter 0.3s ease-out forwards;
                }
                
                @keyframes modalEnter {
                    from {
                        opacity: 0;
                        transform: scale(0.9);
                    }
                    to {
                        opacity: 1;
                        transform: scale(1);
                    }
                }
                
                /* Efectos de tabla mejorados */
                table th {
                    position: relative;
                    overflow: hidden;
                }
                
                table th:hover::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    animation: shimmer 1.5s ease-in-out;
                }
                
                @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
            </style>
        `;

        // A�adir estilos al head
        document.head.insertAdjacentHTML('beforeend', additionalStyles);

        // Llamar despu�s de cargar datos en la tabla
        window.addEventListener('load', () => {
            setTimeout(addTableRowEffects, 1000);
        });

        // Funci�n para convertir gui�n a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Funci�n para aplicar la conversi�n a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversi�n a los campos de c�digo cuando se cargue la p�gina
        document.addEventListener('DOMContentLoaded', function() {
            const busquedaCodigo = document.getElementById('busquedaCodigo');
            const codigoProducto = document.getElementById('codigoProducto');
            const filtroCodigo = document.getElementById('filtroCodigo');
            
            aplicarConversionCodigo(busquedaCodigo);
            aplicarConversionCodigo(codigoProducto);
            aplicarConversionCodigo(filtroCodigo);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Preconteo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <script src="../librer�as/JsBarcode.all.min.js"></script>
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>

    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    </script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-xl font-bold">Reporte de Preconteo</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <nav class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-xl font-bold">GestorInventory</h1>
            <a href="./main.html" class="hover:underline">Regresar</a>
            <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
                Men�
            </button>
        </div>
    </nav>

    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold text-center mb-6">Generador de Reportes de Preconteo</h1>

        <div class="mb-6 bg-white p-4 rounded shadow">
            <div class="mb-4">
                <label class="block font-semibold mb-2">Selecciona una o varias �reas:</label>
                <div id="areasContainer" class="grid grid-cols-2 md:grid-cols-3 gap-2 border rounded p-3">
                    <!-- Las �reas se cargar�n din�micamente como checkboxes -->
                    <div class="flex items-center">
                        <input type="checkbox" id="area-todas" value="todas" class="areaCheckbox mr-2" checked>
                        <label for="area-todas">Todas las �reas</label>
                    </div>
                </div>
                <div class="mt-2 text-right">
                    <button id="aplicarFiltroBtn" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">
                        Aplicar filtro
                    </button>
                </div>
            </div>

            <div id="loadingIndicator" class="hidden">
                <div class="flex items-center justify-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                    <span class="ml-2">Cargando productos...</span>
                </div>
            </div>

            <div id="productosList" class="mt-4">
                <h2 class="text-xl font-semibold mb-2">Lista de productos:</h2>
                <ul id="productosContainer" class="list-decimal pl-6 space-y-1">
                    <!-- Los productos se cargar�n din�micamente -->
                </ul>
            </div>
        </div>

        <div class="text-center">
            <button id="generarReporteBtn"
                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded">
                GENERAR REPORTE DE PRECONTEO
            </button>
        </div>

        <!-- Contenedor invisible para generar c�digos de barras -->
        <div id="barcodeContainer" class="hidden"></div>
    </div>

    <!-- Cargar nuestro script principal despu�s de asegurarnos que las dependencias est�n cargadas -->
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/reports/rep.js"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Recuperar Contraseña</h1>
            
            <form id="formPasswordReset" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Correo Electrónico</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="tu@email.com"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Enviar Enlace de Recuperación
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Recordaste tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restablecer Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Restablecer Contraseña</h1>
            
            <form id="formResetPassword" class="space-y-4">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Nueva Contraseña</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Ingresa tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-300 mb-2">Confirmar Contraseña</label>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        name="confirmPassword" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Confirma tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Restablecer Contraseña
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Ya tienes tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }

        // Manejar reset de contraseña
        document.addEventListener('DOMContentLoaded', async () => {
            const formResetPassword = document.getElementById('formResetPassword');
            
            if (formResetPassword) {
                formResetPassword.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    // Validar que las contraseñas coincidan
                    if (password !== confirmPassword) {
                        alert('Las contraseñas no coinciden');
                        return;
                    }
                    
                    // Validar longitud mínima
                    if (password.length < 6) {
                        alert('La contraseña debe tener al menos 6 caracteres');
                        return;
                    }

                    try {
                        // Obtener el hash del enlace de reseteo de la URL
                        const hash = window.location.hash;
                        
                        if (!hash) {
                            alert('Enlace de recuperación inválido');
                            return;
                        }

                        // Esperar a que Supabase esté disponible
                        let attempts = 0;
                        while (!window.supabase && attempts < 50) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }

                        if (!window.supabase) {
                            alert('Error: No se pudo cargar Supabase');
                            return;
                        }

                        const { error } = await window.supabase.auth.updateUser({
                            password: password
                        });

                        if (error) {
                            alert('Error al actualizar contraseña: ' + error.message);
                            return;
                        }

                        alert('Contraseña actualizada correctamente');
                        window.location.href = '../index.html';
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al restablecer contraseña');
                    }
                });
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesti�n de Archivos - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css" />
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css" />
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Gesti�n de Archivos</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">
                Cerrar
            </button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <div id="archivos" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Gesti�n de Archivos</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Men�
        </button>

        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">
                    Cargar Archivo CSV:
                </label>
                <input type="file" id="csvFile" accept=".csv"
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />
                <div class="mb-4">
                    <button id="descargarCSV"
                        class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                        Exportar Datos a CSV
                    </button>
                </div>
                <div class="mb-4">
                    <button id="resetearBaseDatos"
                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                        Resetear Base de Datos
                    </button>
                </div>
            </div>
        </div>

        <button class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded" id="sync-down-btn">
            Sincronizar en Bajada
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4">Base de Datos Actual</h2>
        <div class="overflow-x-auto">
            <table class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">C�digo</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categor�a</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Unidad</th>
                    </tr>
                </thead>
                <tbody id="databaseBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const menuToggle = document.getElementById("menuToggle");
            const sideMenu = document.getElementById("sideMenu");
            const closeMenu = document.getElementById("closeMenu");
            const menuRoutes = document.getElementById("menuRoutes");

            const routes = [
                { name: "Consulta de Producto", path: "./consulta.html" },
                { name: "Editar Producto", path: "./editar.html" },
                { name: "Inventario", path: "./inventario.html" },
                { name: "Reporte para Inventario", path: "./report.html" },
                { name: "Agregar Productos", path: "./agregar.html" }
            ];

            routes.forEach((route) => {
                const li = document.createElement("li");
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            menuToggle.addEventListener("click", () => {
                sideMenu.classList.remove("-translate-x-full");
            });

            closeMenu.addEventListener("click", () => {
                sideMenu.classList.add("-translate-x-full");
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraciones - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    <script src="../js/utils/theme-debug.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Configuraciones del Sistema</h1>
        <div class="flex items-center space-x-4">
            <span id="userInfo" class="text-sm font-medium"></span>
        </div>
    </header>

    <div class="container mx-auto mt-8 p-4">
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar al Dashboard</a>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Configuraciones de Usuario -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    Configuraciones de Usuario
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cambiar Contrase�a</label>
                        <button id="changePasswordBtn"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Cambiar Contrase�a
                        </button>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Informaci�n del Perfil</label>
                        <div id="profileInfo" class="bg-gray-50 p-4 rounded border">
                            <!-- Se llenar� din�micamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraciones del Sistema -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Configuraciones del Sistema
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tema de la Aplicaci�n</label>
                        <select id="themeSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="light">Claro</option>
                            <option value="dark">Oscuro</option>
                            <option value="auto">Autom�tico</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Idioma</label>
                        <select id="languageSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="es">Espa�ol</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Google Services -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                        </path>
                    </svg>
                    Credenciales de Google
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Drive API Key</label>
                        <div class="relative">
                            <input type="password" id="googleDriveApiKey"
                                class="w-full border border-gray-300 rounded px-3 py-2 pr-12"
                                placeholder="Ingresa tu API Key de Google Drive">
                            <button type="button" id="toggleDriveKey"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Necesaria para acceder a Google Drive desde la aplicaci�n
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Sheets API Key</label>
                        <div class="relative">
                            <input type="password" id="googleSheetsApiKey"
                                class="w-full border border-gray-300 rounded px-3 py-2 pr-12"
                                placeholder="Ingresa tu API Key de Google Sheets">
                            <button type="button" id="toggleSheetsKey"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Necesaria para integraci�n con Google Sheets</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ID de Google Sheets</label>
                        <input type="text" id="googleSheetsId" class="w-full border border-gray-300 rounded px-3 py-2"
                            placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                        <p class="text-xs text-gray-500 mt-1">ID de la hoja de c�lculo de Google donde se sincronizar�n
                            los datos</p>
                    </div>

                    <div class="flex space-x-2">
                        <button id="testGoogleConnection"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Probar Conexi�n
                        </button>
                        <button id="saveGoogleCredentials"
                            class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                            Guardar Credenciales
                        </button>
                        <button id="clearGoogleCredentials"
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                            Limpiar
                        </button>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mt-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">
                                    <strong>Informaci�n:</strong> Para obtener las API Keys, visita la
                                    <a href="https://console.developers.google.com/" target="_blank"
                                        class="underline hover:text-blue-800">
                                        Google Cloud Console
                                    </a> y habilita las APIs de Google Drive y Google Sheets.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Sincronizaci�n -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                        </path>
                    </svg>
                    Sincronizaci�n
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sincronizaci�n Autom�tica</label>
                        <div class="flex items-center">
                            <input type="checkbox" id="autoSyncEnabled" class="mr-2">
                            <span>Habilitar sincronizaci�n autom�tica</span>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Intervalo de Sincronizaci�n
                            (minutos)</label>
                        <input type="number" id="syncInterval" class="border border-gray-300 rounded px-3 py-2 w-full"
                            min="1" max="60" value="5">
                    </div>

                    <div class="flex space-x-2">
                        <button id="manualSyncBtn"
                            class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                            Sincronizar Ahora
                        </button>
                        <button id="resetSyncBtn"
                            class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">
                            Resetear Configuraci�n
                        </button>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Notificaciones -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-5 5v-5zM7 7h10v10H7V7z"></path>
                    </svg>
                    Notificaciones
                </h2>

                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="browserNotifications" class="mr-2">
                        <span>Notificaciones del navegador</span>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="soundNotifications" class="mr-2">
                        <span>Notificaciones sonoras</span>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="lowStockAlerts" class="mr-2">
                        <span>Alertas de stock bajo</span>
                    </div>
                </div>
            </div>

            <!-- Informaci�n del Sistema -->
            <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Informaci�n del Sistema
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">Versi�n de la Aplicaci�n</h3>
                        <p id="appVersion" class="text-lg">1.0.0</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">Estado de Conexi�n</h3>
                        <p id="connectionStatus" class="text-lg">Conectado</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">�ltima Sincronizaci�n</h3>
                        <p id="lastSync" class="text-lg">--</p>
                    </div>
                </div>

                <div class="mt-4 flex space-x-2">
                    <button id="exportConfigBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Exportar Configuraci�n
                    </button>
                    <button id="importConfigBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Importar Configuraci�n
                    </button>
                    <input type="file" id="importConfigFile" accept=".json" class="hidden">
                </div>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/configuraciones.js"></script>
</body>

</html>
<<<<<<< HEAD=======<!DOCTYPE html>
    <html lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Confirmaci�n de Correo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
        <link href="../librer�as/tailwind.min.css" rel="stylesheet">
        <link href="../css/styles.css" rel="stylesheet">
        <script src="../js/utils/theme-manager.js"></script>
        <script src="../js/ui/theme-toggle.js"></script>
    </head>

    <body class="bg-gray-100 flex items-center justify-center h-screen">
        <div class="container mx-auto p-6 max-w-md bg-white shadow-md rounded-lg text-center">
            <h1 id="statusTitle" class="text-2xl font-bold mb-4 text-blue-600">Verificando tu correo...</h1>
            <p id="statusMessage" class="text-gray-700 mb-6">Por favor, espera un momento mientras procesamos tu
                confirmaci�n.</p>
            <p id="detailsMessage" class="text-gray-600 mb-4"></p>
            <a href="../index.html"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-2 inline-block">
                Ir al Inicio de Sesi�n
            </a>
        </div>
        <script src="../js/ui/mobile-optimizer.js"></script>
        <script type="module">
            import { supabase } from '../js/auth/auth.js';

            const statusTitleEl = document.getElementById('statusTitle');
            const statusMessageEl = document.getElementById('statusMessage');
            const detailsMessageEl = document.getElementById('detailsMessage');

            // Supabase maneja la confirmaci�n del token en el backend antes de redirigir aqu�.
            // Esta p�gina muestra el resultado basado en los par�metros de la URL o el estado de la sesi�n.

            const urlParams = new URLSearchParams(window.location.search);
            const errorDescription = urlParams.get('error_description');
            // const errorCode = urlParams.get('error'); // Podr�as usarlo para errores m�s espec�ficos

            if (errorDescription) {
                statusTitleEl.textContent = 'Error en la Confirmaci�n';
                statusTitleEl.classList.remove('text-blue-600', 'text-green-600');
                statusTitleEl.classList.add('text-red-600');
                statusMessageEl.textContent = 'No pudimos confirmar tu direcci�n de correo electr�nico.';
                detailsMessageEl.textContent = `Detalles: ${decodeURIComponent(errorDescription)}`;
                detailsMessageEl.classList.add('text-red-500');
            } else {
                // Si no hay error en la URL, la confirmaci�n fue procesada por Supabase.
                // Esto puede significar que el correo se confirm� ahora o ya estaba confirmado.
                statusTitleEl.textContent = '¡Correo Verificado!';
                statusTitleEl.classList.remove('text-blue-600', 'text-red-600');
                statusTitleEl.classList.add('text-green-600');
                statusMessageEl.textContent = 'Tu direcci�n de correo electr�nico ha sido verificada exitosamente.';
                detailsMessageEl.textContent = 'Ya puedes cerrar esta ventana e iniciar sesi�n.';

                // onAuthStateChange puede dar feedback adicional si la confirmaci�n tambi�n inicia sesi�n.
                supabase.auth.onAuthStateChange((event, session) => {
                    if (event === 'SIGNED_IN' && session) {
                        detailsMessageEl.textContent = 'Has iniciado sesi�n autom�ticamente. ¡Bienvenido!';
                    } else if (event === 'USER_UPDATED' && session?.user?.email_confirmed_at) {
                        // El correo est� confirmado, el mensaje por defecto ya es apropiado.
                        // Puedes a�adir algo m�s si es necesario.
                    }
                });
            }
        </script>
    </body>

    </html>
    >>>>>>> 1e3239b (feat: A�adir enlace para recuperaci�n de contrase�a en la p�gina de inicio de sesi�n y mejorar
    mensajes de confirmaci�n de correo)
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Producto - Sistema de Gestión de Productos</title>
    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <!-- Cambiamos Quagga por Html5QrCode -->
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../librerías/sweetalert2@11.js"></script>
    <!-- Añadir JsBarcode para códigos de barra -->
    <script src="../librerías/JsBarcode.all.min.js"></script>
    <!-- Añadir jsPDF para generación de PDFs -->
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Consulta de Producto</h1>

    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="consulta" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Consulta de Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">Menú</button>

        <!-- Sistema de pestañas -->
        <div class="mb-4 mt-4">
            <nav class="flex border-b">
                <button id="tab-busqueda" class="tab-button border-b-2 border-blue-500 text-blue-600 px-4 py-2 font-semibold">Búsqueda</button>
                <button id="tab-relaciones" class="tab-button border-b-2 border-transparent text-gray-500 px-4 py-2 font-semibold">Relaciones</button>
            </nav>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-busqueda" class="tab-content">
            <form id="formConsultaProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoConsulta">Código/PLU:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoConsulta" type="text">
                        <button type="button" id="escanearBtnConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear Código de Barras</button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreConsulta">Nombre:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="nombreConsulta" type="text">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaConsulta">Categoría:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="categoriaConsulta" type="text">
                </div>
                <div class="flex items-center justify-between">
                    <button id="buscarConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">Buscar Producto</button>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
        </div>
        <div id="content-relaciones" class="tab-content" style="display:none;">
            <form id="formRelaciones" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoRelacion">Código del producto:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoRelacion" type="text" placeholder="Escanea o ingresa el código o últimos 4 dígitos">
                        <button type="button" id="escanearBtnRelacion" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear</button>
                        <button type="button" id="buscarRelacion" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Buscar Relación</button>
                    </div>
                </div>
            </form>
            <div id="relaciones" class="mt-4"></div>
        </div>

        <!-- Modificamos el contenedor del escáner -->
        <!-- En plantillas/consulta.html -->
        <div id="scanner-container-consulta" class="mt-4" style="display: none;">
            <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
            <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
        </div>

        <!-- Div to hold the barcode -->
        <div id="barcodeContainer" class="mt-4"></div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Búsqueda relacional de productos con pestañas
        document.addEventListener('DOMContentLoaded', function() {
            const codigoConsulta = document.getElementById('codigoConsulta');
            aplicarConversionCodigo(codigoConsulta);
            // Para la pestaña de relaciones
            const codigoRelacion = document.getElementById('codigoRelacion');
            if (codigoRelacion) aplicarConversionCodigo(codigoRelacion);

            // Tabs
            const tabBusqueda = document.getElementById('tab-busqueda');
            const tabRelaciones = document.getElementById('tab-relaciones');
            const contentBusqueda = document.getElementById('content-busqueda');
            const contentRelaciones = document.getElementById('content-relaciones');
            const relacionesDiv = document.getElementById('relaciones');
            let ultimoProducto = null;

            function switchTab(tab) {
                if (tab === 'busqueda') {
                    tabBusqueda.classList.add('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.remove('border-transparent', 'text-gray-500');
                    tabRelaciones.classList.remove('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'block';
                    contentRelaciones.style.display = 'none';
                } else {
                    if (tabRelaciones.disabled) return; // No cambiar si está deshabilitada
                    tabRelaciones.classList.add('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.remove('border-transparent', 'text-gray-500');
                    tabBusqueda.classList.remove('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'none';
                    contentRelaciones.style.display = 'block';
                }
            }
            tabBusqueda.addEventListener('click', () => switchTab('busqueda'));
            tabRelaciones.addEventListener('click', () => switchTab('relaciones'));
            switchTab('busqueda');

            const buscarBtn = document.getElementById('buscarConsulta');
            const resultadosDiv = document.getElementById('resultados');

            buscarBtn.addEventListener('click', async function() {
                resultadosDiv.innerHTML = '';
                ultimoProducto = null;
                const codigoInput = document.getElementById('codigoConsulta').value.trim();
                const nombre = document.getElementById('nombreConsulta').value.trim();
                const categoria = document.getElementById('categoriaConsulta').value.trim();

                // Buscar primero en IndexedDB para obtener el código completo
                function buscarEnIndexedDB(codigo, nombre, categoria) {
                    return new Promise((resolve, reject) => {
                        if (!window.indexedDB) {
                            resolve(null);
                            return;
                        }
                        const request = window.indexedDB.open('InventarioDB', 1);
                        request.onerror = function() { resolve(null); };
                        request.onsuccess = function(event) {
                            const db = event.target.result;
                            const tx = db.transaction(['productos'], 'readonly');
                            const store = tx.objectStore('productos');
                            const allReq = store.getAll();
                            allReq.onsuccess = function(e) {
                                const productos = e.target.result || [];
                                let encontrados = [];
                                if (codigo) {
                                    if (codigo.length === 4) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo.endsWith(codigo));
                                    } else if (codigo.length === 13) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    } else {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    }
                                } else if (nombre || categoria) {
                                    encontrados = productos.filter(p => {
                                        let match = true;
                                        if (nombre) match = match && p.nombre && p.nombre.toLowerCase().includes(nombre.toLowerCase());
                                        if (categoria) match = match && p.categoria && p.categoria.toLowerCase().includes(categoria.toLowerCase());
                                        return match;
                                    });
                                }
                                resolve(encontrados);
                            };
                            allReq.onerror = function() { resolve(null); };
                        };
                    });
                }

                const productosLocal = await buscarEnIndexedDB(codigoInput, nombre, categoria);
                if (!productosLocal || productosLocal.length === 0) {
                    resultadosDiv.innerHTML = '<div class="text-red-600 font-semibold">No se encontraron productos en el dispositivo.</div>';
                    return;
                }

                // Mostrar resultados principales
                productosLocal.forEach((producto, idx) => {
                    let html = `<div class="bg-white rounded shadow p-4 mb-4">
                        <h3 class="text-xl font-bold mb-2">${producto.nombre}</h3>
                        <div><b>Código:</b> ${producto.codigo}</div>
                        <div><b>Categoría:</b> ${producto.categoria}</div>
                        <div><b>Marca:</b> ${producto.marca}</div>
                        <div><b>Unidad:</b> ${producto.unidad}</div>
                    </div>`;
                    resultadosDiv.innerHTML += html;
                    if (idx === 0) ultimoProducto = producto;
                });
            });

            // Lógica independiente para la pestaña de relaciones
            const buscarRelacionBtn = document.getElementById('buscarRelacion');
            if (buscarRelacionBtn) {
                buscarRelacionBtn.addEventListener('click', async function() {
                    relacionesDiv.innerHTML = '';
                    let codigo = document.getElementById('codigoRelacion').value.trim();
                    if (!codigo) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Ingresa un código para buscar relaciones.</div>';
                        return;
                    }
                    // Permitir búsqueda por últimos 4 dígitos
                    if (codigo.length === 4) {
                        // Buscar en Supabase todos los productos cuyo substring(2,5) sea igual a esos 4 dígitos
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        // Traer todos los códigos y filtrar en JS (por compatibilidad universal)
                        const { data: productosTodos } = await supabase.from('productos').select('codigo');
                        const productos4 = (productosTodos || []).filter(p => typeof p.codigo === 'string' && p.codigo.length >= 5 && p.codigo.substring(1,5) === codigo);
                        if (productos4.length > 0) {
                            if (productos4.length > 1) {
                                relacionesDiv.innerHTML = `<div class='mb-2'>Se encontraron varios productos con los dígitos 2-5 <b>${codigo}</b>:</div>`;
                                productos4.forEach(p => {
                                    relacionesDiv.innerHTML += `<button class='bg-blue-100 hover:bg-blue-300 text-blue-800 px-2 py-1 rounded m-1' onclick='document.getElementById("codigoRelacion").value="${p.codigo}";document.getElementById("buscarRelacion").click();return false;'>${p.codigo}</button>`;
                                });
                                return;
                            } else {
                                codigo = productos4[0].codigo;
                                document.getElementById('codigoRelacion').value = codigo;
                            }
                        } else {
                            relacionesDiv.innerHTML = `<div class='text-red-600'>No se encontró ningún producto con los dígitos 2-5 igual a <b>${codigo}</b>.</div>`;
                            return;
                        }
                    }
                    relacionesDiv.innerHTML = '<div class="text-gray-500">Buscando relaciones...</div>';
                    try {
                        const { obtenerRelacionesProductosSupabase, buscarRelacionProducto } = await import('../js/relaciones-productos.js');
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        const relaciones = await obtenerRelacionesProductosSupabase();
                        const resultado = buscarRelacionProducto(codigo, relaciones);
                        // Buscar info del producto consultado
                        let relHtml = `<div class="bg-white rounded shadow p-4 mb-4">
                            <h3 class="text-lg font-bold mb-2">Relaciones para: <span class='font-mono'>${codigo}</span></h3>`;
                        const { data: productoInfo } = await supabase.from('productos').select('*').eq('codigo', codigo);
                        if (productoInfo && productoInfo.length > 0) {
                            const p = productoInfo[0];
                            relHtml += `<div class='mb-2 text-sm text-gray-700'>${p.nombre} | ${p.unidad || ''} | ${p.categoria || ''} | ${p.marca || ''}</div>`;
                        }
                        // Si es principal, mostrar subproductos
                        if (resultado.tipo === 'principal' && resultado.subproductos.length > 0) {
                            // Buscar info de subproductos
                            const { data: subproductosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos);
                            relHtml += `<div class="mt-2"><b>Subproductos relacionados:</b>
                            <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                            resultado.subproductos.forEach(subCodigo => {
                                const sub = subproductosInfo ? subproductosInfo.find(p => p.codigo === subCodigo) : null;
                                if (sub) {
                                    relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                } else {
                                    relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                }
                            });
                            relHtml += '</tbody></table></div>';
                        }
                        // Si es subproducto, mostrar principal y hermanos
                        if (resultado.tipo === 'subproducto' && resultado.principal) {
                            // Buscar info del principal
                            const { data: principalArr } = await supabase.from('productos').select('*').eq('codigo', resultado.principal);
                            if (principalArr && principalArr.length > 0) {
                                const principal = principalArr[0];
                                relHtml += `<div class="mt-4"><b>Producto principal:</b>
                                    <div class="bg-gray-50 rounded p-2 mt-1">
                                        <b>${principal.nombre}</b> (Código: ${principal.codigo})<br>
                                        Categoría: ${principal.categoria} | Marca: ${principal.marca} | Unidad: ${principal.unidad}
                                    </div>
                                </div>`;
                            } else {
                                relHtml += `<div class="mt-4"><b>Producto principal:</b> <span class='text-gray-400'>${resultado.principal} (No encontrado)</span></div>`;
                            }
                            // Mostrar hermanos (otros subproductos)
                            if (resultado.subproductos.length > 1) {
                                const { data: hermanosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos.filter(c => c !== codigo));
                                relHtml += `<div class="mt-2"><b>Otros subproductos relacionados:</b>
                                <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                                resultado.subproductos.forEach(subCodigo => {
                                    if (subCodigo === codigo) return;
                                    const sub = hermanosInfo ? hermanosInfo.find(p => p.codigo === subCodigo) : null;
                                    if (sub) {
                                        relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                    } else {
                                        relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                    }
                                });
                                relHtml += '</tbody></table></div>';
                            }
                        }
                        if (resultado.tipo === 'ninguno') {
                            relHtml += '<div class="mt-2 text-gray-400">Este producto no tiene relaciones registradas.</div>';
                        }
                        relHtml += '</div>';
                        relacionesDiv.innerHTML = relHtml;
                    } catch (e) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Error al consultar relaciones: ' + (e.message || e) + '</div>';
                    }
                });
            }

            // El manejo del botón de escanear ya lo realiza `main.js` (evitamos listeners duplicados).
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#">
    <title>Editar Producto - Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <script src="../librerías/html5-qrcode.min.js"></script>
    <link rel="stylesheet" href="../librerías/tailwind.min.css" />
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">

    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Editar Producto</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Editar Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Pestañas -->
        <div class="mb-6 mt-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-editar-individual"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button active">
                        Edición Individual
                    </button>
                    <button id="tab-editar-tabla"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Edición por Tabla
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-editar-individual" class="tab-content">
            <form id="formEditarProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoEditar">
                        Código/PLU:
                    </label>
                    <div class="flex">
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="codigoEditar" type="text" required />
                        <button type="button" id="escanearBtnEditar"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                            Escanear Código de Barras
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <button id="buscarEditar"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="button">
                        Buscar
                    </button>
                </div>
                <div id="formularioEdicion" style="display: none">
                    <!-- Campo de código editable -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo">
                            Código
                        </label>
                        <input type="text" id="codigoEditado"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreEditar">
                            Nombre:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="nombreEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaEditar">
                            Categoría:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="categoriaEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="marcaEditar">
                            Marca/Proveedor:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="marcaEditar" type="text" required />
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="unidadEditar">
                            Unidad:
                        </label>
                        <input type="text" id="unidadEditar"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="flex items-center justify-between">
                        <button id="guardarCambios"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Guardar Cambios
                        </button>
                        <button id="eliminarProducto"
                            class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Eliminar Producto
                        </button>
                    </div>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
            <div id="scanner-container-editar" class="mt-4" style="display: none">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>
        </div>

        <!-- Pestaña Edición por Tabla -->
        <div id="content-editar-tabla" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Edición por Tabla</h3>
                <form id="formBuscarTabla" class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoBuscarTabla">
                        Buscar por Código de Producto Primario o Subproducto:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="codigoBuscarTabla" type="text" placeholder="Ej: 1234 o 201670000004" required />
                    <button type="submit"
                        class="mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Buscar</button>
                </form>
                <div id="tabla-edicion-resultados"></div>
                <div id="tabla-edicion-resultados"></div>
                <script type="module">
                    import { db, inicializarDB } from '../js/db-operations.js';
                    import { obtenerRelacionesProductosSupabase, buscarRelacionProducto } from '../js/relaciones-productos.js';
                    // Exponer para main.js si se requiere (opcional)
                    window.obtenerRelacionesProductosSupabase = obtenerRelacionesProductosSupabase;
                    window.buscarRelacionProducto = buscarRelacionProducto;

                    // Lógica de búsqueda y edición en tabla
                    document.getElementById('formBuscarTabla').addEventListener('submit', function (e) {
                        e.preventDefault();
                        const codigo = document.getElementById('codigoBuscarTabla').value.trim();
                        const resultadosDiv = document.getElementById('tabla-edicion-resultados');
                        resultadosDiv.innerHTML = `<div class='text-gray-600'>Sincronizando productos y relaciones...</div>`;

                        (async () => {
                            console.log('[DEBUG] db antes de inicializar:', db);
                            let dbReady = db;
                            if (!dbReady) {
                                resultadosDiv.innerHTML = `<div class='text-gray-600'>Inicializando base de datos local...</div>`;
                                try {
                                    await inicializarDB();
                                } catch (err) {
                                    console.error('[DEBUG] Error al inicializarDB:', err);
                                }
                                dbReady = db;
                                console.log('[DEBUG] db después de inicializar:', dbReady);
                            }
                            if (!dbReady) {
                                console.error('[DEBUG] IndexedDB sigue sin inicializar tras inicializarDB.');
                                resultadosDiv.innerHTML = `<div class='text-red-600'>IndexedDB no inicializado.</div>`;
                                return;
                            }
                            // 1. Sincronizar productos desde Supabase a IndexedDB y obtener relaciones
                            Promise.all([
                                importarProductosSupabaseAIndexedDB(dbReady),
                                obtenerRelacionesProductosSupabase()
                            ]).then(([_, relaciones]) => {
                                // 2. Buscar relación en el Map
                                const relacion = buscarRelacionProducto(codigo, relaciones);
                                // 3. Buscar detalles de productos en IndexedDB
                                buscarProductosRelacionadosConMap(dbReady, codigo, relacion, resultadosDiv);
                            }).catch(err => {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al sincronizar: ${err.message || err}`;
                            });
                        })();

                        // --- Función para importar productos de Supabase a IndexedDB ---
                        async function importarProductosSupabaseAIndexedDB(dbInstance) {
                            if (!window.getSupabase) throw new Error('No se encontró getSupabase.');
                            const supabase = await window.getSupabase();
                            const { data: productos, error } = await supabase.from('productos').select('*');
                            if (error) throw error;
                            if (!dbInstance) throw new Error('IndexedDB no inicializado');
                            return new Promise((resolve, reject) => {
                                const transaction = dbInstance.transaction(['productos'], 'readwrite');
                                const objectStore = transaction.objectStore('productos');
                                const clearReq = objectStore.clear();
                                clearReq.onsuccess = function () {
                                    productos.forEach(prod => {
                                        const p = {
                                            codigo: prod.codigo,
                                            nombre: prod.nombre,
                                            categoria: prod.categoria,
                                            marca: prod.marca,
                                            unidad: prod.unidad
                                        };
                                        objectStore.put(p);
                                    });
                                    transaction.oncomplete = resolve;
                                    transaction.onerror = reject;
                                };
                                clearReq.onerror = reject;
                            });
                        }

                        // --- Función para buscar productos relacionados usando el Map de relaciones ---
                        function buscarProductosRelacionadosConMap(dbInstance, codigo, relacion, resultadosDiv) {
                            const transaction = dbInstance.transaction(['productos'], 'readonly');
                            const objectStore = transaction.objectStore('productos');
                            const getAllReq = objectStore.getAll();
                            getAllReq.onsuccess = function (e) {
                                const productos = e.target.result;
                                // Buscar producto exacto (por código completo o 4 dígitos)
                                let producto = productos.find(p => p.codigo === codigo || p.codigo.endsWith(codigo));
                                if (!producto) {
                                    resultadosDiv.innerHTML = `<div class='text-red-600'>No se encontró el producto <b>${codigo}</b>.</div>`;
                                    return;
                                }
                                // Buscar principal y subproductos según el Map
                                let productoPrincipal = null;
                                let subproductos = [];
                                if (relacion.tipo === 'principal') {
                                    productoPrincipal = producto;
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                } else if (relacion.tipo === 'subproducto') {
                                    productoPrincipal = productos.find(p => p.codigo === relacion.principal);
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                }
                                // Mostrar resultados
                                let html = '';
                                // Producto encontrado (si es principal, mostrar botón editar principal)
                                html += `<div class='mb-4'><b>Producto encontrado:</b><br>${producto.codigo} - ${producto.nombre} (${producto.categoria})<br>Marca: ${producto.marca} | Unidad: ${producto.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${producto.codigo}'>Editar</button></div>`;
                                // Si hay producto principal distinto, mostrarlo con botón editar
                                if (productoPrincipal && productoPrincipal.codigo !== producto.codigo) {
                                    html += `<div class='mb-4'><b>Producto Principal:</b><br>${productoPrincipal.codigo} - ${productoPrincipal.nombre} (${productoPrincipal.categoria})<br>Marca: ${productoPrincipal.marca} | Unidad: ${productoPrincipal.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${productoPrincipal.codigo}'>Editar</button></div>`;
                                }
                                if (subproductos.length > 0) {
                                    html += `<div class='mb-2'><b>Subproductos relacionados:</b> <button id='expand-relacionados' class='ml-2 px-2 py-1 bg-blue-200 rounded'>Ver relacionados</button></div><ul class='mb-4' id='lista-relacionados' style='display:none;'>`;
                                    subproductos.forEach(sp => {
                                        html += `<li class='mb-1'>${sp.codigo} - ${sp.nombre} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${sp.codigo}'>Editar</button></li>`;
                                    });
                                    html += '</ul>';
                                }
                                resultadosDiv.innerHTML = html;
                                // Botón para expandir/collapse relacionados
                                const expandBtn = resultadosDiv.querySelector('#expand-relacionados');
                                const listaRelacionados = resultadosDiv.querySelector('#lista-relacionados');
                                if (expandBtn && listaRelacionados) {
                                    expandBtn.addEventListener('click', () => {
                                        listaRelacionados.style.display = listaRelacionados.style.display === 'none' ? 'block' : 'none';
                                        expandBtn.textContent = listaRelacionados.style.display === 'none' ? 'Ver relacionados' : 'Ocultar relacionados';
                                    });
                                }
                                // Agregar listeners a los botones de edición
                                resultadosDiv.querySelectorAll('.edit-btn').forEach(btn => {
                                    btn.addEventListener('click', function () {
                                        const codigoEditar = btn.dataset.codigo;
                                        // Buscar el producto en la lista de productos
                                        const prod = productos.find(p => p.codigo === codigoEditar);
                                        if (!prod) {
                                            Swal.fire('Error', 'No se encontró el producto en la base local.', 'error');
                                            return;
                                        }
                                        // Rellenar el formulario de edición individual
                                        document.getElementById('codigoEditar').value = prod.codigo;
                                        document.getElementById('codigoEditado').value = prod.codigo;
                                        document.getElementById('nombreEditar').value = prod.nombre;
                                        document.getElementById('categoriaEditar').value = prod.categoria;
                                        document.getElementById('marcaEditar').value = prod.marca;
                                        document.getElementById('unidadEditar').value = prod.unidad;
                                        // Mostrar el formulario de edición si está oculto
                                        document.getElementById('formularioEdicion').style.display = '';
                                        // Cambiar a la pestaña de Edición Individual
                                        const tabButtons = document.querySelectorAll('.tab-button');
                                        const tabContents = document.querySelectorAll('.tab-content');
                                        tabButtons.forEach(btn => {
                                            btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                                            btn.classList.add('border-transparent', 'text-gray-500');
                                        });
                                        tabContents.forEach(content => {
                                            content.style.display = 'none';
                                        });
                                        document.getElementById('tab-editar-individual').classList.add('active', 'border-blue-500', 'text-blue-600');
                                        document.getElementById('tab-editar-individual').classList.remove('border-transparent', 'text-gray-500');
                                        document.getElementById('content-editar-individual').style.display = 'block';
                                        // Scroll al formulario de edición
                                        document.getElementById('formEditarProducto').scrollIntoView({ behavior: 'smooth' });
                                    });
                                });
                            };
                            getAllReq.onerror = function () {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al buscar productos en IndexedDB.</div>`;
                            };
                        }
                    });
                </script>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Pestañas
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            function switchTab(targetTab) {
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });
                const activeButton = document.getElementById(`tab-${targetTab}`);
                activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');
                document.getElementById(`content-${targetTab}`).style.display = 'block';
            }
            document.getElementById('tab-editar-individual').addEventListener('click', () => switchTab('editar-individual'));
            document.getElementById('tab-editar-tabla').addEventListener('click', () => switchTab('editar-tabla'));

            // Aplicar conversión de guión a ceros en campos de código
            const codigoEditar = document.getElementById('codigoEditar');
            const codigoEditado = document.getElementById('codigoEditado');
            const codigoBuscarTabla = document.getElementById('codigoBuscarTabla');
            aplicarConversionCodigo(codigoEditar);
            aplicarConversionCodigo(codigoEditado);
            aplicarConversionCodigo(codigoBuscarTabla);


        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link href="../librerías/tailwind.min.css" rel="stylesheet">
    <script src="../librerías/sweetalert2@11.js"></script>
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Inventario</h1>
        <div class="flex items-center space-x-4">
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="inventario" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6 dark-theme-title">Inventario</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Nuevo div para mostrar la ubicación actual -->
        <div class="mb-4 p-4 bg-white shadow-md rounded">
            <h2 class="text-xl font-bold mb-2">Ubicación Actual: <span id="ubicacionActual"></span></h2>
            <button id="cambiarUbicacion" class="bg-yellow-500 text-white px-4 py-2">Cambiar Ubicación</button>
        </div>

        <!-- Pestañas principales de inventario -->
        <div class="mb-6">
            <div class="flex border-b bg-white shadow-sm rounded-t-lg">
                <button id="tabInventarioManual"
                    class="px-6 py-3 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500 font-semibold">
                    📦 Inventario Manual
                </button>
                <button id="tabLotesAvanzado"
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300 font-semibold">
                    🚀 Inventario por Lotes Avanzado
                </button>
            </div>
        </div>

        <!-- Contenido de Inventario Manual -->
        <div id="contenidoInventarioManual" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <!-- Formulario de búsqueda de inventario -->
            <div class="mb-4">
                <label for="codigo" class="block mb-2">Código/PLU:</label>
                <div class="flex">
                    <input type="text" id="codigo" class="border p-2 w-full">
                    <button id="escanearBtn" class="bg-blue-500 text-white px-4 py-2 ml-2">Escanear Código</button>
                </div>
            </div>

            <div class="mb-4">
                <label for="nombreInventario" class="block mb-2">Nombre:</label>
                <input type="text" id="nombreInventario" class="border p-2 w-full">
            </div>

            <div class="mb-4">
                <label for="marcaInventario" class="block mb-2">Marca:</label>
                <input type="text" id="marcaInventario" class="border p-2 w-full">
            </div>

            <button id="buscarInventario" class="bg-green-500 text-white px-4 py-2 mb-4">Buscar Producto</button>

            <div id="resultadosInventario" class="mt-4" style="display: none;">
                <!-- Los resultados de la búsqueda se mostrarán aquí -->
            </div>

            <div id="datosInventario" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
                <!-- Pestañas para productos tipo Kg -->
                <div id="tabsContainer" class="mb-6" style="display: none;">
                    <div class="flex border-b">
                        <button id="tabInventario"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            Inventario Normal
                        </button>
                        <button id="tabLotes"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            Lotes
                        </button>
                    </div>
                </div>

                <!-- Formulario de inventario normal -->
                <div id="formularioInventarioNormal">
                    <div class="mb-4">
                        <label for="codigoProductoInventario" class="block mb-2">Codigo del Producto:</label>
                        <input type="text" id="codigoProductoInventario" class="border p-2 w-full" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="nombreProductoInventario" class="block mb-2">Nombre del Producto:</label>
                        <input type="text" id="nombreProductoInventario" class="border p-2 w-full" readonly>
                    </div>

                    <div class="mb-4">
                        <label for="unidadProducto" class="block mb-2">Unidad:</label>
                        <input type="text" id="unidadProducto" class="border p-2 w-full" readonly>
                        <!-- Mostrar la unidad como texto -->
                    </div>

                    <div class="mb-4">
                        <label for="cantidad" class="block mb-2">Cantidad:</label>
                        <input type="number" id="cantidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-4">
                        <label for="fechaCaducidad" class="block mb-2">Fecha de Caducidad:</label>
                        <input type="date" id="fechaCaducidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-6">
                        <label for="comentarios" class="block mb-2">Comentarios:</label>
                        <textarea id="comentarios" class="border p-2 w-full"></textarea>
                    </div>

                    <div id="botonguardar" class="flex items-center justify-between">
                        <button id="guardarInventario" class="bg-blue-500 text-white px-4 py-2">Guardar
                            Inventario</button>
                    </div>
                    <div id="botonmodificar" class="flex items-center justify-between" style="display: none;">
                        <button id="modificarInventario" class="bg-blue-500 text-white px-4 py-2">Modificar
                            Inventario</button>
                    </div>
                </div>

                <!-- Formulario de escaneo por lotes para productos Kg -->
                <div id="formularioLotes" style="display: none;">
                    <div class="bg-blue-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-bold mb-3 text-blue-800">Información del Producto</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Código:</label>
                                <span id="codigoProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre:</label>
                                <span id="nombreProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Unidad:</label>
                                <span id="unidadProductoLotes" class="text-sm font-semibold text-green-600">Kg</span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoría:</label>
                                <span id="categoriaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Marca:</label>
                                <span id="marcaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label for="precioKilo" class="block text-sm font-medium text-gray-700 mb-2">Precio por Kilo
                            ($):</label>
                        <input type="number" id="precioKilo" step="0.01" min="0"
                            class="border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Ingrese el precio por kilogramo">
                    </div>

                    <div class="text-center">
                        <button id="iniciarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            📱 Iniciar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>

            <div id="mensaje" class="mt-4"></div>

            <div id="scanner-container-inventario" class="mt-4" style="display: none;">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>

            <button id="generarHojaInventario" class="bg-purple-500 text-white px-4 py-2 mt-4">Generar Hoja de
                Inventario</button>
        </div>

        <!-- Contenido de Inventario por Lotes Avanzado -->
        <div id="contenidoLotesAvanzado" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
            <!-- Panel de alerta y configuración -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-yellow-800">Inventario por Lotes Avanzado</h3>
                        <div class="mt-2 text-sm text-yellow-700">
                            <ul class="list-disc list-inside space-y-1">
                                <li>Solo se pueden contar productos con unidad tipo <strong>Kg</strong></li>
                                <li>El escaneo será automático sin necesidad de búsqueda previa</li>
                                <li>Se extraerán automáticamente PLU, peso y precio desde códigos CODE128</li>
                                <li>Los productos se agruparán por productos primarios y subproductos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel de configuración -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-4 text-gray-800">⚙️ Configuración de Escaneo</h3>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="confirmarProductosSimilares"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                        <label for="confirmarProductosSimilares" class="text-sm font-medium text-gray-700">
                            Mostrar ventana de confirmación para productos similares
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="agruparAutomaticamente"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="agruparAutomaticamente" class="text-sm font-medium text-gray-700">
                            Agrupar automáticamente productos con el mismo PLU
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="sonidoConfirmacion"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="sonidoConfirmacion" class="text-sm font-medium text-gray-700">
                            Reproducir sonido de confirmación al escanear
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="relacionarProductos"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="relacionarProductos" class="text-sm font-medium text-gray-700">
                            Relacionar productos (buscar en productos_subproductos)
                        </label>
                    </div>
                </div>
            </div>

            <!-- Botón para iniciar escaneo -->
            <div class="text-center mb-6">
                <button id="iniciarEscaneoLotesAvanzado"
                    class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform hover:scale-105 transition duration-200">
                    🚀 Iniciar Escaneo por Lotes Avanzado
                </button>
            </div>

            <!-- Área de resultados de productos escaneados -->
            <div id="resultadosLotesAvanzado" class="hidden">
                <h3 class="text-lg font-bold mb-4 text-gray-800">📊 Productos Escaneados</h3>
                <div id="contenedorProductosPrimarios" class="space-y-4">
                    <!-- Las tarjetas de productos primarios se mostrarán aquí -->
                </div>

                <!-- Botón para guardar inventario -->
                <div class="text-center mt-6">
                    <button id="guardarInventarioLotesAvanzado"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled>
                        💾 Guardar Inventario
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes Avanzado -->
        <div id="modalEscaneoLotesAvanzado"
            class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
            <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-5xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-900">🚀 Escaneo por Lotes Avanzado</h3>
                        <button id="cerrarModalLotesAvanzado" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscanerAvanzado"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListadoAvanzado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Productos Escaneados (<span id="contadorProductosAvanzado">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscanerAvanzado" class="mb-4">
                        <div id="scanner-container-lotes-avanzado" class="mb-4">
                            <div id="reader-lotes-avanzado" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="accionEscaneoLotesAvanzado"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-bold"
                                style="user-select:none;">
                                Activar escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListadoAvanzado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Nombre</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio/Kg</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Tipo</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoProductosAvanzado">
                                    <!-- Los productos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total productos: <span id="totalProductosAvanzado" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotalAvanzado" class="font-bold">0.000 Kg</span> |
                            Productos primarios: <span id="totalProductosPrimarios" class="font-bold">0</span>
                        </div>
                        <button id="finalizarEscaneoLotesAvanzado"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes Avanzado
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Edición de Producto de Lote -->
        <div id="modalEdicionProductoLote" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 10000;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-md shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">✏️ Editar Producto Escaneado</h3>
                        <button onclick="cerrarModalEdicionProducto()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Información del producto -->
                    <div class="mb-4 p-3 bg-gray-50 rounded">
                        <p class="text-sm"><strong>Producto:</strong> <span id="editProductoNombre" class="font-medium"></span></p>
                        <p class="text-sm"><strong>Código:</strong> <span id="editProductoCodigo" class="font-mono"></span></p>
                        <p class="text-sm"><strong>PLU:</strong> <span id="editProductoPLU" class="font-mono"></span></p>
                        <input type="hidden" id="editProductoId">
                    </div>

                    <!-- Campos editables -->
                    <div class="space-y-4">
                        <!-- Precio por Kilo -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                💰 Precio por Kilo ($)
                            </label>
                            <input type="number" id="editPrecioKilo" step="0.01" min="0.01"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el precio por kilo era diferente al momento de crear la etiqueta
                            </p>
                        </div>

                        <!-- Peso -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                ⚖️ Peso (Kg)
                            </label>
                            <input type="number" id="editPeso" step="0.001" min="0.001"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.000">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el peso calculado no es correcto (recalcula precio automáticamente)
                            </p>
                        </div>

                        <!-- Precio de Porción (solo lectura, se actualiza automáticamente) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                🏷️ Precio de Porción ($)
                            </label>
                            <input type="number" id="editPrecioPorcion" step="0.01" min="0.01" readonly
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                ℹ️ Se calcula automáticamente: Precio/Kg × Peso
                            </p>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="cerrarModalEdicionProducto()"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button onclick="guardarEdicionProducto()"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            💾 Guardar Cambios
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Información de Producto -->
        <div id="modalInfoProducto" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 9999;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">📋 Información del Producto</h3>
                        <button id="cerrarModalInfoProducto" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Contenido del modal -->
                    <div id="contenidoInfoProducto">
                        <!-- Se llenará dinámicamente -->
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button id="cancelarInfoProducto"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button id="guardarInfoProducto"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            Guardar Info
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes (original) -->
        <div id="modalEscaneoLotes" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
            style="display: none;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">Escaneo por Lotes</h3>
                        <button id="cerrarModalLotes" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscaner"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Códigos Escaneados (<span id="contadorCodigos">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscaner" class="mb-4">
                        <div id="scanner-container-lotes" class="mb-4">
                            <div id="reader-lotes" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="pararEscaneoLotes"
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                                Pausar Escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código Completo</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoCodigosEscaneados">
                                    <!-- Los códigos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total de códigos: <span id="totalCodigos" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotal" class="font-bold">0.00 Kg</span> |
                            Valor total porciones: <span id="precioTotalGeneral" class="font-bold">$0.00</span>
                        </div>
                        <button id="finalizarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- tabla de productos en inventario -->
    <div>
        <button id="sync-inventario-down-btn"
            class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Inventario desde Supabase
        </button>
        <button id="sincronizarManual" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Ahora
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4"> Productos en Inventario </h2>
        <div class="overflow-x-auto">
            <table id="estructura-plantilla" class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">Código</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categoría</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Tipo de Cantidad</th>
                        <th class="py-3 px-6 text-left">Cantidad</th>
                        <th class="py-3 px-6 text-left">Fecha de Caducidad</th>
                        <th class="py-3 px-6 text-left">Comentarios</th>
                        <th class="py-3 px-6 text-left">ubicacion</th>
                    </tr>
                </thead>
                <tbody id="estructuraPlantillaBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/scanner/lotes-avanzado.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;

            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);

                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;

                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversión a los campos de código cuando se cargue la página
        document.addEventListener('DOMContentLoaded', function () {
            const codigo = document.getElementById('codigo');
            const codigoProductoInventario = document.getElementById('codigoProductoInventario');

            aplicarConversionCodigo(codigo);
            // Note: codigoProductoInventario es readonly, pero aplicamos por si acaso
            aplicarConversionCodigo(codigoProductoInventario);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Sistema de Gestión de Productos</h1>
        <div class="flex items-center space-x-4">
            <!-- Indicador de estado del backend -->
            <div id="backendStatus" class="px-3 py-1 rounded-full text-sm font-semibold" 
                 title="Estado de conexión con el backend"
                 style="background-color: #fbbf24; color: #78350f;">
                ⏳ Verificando...
            </div>
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t dark-theme-sidebar-footer">
            <button id="logoutBtn" class="w-full bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded dark-theme-button">
                Cerrar Sesión
            </button>
        </div>
    </div>

    <a href="../index.html" class="text-blue-500 hover:underline mb-4 inline-block dark-theme-link">← Regresar</a>
    <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200 dark-theme-menu-toggle">
        Menú
    </button>

    <main class="container mx-auto mt-8">
        <section id="dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div id="consulta" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Consulta de Producto</h2>
                <p class="mb-4 dark-theme-card-text">Busca productos en la base de datos por diferentes criterios.</p>
                <a id="consultaLink" href="./consulta.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Consulta
                    Producto</a>
            </div>

            <div id="editar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Editar Producto</h2>
                <p class="mb-4 dark-theme-card-text">Edita los atributos de los productos existentes en la base de
                    datos.</p>
                <a id="editarLink" href="./editar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Editar
                    Producto</a>
            </div>

            <div id="inventario" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona el inventario de productos con datos adicionales.</p>
                <a id="inventarioLink" href="./inventario.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Inventario</a>
            </div>

            <div id="reporte" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Reporte para Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Genera reportes detallados del inventario de productos.</p>
                <a id="reporteLink" href="./report.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Reporte
                    para Inventario</a>
            </div>

            <div id="agregar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Agregar Productos</h2>
                <p class="mb-4 dark-theme-card-text">Escanea y agrega nuevos productos a la base de datos.</p>
                <a id="agregarLink" href="./agregar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Agregar
                    Productos</a>
            </div>

            <div id="archivos" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Administración de Archivos</h2>
                <p class="mb-4 dark-theme-card-text">Sube o descarga archivos CSV para la base de datos.</p>
                <a id="archivosLink" href="./archivos.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Archivos</a>
            </div>

            <div id="configuraciones" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Configuraciones</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona las configuraciones del sistema, perfil de usuario y
                    preferencias.</p>
                <a id="configuracionesLink" href="./configuraciones.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Configuraciones</a>
            </div>
        </section>
    </main>

    <footer class="bg-blue-600 text-white p-4 mt-8 dark-theme-footer">
        <p class="text-center dark-theme-footer-text">&copy; 2024 Sistema de Gestión de Productos. Todos los derechos
            reservados.</p>
    </footer>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>    <script type="module">
        import { backendStatusMonitor } from '../js/backend-status.js';
        
        // Monitorear estado del backend
        document.addEventListener('DOMContentLoaded', () => {
            const backendStatusEl = document.getElementById('backendStatus');
            
            // Escuchar cambios de estado del backend
            window.addEventListener('backendStatusChanged', (event) => {
                const { available } = event.detail;
                
                if (available) {
                    backendStatusEl.textContent = '🟢 Backend activo';
                    backendStatusEl.style.backgroundColor = '#dcfce7'; // green-100
                    backendStatusEl.style.color = '#166534'; // green-800
                } else {
                    backendStatusEl.textContent = '🔴 Backend no disponible';
                    backendStatusEl.style.backgroundColor = '#fee2e2'; // red-100
                    backendStatusEl.style.color = '#991b1b'; // red-900
                    
                    // Mostrar alerta una sola vez
                    if (!window.backendDownNotified) {
                        setTimeout(() => {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Backend no disponible',
                                text: 'La aplicación funcionará en modo offline. Los cambios se sincronizarán cuando el servidor esté disponible.',
                                allowOutsideClick: false,
                                didOpen: (modal) => {
                                    // Cerrar automáticamente después de 5 segundos
                                    setTimeout(() => {
                                        Swal.close();
                                    }, 5000);
                                }
                            });
                        }, 500);
                        window.backendDownNotified = true;
                    }
                }
            });
            
            // Iniciar monitoreo (cada 30 segundos)
            backendStatusMonitor.startMonitoring(30);
        });
    </script>
    <script type="module">
        import { cerrarSesion } from '../js/auth/auth.js';
        
        // Manejar botón de logout
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    const { value: rememberUser } = await Swal.fire({
                        title: 'Cerrar Sesión',
                        text: '¿Deseas que se recuerde tu usuario para el próximo login?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Sí, recordar usuario',
                        cancelButtonText: 'No, no recordar',
                        allowOutsideClick: false
                    });
                    
                    // Si cancela, no hace nada
                    if (rememberUser === undefined) return;
                    
                    // Llamar función de logout
                    await cerrarSesion(rememberUser === true);
                });
            }
        });
    </script>    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menuToggle');
            const sideMenu = document.getElementById('sideMenu');
            const closeMenu = document.getElementById('closeMenu');
            const menuRoutes = document.getElementById('menuRoutes');
            const routes = [
                { name: 'Consulta de Producto', path: './consulta.html' },
                { name: 'Editar Producto', path: './editar.html' },
                { name: 'Inventario', path: './inventario.html' },
                { name: 'Registro de Entradas', path: './registro-entradas.html' },
                { name: 'Reporte para Inventario', path: './report.html' },
                { name: 'Agregar Productos', path: './agregar.html' },
                { name: 'Administración de Archivos', path: './archivos.html' },
                { name: 'Configuraciones', path: './configuraciones.html' }
            ];

            // Generar las rutas dinámicamente
            routes.forEach(route => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline dark-theme-nav-link">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            // Mostrar el menú
            menuToggle.addEventListener('click', () => {
                sideMenu.classList.remove('-translate-x-full');
            });

            // Ocultar el menú
            closeMenu.addEventListener('click', () => {
                sideMenu.classList.add('-translate-x-full');
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Entradas</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-green-600 text-white p-4 flex justify-between items-center shadow-lg">
        <div class="flex items-center space-x-3">
            <div class="p-2 bg-green-700 rounded-lg">
                📦
            </div>
            <h1 class="text-3xl font-bold tracking-wide">Registro de Entradas</h1>
        </div>
        <div class="flex items-center space-x-6">
            <div id="conexionStatus" class="text-sm flex items-center space-x-2 bg-green-700 px-3 py-1 rounded-full">
                <span class="status-indicator status-success"></span>
                <span>Conectado</span>
            </div>
            <div id="clockDisplay" class="text-sm font-mono bg-green-700 px-3 py-1 rounded-full"></div>
            <div class="text-sm bg-green-700 px-3 py-1 rounded-full">
                <span id="totalEntradas">0</span> entradas registradas
            </div>
        </div>
    </header>
    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform z-50">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>
    <div class="container mx-auto mt-8 p-4">
        <div class="mb-6 flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center space-x-4">
                <h1 class="text-4xl font-bold text-gray-800 flex items-center">
                    📦 Registro de Entradas
                    <span class="ml-3 text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                        Sistema de Gesti�n
                    </span>
                </h1>
            </div>
            <div class="flex items-center space-x-3">
                <a href="./main.html"
                    class="text-green-600 hover:text-green-800 hover:underline font-medium flex items-center space-x-2 transition-colors">
                    <span>←</span>
                    <span>Regresar al Men� Principal</span>
                </a>
                <button id="menuToggle"
                    class="bg-white text-green-600 px-4 py-2 rounded-lg hover:bg-green-50 border-2 border-green-600 font-semibold transition-all hover:shadow-md">
                    📋 Men� de Navegaci�n
                </button>
            </div>
        </div> <!-- Secci�n de b�squeda de productos -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                🔍 Buscar Producto
                <span id="searchStatus" class="ml-3 text-sm"></span>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="ultimaBusqueda"></span>
                </div>
            </h2>

            <div class="grid md:grid-cols-3 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ Buscar por C�digo:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaCodigo"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese c�digo del producto">
                        <button id="buscarPorCodigo"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnCodigoText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 Buscar por Nombre:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaNombre"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese nombre del producto">
                        <button id="buscarPorNombre"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnNombreText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 Buscar por Marca:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaMarca"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese marca del producto">
                        <button id="buscarPorMarca"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnMarcaText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-center">
                <button id="escanearBtn"
                    class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                    <span>📷</span>
                    <span>Escanear C�digo de Barras</span>
                </button>
            </div>

            <!-- Mensaje de b�squeda reciente -->
            <div id="busquedaReciente" class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 rounded"
                style="display: none;">
                <p class="text-sm text-blue-700">
                    <strong>B�squeda reciente:</strong> <span id="textoUltimaBusqueda"></span>
                </p>
            </div>
        </div> <!-- Formulario de datos del producto y entrada -->
        <div id="productForm"
            class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover"
            style="display: none;">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                📦 Datos del Producto
                <div id="productLoadingIndicator" class="ml-3" style="display: none;">
                    <div
                        class="inline-block w-4 h-4 border-2 border-green-500 border-t-transparent rounded-full animate-spin">
                    </div>
                    <span class="ml-2">Cargando informaci�n...</span>
                </div>
                <div class="ml-auto">
                    <span class="text-sm text-gray-500 bg-green-100 px-3 py-1 rounded-full">
                        Producto encontrado ✅
                    </span>
                </div>
            </h2>

            <div id="productInfo"
                class="grid md:grid-cols-2 gap-6 mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border-2 border-green-200 shadow-inner">
                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="codigoProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">C�digo del Producto:</span>
                        </label>
                        <input type="text" id="codigoProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-mono text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="nombreProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📝 <span class="ml-2">Nombre del Producto:</span>
                        </label>
                        <input type="text" id="nombreProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-semibold text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="marcaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏢 <span class="ml-2">Marca:</span>
                        </label>
                        <input type="text" id="marcaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="categoriaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📂 <span class="ml-2">Categor�a:</span>
                        </label>
                        <input type="text" id="categoriaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="unidadProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📏 <span class="ml-2">Unidad de Medida:</span>
                        </label>
                        <input type="text" id="unidadProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <!-- Informaci�n adicional del stock actual -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="text-sm font-semibold text-blue-700 mb-2">📊 Stock Actual</h4>
                        <div class="text-2xl font-bold text-blue-600" id="stockActual">--</div>
                        <div class="text-xs text-blue-500">unidades disponibles</div>
                    </div>
                </div>
            </div>
            <div class="border-t-2 border-gray-200 pt-8">
                <h3 class="text-lg font-semibold mb-6 text-green-600 flex items-center">
                    📝 Datos de la Entrada
                    <span class="ml-3 text-sm text-gray-500 bg-yellow-100 px-3 py-1 rounded-full">
                        * Campos obligatorios
                    </span>
                    <div class="ml-auto text-sm text-gray-400">
                        <span id="fechaActual"></span>
                    </div>
                </h3>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="transform transition-all hover:scale-105">
                        <label for="cantidadEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📊 <span class="ml-2">Cantidad Recibida *:</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="cantidadEntrada"
                                class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg font-semibold"
                                min="0.01" step="0.01" required placeholder="0.00">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <span id="unidadMedida">unidades</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">Ingrese la cantidad exacta recibida</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="fechaEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📅 <span class="ml-2">Fecha de Entrada *:</span>
                        </label>
                        <input type="date" id="fechaEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg"
                            required>
                        <div class="text-xs text-gray-500 mt-1">Fecha en que se recibi� el producto</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="loteEntrada" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">N�mero de Lote:</span>
                        </label>
                        <input type="text" id="loteEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                            placeholder="Opcional">
                        <div class="text-xs text-gray-500 mt-1">N�mero de lote del proveedor</div>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="comentariosEntrada"
                        class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        💬 <span class="ml-2">Comentarios y Observaciones:</span>
                    </label>
                    <textarea id="comentariosEntrada"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                        rows="4"
                        placeholder="Informaci�n adicional: estado del producto, observaciones del proveedor, condiciones especiales..."></textarea>
                </div>

                <div class="flex justify-between items-center bg-gray-50 p-4 rounded-lg">
                    <button id="limpiarFormulario"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>🗑️</span>
                        <span>Limpiar Formulario</span>
                    </button>
                    <button id="registrarEntrada"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnRegistrarText">✅ Registrar Entrada</span>
                    </button>
                </div>

                <!-- Resumen de la entrada -->
                <div id="resumenEntrada" class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded"
                    style="display: none;">
                    <h4 class="font-semibold text-blue-700 mb-2">📋 Resumen de la Entrada:</h4>
                    <div id="textoResumen" class="text-sm text-blue-600"></div>
                </div>
            </div>
        </div> <!-- Filtros y controles -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-blue-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-blue-600 flex items-center">
                🔧 Filtros y Controles del Sistema
                <div id="syncStatus" class="ml-3 text-sm"></div>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="estadoSistema" class="bg-green-100 text-green-700 px-3 py-1 rounded-full">
                        Sistema Operativo
                    </span>
                </div>
            </h2>

            <div class="grid md:grid-cols-4 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="filtroCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ <span class="ml-2">Filtrar por C�digo:</span>
                    </label>
                    <input type="text" id="filtroCodigo"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="C�digo del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 <span class="ml-2">Filtrar por Nombre:</span>
                    </label>
                    <input type="text" id="filtroNombre"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Nombre del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 <span class="ml-2">Filtrar por Marca:</span>
                    </label>
                    <input type="text" id="filtroMarca"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Marca del producto...">
                </div>

                <div class="flex items-end space-x-2">
                    <button id="filtrarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🔍</span>
                        <span>Filtrar</span>
                    </button>
                    <button id="limpiarFiltros"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🗑️</span>
                        <span>Limpiar</span>
                    </button>
                </div>
            </div>

            <!-- Filtros de fecha -->
            <div class="grid md:grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-lg">
                <div>
                    <label for="fechaDesde" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Desde:</span>
                    </label>
                    <input type="date" id="fechaDesde"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div>
                    <label for="fechaHasta" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Hasta:</span>
                    </label>
                    <input type="date" id="fechaHasta"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div class="flex items-end">
                    <button id="filtrarPorFecha"
                        class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all w-full">
                        📊 Filtrar por Fechas
                    </button>
                </div>
            </div>

            <div class="flex flex-wrap gap-4 justify-between items-center">
                <div class="flex flex-wrap gap-3">
                    <button id="sincronizarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnSincText">🔄 Sincronizar con Servidor</span>
                    </button>
                    <button id="generarReporte"
                        class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-3 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>📊</span>
                        <span>Generar Reporte CSV</span>
                    </button>
                    <button id="autoRefresh"
                        class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white px-6 py-3 rounded-lg hover:from-indigo-600 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>⚡</span>
                        <span>Auto-actualizaci�n: OFF</span>
                    </button>
                </div>

                <div class="flex items-center space-x-3 text-sm text-gray-600">
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">�ltima sincronizaci�n:</span>
                        <span id="ultimaSync">--:--</span>
                    </div>
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">Estado:</span>
                        <span id="estadoConexion" class="text-green-600">Conectado</span>
                    </div>
                </div>
            </div>
        </div> <!-- Tabla de entradas -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-purple-500 card-hover">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-purple-600 flex items-center">
                        📋 Historial de Entradas del Sistema
                        <div id="tableLoadingIndicator" class="ml-3" style="display: none;">
                            <div
                                class="inline-block w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin">
                            </div>
                            <span class="ml-2 text-sm">Actualizando datos...</span>
                        </div>
                    </h2>
                    <div class="flex items-center space-x-4 mt-2">
                        <p id="contadorEntradas" class="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                            Total: 0 entradas registradas
                        </p>
                        <div class="text-sm text-gray-500">
                            <span id="rangoFechas">Mostrando todas las entradas</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="refreshTable"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Actualizar tabla">
                        <span>🔄</span>
                        <span class="hidden md:inline">Actualizar</span>
                    </button>
                    <button id="exportVisible"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Exportar datos visibles">
                        <span>📥</span>
                        <span class="hidden md:inline">Exportar</span>
                    </button>
                    <button id="expandirTabla"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Expandir/Contraer tabla">
                        <span>⛶</span>
                        <span class="hidden md:inline">Expandir</span>
                    </button>
                </div>
            </div>

            <!-- Barra de b�squeda r�pida -->
            <div class="mb-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <input type="text" id="busquedaRapida"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                        placeholder="🔍 B�squeda r�pida en la tabla...">
                    <select id="ordenarPor"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="fecha-desc">M�s reciente primero</option>
                        <option value="fecha-asc">M�s antiguo primero</option>
                        <option value="cantidad-desc">Mayor cantidad primero</option>
                        <option value="cantidad-asc">Menor cantidad primero</option>
                        <option value="nombre-asc">Nombre A-Z</option>
                        <option value="nombre-desc">Nombre Z-A</option>
                    </select>
                </div>
                <div class="text-sm text-gray-500">
                    <span id="resultadosBusqueda"></span>
                </div>
            </div>

            <div class="overflow-x-auto shadow-lg rounded-lg">
                <table class="min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg">
                    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('codigo')">
                                <div class="flex items-center space-x-1">
                                    <span>🏷️ C�digo</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('nombre')">
                                <div class="flex items-center space-x-1">
                                    <span>📝 Nombre</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('marca')">
                                <div class="flex items-center space-x-1">
                                    <span>🏢 Marca</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('categoria')">
                                <div class="flex items-center space-x-1">
                                    <span>📂 Categor�a</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('unidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📏 Unidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('cantidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📊 Cantidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('fecha')">
                                <div class="flex items-center space-x-1">
                                    <span>📅 Fecha</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                                💬 Comentarios
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ⚙️ Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tablaEntradasBody" class="bg-white divide-y divide-gray-200">
                        <!-- Las entradas se cargar�n din�micamente aqu� -->
                        <tr class="text-center text-gray-500 bg-gray-50">
                            <td colspan="9" class="px-6 py-8">
                                <div class="flex flex-col items-center space-y-3">
                                    <div class="text-4xl">📦</div>
                                    <div class="text-lg font-medium">No hay entradas registradas</div>
                                    <div class="text-sm">Las entradas aparecer�n aqu� cuando se registren productos
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginaci�n -->
            <div class="mt-6 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-600">Mostrar:</span>
                    <select id="registrosPorPagina" class="border border-gray-200 rounded p-1 text-sm">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="text-sm text-gray-600">registros por p�gina</span>
                </div>
                <div id="paginacion" class="flex items-center space-x-2">
                    <!-- Los controles de paginaci�n se generar�n din�micamente -->
                </div>
            </div>
        </div> <!-- Scanner container -->
        <div id="scanner-container"
            class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 backdrop-blur-sm"
            style="display: none;">
            <div
                class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl border-4 border-green-500 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        📷 <span class="ml-2">Esc�ner de C�digo de Barras</span>
                    </h3>
                    <button id="cerrarEscaner"
                        class="text-red-500 hover:text-red-700 text-2xl font-bold transition-colors transform hover:scale-110">
                        ✕
                    </button>
                </div>

                <div class="mb-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                    <p class="text-sm text-blue-700">
                        <strong>Instrucciones:</strong> Coloque el c�digo de barras dentro del marco verde.
                        El esc�ner detectar� autom�ticamente el c�digo.
                    </p>
                </div>

                <div id="reader" class="w-full mb-6 rounded-lg overflow-hidden border-4 border-green-200 shadow-lg">
                </div>

                <div class="flex space-x-3">
                    <button id="detenerEscaner"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 w-full transition-all transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2">
                        <span>🛑</span>
                        <span>Detener Esc�ner</span>
                    </button>
                </div>

                <!-- Estado del esc�ner -->
                <div id="estadoEscaner" class="mt-4 text-center text-sm text-gray-600">
                    <div class="flex items-center justify-center space-x-2">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span>Esc�ner activo - Listo para escanear</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../librer�as/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script src="../js/utils/extension-conflict-detector.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script type="module" src="../js/core/registro-entradas-operations.js"></script>
    <script type="module">
        import { inicializarRegistroEntradas } from '../js/registro-entradas-operations.js';
        import { inicializarDB } from '../js/db-operations.js';
        import { toggleEscaner } from '../js/scanner.js';        // Inicializar cuando el DOM est� cargado
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Inicializar base de datos principal
                await inicializarDB();

                // Inicializar p�gina de registro de entradas
                await inicializarRegistroEntradas();

                // Configurar esc�ner
                const escanearBtn = document.getElementById('escanearBtn');
                if (escanearBtn) {
                    escanearBtn.addEventListener('click', () => {
                        toggleEscaner('busquedaCodigo', 'scanner-container');
                    });
                }

                const cerrarEscaner = document.getElementById('cerrarEscaner');
                const detenerEscaner = document.getElementById('detenerEscaner');

                if (cerrarEscaner) {
                    cerrarEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                if (detenerEscaner) {
                    detenerEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                // Inicializar funcionalidades din�micas
                initializeDynamicFeatures();

                console.log('P�gina de registro de entradas inicializada correctamente');

            } catch (error) {
                console.error('Error al inicializar p�gina de registro de entradas:', error);
            }
        });        // Funcionalidades din�micas
        function initializeDynamicFeatures() {
            // Reloj en tiempo real
            updateClock();
            setInterval(updateClock, 1000);

            // Estado de conexi�n
            updateConnectionStatus();
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);

            // Auto-actualizaci�n
            setupAutoRefresh();

            // Efectos de carga
            setupLoadingEffects();

            // Animaciones de entrada
            setupEntranceAnimations();

            // Notificaciones din�micas
            setupDynamicNotifications();

            // Configurar fecha actual
            setupCurrentDate();

            // B�squeda r�pida en tabla
            setupQuickSearch();

            // Autocompletado
            setupAutoComplete();

            // Atajos de teclado
            setupKeyboardShortcuts();

            // Validaciones en tiempo real
            setupRealTimeValidation();
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            const clockDisplay = document.getElementById('clockDisplay');
            if (clockDisplay) {
                clockDisplay.innerHTML = `${timeString}<br><span class="text-xs">${dateString}</span>`;
            }

            // Actualizar fecha actual en el resumen
            const fechaActual = document.getElementById('fechaActual');
            if (fechaActual) {
                fechaActual.textContent = `Hoy: ${dateString}`;
            }
        }

        function updateConnectionStatus() {
            const statusElement = document.getElementById('conexionStatus');
            const estadoConexion = document.getElementById('estadoConexion');

            if (statusElement || estadoConexion) {
                const isOnline = navigator.onLine;
                const status = isOnline
                    ? '<span class="status-indicator status-success"></span>Conectado'
                    : '<span class="status-indicator status-error"></span>Sin conexi�n';

                if (statusElement) statusElement.innerHTML = status;
                if (estadoConexion) {
                    estadoConexion.textContent = isOnline ? 'Conectado' : 'Sin conexi�n';
                    estadoConexion.className = isOnline ? 'text-green-600' : 'text-red-600';
                }

                // Actualizar estado del sistema
                const estadoSistema = document.getElementById('estadoSistema');
                if (estadoSistema) {
                    if (isOnline) {
                        estadoSistema.className = 'bg-green-100 text-green-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Operativo';
                    } else {
                        estadoSistema.className = 'bg-red-100 text-red-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Offline';
                    }
                }
            }
        }

        function setupCurrentDate() {
            const fechaEntrada = document.getElementById('fechaEntrada');
            if (fechaEntrada && !fechaEntrada.value) {
                const today = new Date().toISOString().split('T')[0];
                fechaEntrada.value = today;
            }
        }

        function setupQuickSearch() {
            const busquedaRapida = document.getElementById('busquedaRapida');
            if (busquedaRapida) {
                busquedaRapida.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#tablaEntradasBody tr');
                    let visibleCount = 0;

                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        const isVisible = text.includes(searchTerm);
                        row.style.display = isVisible ? '' : 'none';
                        if (isVisible && !row.classList.contains('text-center')) visibleCount++;
                    });

                    // Actualizar contador de resultados
                    const resultados = document.getElementById('resultadosBusqueda');
                    if (resultados) {
                        resultados.textContent = searchTerm ?
                            `${visibleCount} resultado${visibleCount !== 1 ? 's' : ''} encontrado${visibleCount !== 1 ? 's' : ''}` :
                            '';
                    }
                });
            }
        }

        function setupAutoComplete() {
            // Autocompletado para campos de b�squeda
            const campos = ['busquedaCodigo', 'busquedaNombre', 'busquedaMarca'];
            campos.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.addEventListener('input', debounce((e) => {
                        // Aqu� se implementar�a la l�gica de autocompletado
                        showAutoCompleteHint(campo, e.target.value);
                    }, 300));
                }
            });
        }

        function showAutoCompleteHint(element, value) {
            if (value.length < 2) return;

            // Simular sugerencias (en producci�n vendr�a de la base de datos)
            const hints = ['Producto A', 'Producto B', 'Marca X', 'Marca Y'];
            const matchingHints = hints.filter(hint =>
                hint.toLowerCase().includes(value.toLowerCase())
            );

            // Mostrar hint visual
            if (matchingHints.length > 0) {
                element.title = `Sugerencia: ${matchingHints[0]}`;
                element.style.borderColor = '#10B981';
            } else {
                element.title = '';
                element.style.borderColor = '';
            }
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl + F para buscar
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    const busquedaRapida = document.getElementById('busquedaRapida');
                    if (busquedaRapida) {
                        busquedaRapida.focus();
                        busquedaRapida.select();
                    }
                }

                // Ctrl + S para sincronizar
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    const sincBtn = document.getElementById('sincronizarEntradas');
                    if (sincBtn) sincBtn.click();
                }

                // Ctrl + R para actualizar tabla
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    const refreshBtn = document.getElementById('refreshTable');
                    if (refreshBtn) refreshBtn.click();
                }

                // ESC para cerrar modales
                if (e.key === 'Escape') {
                    const scanner = document.getElementById('scanner-container');
                    if (scanner && scanner.style.display !== 'none') {
                        scanner.style.display = 'none';
                    }
                }
            });
        }

        function setupRealTimeValidation() {
            const cantidadInput = document.getElementById('cantidadEntrada');
            if (cantidadInput) {
                cantidadInput.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    const isValid = value > 0;

                    if (isValid) {
                        e.target.classList.remove('border-red-500');
                        e.target.classList.add('border-green-500');
                        updateEntryPreview();
                    } else {
                        e.target.classList.remove('border-green-500');
                        e.target.classList.add('border-red-500');
                    }
                });
            }

            // Validaci�n de fecha
            const fechaInput = document.getElementById('fechaEntrada');
            if (fechaInput) {
                fechaInput.addEventListener('change', (e) => {
                    const selectedDate = new Date(e.target.value);
                    const today = new Date();
                    const maxDate = new Date();
                    maxDate.setDate(today.getDate() + 30); // M�ximo 30 d�as en el futuro

                    if (selectedDate > maxDate) {
                        e.target.classList.add('border-yellow-500');
                        showToast('⚠️ La fecha seleccionada est� muy lejos en el futuro', 'warning');
                    } else {
                        e.target.classList.remove('border-yellow-500');
                        updateEntryPreview();
                    }
                });
            }
        }

        function updateEntryPreview() {
            const codigo = document.getElementById('codigoProducto')?.value;
            const nombre = document.getElementById('nombreProducto')?.value;
            const cantidad = document.getElementById('cantidadEntrada')?.value;
            const fecha = document.getElementById('fechaEntrada')?.value;
            const unidad = document.getElementById('unidadProducto')?.value;

            if (codigo && nombre && cantidad && fecha) {
                const resumen = document.getElementById('resumenEntrada');
                const textoResumen = document.getElementById('textoResumen');

                if (resumen && textoResumen) {
                    textoResumen.innerHTML = `
                        <strong>${nombre}</strong> (${codigo})<br>
                        Cantidad: <strong>${cantidad} ${unidad || 'unidades'}</strong><br>
                        Fecha: <strong>${new Date(fecha).toLocaleDateString('es-ES')}</strong>
                    `;
                    resumen.style.display = 'block';
                }
            }
        }

        // Funci�n auxiliar para debounce
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Funci�n para mostrar mensajes toast
        function showToast(message, type = 'info') {
            // Implementaci�n simple de toast
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-500' :
                    type === 'warning' ? 'bg-yellow-500' :
                        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                } text-white`;
            toast.textContent = message;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Funci�n para ordenar tabla
        function sortTable(column) {
            console.log(`Ordenando por: ${column}`);
            // Aqu� se implementar�a la l�gica de ordenamiento
        } function setupAutoRefresh() {
            let autoRefreshEnabled = false;
            let autoRefreshInterval;

            const autoRefreshBtn = document.getElementById('autoRefresh');
            if (autoRefreshBtn) {
                autoRefreshBtn.addEventListener('click', () => {
                    autoRefreshEnabled = !autoRefreshEnabled;

                    if (autoRefreshEnabled) {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: ON</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');

                        autoRefreshInterval = setInterval(() => {
                            refreshTableData();
                            updateLastSyncTime();
                        }, 30000); // Cada 30 segundos

                        showToast('✅ Auto-actualizaci�n activada', 'success');
                    } else {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: OFF</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');

                        if (autoRefreshInterval) {
                            clearInterval(autoRefreshInterval);
                        }
                        showToast('⏸️ Auto-actualizaci�n desactivada', 'info');
                    }
                });
            }
        }

        function updateLastSyncTime() {
            const ultimaSync = document.getElementById('ultimaSync');
            if (ultimaSync) {
                const now = new Date();
                ultimaSync.textContent = now.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function setupLoadingEffects() {
            // Interceptar clicks en botones de b�squeda
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        const textId = btnId.replace('buscar', 'btn') + 'Text';
                        showButtonLoading(btn, textId, '🔍 Buscando...');

                        // Simular b�squeda exitosa
                        setTimeout(() => {
                            hideButtonLoading(btn, textId, '🔍 Buscar');
                            updateSearchHistory(btnId);
                        }, 2000);
                    });
                }
            });

            // Interceptar registro de entrada
            const registrarBtn = document.getElementById('registrarEntrada');
            if (registrarBtn) {
                registrarBtn.addEventListener('click', () => {
                    showButtonLoading(registrarBtn, 'btnRegistrarText', '⏳ Registrando entrada...');

                    setTimeout(() => {
                        hideButtonLoading(registrarBtn, 'btnRegistrarText', '✅ Registrar Entrada');
                        showToast('✅ Entrada registrada exitosamente', 'success');
                        updateEntryCounter();
                    }, 3000);
                });
            }

            // Interceptar sincronizaci�n
            const sincBtn = document.getElementById('sincronizarEntradas');
            if (sincBtn) {
                sincBtn.addEventListener('click', () => {
                    showButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizando con servidor...');

                    setTimeout(() => {
                        hideButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizar con Servidor');
                        showToast('✅ Sincronizaci�n completada', 'success');
                        updateLastSyncTime();
                    }, 4000);
                });
            }

            // Interceptar actualizaci�n de tabla
            const refreshBtn = document.getElementById('refreshTable');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    const indicator = document.getElementById('tableLoadingIndicator');
                    if (indicator) {
                        indicator.style.display = 'block';
                        setTimeout(() => {
                            indicator.style.display = 'none';
                            showToast('🔄 Tabla actualizada', 'info');
                        }, 2000);
                    }
                });
            }
        }

        function updateSearchHistory(searchType) {
            const busquedaReciente = document.getElementById('busquedaReciente');
            const textoUltimaBusqueda = document.getElementById('textoUltimaBusqueda');

            if (busquedaReciente && textoUltimaBusqueda) {
                const tipoTexto = {
                    'buscarPorCodigo': 'B�squeda por c�digo',
                    'buscarPorNombre': 'B�squeda por nombre',
                    'buscarPorMarca': 'B�squeda por marca'
                };

                const now = new Date().toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                textoUltimaBusqueda.textContent = `${tipoTexto[searchType]} a las ${now}`;
                busquedaReciente.style.display = 'block';

                // Ocultar despu�s de 10 segundos
                setTimeout(() => {
                    busquedaReciente.style.display = 'none';
                }, 10000);
            }
        }

        function updateEntryCounter() {
            const contador = document.getElementById('contadorEntradas');
            const totalEntradas = document.getElementById('totalEntradas');

            if (contador) {
                const currentCount = parseInt(contador.textContent.match(/\d+/) || [0])[0];
                const newCount = currentCount + 1;
                contador.textContent = `Total: ${newCount} entradas registradas`;

                // Animaci�n del contador
                contador.classList.add('animate-pulse');
                setTimeout(() => {
                    contador.classList.remove('animate-pulse');
                }, 1000);
            }

            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                totalEntradas.textContent = currentCount + 1;
            }
        }

        function showButtonLoading(button, textElementId = null, loadingText = 'Cargando...') {
            button.disabled = true;
            button.classList.add('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
                }
            } else {
                button.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
            }
        }

        function hideButtonLoading(button, textElementId = null, originalText = 'Buscar') {
            button.disabled = false;
            button.classList.remove('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.textContent = originalText;
                }
            } else {
                button.textContent = originalText;
            }
        } function setupEntranceAnimations() {
            // Animar elementos cuando aparecen
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-fade-in-up');

                        // A�adir un peque�o retraso para elementos consecutivos
                        const siblings = Array.from(entry.target.parentElement.children);
                        const index = siblings.indexOf(entry.target);
                        entry.target.style.animationDelay = `${index * 0.1}s`;
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            // Observar todas las tarjetas
            document.querySelectorAll('.card-hover').forEach(card => {
                observer.observe(card);
            });

            // Animaciones para botones al hacer hover
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('mouseenter', () => {
                    if (!button.disabled) {
                        button.style.transform = 'translateY(-2px)';
                        button.style.boxShadow = '0 10px 25px rgba(0,0,0,0.2)';
                    }
                });

                button.addEventListener('mouseleave', () => {
                    button.style.transform = 'translateY(0)';
                    button.style.boxShadow = '';
                });
            });

            // Animaci�n de aparecer para modales
            const scanner = document.getElementById('scanner-container');
            if (scanner) {
                const originalDisplay = scanner.style.display;
                scanner.addEventListener('click', (e) => {
                    if (e.target === scanner) {
                        // Cerrar al hacer click fuera del modal
                        hideModal(scanner);
                    }
                });
            }
        }

        function showModal(modal) {
            modal.style.display = 'flex';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.transition = 'all 0.3s ease';
                modal.style.opacity = '1';
                modal.style.transform = 'scale(1)';
            }, 10);
        }

        function hideModal(modal) {
            modal.style.transition = 'all 0.3s ease';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function setupDynamicNotifications() {
            // Mostrar formulario solo cuando se selecciona un producto
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        setTimeout(() => {
                            const productForm = document.getElementById('productForm');
                            const codigoProducto = document.getElementById('codigoProducto');

                            if (productForm && codigoProducto && codigoProducto.value) {
                                // Mostrar formulario con animaci�n
                                productForm.style.display = 'block';
                                productForm.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });

                                // Animaci�n de aparici�n
                                productForm.style.opacity = '0';
                                productForm.style.transform = 'translateY(30px)';

                                setTimeout(() => {
                                    productForm.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                                    productForm.style.opacity = '1';
                                    productForm.style.transform = 'translateY(0)';

                                    // Destacar el formulario brevemente
                                    productForm.classList.add('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    setTimeout(() => {
                                        productForm.classList.remove('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    }, 2000);
                                }, 100);

                                // Actualizar stock actual (simulado)
                                updateStockDisplay();

                                // Focus en el primer campo editable
                                const cantidadInput = document.getElementById('cantidadEntrada');
                                if (cantidadInput) {
                                    setTimeout(() => cantidadInput.focus(), 800);
                                }
                            }
                        }, 500);
                    });
                }
            });

            // Feedback visual en inputs con animaciones mejoradas
            document.querySelectorAll('input, textarea, select').forEach(input => {
                input.addEventListener('focus', (e) => {
                    e.target.style.transform = 'scale(1.02)';
                    e.target.style.transition = 'transform 0.2s ease';

                    // A�adir indicador de foco
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '#10B981';
                        label.style.transform = 'scale(1.05)';
                        label.style.transition = 'all 0.2s ease';
                    }
                });

                input.addEventListener('blur', (e) => {
                    e.target.style.transform = 'scale(1)';

                    // Restaurar label
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '';
                        label.style.transform = 'scale(1)';
                    }
                });

                // Validaci�n visual en tiempo real
                if (input.type === 'number') {
                    input.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        if (value > 0) {
                            e.target.style.borderColor = '#10B981';
                            e.target.style.backgroundColor = '#F0FDF4';
                        } else if (e.target.value) {
                            e.target.style.borderColor = '#EF4444';
                            e.target.style.backgroundColor = '#FEF2F2';
                        } else {
                            e.target.style.borderColor = '';
                            e.target.style.backgroundColor = '';
                        }
                    });
                }
            });

            // Animaciones para las filas de la tabla
            setupTableRowAnimations();

            // Notificaciones de estado del sistema
            setupSystemStatusNotifications();
        }

        function updateStockDisplay() {
            const stockActual = document.getElementById('stockActual');
            if (stockActual) {
                // Simular datos de stock
                const stock = Math.floor(Math.random() * 500) + 10;
                stockActual.textContent = stock;

                // Animaci�n del contador
                stockActual.style.transform = 'scale(1.2)';
                stockActual.style.transition = 'transform 0.3s ease';

                setTimeout(() => {
                    stockActual.style.transform = 'scale(1)';
                }, 300);

                // Color basado en el stock
                if (stock < 50) {
                    stockActual.className = 'text-2xl font-bold text-red-600';
                    stockActual.parentElement.className = 'bg-red-50 p-4 rounded-lg border border-red-200';
                } else if (stock < 100) {
                    stockActual.className = 'text-2xl font-bold text-yellow-600';
                    stockActual.parentElement.className = 'bg-yellow-50 p-4 rounded-lg border border-yellow-200';
                } else {
                    stockActual.className = 'text-2xl font-bold text-green-600';
                    stockActual.parentElement.className = 'bg-green-50 p-4 rounded-lg border border-green-200';
                }
            }
        }

        function setupTableRowAnimations() {
            // Observador para filas de tabla
            const tableObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeName === 'TR' && !node.classList.contains('text-center')) {
                                // Animar nueva fila
                                node.style.opacity = '0';
                                node.style.transform = 'translateX(-20px)';

                                setTimeout(() => {
                                    node.style.transition = 'all 0.5s ease';
                                    node.style.opacity = '1';
                                    node.style.transform = 'translateX(0)';
                                }, 100);

                                // Efectos hover mejorados
                                node.addEventListener('mouseenter', () => {
                                    node.style.backgroundColor = '#F0FDF4';
                                    node.style.transform = 'scale(1.01)';
                                    node.style.transition = 'all 0.2s ease';
                                    node.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
                                });

                                node.addEventListener('mouseleave', () => {
                                    node.style.backgroundColor = '';
                                    node.style.transform = 'scale(1)';
                                    node.style.boxShadow = '';
                                });
                            }
                        });
                    }
                });
            });

            const tableBody = document.getElementById('tablaEntradasBody');
            if (tableBody) {
                tableObserver.observe(tableBody, { childList: true });
            }
        }

        function setupSystemStatusNotifications() {
            // Notificaciones peri�dicas de estado
            setInterval(() => {
                if (Math.random() < 0.1) { // 10% de probabilidad cada minuto
                    const messages = [
                        '✅ Sistema funcionando correctamente',
                        '📊 Base de datos sincronizada',
                        '🔄 Datos actualizados autom�ticamente',
                        '📈 Rendimiento �ptimo del sistema'
                    ];

                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    showToast(randomMessage, 'success');
                }
            }, 60000); // Cada minuto
        } function refreshTableData() {
            const indicator = document.getElementById('tableLoadingIndicator');
            if (indicator) {
                indicator.style.display = 'block';

                // Simular carga de datos
                setTimeout(() => {
                    indicator.style.display = 'none';
                    updateLastSyncTime();

                    // Actualizar contador si hay datos
                    const tbody = document.getElementById('tablaEntradasBody');
                    if (tbody) {
                        const rows = tbody.querySelectorAll('tr:not(.text-center)');
                        const contador = document.getElementById('contadorEntradas');
                        if (contador) {
                            contador.textContent = `Total: ${rows.length} entradas registradas`;
                        }
                    }
                }, 2000);
            }

            console.log('Actualizando datos de la tabla...');
        }

        // Efectos adicionales para las filas de la tabla
        function addTableRowEffects() {
            document.querySelectorAll('#tablaEntradasBody tr:not(.text-center)').forEach(row => {
                // Eliminar eventos anteriores para evitar duplicados
                row.removeEventListener('mouseenter', handleRowHover);
                row.removeEventListener('mouseleave', handleRowLeave);

                // A�adir nuevos eventos
                row.addEventListener('mouseenter', handleRowHover);
                row.addEventListener('mouseleave', handleRowLeave);
            });
        }

        function handleRowHover(e) {
            e.target.style.backgroundColor = '#F0FDF4';
            e.target.style.transform = 'scale(1.01)';
            e.target.style.transition = 'all 0.2s ease';
            e.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        }

        function handleRowLeave(e) {
            e.target.style.backgroundColor = '';
            e.target.style.transform = 'scale(1)';
            e.target.style.boxShadow = '';
        }

        // Inicializar mejoras adicionales al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                addTableRowEffects();
                initializeAdditionalFeatures();
            }, 1000);
        });

        // Caracter�sticas adicionales
        function initializeAdditionalFeatures() {
            // Configurar filtros de fecha inteligentes
            setupIntelligentDateFilters();

            // Configurar exportaci�n mejorada
            setupEnhancedExport();

            // Configurar modo expandido de tabla
            setupTableExpandMode();

            // Configurar estad�sticas en tiempo real
            setupRealTimeStats();
        }

        function setupIntelligentDateFilters() {
            const filtrarPorFecha = document.getElementById('filtrarPorFecha');
            if (filtrarPorFecha) {
                filtrarPorFecha.addEventListener('click', () => {
                    const fechaDesde = document.getElementById('fechaDesde').value;
                    const fechaHasta = document.getElementById('fechaHasta').value;

                    if (fechaDesde && fechaHasta) {
                        const rangoFechas = document.getElementById('rangoFechas');
                        if (rangoFechas) {
                            const desde = new Date(fechaDesde).toLocaleDateString('es-ES');
                            const hasta = new Date(fechaHasta).toLocaleDateString('es-ES');
                            rangoFechas.textContent = `Mostrando entradas del ${desde} al ${hasta}`;
                        }
                        showToast(`📅 Filtro aplicado: ${fechaDesde} a ${fechaHasta}`, 'info');
                    } else {
                        showToast('⚠️ Seleccione ambas fechas para filtrar', 'warning');
                    }
                });
            }
        }

        function setupEnhancedExport() {
            const exportBtn = document.getElementById('exportVisible');
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    showToast('📥 Preparando exportaci�n...', 'info');

                    setTimeout(() => {
                        showToast('✅ Datos exportados exitosamente', 'success');
                    }, 2000);
                });
            }
        }

        function setupTableExpandMode() {
            const expandBtn = document.getElementById('expandirTabla');
            let isExpanded = false;

            if (expandBtn) {
                expandBtn.addEventListener('click', () => {
                    const tableContainer = expandBtn.closest('.bg-white');

                    if (!isExpanded) {
                        tableContainer.classList.add('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Contraer</span>';
                        isExpanded = true;
                        showToast('⛶ Tabla expandida', 'info');
                    } else {
                        tableContainer.classList.remove('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Expandir</span>';
                        isExpanded = false;
                        showToast('⛶ Tabla contra�da', 'info');
                    }
                });
            }
        }

        function setupRealTimeStats() {
            // Actualizar estad�sticas cada 30 segundos
            setInterval(() => {
                updateSystemStats();
            }, 30000);

            // Actualizaci�n inicial
            updateSystemStats();
        }

        function updateSystemStats() {
            // Simular actualizaci�n de estad�sticas
            const totalEntradas = document.getElementById('totalEntradas');
            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                if (Math.random() < 0.3) { // 30% de probabilidad de incremento
                    totalEntradas.textContent = currentCount + Math.floor(Math.random() * 3) + 1;
                }
            }
        }

        // CSS para animaciones adicionales
        const additionalStyles = `
            <style>
                .animate-fade-in-up {
                    animation: fadeInUp 0.6s ease-out forwards;
                }
                
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(30px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .status-indicator {
                    display: inline-block;
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    margin-right: 6px;
                }
                
                .status-success {
                    background-color: #10B981;
                    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
                }
                
                .status-error {
                    background-color: #EF4444;
                    box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
                }
                
                .card-hover {
                    transition: all 0.3s ease;
                }
                
                .card-hover:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                }
                
                .loading-spinner {
                    border: 2px solid #f3f3f3;
                    border-top: 2px solid #3498db;
                    border-radius: 50%;
                    width: 16px;
                    height: 16px;
                    animation: spin 1s linear infinite;
                }
                
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                
                /* Efectos de hover mejorados */
                button:not(:disabled):hover {
                    transform: translateY(-1px) !important;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                }
                
                input:focus, textarea:focus, select:focus {
                    transform: scale(1.01);
                    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
                }
                
                /* Animaciones para modales */
                .modal-enter {
                    animation: modalEnter 0.3s ease-out forwards;
                }
                
                @keyframes modalEnter {
                    from {
                        opacity: 0;
                        transform: scale(0.9);
                    }
                    to {
                        opacity: 1;
                        transform: scale(1);
                    }
                }
                
                /* Efectos de tabla mejorados */
                table th {
                    position: relative;
                    overflow: hidden;
                }
                
                table th:hover::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    animation: shimmer 1.5s ease-in-out;
                }
                
                @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
            </style>
        `;

        // A�adir estilos al head
        document.head.insertAdjacentHTML('beforeend', additionalStyles);

        // Llamar despu�s de cargar datos en la tabla
        window.addEventListener('load', () => {
            setTimeout(addTableRowEffects, 1000);
        });

        // Funci�n para convertir gui�n a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Funci�n para aplicar la conversi�n a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversi�n a los campos de c�digo cuando se cargue la p�gina
        document.addEventListener('DOMContentLoaded', function() {
            const busquedaCodigo = document.getElementById('busquedaCodigo');
            const codigoProducto = document.getElementById('codigoProducto');
            const filtroCodigo = document.getElementById('filtroCodigo');
            
            aplicarConversionCodigo(busquedaCodigo);
            aplicarConversionCodigo(codigoProducto);
            aplicarConversionCodigo(filtroCodigo);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Preconteo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <script src="../librer�as/JsBarcode.all.min.js"></script>
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>

    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    </script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-xl font-bold">Reporte de Preconteo</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <nav class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-xl font-bold">GestorInventory</h1>
            <a href="./main.html" class="hover:underline">Regresar</a>
            <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
                Men�
            </button>
        </div>
    </nav>

    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold text-center mb-6">Generador de Reportes de Preconteo</h1>

        <div class="mb-6 bg-white p-4 rounded shadow">
            <div class="mb-4">
                <label class="block font-semibold mb-2">Selecciona una o varias �reas:</label>
                <div id="areasContainer" class="grid grid-cols-2 md:grid-cols-3 gap-2 border rounded p-3">
                    <!-- Las �reas se cargar�n din�micamente como checkboxes -->
                    <div class="flex items-center">
                        <input type="checkbox" id="area-todas" value="todas" class="areaCheckbox mr-2" checked>
                        <label for="area-todas">Todas las �reas</label>
                    </div>
                </div>
                <div class="mt-2 text-right">
                    <button id="aplicarFiltroBtn" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">
                        Aplicar filtro
                    </button>
                </div>
            </div>

            <div id="loadingIndicator" class="hidden">
                <div class="flex items-center justify-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                    <span class="ml-2">Cargando productos...</span>
                </div>
            </div>

            <div id="productosList" class="mt-4">
                <h2 class="text-xl font-semibold mb-2">Lista de productos:</h2>
                <ul id="productosContainer" class="list-decimal pl-6 space-y-1">
                    <!-- Los productos se cargar�n din�micamente -->
                </ul>
            </div>
        </div>

        <div class="text-center">
            <button id="generarReporteBtn"
                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded">
                GENERAR REPORTE DE PRECONTEO
            </button>
        </div>

        <!-- Contenedor invisible para generar c�digos de barras -->
        <div id="barcodeContainer" class="hidden"></div>
    </div>

    <!-- Cargar nuestro script principal despu�s de asegurarnos que las dependencias est�n cargadas -->
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/reports/rep.js"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Recuperar Contraseña</h1>
            
            <form id="formPasswordReset" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Correo Electrónico</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="tu@email.com"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Enviar Enlace de Recuperación
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Recordaste tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restablecer Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Restablecer Contraseña</h1>
            
            <form id="formResetPassword" class="space-y-4">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Nueva Contraseña</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Ingresa tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-300 mb-2">Confirmar Contraseña</label>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        name="confirmPassword" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Confirma tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Restablecer Contraseña
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Ya tienes tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }

        // Manejar reset de contraseña
        document.addEventListener('DOMContentLoaded', async () => {
            const formResetPassword = document.getElementById('formResetPassword');
            
            if (formResetPassword) {
                formResetPassword.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    // Validar que las contraseñas coincidan
                    if (password !== confirmPassword) {
                        alert('Las contraseñas no coinciden');
                        return;
                    }
                    
                    // Validar longitud mínima
                    if (password.length < 6) {
                        alert('La contraseña debe tener al menos 6 caracteres');
                        return;
                    }

                    try {
                        // Obtener el hash del enlace de reseteo de la URL
                        const hash = window.location.hash;
                        
                        if (!hash) {
                            alert('Enlace de recuperación inválido');
                            return;
                        }

                        // Esperar a que Supabase esté disponible
                        let attempts = 0;
                        while (!window.supabase && attempts < 50) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }

                        if (!window.supabase) {
                            alert('Error: No se pudo cargar Supabase');
                            return;
                        }

                        const { error } = await window.supabase.auth.updateUser({
                            password: password
                        });

                        if (error) {
                            alert('Error al actualizar contraseña: ' + error.message);
                            return;
                        }

                        alert('Contraseña actualizada correctamente');
                        window.location.href = '../index.html';
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al restablecer contraseña');
                    }
                });
            }
        });
    </script>
</body>
</html>
<<<<<<< HEAD=======<!DOCTYPE html>
    <html lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Confirmaci�n de Correo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
        <link href="../librer�as/tailwind.min.css" rel="stylesheet">
        <link href="../css/styles.css" rel="stylesheet">
        <script src="../js/utils/theme-manager.js"></script>
        <script src="../js/ui/theme-toggle.js"></script>
    </head>

    <body class="bg-gray-100 flex items-center justify-center h-screen">
        <div class="container mx-auto p-6 max-w-md bg-white shadow-md rounded-lg text-center">
            <h1 id="statusTitle" class="text-2xl font-bold mb-4 text-blue-600">Verificando tu correo...</h1>
            <p id="statusMessage" class="text-gray-700 mb-6">Por favor, espera un momento mientras procesamos tu
                confirmaci�n.</p>
            <p id="detailsMessage" class="text-gray-600 mb-4"></p>
            <a href="../index.html"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-2 inline-block">
                Ir al Inicio de Sesi�n
            </a>
        </div>
        <script src="../js/ui/mobile-optimizer.js"></script>
        <script type="module">
            import { supabase } from '../js/auth/auth.js';

            const statusTitleEl = document.getElementById('statusTitle');
            const statusMessageEl = document.getElementById('statusMessage');
            const detailsMessageEl = document.getElementById('detailsMessage');

            // Supabase maneja la confirmaci�n del token en el backend antes de redirigir aqu�.
            // Esta p�gina muestra el resultado basado en los par�metros de la URL o el estado de la sesi�n.

            const urlParams = new URLSearchParams(window.location.search);
            const errorDescription = urlParams.get('error_description');
            // const errorCode = urlParams.get('error'); // Podr�as usarlo para errores m�s espec�ficos

            if (errorDescription) {
                statusTitleEl.textContent = 'Error en la Confirmaci�n';
                statusTitleEl.classList.remove('text-blue-600', 'text-green-600');
                statusTitleEl.classList.add('text-red-600');
                statusMessageEl.textContent = 'No pudimos confirmar tu direcci�n de correo electr�nico.';
                detailsMessageEl.textContent = `Detalles: ${decodeURIComponent(errorDescription)}`;
                detailsMessageEl.classList.add('text-red-500');
            } else {
                // Si no hay error en la URL, la confirmaci�n fue procesada por Supabase.
                // Esto puede significar que el correo se confirm� ahora o ya estaba confirmado.
                statusTitleEl.textContent = '¡Correo Verificado!';
                statusTitleEl.classList.remove('text-blue-600', 'text-red-600');
                statusTitleEl.classList.add('text-green-600');
                statusMessageEl.textContent = 'Tu direcci�n de correo electr�nico ha sido verificada exitosamente.';
                detailsMessageEl.textContent = 'Ya puedes cerrar esta ventana e iniciar sesi�n.';

                // onAuthStateChange puede dar feedback adicional si la confirmaci�n tambi�n inicia sesi�n.
                supabase.auth.onAuthStateChange((event, session) => {
                    if (event === 'SIGNED_IN' && session) {
                        detailsMessageEl.textContent = 'Has iniciado sesi�n autom�ticamente. ¡Bienvenido!';
                    } else if (event === 'USER_UPDATED' && session?.user?.email_confirmed_at) {
                        // El correo est� confirmado, el mensaje por defecto ya es apropiado.
                        // Puedes a�adir algo m�s si es necesario.
                    }
                });
            }
        </script>
    </body>

    </html>
    >>>>>>> 1e3239b (feat: A�adir enlace para recuperaci�n de contrase�a en la p�gina de inicio de sesi�n y mejorar
    mensajes de confirmaci�n de correo)
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Producto - Sistema de Gestión de Productos</title>
    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <!-- Cambiamos Quagga por Html5QrCode -->
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../librerías/sweetalert2@11.js"></script>
    <!-- Añadir JsBarcode para códigos de barra -->
    <script src="../librerías/JsBarcode.all.min.js"></script>
    <!-- Añadir jsPDF para generación de PDFs -->
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Consulta de Producto</h1>

    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="consulta" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Consulta de Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">Menú</button>

        <!-- Sistema de pestañas -->
        <div class="mb-4 mt-4">
            <nav class="flex border-b">
                <button id="tab-busqueda" class="tab-button border-b-2 border-blue-500 text-blue-600 px-4 py-2 font-semibold">Búsqueda</button>
                <button id="tab-relaciones" class="tab-button border-b-2 border-transparent text-gray-500 px-4 py-2 font-semibold">Relaciones</button>
            </nav>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-busqueda" class="tab-content">
            <form id="formConsultaProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoConsulta">Código/PLU:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoConsulta" type="text">
                        <button type="button" id="escanearBtnConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear Código de Barras</button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreConsulta">Nombre:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="nombreConsulta" type="text">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaConsulta">Categoría:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="categoriaConsulta" type="text">
                </div>
                <div class="flex items-center justify-between">
                    <button id="buscarConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">Buscar Producto</button>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
        </div>
        <div id="content-relaciones" class="tab-content" style="display:none;">
            <form id="formRelaciones" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoRelacion">Código del producto:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoRelacion" type="text" placeholder="Escanea o ingresa el código o últimos 4 dígitos">
                        <button type="button" id="escanearBtnRelacion" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear</button>
                        <button type="button" id="buscarRelacion" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Buscar Relación</button>
                    </div>
                </div>
            </form>
            <div id="relaciones" class="mt-4"></div>
        </div>

        <!-- Modificamos el contenedor del escáner -->
        <!-- En plantillas/consulta.html -->
        <div id="scanner-container-consulta" class="mt-4" style="display: none;">
            <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
            <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
        </div>

        <!-- Div to hold the barcode -->
        <div id="barcodeContainer" class="mt-4"></div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Búsqueda relacional de productos con pestañas
        document.addEventListener('DOMContentLoaded', function() {
            const codigoConsulta = document.getElementById('codigoConsulta');
            aplicarConversionCodigo(codigoConsulta);
            // Para la pestaña de relaciones
            const codigoRelacion = document.getElementById('codigoRelacion');
            if (codigoRelacion) aplicarConversionCodigo(codigoRelacion);

            // Tabs
            const tabBusqueda = document.getElementById('tab-busqueda');
            const tabRelaciones = document.getElementById('tab-relaciones');
            const contentBusqueda = document.getElementById('content-busqueda');
            const contentRelaciones = document.getElementById('content-relaciones');
            const relacionesDiv = document.getElementById('relaciones');
            let ultimoProducto = null;

            function switchTab(tab) {
                if (tab === 'busqueda') {
                    tabBusqueda.classList.add('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.remove('border-transparent', 'text-gray-500');
                    tabRelaciones.classList.remove('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'block';
                    contentRelaciones.style.display = 'none';
                } else {
                    if (tabRelaciones.disabled) return; // No cambiar si está deshabilitada
                    tabRelaciones.classList.add('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.remove('border-transparent', 'text-gray-500');
                    tabBusqueda.classList.remove('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'none';
                    contentRelaciones.style.display = 'block';
                }
            }
            tabBusqueda.addEventListener('click', () => switchTab('busqueda'));
            tabRelaciones.addEventListener('click', () => switchTab('relaciones'));
            switchTab('busqueda');

            const buscarBtn = document.getElementById('buscarConsulta');
            const resultadosDiv = document.getElementById('resultados');

            buscarBtn.addEventListener('click', async function() {
                resultadosDiv.innerHTML = '';
                ultimoProducto = null;
                const codigoInput = document.getElementById('codigoConsulta').value.trim();
                const nombre = document.getElementById('nombreConsulta').value.trim();
                const categoria = document.getElementById('categoriaConsulta').value.trim();

                // Buscar primero en IndexedDB para obtener el código completo
                function buscarEnIndexedDB(codigo, nombre, categoria) {
                    return new Promise((resolve, reject) => {
                        if (!window.indexedDB) {
                            resolve(null);
                            return;
                        }
                        const request = window.indexedDB.open('InventarioDB', 1);
                        request.onerror = function() { resolve(null); };
                        request.onsuccess = function(event) {
                            const db = event.target.result;
                            const tx = db.transaction(['productos'], 'readonly');
                            const store = tx.objectStore('productos');
                            const allReq = store.getAll();
                            allReq.onsuccess = function(e) {
                                const productos = e.target.result || [];
                                let encontrados = [];
                                if (codigo) {
                                    if (codigo.length === 4) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo.endsWith(codigo));
                                    } else if (codigo.length === 13) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    } else {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    }
                                } else if (nombre || categoria) {
                                    encontrados = productos.filter(p => {
                                        let match = true;
                                        if (nombre) match = match && p.nombre && p.nombre.toLowerCase().includes(nombre.toLowerCase());
                                        if (categoria) match = match && p.categoria && p.categoria.toLowerCase().includes(categoria.toLowerCase());
                                        return match;
                                    });
                                }
                                resolve(encontrados);
                            };
                            allReq.onerror = function() { resolve(null); };
                        };
                    });
                }

                const productosLocal = await buscarEnIndexedDB(codigoInput, nombre, categoria);
                if (!productosLocal || productosLocal.length === 0) {
                    resultadosDiv.innerHTML = '<div class="text-red-600 font-semibold">No se encontraron productos en el dispositivo.</div>';
                    return;
                }

                // Mostrar resultados principales
                productosLocal.forEach((producto, idx) => {
                    let html = `<div class="bg-white rounded shadow p-4 mb-4">
                        <h3 class="text-xl font-bold mb-2">${producto.nombre}</h3>
                        <div><b>Código:</b> ${producto.codigo}</div>
                        <div><b>Categoría:</b> ${producto.categoria}</div>
                        <div><b>Marca:</b> ${producto.marca}</div>
                        <div><b>Unidad:</b> ${producto.unidad}</div>
                    </div>`;
                    resultadosDiv.innerHTML += html;
                    if (idx === 0) ultimoProducto = producto;
                });
            });

            // Lógica independiente para la pestaña de relaciones
            const buscarRelacionBtn = document.getElementById('buscarRelacion');
            if (buscarRelacionBtn) {
                buscarRelacionBtn.addEventListener('click', async function() {
                    relacionesDiv.innerHTML = '';
                    let codigo = document.getElementById('codigoRelacion').value.trim();
                    if (!codigo) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Ingresa un código para buscar relaciones.</div>';
                        return;
                    }
                    // Permitir búsqueda por últimos 4 dígitos
                    if (codigo.length === 4) {
                        // Buscar en Supabase todos los productos cuyo substring(2,5) sea igual a esos 4 dígitos
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        // Traer todos los códigos y filtrar en JS (por compatibilidad universal)
                        const { data: productosTodos } = await supabase.from('productos').select('codigo');
                        const productos4 = (productosTodos || []).filter(p => typeof p.codigo === 'string' && p.codigo.length >= 5 && p.codigo.substring(1,5) === codigo);
                        if (productos4.length > 0) {
                            if (productos4.length > 1) {
                                relacionesDiv.innerHTML = `<div class='mb-2'>Se encontraron varios productos con los dígitos 2-5 <b>${codigo}</b>:</div>`;
                                productos4.forEach(p => {
                                    relacionesDiv.innerHTML += `<button class='bg-blue-100 hover:bg-blue-300 text-blue-800 px-2 py-1 rounded m-1' onclick='document.getElementById("codigoRelacion").value="${p.codigo}";document.getElementById("buscarRelacion").click();return false;'>${p.codigo}</button>`;
                                });
                                return;
                            } else {
                                codigo = productos4[0].codigo;
                                document.getElementById('codigoRelacion').value = codigo;
                            }
                        } else {
                            relacionesDiv.innerHTML = `<div class='text-red-600'>No se encontró ningún producto con los dígitos 2-5 igual a <b>${codigo}</b>.</div>`;
                            return;
                        }
                    }
                    relacionesDiv.innerHTML = '<div class="text-gray-500">Buscando relaciones...</div>';
                    try {
                        const { obtenerRelacionesProductosSupabase, buscarRelacionProducto } = await import('../js/relaciones-productos.js');
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        const relaciones = await obtenerRelacionesProductosSupabase();
                        const resultado = buscarRelacionProducto(codigo, relaciones);
                        // Buscar info del producto consultado
                        let relHtml = `<div class="bg-white rounded shadow p-4 mb-4">
                            <h3 class="text-lg font-bold mb-2">Relaciones para: <span class='font-mono'>${codigo}</span></h3>`;
                        const { data: productoInfo } = await supabase.from('productos').select('*').eq('codigo', codigo);
                        if (productoInfo && productoInfo.length > 0) {
                            const p = productoInfo[0];
                            relHtml += `<div class='mb-2 text-sm text-gray-700'>${p.nombre} | ${p.unidad || ''} | ${p.categoria || ''} | ${p.marca || ''}</div>`;
                        }
                        // Si es principal, mostrar subproductos
                        if (resultado.tipo === 'principal' && resultado.subproductos.length > 0) {
                            // Buscar info de subproductos
                            const { data: subproductosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos);
                            relHtml += `<div class="mt-2"><b>Subproductos relacionados:</b>
                            <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                            resultado.subproductos.forEach(subCodigo => {
                                const sub = subproductosInfo ? subproductosInfo.find(p => p.codigo === subCodigo) : null;
                                if (sub) {
                                    relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                } else {
                                    relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                }
                            });
                            relHtml += '</tbody></table></div>';
                        }
                        // Si es subproducto, mostrar principal y hermanos
                        if (resultado.tipo === 'subproducto' && resultado.principal) {
                            // Buscar info del principal
                            const { data: principalArr } = await supabase.from('productos').select('*').eq('codigo', resultado.principal);
                            if (principalArr && principalArr.length > 0) {
                                const principal = principalArr[0];
                                relHtml += `<div class="mt-4"><b>Producto principal:</b>
                                    <div class="bg-gray-50 rounded p-2 mt-1">
                                        <b>${principal.nombre}</b> (Código: ${principal.codigo})<br>
                                        Categoría: ${principal.categoria} | Marca: ${principal.marca} | Unidad: ${principal.unidad}
                                    </div>
                                </div>`;
                            } else {
                                relHtml += `<div class="mt-4"><b>Producto principal:</b> <span class='text-gray-400'>${resultado.principal} (No encontrado)</span></div>`;
                            }
                            // Mostrar hermanos (otros subproductos)
                            if (resultado.subproductos.length > 1) {
                                const { data: hermanosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos.filter(c => c !== codigo));
                                relHtml += `<div class="mt-2"><b>Otros subproductos relacionados:</b>
                                <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                                resultado.subproductos.forEach(subCodigo => {
                                    if (subCodigo === codigo) return;
                                    const sub = hermanosInfo ? hermanosInfo.find(p => p.codigo === subCodigo) : null;
                                    if (sub) {
                                        relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                    } else {
                                        relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                    }
                                });
                                relHtml += '</tbody></table></div>';
                            }
                        }
                        if (resultado.tipo === 'ninguno') {
                            relHtml += '<div class="mt-2 text-gray-400">Este producto no tiene relaciones registradas.</div>';
                        }
                        relHtml += '</div>';
                        relacionesDiv.innerHTML = relHtml;
                    } catch (e) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Error al consultar relaciones: ' + (e.message || e) + '</div>';
                    }
                });
            }

            // El manejo del botón de escanear ya lo realiza `main.js` (evitamos listeners duplicados).
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#">
    <title>Editar Producto - Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <script src="../librerías/html5-qrcode.min.js"></script>
    <link rel="stylesheet" href="../librerías/tailwind.min.css" />
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">

    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Editar Producto</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Editar Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Pestañas -->
        <div class="mb-6 mt-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-editar-individual"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button active">
                        Edición Individual
                    </button>
                    <button id="tab-editar-tabla"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Edición por Tabla
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-editar-individual" class="tab-content">
            <form id="formEditarProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoEditar">
                        Código/PLU:
                    </label>
                    <div class="flex">
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="codigoEditar" type="text" required />
                        <button type="button" id="escanearBtnEditar"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                            Escanear Código de Barras
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <button id="buscarEditar"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="button">
                        Buscar
                    </button>
                </div>
                <div id="formularioEdicion" style="display: none">
                    <!-- Campo de código editable -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo">
                            Código
                        </label>
                        <input type="text" id="codigoEditado"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreEditar">
                            Nombre:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="nombreEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaEditar">
                            Categoría:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="categoriaEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="marcaEditar">
                            Marca/Proveedor:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="marcaEditar" type="text" required />
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="unidadEditar">
                            Unidad:
                        </label>
                        <input type="text" id="unidadEditar"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="flex items-center justify-between">
                        <button id="guardarCambios"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Guardar Cambios
                        </button>
                        <button id="eliminarProducto"
                            class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Eliminar Producto
                        </button>
                    </div>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
            <div id="scanner-container-editar" class="mt-4" style="display: none">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>
        </div>

        <!-- Pestaña Edición por Tabla -->
        <div id="content-editar-tabla" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Edición por Tabla</h3>
                <form id="formBuscarTabla" class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoBuscarTabla">
                        Buscar por Código de Producto Primario o Subproducto:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="codigoBuscarTabla" type="text" placeholder="Ej: 1234 o 201670000004" required />
                    <button type="submit"
                        class="mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Buscar</button>
                </form>
                <div id="tabla-edicion-resultados"></div>
                <div id="tabla-edicion-resultados"></div>
                <script type="module">
                    import { db, inicializarDB } from '../js/db-operations.js';
                    import { obtenerRelacionesProductosSupabase, buscarRelacionProducto } from '../js/relaciones-productos.js';
                    // Exponer para main.js si se requiere (opcional)
                    window.obtenerRelacionesProductosSupabase = obtenerRelacionesProductosSupabase;
                    window.buscarRelacionProducto = buscarRelacionProducto;

                    // Lógica de búsqueda y edición en tabla
                    document.getElementById('formBuscarTabla').addEventListener('submit', function (e) {
                        e.preventDefault();
                        const codigo = document.getElementById('codigoBuscarTabla').value.trim();
                        const resultadosDiv = document.getElementById('tabla-edicion-resultados');
                        resultadosDiv.innerHTML = `<div class='text-gray-600'>Sincronizando productos y relaciones...</div>`;

                        (async () => {
                            console.log('[DEBUG] db antes de inicializar:', db);
                            let dbReady = db;
                            if (!dbReady) {
                                resultadosDiv.innerHTML = `<div class='text-gray-600'>Inicializando base de datos local...</div>`;
                                try {
                                    await inicializarDB();
                                } catch (err) {
                                    console.error('[DEBUG] Error al inicializarDB:', err);
                                }
                                dbReady = db;
                                console.log('[DEBUG] db después de inicializar:', dbReady);
                            }
                            if (!dbReady) {
                                console.error('[DEBUG] IndexedDB sigue sin inicializar tras inicializarDB.');
                                resultadosDiv.innerHTML = `<div class='text-red-600'>IndexedDB no inicializado.</div>`;
                                return;
                            }
                            // 1. Sincronizar productos desde Supabase a IndexedDB y obtener relaciones
                            Promise.all([
                                importarProductosSupabaseAIndexedDB(dbReady),
                                obtenerRelacionesProductosSupabase()
                            ]).then(([_, relaciones]) => {
                                // 2. Buscar relación en el Map
                                const relacion = buscarRelacionProducto(codigo, relaciones);
                                // 3. Buscar detalles de productos en IndexedDB
                                buscarProductosRelacionadosConMap(dbReady, codigo, relacion, resultadosDiv);
                            }).catch(err => {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al sincronizar: ${err.message || err}`;
                            });
                        })();

                        // --- Función para importar productos de Supabase a IndexedDB ---
                        async function importarProductosSupabaseAIndexedDB(dbInstance) {
                            if (!window.getSupabase) throw new Error('No se encontró getSupabase.');
                            const supabase = await window.getSupabase();
                            const { data: productos, error } = await supabase.from('productos').select('*');
                            if (error) throw error;
                            if (!dbInstance) throw new Error('IndexedDB no inicializado');
                            return new Promise((resolve, reject) => {
                                const transaction = dbInstance.transaction(['productos'], 'readwrite');
                                const objectStore = transaction.objectStore('productos');
                                const clearReq = objectStore.clear();
                                clearReq.onsuccess = function () {
                                    productos.forEach(prod => {
                                        const p = {
                                            codigo: prod.codigo,
                                            nombre: prod.nombre,
                                            categoria: prod.categoria,
                                            marca: prod.marca,
                                            unidad: prod.unidad
                                        };
                                        objectStore.put(p);
                                    });
                                    transaction.oncomplete = resolve;
                                    transaction.onerror = reject;
                                };
                                clearReq.onerror = reject;
                            });
                        }

                        // --- Función para buscar productos relacionados usando el Map de relaciones ---
                        function buscarProductosRelacionadosConMap(dbInstance, codigo, relacion, resultadosDiv) {
                            const transaction = dbInstance.transaction(['productos'], 'readonly');
                            const objectStore = transaction.objectStore('productos');
                            const getAllReq = objectStore.getAll();
                            getAllReq.onsuccess = function (e) {
                                const productos = e.target.result;
                                // Buscar producto exacto (por código completo o 4 dígitos)
                                let producto = productos.find(p => p.codigo === codigo || p.codigo.endsWith(codigo));
                                if (!producto) {
                                    resultadosDiv.innerHTML = `<div class='text-red-600'>No se encontró el producto <b>${codigo}</b>.</div>`;
                                    return;
                                }
                                // Buscar principal y subproductos según el Map
                                let productoPrincipal = null;
                                let subproductos = [];
                                if (relacion.tipo === 'principal') {
                                    productoPrincipal = producto;
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                } else if (relacion.tipo === 'subproducto') {
                                    productoPrincipal = productos.find(p => p.codigo === relacion.principal);
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                }
                                // Mostrar resultados
                                let html = '';
                                // Producto encontrado (si es principal, mostrar botón editar principal)
                                html += `<div class='mb-4'><b>Producto encontrado:</b><br>${producto.codigo} - ${producto.nombre} (${producto.categoria})<br>Marca: ${producto.marca} | Unidad: ${producto.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${producto.codigo}'>Editar</button></div>`;
                                // Si hay producto principal distinto, mostrarlo con botón editar
                                if (productoPrincipal && productoPrincipal.codigo !== producto.codigo) {
                                    html += `<div class='mb-4'><b>Producto Principal:</b><br>${productoPrincipal.codigo} - ${productoPrincipal.nombre} (${productoPrincipal.categoria})<br>Marca: ${productoPrincipal.marca} | Unidad: ${productoPrincipal.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${productoPrincipal.codigo}'>Editar</button></div>`;
                                }
                                if (subproductos.length > 0) {
                                    html += `<div class='mb-2'><b>Subproductos relacionados:</b> <button id='expand-relacionados' class='ml-2 px-2 py-1 bg-blue-200 rounded'>Ver relacionados</button></div><ul class='mb-4' id='lista-relacionados' style='display:none;'>`;
                                    subproductos.forEach(sp => {
                                        html += `<li class='mb-1'>${sp.codigo} - ${sp.nombre} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${sp.codigo}'>Editar</button></li>`;
                                    });
                                    html += '</ul>';
                                }
                                resultadosDiv.innerHTML = html;
                                // Botón para expandir/collapse relacionados
                                const expandBtn = resultadosDiv.querySelector('#expand-relacionados');
                                const listaRelacionados = resultadosDiv.querySelector('#lista-relacionados');
                                if (expandBtn && listaRelacionados) {
                                    expandBtn.addEventListener('click', () => {
                                        listaRelacionados.style.display = listaRelacionados.style.display === 'none' ? 'block' : 'none';
                                        expandBtn.textContent = listaRelacionados.style.display === 'none' ? 'Ver relacionados' : 'Ocultar relacionados';
                                    });
                                }
                                // Agregar listeners a los botones de edición
                                resultadosDiv.querySelectorAll('.edit-btn').forEach(btn => {
                                    btn.addEventListener('click', function () {
                                        const codigoEditar = btn.dataset.codigo;
                                        // Buscar el producto en la lista de productos
                                        const prod = productos.find(p => p.codigo === codigoEditar);
                                        if (!prod) {
                                            Swal.fire('Error', 'No se encontró el producto en la base local.', 'error');
                                            return;
                                        }
                                        // Rellenar el formulario de edición individual
                                        document.getElementById('codigoEditar').value = prod.codigo;
                                        document.getElementById('codigoEditado').value = prod.codigo;
                                        document.getElementById('nombreEditar').value = prod.nombre;
                                        document.getElementById('categoriaEditar').value = prod.categoria;
                                        document.getElementById('marcaEditar').value = prod.marca;
                                        document.getElementById('unidadEditar').value = prod.unidad;
                                        // Mostrar el formulario de edición si está oculto
                                        document.getElementById('formularioEdicion').style.display = '';
                                        // Cambiar a la pestaña de Edición Individual
                                        const tabButtons = document.querySelectorAll('.tab-button');
                                        const tabContents = document.querySelectorAll('.tab-content');
                                        tabButtons.forEach(btn => {
                                            btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                                            btn.classList.add('border-transparent', 'text-gray-500');
                                        });
                                        tabContents.forEach(content => {
                                            content.style.display = 'none';
                                        });
                                        document.getElementById('tab-editar-individual').classList.add('active', 'border-blue-500', 'text-blue-600');
                                        document.getElementById('tab-editar-individual').classList.remove('border-transparent', 'text-gray-500');
                                        document.getElementById('content-editar-individual').style.display = 'block';
                                        // Scroll al formulario de edición
                                        document.getElementById('formEditarProducto').scrollIntoView({ behavior: 'smooth' });
                                    });
                                });
                            };
                            getAllReq.onerror = function () {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al buscar productos en IndexedDB.</div>`;
                            };
                        }
                    });
                </script>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Pestañas
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            function switchTab(targetTab) {
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });
                const activeButton = document.getElementById(`tab-${targetTab}`);
                activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');
                document.getElementById(`content-${targetTab}`).style.display = 'block';
            }
            document.getElementById('tab-editar-individual').addEventListener('click', () => switchTab('editar-individual'));
            document.getElementById('tab-editar-tabla').addEventListener('click', () => switchTab('editar-tabla'));

            // Aplicar conversión de guión a ceros en campos de código
            const codigoEditar = document.getElementById('codigoEditar');
            const codigoEditado = document.getElementById('codigoEditado');
            const codigoBuscarTabla = document.getElementById('codigoBuscarTabla');
            aplicarConversionCodigo(codigoEditar);
            aplicarConversionCodigo(codigoEditado);
            aplicarConversionCodigo(codigoBuscarTabla);


        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link href="../librerías/tailwind.min.css" rel="stylesheet">
    <script src="../librerías/sweetalert2@11.js"></script>
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Inventario</h1>
        <div class="flex items-center space-x-4">
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="inventario" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6 dark-theme-title">Inventario</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Nuevo div para mostrar la ubicación actual -->
        <div class="mb-4 p-4 bg-white shadow-md rounded">
            <h2 class="text-xl font-bold mb-2">Ubicación Actual: <span id="ubicacionActual"></span></h2>
            <button id="cambiarUbicacion" class="bg-yellow-500 text-white px-4 py-2">Cambiar Ubicación</button>
        </div>

        <!-- Pestañas principales de inventario -->
        <div class="mb-6">
            <div class="flex border-b bg-white shadow-sm rounded-t-lg">
                <button id="tabInventarioManual"
                    class="px-6 py-3 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500 font-semibold">
                    📦 Inventario Manual
                </button>
                <button id="tabLotesAvanzado"
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300 font-semibold">
                    🚀 Inventario por Lotes Avanzado
                </button>
            </div>
        </div>

        <!-- Contenido de Inventario Manual -->
        <div id="contenidoInventarioManual" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <!-- Formulario de búsqueda de inventario -->
            <div class="mb-4">
                <label for="codigo" class="block mb-2">Código/PLU:</label>
                <div class="flex">
                    <input type="text" id="codigo" class="border p-2 w-full">
                    <button id="escanearBtn" class="bg-blue-500 text-white px-4 py-2 ml-2">Escanear Código</button>
                </div>
            </div>

            <div class="mb-4">
                <label for="nombreInventario" class="block mb-2">Nombre:</label>
                <input type="text" id="nombreInventario" class="border p-2 w-full">
            </div>

            <div class="mb-4">
                <label for="marcaInventario" class="block mb-2">Marca:</label>
                <input type="text" id="marcaInventario" class="border p-2 w-full">
            </div>

            <button id="buscarInventario" class="bg-green-500 text-white px-4 py-2 mb-4">Buscar Producto</button>

            <div id="resultadosInventario" class="mt-4" style="display: none;">
                <!-- Los resultados de la búsqueda se mostrarán aquí -->
            </div>

            <div id="datosInventario" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
                <!-- Pestañas para productos tipo Kg -->
                <div id="tabsContainer" class="mb-6" style="display: none;">
                    <div class="flex border-b">
                        <button id="tabInventario"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            Inventario Normal
                        </button>
                        <button id="tabLotes"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            Lotes
                        </button>
                    </div>
                </div>

                <!-- Formulario de inventario normal -->
                <div id="formularioInventarioNormal">
                    <div class="mb-4">
                        <label for="codigoProductoInventario" class="block mb-2">Codigo del Producto:</label>
                        <input type="text" id="codigoProductoInventario" class="border p-2 w-full" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="nombreProductoInventario" class="block mb-2">Nombre del Producto:</label>
                        <input type="text" id="nombreProductoInventario" class="border p-2 w-full" readonly>
                    </div>

                    <div class="mb-4">
                        <label for="unidadProducto" class="block mb-2">Unidad:</label>
                        <input type="text" id="unidadProducto" class="border p-2 w-full" readonly>
                        <!-- Mostrar la unidad como texto -->
                    </div>

                    <div class="mb-4">
                        <label for="cantidad" class="block mb-2">Cantidad:</label>
                        <input type="number" id="cantidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-4">
                        <label for="fechaCaducidad" class="block mb-2">Fecha de Caducidad:</label>
                        <input type="date" id="fechaCaducidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-6">
                        <label for="comentarios" class="block mb-2">Comentarios:</label>
                        <textarea id="comentarios" class="border p-2 w-full"></textarea>
                    </div>

                    <div id="botonguardar" class="flex items-center justify-between">
                        <button id="guardarInventario" class="bg-blue-500 text-white px-4 py-2">Guardar
                            Inventario</button>
                    </div>
                    <div id="botonmodificar" class="flex items-center justify-between" style="display: none;">
                        <button id="modificarInventario" class="bg-blue-500 text-white px-4 py-2">Modificar
                            Inventario</button>
                    </div>
                </div>

                <!-- Formulario de escaneo por lotes para productos Kg -->
                <div id="formularioLotes" style="display: none;">
                    <div class="bg-blue-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-bold mb-3 text-blue-800">Información del Producto</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Código:</label>
                                <span id="codigoProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre:</label>
                                <span id="nombreProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Unidad:</label>
                                <span id="unidadProductoLotes" class="text-sm font-semibold text-green-600">Kg</span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoría:</label>
                                <span id="categoriaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Marca:</label>
                                <span id="marcaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label for="precioKilo" class="block text-sm font-medium text-gray-700 mb-2">Precio por Kilo
                            ($):</label>
                        <input type="number" id="precioKilo" step="0.01" min="0"
                            class="border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Ingrese el precio por kilogramo">
                    </div>

                    <div class="text-center">
                        <button id="iniciarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            📱 Iniciar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>

            <div id="mensaje" class="mt-4"></div>

            <div id="scanner-container-inventario" class="mt-4" style="display: none;">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>

            <button id="generarHojaInventario" class="bg-purple-500 text-white px-4 py-2 mt-4">Generar Hoja de
                Inventario</button>
        </div>

        <!-- Contenido de Inventario por Lotes Avanzado -->
        <div id="contenidoLotesAvanzado" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
            <!-- Panel de alerta y configuración -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-yellow-800">Inventario por Lotes Avanzado</h3>
                        <div class="mt-2 text-sm text-yellow-700">
                            <ul class="list-disc list-inside space-y-1">
                                <li>Solo se pueden contar productos con unidad tipo <strong>Kg</strong></li>
                                <li>El escaneo será automático sin necesidad de búsqueda previa</li>
                                <li>Se extraerán automáticamente PLU, peso y precio desde códigos CODE128</li>
                                <li>Los productos se agruparán por productos primarios y subproductos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel de configuración -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-4 text-gray-800">⚙️ Configuración de Escaneo</h3>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="confirmarProductosSimilares"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                        <label for="confirmarProductosSimilares" class="text-sm font-medium text-gray-700">
                            Mostrar ventana de confirmación para productos similares
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="agruparAutomaticamente"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="agruparAutomaticamente" class="text-sm font-medium text-gray-700">
                            Agrupar automáticamente productos con el mismo PLU
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="sonidoConfirmacion"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="sonidoConfirmacion" class="text-sm font-medium text-gray-700">
                            Reproducir sonido de confirmación al escanear
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="relacionarProductos"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="relacionarProductos" class="text-sm font-medium text-gray-700">
                            Relacionar productos (buscar en productos_subproductos)
                        </label>
                    </div>
                </div>
            </div>

            <!-- Botón para iniciar escaneo -->
            <div class="text-center mb-6">
                <button id="iniciarEscaneoLotesAvanzado"
                    class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform hover:scale-105 transition duration-200">
                    🚀 Iniciar Escaneo por Lotes Avanzado
                </button>
            </div>

            <!-- Área de resultados de productos escaneados -->
            <div id="resultadosLotesAvanzado" class="hidden">
                <h3 class="text-lg font-bold mb-4 text-gray-800">📊 Productos Escaneados</h3>
                <div id="contenedorProductosPrimarios" class="space-y-4">
                    <!-- Las tarjetas de productos primarios se mostrarán aquí -->
                </div>

                <!-- Botón para guardar inventario -->
                <div class="text-center mt-6">
                    <button id="guardarInventarioLotesAvanzado"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled>
                        💾 Guardar Inventario
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes Avanzado -->
        <div id="modalEscaneoLotesAvanzado"
            class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
            <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-5xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-900">🚀 Escaneo por Lotes Avanzado</h3>
                        <button id="cerrarModalLotesAvanzado" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscanerAvanzado"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListadoAvanzado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Productos Escaneados (<span id="contadorProductosAvanzado">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscanerAvanzado" class="mb-4">
                        <div id="scanner-container-lotes-avanzado" class="mb-4">
                            <div id="reader-lotes-avanzado" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="accionEscaneoLotesAvanzado"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-bold"
                                style="user-select:none;">
                                Activar escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListadoAvanzado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Nombre</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio/Kg</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Tipo</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoProductosAvanzado">
                                    <!-- Los productos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total productos: <span id="totalProductosAvanzado" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotalAvanzado" class="font-bold">0.000 Kg</span> |
                            Productos primarios: <span id="totalProductosPrimarios" class="font-bold">0</span>
                        </div>
                        <button id="finalizarEscaneoLotesAvanzado"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes Avanzado
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Edición de Producto de Lote -->
        <div id="modalEdicionProductoLote" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 10000;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-md shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">✏️ Editar Producto Escaneado</h3>
                        <button onclick="cerrarModalEdicionProducto()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Información del producto -->
                    <div class="mb-4 p-3 bg-gray-50 rounded">
                        <p class="text-sm"><strong>Producto:</strong> <span id="editProductoNombre" class="font-medium"></span></p>
                        <p class="text-sm"><strong>Código:</strong> <span id="editProductoCodigo" class="font-mono"></span></p>
                        <p class="text-sm"><strong>PLU:</strong> <span id="editProductoPLU" class="font-mono"></span></p>
                        <input type="hidden" id="editProductoId">
                    </div>

                    <!-- Campos editables -->
                    <div class="space-y-4">
                        <!-- Precio por Kilo -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                💰 Precio por Kilo ($)
                            </label>
                            <input type="number" id="editPrecioKilo" step="0.01" min="0.01"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el precio por kilo era diferente al momento de crear la etiqueta
                            </p>
                        </div>

                        <!-- Peso -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                ⚖️ Peso (Kg)
                            </label>
                            <input type="number" id="editPeso" step="0.001" min="0.001"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.000">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el peso calculado no es correcto (recalcula precio automáticamente)
                            </p>
                        </div>

                        <!-- Precio de Porción (solo lectura, se actualiza automáticamente) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                🏷️ Precio de Porción ($)
                            </label>
                            <input type="number" id="editPrecioPorcion" step="0.01" min="0.01" readonly
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                ℹ️ Se calcula automáticamente: Precio/Kg × Peso
                            </p>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="cerrarModalEdicionProducto()"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button onclick="guardarEdicionProducto()"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            💾 Guardar Cambios
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Información de Producto -->
        <div id="modalInfoProducto" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 9999;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">📋 Información del Producto</h3>
                        <button id="cerrarModalInfoProducto" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Contenido del modal -->
                    <div id="contenidoInfoProducto">
                        <!-- Se llenará dinámicamente -->
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button id="cancelarInfoProducto"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button id="guardarInfoProducto"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            Guardar Info
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes (original) -->
        <div id="modalEscaneoLotes" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
            style="display: none;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">Escaneo por Lotes</h3>
                        <button id="cerrarModalLotes" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscaner"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Códigos Escaneados (<span id="contadorCodigos">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscaner" class="mb-4">
                        <div id="scanner-container-lotes" class="mb-4">
                            <div id="reader-lotes" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="pararEscaneoLotes"
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                                Pausar Escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código Completo</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoCodigosEscaneados">
                                    <!-- Los códigos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total de códigos: <span id="totalCodigos" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotal" class="font-bold">0.00 Kg</span> |
                            Valor total porciones: <span id="precioTotalGeneral" class="font-bold">$0.00</span>
                        </div>
                        <button id="finalizarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- tabla de productos en inventario -->
    <div>
        <button id="sync-inventario-down-btn"
            class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Inventario desde Supabase
        </button>
        <button id="sincronizarManual" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Ahora
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4"> Productos en Inventario </h2>
        <div class="overflow-x-auto">
            <table id="estructura-plantilla" class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">Código</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categoría</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Tipo de Cantidad</th>
                        <th class="py-3 px-6 text-left">Cantidad</th>
                        <th class="py-3 px-6 text-left">Fecha de Caducidad</th>
                        <th class="py-3 px-6 text-left">Comentarios</th>
                        <th class="py-3 px-6 text-left">ubicacion</th>
                    </tr>
                </thead>
                <tbody id="estructuraPlantillaBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/scanner/lotes-avanzado.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;

            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);

                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;

                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversión a los campos de código cuando se cargue la página
        document.addEventListener('DOMContentLoaded', function () {
            const codigo = document.getElementById('codigo');
            const codigoProductoInventario = document.getElementById('codigoProductoInventario');

            aplicarConversionCodigo(codigo);
            // Note: codigoProductoInventario es readonly, pero aplicamos por si acaso
            aplicarConversionCodigo(codigoProductoInventario);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Sistema de Gestión de Productos</h1>
        <div class="flex items-center space-x-4">
            <!-- Indicador de estado del backend -->
            <div id="backendStatus" class="px-3 py-1 rounded-full text-sm font-semibold" 
                 title="Estado de conexión con el backend"
                 style="background-color: #fbbf24; color: #78350f;">
                ⏳ Verificando...
            </div>
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t dark-theme-sidebar-footer">
            <button id="logoutBtn" class="w-full bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded dark-theme-button">
                Cerrar Sesión
            </button>
        </div>
    </div>

    <a href="../index.html" class="text-blue-500 hover:underline mb-4 inline-block dark-theme-link">← Regresar</a>
    <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200 dark-theme-menu-toggle">
        Menú
    </button>

    <main class="container mx-auto mt-8">
        <section id="dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div id="consulta" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Consulta de Producto</h2>
                <p class="mb-4 dark-theme-card-text">Busca productos en la base de datos por diferentes criterios.</p>
                <a id="consultaLink" href="./consulta.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Consulta
                    Producto</a>
            </div>

            <div id="editar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Editar Producto</h2>
                <p class="mb-4 dark-theme-card-text">Edita los atributos de los productos existentes en la base de
                    datos.</p>
                <a id="editarLink" href="./editar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Editar
                    Producto</a>
            </div>

            <div id="inventario" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona el inventario de productos con datos adicionales.</p>
                <a id="inventarioLink" href="./inventario.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Inventario</a>
            </div>

            <div id="reporte" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Reporte para Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Genera reportes detallados del inventario de productos.</p>
                <a id="reporteLink" href="./report.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Reporte
                    para Inventario</a>
            </div>

            <div id="agregar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Agregar Productos</h2>
                <p class="mb-4 dark-theme-card-text">Escanea y agrega nuevos productos a la base de datos.</p>
                <a id="agregarLink" href="./agregar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Agregar
                    Productos</a>
            </div>

            <div id="archivos" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Administración de Archivos</h2>
                <p class="mb-4 dark-theme-card-text">Sube o descarga archivos CSV para la base de datos.</p>
                <a id="archivosLink" href="./archivos.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Archivos</a>
            </div>

            <div id="configuraciones" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Configuraciones</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona las configuraciones del sistema, perfil de usuario y
                    preferencias.</p>
                <a id="configuracionesLink" href="./configuraciones.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Configuraciones</a>
            </div>
        </section>
    </main>

    <footer class="bg-blue-600 text-white p-4 mt-8 dark-theme-footer">
        <p class="text-center dark-theme-footer-text">&copy; 2024 Sistema de Gestión de Productos. Todos los derechos
            reservados.</p>
    </footer>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>    <script type="module">
        import { backendStatusMonitor } from '../js/backend-status.js';
        
        // Monitorear estado del backend
        document.addEventListener('DOMContentLoaded', () => {
            const backendStatusEl = document.getElementById('backendStatus');
            
            // Escuchar cambios de estado del backend
            window.addEventListener('backendStatusChanged', (event) => {
                const { available } = event.detail;
                
                if (available) {
                    backendStatusEl.textContent = '🟢 Backend activo';
                    backendStatusEl.style.backgroundColor = '#dcfce7'; // green-100
                    backendStatusEl.style.color = '#166534'; // green-800
                } else {
                    backendStatusEl.textContent = '🔴 Backend no disponible';
                    backendStatusEl.style.backgroundColor = '#fee2e2'; // red-100
                    backendStatusEl.style.color = '#991b1b'; // red-900
                    
                    // Mostrar alerta una sola vez
                    if (!window.backendDownNotified) {
                        setTimeout(() => {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Backend no disponible',
                                text: 'La aplicación funcionará en modo offline. Los cambios se sincronizarán cuando el servidor esté disponible.',
                                allowOutsideClick: false,
                                didOpen: (modal) => {
                                    // Cerrar automáticamente después de 5 segundos
                                    setTimeout(() => {
                                        Swal.close();
                                    }, 5000);
                                }
                            });
                        }, 500);
                        window.backendDownNotified = true;
                    }
                }
            });
            
            // Iniciar monitoreo (cada 30 segundos)
            backendStatusMonitor.startMonitoring(30);
        });
    </script>
    <script type="module">
        import { cerrarSesion } from '../js/auth/auth.js';
        
        // Manejar botón de logout
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    const { value: rememberUser } = await Swal.fire({
                        title: 'Cerrar Sesión',
                        text: '¿Deseas que se recuerde tu usuario para el próximo login?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Sí, recordar usuario',
                        cancelButtonText: 'No, no recordar',
                        allowOutsideClick: false
                    });
                    
                    // Si cancela, no hace nada
                    if (rememberUser === undefined) return;
                    
                    // Llamar función de logout
                    await cerrarSesion(rememberUser === true);
                });
            }
        });
    </script>    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menuToggle');
            const sideMenu = document.getElementById('sideMenu');
            const closeMenu = document.getElementById('closeMenu');
            const menuRoutes = document.getElementById('menuRoutes');
            const routes = [
                { name: 'Consulta de Producto', path: './consulta.html' },
                { name: 'Editar Producto', path: './editar.html' },
                { name: 'Inventario', path: './inventario.html' },
                { name: 'Registro de Entradas', path: './registro-entradas.html' },
                { name: 'Reporte para Inventario', path: './report.html' },
                { name: 'Agregar Productos', path: './agregar.html' },
                { name: 'Administración de Archivos', path: './archivos.html' },
                { name: 'Configuraciones', path: './configuraciones.html' }
            ];

            // Generar las rutas dinámicamente
            routes.forEach(route => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline dark-theme-nav-link">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            // Mostrar el menú
            menuToggle.addEventListener('click', () => {
                sideMenu.classList.remove('-translate-x-full');
            });

            // Ocultar el menú
            closeMenu.addEventListener('click', () => {
                sideMenu.classList.add('-translate-x-full');
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Entradas</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-green-600 text-white p-4 flex justify-between items-center shadow-lg">
        <div class="flex items-center space-x-3">
            <div class="p-2 bg-green-700 rounded-lg">
                📦
            </div>
            <h1 class="text-3xl font-bold tracking-wide">Registro de Entradas</h1>
        </div>
        <div class="flex items-center space-x-6">
            <div id="conexionStatus" class="text-sm flex items-center space-x-2 bg-green-700 px-3 py-1 rounded-full">
                <span class="status-indicator status-success"></span>
                <span>Conectado</span>
            </div>
            <div id="clockDisplay" class="text-sm font-mono bg-green-700 px-3 py-1 rounded-full"></div>
            <div class="text-sm bg-green-700 px-3 py-1 rounded-full">
                <span id="totalEntradas">0</span> entradas registradas
            </div>
        </div>
    </header>
    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform z-50">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>
    <div class="container mx-auto mt-8 p-4">
        <div class="mb-6 flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center space-x-4">
                <h1 class="text-4xl font-bold text-gray-800 flex items-center">
                    📦 Registro de Entradas
                    <span class="ml-3 text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                        Sistema de Gesti�n
                    </span>
                </h1>
            </div>
            <div class="flex items-center space-x-3">
                <a href="./main.html"
                    class="text-green-600 hover:text-green-800 hover:underline font-medium flex items-center space-x-2 transition-colors">
                    <span>←</span>
                    <span>Regresar al Men� Principal</span>
                </a>
                <button id="menuToggle"
                    class="bg-white text-green-600 px-4 py-2 rounded-lg hover:bg-green-50 border-2 border-green-600 font-semibold transition-all hover:shadow-md">
                    📋 Men� de Navegaci�n
                </button>
            </div>
        </div> <!-- Secci�n de b�squeda de productos -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                🔍 Buscar Producto
                <span id="searchStatus" class="ml-3 text-sm"></span>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="ultimaBusqueda"></span>
                </div>
            </h2>

            <div class="grid md:grid-cols-3 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ Buscar por C�digo:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaCodigo"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese c�digo del producto">
                        <button id="buscarPorCodigo"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnCodigoText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 Buscar por Nombre:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaNombre"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese nombre del producto">
                        <button id="buscarPorNombre"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnNombreText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 Buscar por Marca:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaMarca"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese marca del producto">
                        <button id="buscarPorMarca"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnMarcaText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-center">
                <button id="escanearBtn"
                    class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                    <span>📷</span>
                    <span>Escanear C�digo de Barras</span>
                </button>
            </div>

            <!-- Mensaje de b�squeda reciente -->
            <div id="busquedaReciente" class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 rounded"
                style="display: none;">
                <p class="text-sm text-blue-700">
                    <strong>B�squeda reciente:</strong> <span id="textoUltimaBusqueda"></span>
                </p>
            </div>
        </div> <!-- Formulario de datos del producto y entrada -->
        <div id="productForm"
            class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover"
            style="display: none;">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                📦 Datos del Producto
                <div id="productLoadingIndicator" class="ml-3" style="display: none;">
                    <div
                        class="inline-block w-4 h-4 border-2 border-green-500 border-t-transparent rounded-full animate-spin">
                    </div>
                    <span class="ml-2">Cargando informaci�n...</span>
                </div>
                <div class="ml-auto">
                    <span class="text-sm text-gray-500 bg-green-100 px-3 py-1 rounded-full">
                        Producto encontrado ✅
                    </span>
                </div>
            </h2>

            <div id="productInfo"
                class="grid md:grid-cols-2 gap-6 mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border-2 border-green-200 shadow-inner">
                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="codigoProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">C�digo del Producto:</span>
                        </label>
                        <input type="text" id="codigoProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-mono text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="nombreProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📝 <span class="ml-2">Nombre del Producto:</span>
                        </label>
                        <input type="text" id="nombreProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-semibold text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="marcaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏢 <span class="ml-2">Marca:</span>
                        </label>
                        <input type="text" id="marcaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="categoriaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📂 <span class="ml-2">Categor�a:</span>
                        </label>
                        <input type="text" id="categoriaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="unidadProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📏 <span class="ml-2">Unidad de Medida:</span>
                        </label>
                        <input type="text" id="unidadProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <!-- Informaci�n adicional del stock actual -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="text-sm font-semibold text-blue-700 mb-2">📊 Stock Actual</h4>
                        <div class="text-2xl font-bold text-blue-600" id="stockActual">--</div>
                        <div class="text-xs text-blue-500">unidades disponibles</div>
                    </div>
                </div>
            </div>
            <div class="border-t-2 border-gray-200 pt-8">
                <h3 class="text-lg font-semibold mb-6 text-green-600 flex items-center">
                    📝 Datos de la Entrada
                    <span class="ml-3 text-sm text-gray-500 bg-yellow-100 px-3 py-1 rounded-full">
                        * Campos obligatorios
                    </span>
                    <div class="ml-auto text-sm text-gray-400">
                        <span id="fechaActual"></span>
                    </div>
                </h3>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="transform transition-all hover:scale-105">
                        <label for="cantidadEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📊 <span class="ml-2">Cantidad Recibida *:</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="cantidadEntrada"
                                class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg font-semibold"
                                min="0.01" step="0.01" required placeholder="0.00">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <span id="unidadMedida">unidades</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">Ingrese la cantidad exacta recibida</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="fechaEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📅 <span class="ml-2">Fecha de Entrada *:</span>
                        </label>
                        <input type="date" id="fechaEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg"
                            required>
                        <div class="text-xs text-gray-500 mt-1">Fecha en que se recibi� el producto</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="loteEntrada" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">N�mero de Lote:</span>
                        </label>
                        <input type="text" id="loteEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                            placeholder="Opcional">
                        <div class="text-xs text-gray-500 mt-1">N�mero de lote del proveedor</div>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="comentariosEntrada"
                        class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        💬 <span class="ml-2">Comentarios y Observaciones:</span>
                    </label>
                    <textarea id="comentariosEntrada"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                        rows="4"
                        placeholder="Informaci�n adicional: estado del producto, observaciones del proveedor, condiciones especiales..."></textarea>
                </div>

                <div class="flex justify-between items-center bg-gray-50 p-4 rounded-lg">
                    <button id="limpiarFormulario"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>🗑️</span>
                        <span>Limpiar Formulario</span>
                    </button>
                    <button id="registrarEntrada"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnRegistrarText">✅ Registrar Entrada</span>
                    </button>
                </div>

                <!-- Resumen de la entrada -->
                <div id="resumenEntrada" class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded"
                    style="display: none;">
                    <h4 class="font-semibold text-blue-700 mb-2">📋 Resumen de la Entrada:</h4>
                    <div id="textoResumen" class="text-sm text-blue-600"></div>
                </div>
            </div>
        </div> <!-- Filtros y controles -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-blue-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-blue-600 flex items-center">
                🔧 Filtros y Controles del Sistema
                <div id="syncStatus" class="ml-3 text-sm"></div>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="estadoSistema" class="bg-green-100 text-green-700 px-3 py-1 rounded-full">
                        Sistema Operativo
                    </span>
                </div>
            </h2>

            <div class="grid md:grid-cols-4 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="filtroCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ <span class="ml-2">Filtrar por C�digo:</span>
                    </label>
                    <input type="text" id="filtroCodigo"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="C�digo del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 <span class="ml-2">Filtrar por Nombre:</span>
                    </label>
                    <input type="text" id="filtroNombre"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Nombre del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 <span class="ml-2">Filtrar por Marca:</span>
                    </label>
                    <input type="text" id="filtroMarca"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Marca del producto...">
                </div>

                <div class="flex items-end space-x-2">
                    <button id="filtrarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🔍</span>
                        <span>Filtrar</span>
                    </button>
                    <button id="limpiarFiltros"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🗑️</span>
                        <span>Limpiar</span>
                    </button>
                </div>
            </div>

            <!-- Filtros de fecha -->
            <div class="grid md:grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-lg">
                <div>
                    <label for="fechaDesde" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Desde:</span>
                    </label>
                    <input type="date" id="fechaDesde"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div>
                    <label for="fechaHasta" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Hasta:</span>
                    </label>
                    <input type="date" id="fechaHasta"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div class="flex items-end">
                    <button id="filtrarPorFecha"
                        class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all w-full">
                        📊 Filtrar por Fechas
                    </button>
                </div>
            </div>

            <div class="flex flex-wrap gap-4 justify-between items-center">
                <div class="flex flex-wrap gap-3">
                    <button id="sincronizarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnSincText">🔄 Sincronizar con Servidor</span>
                    </button>
                    <button id="generarReporte"
                        class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-3 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>📊</span>
                        <span>Generar Reporte CSV</span>
                    </button>
                    <button id="autoRefresh"
                        class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white px-6 py-3 rounded-lg hover:from-indigo-600 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>⚡</span>
                        <span>Auto-actualizaci�n: OFF</span>
                    </button>
                </div>

                <div class="flex items-center space-x-3 text-sm text-gray-600">
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">�ltima sincronizaci�n:</span>
                        <span id="ultimaSync">--:--</span>
                    </div>
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">Estado:</span>
                        <span id="estadoConexion" class="text-green-600">Conectado</span>
                    </div>
                </div>
            </div>
        </div> <!-- Tabla de entradas -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-purple-500 card-hover">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-purple-600 flex items-center">
                        📋 Historial de Entradas del Sistema
                        <div id="tableLoadingIndicator" class="ml-3" style="display: none;">
                            <div
                                class="inline-block w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin">
                            </div>
                            <span class="ml-2 text-sm">Actualizando datos...</span>
                        </div>
                    </h2>
                    <div class="flex items-center space-x-4 mt-2">
                        <p id="contadorEntradas" class="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                            Total: 0 entradas registradas
                        </p>
                        <div class="text-sm text-gray-500">
                            <span id="rangoFechas">Mostrando todas las entradas</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="refreshTable"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Actualizar tabla">
                        <span>🔄</span>
                        <span class="hidden md:inline">Actualizar</span>
                    </button>
                    <button id="exportVisible"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Exportar datos visibles">
                        <span>📥</span>
                        <span class="hidden md:inline">Exportar</span>
                    </button>
                    <button id="expandirTabla"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Expandir/Contraer tabla">
                        <span>⛶</span>
                        <span class="hidden md:inline">Expandir</span>
                    </button>
                </div>
            </div>

            <!-- Barra de b�squeda r�pida -->
            <div class="mb-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <input type="text" id="busquedaRapida"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                        placeholder="🔍 B�squeda r�pida en la tabla...">
                    <select id="ordenarPor"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="fecha-desc">M�s reciente primero</option>
                        <option value="fecha-asc">M�s antiguo primero</option>
                        <option value="cantidad-desc">Mayor cantidad primero</option>
                        <option value="cantidad-asc">Menor cantidad primero</option>
                        <option value="nombre-asc">Nombre A-Z</option>
                        <option value="nombre-desc">Nombre Z-A</option>
                    </select>
                </div>
                <div class="text-sm text-gray-500">
                    <span id="resultadosBusqueda"></span>
                </div>
            </div>

            <div class="overflow-x-auto shadow-lg rounded-lg">
                <table class="min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg">
                    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('codigo')">
                                <div class="flex items-center space-x-1">
                                    <span>🏷️ C�digo</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('nombre')">
                                <div class="flex items-center space-x-1">
                                    <span>📝 Nombre</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('marca')">
                                <div class="flex items-center space-x-1">
                                    <span>🏢 Marca</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('categoria')">
                                <div class="flex items-center space-x-1">
                                    <span>📂 Categor�a</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('unidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📏 Unidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('cantidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📊 Cantidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('fecha')">
                                <div class="flex items-center space-x-1">
                                    <span>📅 Fecha</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                                💬 Comentarios
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ⚙️ Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tablaEntradasBody" class="bg-white divide-y divide-gray-200">
                        <!-- Las entradas se cargar�n din�micamente aqu� -->
                        <tr class="text-center text-gray-500 bg-gray-50">
                            <td colspan="9" class="px-6 py-8">
                                <div class="flex flex-col items-center space-y-3">
                                    <div class="text-4xl">📦</div>
                                    <div class="text-lg font-medium">No hay entradas registradas</div>
                                    <div class="text-sm">Las entradas aparecer�n aqu� cuando se registren productos
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginaci�n -->
            <div class="mt-6 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-600">Mostrar:</span>
                    <select id="registrosPorPagina" class="border border-gray-200 rounded p-1 text-sm">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="text-sm text-gray-600">registros por p�gina</span>
                </div>
                <div id="paginacion" class="flex items-center space-x-2">
                    <!-- Los controles de paginaci�n se generar�n din�micamente -->
                </div>
            </div>
        </div> <!-- Scanner container -->
        <div id="scanner-container"
            class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 backdrop-blur-sm"
            style="display: none;">
            <div
                class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl border-4 border-green-500 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        📷 <span class="ml-2">Esc�ner de C�digo de Barras</span>
                    </h3>
                    <button id="cerrarEscaner"
                        class="text-red-500 hover:text-red-700 text-2xl font-bold transition-colors transform hover:scale-110">
                        ✕
                    </button>
                </div>

                <div class="mb-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                    <p class="text-sm text-blue-700">
                        <strong>Instrucciones:</strong> Coloque el c�digo de barras dentro del marco verde.
                        El esc�ner detectar� autom�ticamente el c�digo.
                    </p>
                </div>

                <div id="reader" class="w-full mb-6 rounded-lg overflow-hidden border-4 border-green-200 shadow-lg">
                </div>

                <div class="flex space-x-3">
                    <button id="detenerEscaner"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 w-full transition-all transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2">
                        <span>🛑</span>
                        <span>Detener Esc�ner</span>
                    </button>
                </div>

                <!-- Estado del esc�ner -->
                <div id="estadoEscaner" class="mt-4 text-center text-sm text-gray-600">
                    <div class="flex items-center justify-center space-x-2">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span>Esc�ner activo - Listo para escanear</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../librer�as/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script src="../js/utils/extension-conflict-detector.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script type="module" src="../js/core/registro-entradas-operations.js"></script>
    <script type="module">
        import { inicializarRegistroEntradas } from '../js/registro-entradas-operations.js';
        import { inicializarDB } from '../js/db-operations.js';
        import { toggleEscaner } from '../js/scanner.js';        // Inicializar cuando el DOM est� cargado
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Inicializar base de datos principal
                await inicializarDB();

                // Inicializar p�gina de registro de entradas
                await inicializarRegistroEntradas();

                // Configurar esc�ner
                const escanearBtn = document.getElementById('escanearBtn');
                if (escanearBtn) {
                    escanearBtn.addEventListener('click', () => {
                        toggleEscaner('busquedaCodigo', 'scanner-container');
                    });
                }

                const cerrarEscaner = document.getElementById('cerrarEscaner');
                const detenerEscaner = document.getElementById('detenerEscaner');

                if (cerrarEscaner) {
                    cerrarEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                if (detenerEscaner) {
                    detenerEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                // Inicializar funcionalidades din�micas
                initializeDynamicFeatures();

                console.log('P�gina de registro de entradas inicializada correctamente');

            } catch (error) {
                console.error('Error al inicializar p�gina de registro de entradas:', error);
            }
        });        // Funcionalidades din�micas
        function initializeDynamicFeatures() {
            // Reloj en tiempo real
            updateClock();
            setInterval(updateClock, 1000);

            // Estado de conexi�n
            updateConnectionStatus();
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);

            // Auto-actualizaci�n
            setupAutoRefresh();

            // Efectos de carga
            setupLoadingEffects();

            // Animaciones de entrada
            setupEntranceAnimations();

            // Notificaciones din�micas
            setupDynamicNotifications();

            // Configurar fecha actual
            setupCurrentDate();

            // B�squeda r�pida en tabla
            setupQuickSearch();

            // Autocompletado
            setupAutoComplete();

            // Atajos de teclado
            setupKeyboardShortcuts();

            // Validaciones en tiempo real
            setupRealTimeValidation();
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            const clockDisplay = document.getElementById('clockDisplay');
            if (clockDisplay) {
                clockDisplay.innerHTML = `${timeString}<br><span class="text-xs">${dateString}</span>`;
            }

            // Actualizar fecha actual en el resumen
            const fechaActual = document.getElementById('fechaActual');
            if (fechaActual) {
                fechaActual.textContent = `Hoy: ${dateString}`;
            }
        }

        function updateConnectionStatus() {
            const statusElement = document.getElementById('conexionStatus');
            const estadoConexion = document.getElementById('estadoConexion');

            if (statusElement || estadoConexion) {
                const isOnline = navigator.onLine;
                const status = isOnline
                    ? '<span class="status-indicator status-success"></span>Conectado'
                    : '<span class="status-indicator status-error"></span>Sin conexi�n';

                if (statusElement) statusElement.innerHTML = status;
                if (estadoConexion) {
                    estadoConexion.textContent = isOnline ? 'Conectado' : 'Sin conexi�n';
                    estadoConexion.className = isOnline ? 'text-green-600' : 'text-red-600';
                }

                // Actualizar estado del sistema
                const estadoSistema = document.getElementById('estadoSistema');
                if (estadoSistema) {
                    if (isOnline) {
                        estadoSistema.className = 'bg-green-100 text-green-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Operativo';
                    } else {
                        estadoSistema.className = 'bg-red-100 text-red-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Offline';
                    }
                }
            }
        }

        function setupCurrentDate() {
            const fechaEntrada = document.getElementById('fechaEntrada');
            if (fechaEntrada && !fechaEntrada.value) {
                const today = new Date().toISOString().split('T')[0];
                fechaEntrada.value = today;
            }
        }

        function setupQuickSearch() {
            const busquedaRapida = document.getElementById('busquedaRapida');
            if (busquedaRapida) {
                busquedaRapida.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#tablaEntradasBody tr');
                    let visibleCount = 0;

                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        const isVisible = text.includes(searchTerm);
                        row.style.display = isVisible ? '' : 'none';
                        if (isVisible && !row.classList.contains('text-center')) visibleCount++;
                    });

                    // Actualizar contador de resultados
                    const resultados = document.getElementById('resultadosBusqueda');
                    if (resultados) {
                        resultados.textContent = searchTerm ?
                            `${visibleCount} resultado${visibleCount !== 1 ? 's' : ''} encontrado${visibleCount !== 1 ? 's' : ''}` :
                            '';
                    }
                });
            }
        }

        function setupAutoComplete() {
            // Autocompletado para campos de b�squeda
            const campos = ['busquedaCodigo', 'busquedaNombre', 'busquedaMarca'];
            campos.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.addEventListener('input', debounce((e) => {
                        // Aqu� se implementar�a la l�gica de autocompletado
                        showAutoCompleteHint(campo, e.target.value);
                    }, 300));
                }
            });
        }

        function showAutoCompleteHint(element, value) {
            if (value.length < 2) return;

            // Simular sugerencias (en producci�n vendr�a de la base de datos)
            const hints = ['Producto A', 'Producto B', 'Marca X', 'Marca Y'];
            const matchingHints = hints.filter(hint =>
                hint.toLowerCase().includes(value.toLowerCase())
            );

            // Mostrar hint visual
            if (matchingHints.length > 0) {
                element.title = `Sugerencia: ${matchingHints[0]}`;
                element.style.borderColor = '#10B981';
            } else {
                element.title = '';
                element.style.borderColor = '';
            }
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl + F para buscar
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    const busquedaRapida = document.getElementById('busquedaRapida');
                    if (busquedaRapida) {
                        busquedaRapida.focus();
                        busquedaRapida.select();
                    }
                }

                // Ctrl + S para sincronizar
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    const sincBtn = document.getElementById('sincronizarEntradas');
                    if (sincBtn) sincBtn.click();
                }

                // Ctrl + R para actualizar tabla
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    const refreshBtn = document.getElementById('refreshTable');
                    if (refreshBtn) refreshBtn.click();
                }

                // ESC para cerrar modales
                if (e.key === 'Escape') {
                    const scanner = document.getElementById('scanner-container');
                    if (scanner && scanner.style.display !== 'none') {
                        scanner.style.display = 'none';
                    }
                }
            });
        }

        function setupRealTimeValidation() {
            const cantidadInput = document.getElementById('cantidadEntrada');
            if (cantidadInput) {
                cantidadInput.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    const isValid = value > 0;

                    if (isValid) {
                        e.target.classList.remove('border-red-500');
                        e.target.classList.add('border-green-500');
                        updateEntryPreview();
                    } else {
                        e.target.classList.remove('border-green-500');
                        e.target.classList.add('border-red-500');
                    }
                });
            }

            // Validaci�n de fecha
            const fechaInput = document.getElementById('fechaEntrada');
            if (fechaInput) {
                fechaInput.addEventListener('change', (e) => {
                    const selectedDate = new Date(e.target.value);
                    const today = new Date();
                    const maxDate = new Date();
                    maxDate.setDate(today.getDate() + 30); // M�ximo 30 d�as en el futuro

                    if (selectedDate > maxDate) {
                        e.target.classList.add('border-yellow-500');
                        showToast('⚠️ La fecha seleccionada est� muy lejos en el futuro', 'warning');
                    } else {
                        e.target.classList.remove('border-yellow-500');
                        updateEntryPreview();
                    }
                });
            }
        }

        function updateEntryPreview() {
            const codigo = document.getElementById('codigoProducto')?.value;
            const nombre = document.getElementById('nombreProducto')?.value;
            const cantidad = document.getElementById('cantidadEntrada')?.value;
            const fecha = document.getElementById('fechaEntrada')?.value;
            const unidad = document.getElementById('unidadProducto')?.value;

            if (codigo && nombre && cantidad && fecha) {
                const resumen = document.getElementById('resumenEntrada');
                const textoResumen = document.getElementById('textoResumen');

                if (resumen && textoResumen) {
                    textoResumen.innerHTML = `
                        <strong>${nombre}</strong> (${codigo})<br>
                        Cantidad: <strong>${cantidad} ${unidad || 'unidades'}</strong><br>
                        Fecha: <strong>${new Date(fecha).toLocaleDateString('es-ES')}</strong>
                    `;
                    resumen.style.display = 'block';
                }
            }
        }

        // Funci�n auxiliar para debounce
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Funci�n para mostrar mensajes toast
        function showToast(message, type = 'info') {
            // Implementaci�n simple de toast
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-500' :
                    type === 'warning' ? 'bg-yellow-500' :
                        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                } text-white`;
            toast.textContent = message;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Funci�n para ordenar tabla
        function sortTable(column) {
            console.log(`Ordenando por: ${column}`);
            // Aqu� se implementar�a la l�gica de ordenamiento
        } function setupAutoRefresh() {
            let autoRefreshEnabled = false;
            let autoRefreshInterval;

            const autoRefreshBtn = document.getElementById('autoRefresh');
            if (autoRefreshBtn) {
                autoRefreshBtn.addEventListener('click', () => {
                    autoRefreshEnabled = !autoRefreshEnabled;

                    if (autoRefreshEnabled) {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: ON</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');

                        autoRefreshInterval = setInterval(() => {
                            refreshTableData();
                            updateLastSyncTime();
                        }, 30000); // Cada 30 segundos

                        showToast('✅ Auto-actualizaci�n activada', 'success');
                    } else {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: OFF</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');

                        if (autoRefreshInterval) {
                            clearInterval(autoRefreshInterval);
                        }
                        showToast('⏸️ Auto-actualizaci�n desactivada', 'info');
                    }
                });
            }
        }

        function updateLastSyncTime() {
            const ultimaSync = document.getElementById('ultimaSync');
            if (ultimaSync) {
                const now = new Date();
                ultimaSync.textContent = now.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function setupLoadingEffects() {
            // Interceptar clicks en botones de b�squeda
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        const textId = btnId.replace('buscar', 'btn') + 'Text';
                        showButtonLoading(btn, textId, '🔍 Buscando...');

                        // Simular b�squeda exitosa
                        setTimeout(() => {
                            hideButtonLoading(btn, textId, '🔍 Buscar');
                            updateSearchHistory(btnId);
                        }, 2000);
                    });
                }
            });

            // Interceptar registro de entrada
            const registrarBtn = document.getElementById('registrarEntrada');
            if (registrarBtn) {
                registrarBtn.addEventListener('click', () => {
                    showButtonLoading(registrarBtn, 'btnRegistrarText', '⏳ Registrando entrada...');

                    setTimeout(() => {
                        hideButtonLoading(registrarBtn, 'btnRegistrarText', '✅ Registrar Entrada');
                        showToast('✅ Entrada registrada exitosamente', 'success');
                        updateEntryCounter();
                    }, 3000);
                });
            }

            // Interceptar sincronizaci�n
            const sincBtn = document.getElementById('sincronizarEntradas');
            if (sincBtn) {
                sincBtn.addEventListener('click', () => {
                    showButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizando con servidor...');

                    setTimeout(() => {
                        hideButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizar con Servidor');
                        showToast('✅ Sincronizaci�n completada', 'success');
                        updateLastSyncTime();
                    }, 4000);
                });
            }

            // Interceptar actualizaci�n de tabla
            const refreshBtn = document.getElementById('refreshTable');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    const indicator = document.getElementById('tableLoadingIndicator');
                    if (indicator) {
                        indicator.style.display = 'block';
                        setTimeout(() => {
                            indicator.style.display = 'none';
                            showToast('🔄 Tabla actualizada', 'info');
                        }, 2000);
                    }
                });
            }
        }

        function updateSearchHistory(searchType) {
            const busquedaReciente = document.getElementById('busquedaReciente');
            const textoUltimaBusqueda = document.getElementById('textoUltimaBusqueda');

            if (busquedaReciente && textoUltimaBusqueda) {
                const tipoTexto = {
                    'buscarPorCodigo': 'B�squeda por c�digo',
                    'buscarPorNombre': 'B�squeda por nombre',
                    'buscarPorMarca': 'B�squeda por marca'
                };

                const now = new Date().toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                textoUltimaBusqueda.textContent = `${tipoTexto[searchType]} a las ${now}`;
                busquedaReciente.style.display = 'block';

                // Ocultar despu�s de 10 segundos
                setTimeout(() => {
                    busquedaReciente.style.display = 'none';
                }, 10000);
            }
        }

        function updateEntryCounter() {
            const contador = document.getElementById('contadorEntradas');
            const totalEntradas = document.getElementById('totalEntradas');

            if (contador) {
                const currentCount = parseInt(contador.textContent.match(/\d+/) || [0])[0];
                const newCount = currentCount + 1;
                contador.textContent = `Total: ${newCount} entradas registradas`;

                // Animaci�n del contador
                contador.classList.add('animate-pulse');
                setTimeout(() => {
                    contador.classList.remove('animate-pulse');
                }, 1000);
            }

            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                totalEntradas.textContent = currentCount + 1;
            }
        }

        function showButtonLoading(button, textElementId = null, loadingText = 'Cargando...') {
            button.disabled = true;
            button.classList.add('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
                }
            } else {
                button.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
            }
        }

        function hideButtonLoading(button, textElementId = null, originalText = 'Buscar') {
            button.disabled = false;
            button.classList.remove('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.textContent = originalText;
                }
            } else {
                button.textContent = originalText;
            }
        } function setupEntranceAnimations() {
            // Animar elementos cuando aparecen
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-fade-in-up');

                        // A�adir un peque�o retraso para elementos consecutivos
                        const siblings = Array.from(entry.target.parentElement.children);
                        const index = siblings.indexOf(entry.target);
                        entry.target.style.animationDelay = `${index * 0.1}s`;
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            // Observar todas las tarjetas
            document.querySelectorAll('.card-hover').forEach(card => {
                observer.observe(card);
            });

            // Animaciones para botones al hacer hover
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('mouseenter', () => {
                    if (!button.disabled) {
                        button.style.transform = 'translateY(-2px)';
                        button.style.boxShadow = '0 10px 25px rgba(0,0,0,0.2)';
                    }
                });

                button.addEventListener('mouseleave', () => {
                    button.style.transform = 'translateY(0)';
                    button.style.boxShadow = '';
                });
            });

            // Animaci�n de aparecer para modales
            const scanner = document.getElementById('scanner-container');
            if (scanner) {
                const originalDisplay = scanner.style.display;
                scanner.addEventListener('click', (e) => {
                    if (e.target === scanner) {
                        // Cerrar al hacer click fuera del modal
                        hideModal(scanner);
                    }
                });
            }
        }

        function showModal(modal) {
            modal.style.display = 'flex';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.transition = 'all 0.3s ease';
                modal.style.opacity = '1';
                modal.style.transform = 'scale(1)';
            }, 10);
        }

        function hideModal(modal) {
            modal.style.transition = 'all 0.3s ease';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function setupDynamicNotifications() {
            // Mostrar formulario solo cuando se selecciona un producto
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        setTimeout(() => {
                            const productForm = document.getElementById('productForm');
                            const codigoProducto = document.getElementById('codigoProducto');

                            if (productForm && codigoProducto && codigoProducto.value) {
                                // Mostrar formulario con animaci�n
                                productForm.style.display = 'block';
                                productForm.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });

                                // Animaci�n de aparici�n
                                productForm.style.opacity = '0';
                                productForm.style.transform = 'translateY(30px)';

                                setTimeout(() => {
                                    productForm.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                                    productForm.style.opacity = '1';
                                    productForm.style.transform = 'translateY(0)';

                                    // Destacar el formulario brevemente
                                    productForm.classList.add('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    setTimeout(() => {
                                        productForm.classList.remove('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    }, 2000);
                                }, 100);

                                // Actualizar stock actual (simulado)
                                updateStockDisplay();

                                // Focus en el primer campo editable
                                const cantidadInput = document.getElementById('cantidadEntrada');
                                if (cantidadInput) {
                                    setTimeout(() => cantidadInput.focus(), 800);
                                }
                            }
                        }, 500);
                    });
                }
            });

            // Feedback visual en inputs con animaciones mejoradas
            document.querySelectorAll('input, textarea, select').forEach(input => {
                input.addEventListener('focus', (e) => {
                    e.target.style.transform = 'scale(1.02)';
                    e.target.style.transition = 'transform 0.2s ease';

                    // A�adir indicador de foco
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '#10B981';
                        label.style.transform = 'scale(1.05)';
                        label.style.transition = 'all 0.2s ease';
                    }
                });

                input.addEventListener('blur', (e) => {
                    e.target.style.transform = 'scale(1)';

                    // Restaurar label
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '';
                        label.style.transform = 'scale(1)';
                    }
                });

                // Validaci�n visual en tiempo real
                if (input.type === 'number') {
                    input.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        if (value > 0) {
                            e.target.style.borderColor = '#10B981';
                            e.target.style.backgroundColor = '#F0FDF4';
                        } else if (e.target.value) {
                            e.target.style.borderColor = '#EF4444';
                            e.target.style.backgroundColor = '#FEF2F2';
                        } else {
                            e.target.style.borderColor = '';
                            e.target.style.backgroundColor = '';
                        }
                    });
                }
            });

            // Animaciones para las filas de la tabla
            setupTableRowAnimations();

            // Notificaciones de estado del sistema
            setupSystemStatusNotifications();
        }

        function updateStockDisplay() {
            const stockActual = document.getElementById('stockActual');
            if (stockActual) {
                // Simular datos de stock
                const stock = Math.floor(Math.random() * 500) + 10;
                stockActual.textContent = stock;

                // Animaci�n del contador
                stockActual.style.transform = 'scale(1.2)';
                stockActual.style.transition = 'transform 0.3s ease';

                setTimeout(() => {
                    stockActual.style.transform = 'scale(1)';
                }, 300);

                // Color basado en el stock
                if (stock < 50) {
                    stockActual.className = 'text-2xl font-bold text-red-600';
                    stockActual.parentElement.className = 'bg-red-50 p-4 rounded-lg border border-red-200';
                } else if (stock < 100) {
                    stockActual.className = 'text-2xl font-bold text-yellow-600';
                    stockActual.parentElement.className = 'bg-yellow-50 p-4 rounded-lg border border-yellow-200';
                } else {
                    stockActual.className = 'text-2xl font-bold text-green-600';
                    stockActual.parentElement.className = 'bg-green-50 p-4 rounded-lg border border-green-200';
                }
            }
        }

        function setupTableRowAnimations() {
            // Observador para filas de tabla
            const tableObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeName === 'TR' && !node.classList.contains('text-center')) {
                                // Animar nueva fila
                                node.style.opacity = '0';
                                node.style.transform = 'translateX(-20px)';

                                setTimeout(() => {
                                    node.style.transition = 'all 0.5s ease';
                                    node.style.opacity = '1';
                                    node.style.transform = 'translateX(0)';
                                }, 100);

                                // Efectos hover mejorados
                                node.addEventListener('mouseenter', () => {
                                    node.style.backgroundColor = '#F0FDF4';
                                    node.style.transform = 'scale(1.01)';
                                    node.style.transition = 'all 0.2s ease';
                                    node.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
                                });

                                node.addEventListener('mouseleave', () => {
                                    node.style.backgroundColor = '';
                                    node.style.transform = 'scale(1)';
                                    node.style.boxShadow = '';
                                });
                            }
                        });
                    }
                });
            });

            const tableBody = document.getElementById('tablaEntradasBody');
            if (tableBody) {
                tableObserver.observe(tableBody, { childList: true });
            }
        }

        function setupSystemStatusNotifications() {
            // Notificaciones peri�dicas de estado
            setInterval(() => {
                if (Math.random() < 0.1) { // 10% de probabilidad cada minuto
                    const messages = [
                        '✅ Sistema funcionando correctamente',
                        '📊 Base de datos sincronizada',
                        '🔄 Datos actualizados autom�ticamente',
                        '📈 Rendimiento �ptimo del sistema'
                    ];

                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    showToast(randomMessage, 'success');
                }
            }, 60000); // Cada minuto
        } function refreshTableData() {
            const indicator = document.getElementById('tableLoadingIndicator');
            if (indicator) {
                indicator.style.display = 'block';

                // Simular carga de datos
                setTimeout(() => {
                    indicator.style.display = 'none';
                    updateLastSyncTime();

                    // Actualizar contador si hay datos
                    const tbody = document.getElementById('tablaEntradasBody');
                    if (tbody) {
                        const rows = tbody.querySelectorAll('tr:not(.text-center)');
                        const contador = document.getElementById('contadorEntradas');
                        if (contador) {
                            contador.textContent = `Total: ${rows.length} entradas registradas`;
                        }
                    }
                }, 2000);
            }

            console.log('Actualizando datos de la tabla...');
        }

        // Efectos adicionales para las filas de la tabla
        function addTableRowEffects() {
            document.querySelectorAll('#tablaEntradasBody tr:not(.text-center)').forEach(row => {
                // Eliminar eventos anteriores para evitar duplicados
                row.removeEventListener('mouseenter', handleRowHover);
                row.removeEventListener('mouseleave', handleRowLeave);

                // A�adir nuevos eventos
                row.addEventListener('mouseenter', handleRowHover);
                row.addEventListener('mouseleave', handleRowLeave);
            });
        }

        function handleRowHover(e) {
            e.target.style.backgroundColor = '#F0FDF4';
            e.target.style.transform = 'scale(1.01)';
            e.target.style.transition = 'all 0.2s ease';
            e.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        }

        function handleRowLeave(e) {
            e.target.style.backgroundColor = '';
            e.target.style.transform = 'scale(1)';
            e.target.style.boxShadow = '';
        }

        // Inicializar mejoras adicionales al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                addTableRowEffects();
                initializeAdditionalFeatures();
            }, 1000);
        });

        // Caracter�sticas adicionales
        function initializeAdditionalFeatures() {
            // Configurar filtros de fecha inteligentes
            setupIntelligentDateFilters();

            // Configurar exportaci�n mejorada
            setupEnhancedExport();

            // Configurar modo expandido de tabla
            setupTableExpandMode();

            // Configurar estad�sticas en tiempo real
            setupRealTimeStats();
        }

        function setupIntelligentDateFilters() {
            const filtrarPorFecha = document.getElementById('filtrarPorFecha');
            if (filtrarPorFecha) {
                filtrarPorFecha.addEventListener('click', () => {
                    const fechaDesde = document.getElementById('fechaDesde').value;
                    const fechaHasta = document.getElementById('fechaHasta').value;

                    if (fechaDesde && fechaHasta) {
                        const rangoFechas = document.getElementById('rangoFechas');
                        if (rangoFechas) {
                            const desde = new Date(fechaDesde).toLocaleDateString('es-ES');
                            const hasta = new Date(fechaHasta).toLocaleDateString('es-ES');
                            rangoFechas.textContent = `Mostrando entradas del ${desde} al ${hasta}`;
                        }
                        showToast(`📅 Filtro aplicado: ${fechaDesde} a ${fechaHasta}`, 'info');
                    } else {
                        showToast('⚠️ Seleccione ambas fechas para filtrar', 'warning');
                    }
                });
            }
        }

        function setupEnhancedExport() {
            const exportBtn = document.getElementById('exportVisible');
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    showToast('📥 Preparando exportaci�n...', 'info');

                    setTimeout(() => {
                        showToast('✅ Datos exportados exitosamente', 'success');
                    }, 2000);
                });
            }
        }

        function setupTableExpandMode() {
            const expandBtn = document.getElementById('expandirTabla');
            let isExpanded = false;

            if (expandBtn) {
                expandBtn.addEventListener('click', () => {
                    const tableContainer = expandBtn.closest('.bg-white');

                    if (!isExpanded) {
                        tableContainer.classList.add('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Contraer</span>';
                        isExpanded = true;
                        showToast('⛶ Tabla expandida', 'info');
                    } else {
                        tableContainer.classList.remove('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Expandir</span>';
                        isExpanded = false;
                        showToast('⛶ Tabla contra�da', 'info');
                    }
                });
            }
        }

        function setupRealTimeStats() {
            // Actualizar estad�sticas cada 30 segundos
            setInterval(() => {
                updateSystemStats();
            }, 30000);

            // Actualizaci�n inicial
            updateSystemStats();
        }

        function updateSystemStats() {
            // Simular actualizaci�n de estad�sticas
            const totalEntradas = document.getElementById('totalEntradas');
            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                if (Math.random() < 0.3) { // 30% de probabilidad de incremento
                    totalEntradas.textContent = currentCount + Math.floor(Math.random() * 3) + 1;
                }
            }
        }

        // CSS para animaciones adicionales
        const additionalStyles = `
            <style>
                .animate-fade-in-up {
                    animation: fadeInUp 0.6s ease-out forwards;
                }
                
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(30px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .status-indicator {
                    display: inline-block;
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    margin-right: 6px;
                }
                
                .status-success {
                    background-color: #10B981;
                    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
                }
                
                .status-error {
                    background-color: #EF4444;
                    box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
                }
                
                .card-hover {
                    transition: all 0.3s ease;
                }
                
                .card-hover:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                }
                
                .loading-spinner {
                    border: 2px solid #f3f3f3;
                    border-top: 2px solid #3498db;
                    border-radius: 50%;
                    width: 16px;
                    height: 16px;
                    animation: spin 1s linear infinite;
                }
                
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                
                /* Efectos de hover mejorados */
                button:not(:disabled):hover {
                    transform: translateY(-1px) !important;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                }
                
                input:focus, textarea:focus, select:focus {
                    transform: scale(1.01);
                    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
                }
                
                /* Animaciones para modales */
                .modal-enter {
                    animation: modalEnter 0.3s ease-out forwards;
                }
                
                @keyframes modalEnter {
                    from {
                        opacity: 0;
                        transform: scale(0.9);
                    }
                    to {
                        opacity: 1;
                        transform: scale(1);
                    }
                }
                
                /* Efectos de tabla mejorados */
                table th {
                    position: relative;
                    overflow: hidden;
                }
                
                table th:hover::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    animation: shimmer 1.5s ease-in-out;
                }
                
                @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
            </style>
        `;

        // A�adir estilos al head
        document.head.insertAdjacentHTML('beforeend', additionalStyles);

        // Llamar despu�s de cargar datos en la tabla
        window.addEventListener('load', () => {
            setTimeout(addTableRowEffects, 1000);
        });

        // Funci�n para convertir gui�n a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Funci�n para aplicar la conversi�n a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversi�n a los campos de c�digo cuando se cargue la p�gina
        document.addEventListener('DOMContentLoaded', function() {
            const busquedaCodigo = document.getElementById('busquedaCodigo');
            const codigoProducto = document.getElementById('codigoProducto');
            const filtroCodigo = document.getElementById('filtroCodigo');
            
            aplicarConversionCodigo(busquedaCodigo);
            aplicarConversionCodigo(codigoProducto);
            aplicarConversionCodigo(filtroCodigo);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Nuevo Producto - Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Agregar Nuevo Producto</h1>

    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Agregar Nuevo Producto</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Pestañas -->
        <div class="mb-6 mt-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-individual"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button active">
                        Producto Individual
                    </button>
                    <button id="tab-tabla"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Agregado por Tabla
                    </button>
                    <button id="tab-csv"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Carga por CSV
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenido de Pestañas -->

        <!-- Pestaña Individual (formulario original) -->
        <div id="content-individual" class="tab-content">
            <form id="formAgregarProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo">
                        Código/PLU:
                    </label>
                    <div class="flex">
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            placeholder="Codigo" id="codigoAgregar" type="text" required>
                        <button type="button" id="escanearBtnAgregar"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                            Escanear Código
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nombre">
                        Nombre:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="nombre" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="categoria">
                        Categoría:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="categoria" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="marca">
                        Marca/Proveedor:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="marca" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="marca">
                        Unidad:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="unidad" type="text" required>
                </div>

                <!-- Campo para producto primario (aparece solo cuando unidad es Kg) -->
                <div id="producto-primario-container" class="mb-4" style="display: none;">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-3">
                        <div class="flex items-center mb-2">
                            <svg class="w-5 h-5 text-yellow-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                    clip-rule="evenodd"></path>
                            </svg>
                            <span class="text-yellow-800 font-medium text-sm">Nota importante:</span>
                        </div>
                        <p class="text-yellow-700 text-sm">
                            Si el producto es un subproducto y cuenta con un producto primario,
                            ingresa el código del producto primario en el campo de abajo.
                        </p>
                    </div>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="producto-primario">
                        Código del Producto Primario (opcional):
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="producto-primario" type="text" placeholder="Codigo del Producto Primario">
                </div>
                <div class="flex items-center justify-between">
                    <button
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="submit">
                        Agregar Producto
                    </button>
                </div>
            </form>
        </div>

        <!-- Pestaña Tabla (nueva funcionalidad) -->
        <div id="content-tabla" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <!-- Sección Producto Primario -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">Producto Primario</h3>

                    <!-- Campo código producto primario -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo-primario">
                            Código de Producto Primario:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            placeholder="Ingrese código del producto primario" id="codigo-primario" type="text"
                            required>
                    </div>

                    <!-- Información del producto primario -->
                    <div id="info-producto-primario" class="grid grid-cols-1 md:grid-cols-2 gap-4"
                        style="display: none;">
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Nombre:</label>
                            <input id="primario-nombre"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Categoría:</label>
                            <input id="primario-categoria"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Marca/Proveedor:</label>
                            <input id="primario-marca"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Unidad:</label>
                            <input id="primario-unidad"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                    </div>
                </div>

                <!-- Sección Subproductos -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">Subproductos</h3>
                        <button id="agregar-fila-btn"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                            style="display: none;">
                            + Agregar Nueva Fila
                        </button>
                    </div>

                    <div id="subproductos-container" class="space-y-4">
                        <!-- Las filas de subproductos se generarán dinámicamente -->
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="flex justify-between items-center pt-6 border-t">
                    <button id="limpiar-tabla-btn"
                        class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                        Limpiar Todo
                    </button>
                    <button id="guardar-tabla-btn"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
                        style="display: none;">
                        Guardar Tabla de Productos
                    </button>
                </div>
            </div>
        </div>


        <!-- Pestaña CSV -->
        <div id="content-csv" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Carga Masiva por CSV</h3>
                <form id="csv-upload-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">Selecciona archivo
                            CSV:</label>
                        <input type="file" id="csvFile" accept=".csv"
                            class="block w-full text-sm text-gray-700 border border-gray-300 rounded py-2 px-3"
                            required />
                    </div>
                    <button type="submit"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Cargar y
                        Previsualizar</button>
                </form>
                <div id="csv-preview" class="mt-6" style="display:none;">
                    <h4 class="text-lg font-semibold mb-2">Vista previa de datos</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200" id="csv-table"></table>
                    </div>
                    <button id="csv-upload-confirm"
                        class="mt-4 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Subir al
                        sistema</button>
                </div>
                <div id="csv-error" class="mt-4 text-red-600 font-semibold"></div>
            </div>
        </div>

        <div id="mensaje" class="mt-4"></div>

        <div id="scanner-container-agregar" class="mt-4" style="display: none;">
            <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
            <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script type="module" src="../js/ui/tabla-productos.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            // Reemplazar cada guión (-) con 6 ceros (000000)
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;

            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);

                // Solo actualizar si hay diferencia (para evitar bucles infinitos)
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;

                    // Ajustar posición del cursor
                    // Si se agregaron caracteres, mover el cursor proporcionalmente
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            // También aplicar en blur para asegurar conversión final
            input.addEventListener('blur', function (e) {
                const valorConvertido = convertirGuionACeros(e.target.value);
                e.target.value = valorConvertido;
            });
        }

        // Hacer la función disponible globalmente para tabla-productos.js
        window.aplicarConversionCodigoAInput = aplicarConversionCodigo;

        // Script para pestañas
        document.addEventListener('DOMContentLoaded', function () {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            function switchTab(targetTab) {
                // Remover clase activa de todos los botones
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });

                // Ocultar todo el contenido
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });

                // Activar pestaña seleccionada
                const activeButton = document.getElementById(`tab-${targetTab}`);
                activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');

                // Mostrar contenido correspondiente
                document.getElementById(`content-${targetTab}`).style.display = 'block';
            }

            // Event listeners para los botones de pestañas
            document.getElementById('tab-individual').addEventListener('click', () => switchTab('individual'));
            document.getElementById('tab-tabla').addEventListener('click', () => switchTab('tabla'));
            document.getElementById('tab-csv').addEventListener('click', () => switchTab('csv'));
            // CSV: Lógica de carga y validación
            const csvForm = document.getElementById('csv-upload-form');
            const csvFileInput = document.getElementById('csvFile');
            const csvPreview = document.getElementById('csv-preview');
            const csvTable = document.getElementById('csv-table');
            const csvError = document.getElementById('csv-error');
            const csvUploadConfirm = document.getElementById('csv-upload-confirm');
            let csvData = [];

            function parseCSV(text) {
                const lines = text.trim().split(/\r?\n/);
                const headers = lines[0].split(',').map(h => h.trim());
                const rows = lines.slice(1).map(line => {
                    // Soporta campos con comas entre comillas
                    const regex = /(?:"([^"]*)")|([^,]+)/g;
                    let match, arr = [];
                    let i = 0;
                    while ((match = regex.exec(line)) !== null) {
                        arr.push(match[1] !== undefined ? match[1] : match[2]);
                        i++;
                    }
                    // Si no hay comillas, fallback split normal
                    if (arr.length === 0) arr = line.split(',');
                    return arr.map(x => x ? x.trim() : '');
                });
                return { headers, rows };
            }

            function validateHeaders(headers) {
                const required = ['Codigo', 'Nombre', 'Categoria', 'Marca', 'Unidad'];
                return required.every(h => headers.includes(h));
            }

            csvForm.addEventListener('submit', function (e) {
                e.preventDefault();
                csvError.textContent = '';
                csvPreview.style.display = 'none';
                csvTable.innerHTML = '';
                csvData = [];
                const file = csvFileInput.files[0];
                if (!file) {
                    csvError.textContent = 'Selecciona un archivo CSV.';
                    return;
                }
                const reader = new FileReader();
                reader.onload = function (evt) {
                    const text = evt.target.result;
                    const { headers, rows } = parseCSV(text);
                    if (!validateHeaders(headers)) {
                        csvError.textContent = 'El archivo debe contener los campos: Codigo, Nombre, Categoria, Marca y Unidad.';
                        return;
                    }
                    // Mostrar tabla
                    let html = '<thead><tr>' + headers.map(h => `<th class="px-2 py-1 border">${h}</th>`).join('') + '</tr></thead><tbody>';
                    rows.forEach(row => {
                        html += '<tr>' + row.map(cell => `<td class="px-2 py-1 border">${cell}</td>`).join('') + '</tr>';
                    });
                    html += '</tbody>';
                    csvTable.innerHTML = html;
                    csvPreview.style.display = 'block';
                    csvData = rows.map(row => {
                        let obj = {};
                        headers.forEach((h, i) => obj[h] = row[i]);
                        return obj;
                    });
                };
                reader.readAsText(file);
            });

            csvUploadConfirm.addEventListener('click', function () {
                if (!csvData.length) {
                    csvError.textContent = 'No hay datos para subir.';
                    return;
                }
                // Lógica real para subir a Supabase, omitiendo los que ya existen y agregando usuario_id
                (async () => {
                    try {
                        if (!window.getSupabase) throw new Error('No se encontró getSupabase.');
                        const supabase = await window.getSupabase();
                        // Obtener usuario_id y categoria_id de localStorage
                        const userId = localStorage.getItem('usuario_id');
                        const categoriaId = localStorage.getItem('categoria_id');
                        if (!userId) throw new Error('No se pudo obtener el usuario autenticado.');
                        if (!categoriaId) throw new Error('No se pudo obtener la categoría del usuario.');
                        // 1. Obtener todos los códigos existentes en Supabase
                        const { data: existentes, error: errorExist } = await supabase.from('productos').select('codigo');
                        if (errorExist) throw errorExist;
                        const codigosExistentes = new Set((existentes || []).map(p => p.codigo));
                        // 2. Filtrar productos nuevos
                        const nuevos = csvData.filter(prod => !codigosExistentes.has(prod.Codigo));
                        let omitidos = csvData.length - nuevos.length;
                        // 3. Insertar los nuevos
                        let insertados = 0;
                        if (nuevos.length > 0) {
                            // Mapear campos a los nombres de la tabla e incluir usuario_id y categoria_id
                            const productosInsertar = nuevos.map(prod => ({
                                codigo: prod.Codigo,
                                nombre: prod.Nombre,
                                categoria: prod.Categoria,
                                marca: prod.Marca,
                                unidad: prod.Unidad,
                                usuario_id: userId,
                                categoria_id: categoriaId
                            }));
                            const { error: errorInsert } = await supabase.from('productos').insert(productosInsertar);
                            if (errorInsert) throw errorInsert;
                            insertados = productosInsertar.length;
                        }
                        Swal.fire({
                            icon: 'success',
                            title: 'Carga completada',
                            html: `<b>${insertados}</b> productos agregados.<br><b>${omitidos}</b> productos ya existían y fueron omitidos.`
                        });
                        csvPreview.style.display = 'none';
                        csvTable.innerHTML = '';
                        csvData = [];
                    } catch (err) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error al subir productos',
                            text: err.message || err
                        });
                    }
                })();
            });

            // Aplicar conversión de guión a ceros en campos de código
            // Pestaña Individual
            const codigoIndividual = document.getElementById('codigoAgregar');
            const productoPrimarioIndividual = document.getElementById('producto-primario');

            aplicarConversionCodigo(codigoIndividual);
            aplicarConversionCodigo(productoPrimarioIndividual);

            // Pestaña Tabla
            const codigoPrimarioTabla = document.getElementById('codigo-primario');
            aplicarConversionCodigo(codigoPrimarioTabla);

            // Para los subproductos en la tabla (se aplicará dinámicamente cuando se creen)

            // Inicializar funcionalidad de tabla directamente aquí como backup
            setTimeout(() => {
                try {
                    const limpiarBtn = document.getElementById('limpiar-tabla-btn');
                    if (limpiarBtn) {
                        limpiarBtn.addEventListener('click', function () {
                            console.log('Click en limpiar tabla');
                            if (confirm('¿Está seguro de que desea limpiar todos los datos?')) {
                                document.getElementById('codigo-primario').value = '';
                                document.getElementById('info-producto-primario').style.display = 'none';
                                document.getElementById('subproductos-container').innerHTML = '';
                                document.getElementById('agregar-fila-btn').style.display = 'none';
                                document.getElementById('guardar-tabla-btn').style.display = 'none';
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error en backup de inicialización:', error);
                }
            }, 1000);

            // Script original para mostrar/ocultar el campo de producto primario
            const unidadInput = document.getElementById('unidad');
            const productoPrimarioContainer = document.getElementById('producto-primario-container');
            const form = document.getElementById('formAgregarProducto');

            function toggleProductoPrimario() {
                if (unidadInput && productoPrimarioContainer) {
                    const unidad = unidadInput.value.toLowerCase().trim();
                    if (unidad === 'kg') {
                        productoPrimarioContainer.style.display = 'block';
                    } else {
                        productoPrimarioContainer.style.display = 'none';
                        // Limpiar el campo si se oculta
                        const productoPrimarioInput = document.getElementById('producto-primario');
                        if (productoPrimarioInput) {
                            productoPrimarioInput.value = '';
                        }
                    }
                }
            }

            // Agregar event listener al campo unidad
            if (unidadInput) {
                unidadInput.addEventListener('input', toggleProductoPrimario);
                unidadInput.addEventListener('change', toggleProductoPrimario);
            }

            // Ocultar el campo cuando se resetee el formulario
            if (form) {
                form.addEventListener('reset', function () {
                    setTimeout(() => {
                        if (productoPrimarioContainer) {
                            productoPrimarioContainer.style.display = 'none';
                        }
                    }, 10); // Pequeño delay para asegurar que el reset se complete
                });
            }
        });
    </script>
    <style>
        .tab-button.active {
            border-color: #3b82f6;
            color: #2563eb;
        }

        .subproducto-row {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            background-color: #f9fafb;
        }

        .campo-readonly {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }

        .producto-existente {
            background-color: #dcfce7;
            border-color: #16a34a;
        }

        .producto-nuevo {
            background-color: #fef3c7;
            border-color: #d97706;
        }
    </style>
</body>

</html>
<!DOCTYPE html>    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesti�n de Archivos - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css" />
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css" />
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Gesti�n de Archivos</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">
                Cerrar
            </button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <div id="archivos" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Gesti�n de Archivos</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Men�
        </button>

        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">
                    Cargar Archivo CSV:
                </label>
                <input type="file" id="csvFile" accept=".csv"
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />
                <div class="mb-4">
                    <button id="descargarCSV"
                        class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                        Exportar Datos a CSV
                    </button>
                </div>
                <div class="mb-4">
                    <button id="resetearBaseDatos"
                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                        Resetear Base de Datos
                    </button>
                </div>
            </div>
        </div>

        <button class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded" id="sync-down-btn">
            Sincronizar en Bajada
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4">Base de Datos Actual</h2>
        <div class="overflow-x-auto">
            <table class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">C�digo</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categor�a</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Unidad</th>
                    </tr>
                </thead>
                <tbody id="databaseBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const menuToggle = document.getElementById("menuToggle");
            const sideMenu = document.getElementById("sideMenu");
            const closeMenu = document.getElementById("closeMenu");
            const menuRoutes = document.getElementById("menuRoutes");

            const routes = [
                { name: "Consulta de Producto", path: "./consulta.html" },
                { name: "Editar Producto", path: "./editar.html" },
                { name: "Inventario", path: "./inventario.html" },
                { name: "Reporte para Inventario", path: "./report.html" },
                { name: "Agregar Productos", path: "./agregar.html" }
            ];

            routes.forEach((route) => {
                const li = document.createElement("li");
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            menuToggle.addEventListener("click", () => {
                sideMenu.classList.remove("-translate-x-full");
            });

            closeMenu.addEventListener("click", () => {
                sideMenu.classList.add("-translate-x-full");
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraciones - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    <script src="../js/utils/theme-debug.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Configuraciones del Sistema</h1>
        <div class="flex items-center space-x-4">
            <span id="userInfo" class="text-sm font-medium"></span>
        </div>
    </header>

    <div class="container mx-auto mt-8 p-4">
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar al Dashboard</a>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Configuraciones de Usuario -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    Configuraciones de Usuario
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cambiar Contrase�a</label>
                        <button id="changePasswordBtn"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Cambiar Contrase�a
                        </button>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Informaci�n del Perfil</label>
                        <div id="profileInfo" class="bg-gray-50 p-4 rounded border">
                            <!-- Se llenar� din�micamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraciones del Sistema -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Configuraciones del Sistema
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tema de la Aplicaci�n</label>
                        <select id="themeSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="light">Claro</option>
                            <option value="dark">Oscuro</option>
                            <option value="auto">Autom�tico</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Idioma</label>
                        <select id="languageSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="es">Espa�ol</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Google Services -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                        </path>
                    </svg>
                    Credenciales de Google
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Drive API Key</label>
                        <div class="relative">
                            <input type="password" id="googleDriveApiKey"
                                class="w-full border border-gray-300 rounded px-3 py-2 pr-12"
                                placeholder="Ingresa tu API Key de Google Drive">
                            <button type="button" id="toggleDriveKey"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Necesaria para acceder a Google Drive desde la aplicaci�n
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Sheets API Key</label>
                        <div class="relative">
                            <input type="password" id="googleSheetsApiKey"
                                class="w-full border border-gray-300 rounded px-3 py-2 pr-12"
                                placeholder="Ingresa tu API Key de Google Sheets">
                            <button type="button" id="toggleSheetsKey"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Necesaria para integraci�n con Google Sheets</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ID de Google Sheets</label>
                        <input type="text" id="googleSheetsId" class="w-full border border-gray-300 rounded px-3 py-2"
                            placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                        <p class="text-xs text-gray-500 mt-1">ID de la hoja de c�lculo de Google donde se sincronizar�n
                            los datos</p>
                    </div>

                    <div class="flex space-x-2">
                        <button id="testGoogleConnection"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Probar Conexi�n
                        </button>
                        <button id="saveGoogleCredentials"
                            class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                            Guardar Credenciales
                        </button>
                        <button id="clearGoogleCredentials"
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                            Limpiar
                        </button>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mt-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">
                                    <strong>Informaci�n:</strong> Para obtener las API Keys, visita la
                                    <a href="https://console.developers.google.com/" target="_blank"
                                        class="underline hover:text-blue-800">
                                        Google Cloud Console
                                    </a> y habilita las APIs de Google Drive y Google Sheets.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Sincronizaci�n -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                        </path>
                    </svg>
                    Sincronizaci�n
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sincronizaci�n Autom�tica</label>
                        <div class="flex items-center">
                            <input type="checkbox" id="autoSyncEnabled" class="mr-2">
                            <span>Habilitar sincronizaci�n autom�tica</span>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Intervalo de Sincronizaci�n
                            (minutos)</label>
                        <input type="number" id="syncInterval" class="border border-gray-300 rounded px-3 py-2 w-full"
                            min="1" max="60" value="5">
                    </div>

                    <div class="flex space-x-2">
                        <button id="manualSyncBtn"
                            class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                            Sincronizar Ahora
                        </button>
                        <button id="resetSyncBtn"
                            class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">
                            Resetear Configuraci�n
                        </button>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Notificaciones -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-5 5v-5zM7 7h10v10H7V7z"></path>
                    </svg>
                    Notificaciones
                </h2>

                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="browserNotifications" class="mr-2">
                        <span>Notificaciones del navegador</span>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="soundNotifications" class="mr-2">
                        <span>Notificaciones sonoras</span>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="lowStockAlerts" class="mr-2">
                        <span>Alertas de stock bajo</span>
                    </div>
                </div>
            </div>

            <!-- Informaci�n del Sistema -->
            <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Informaci�n del Sistema
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">Versi�n de la Aplicaci�n</h3>
                        <p id="appVersion" class="text-lg">1.0.0</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">Estado de Conexi�n</h3>
                        <p id="connectionStatus" class="text-lg">Conectado</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">�ltima Sincronizaci�n</h3>
                        <p id="lastSync" class="text-lg">--</p>
                    </div>
                </div>

                <div class="mt-4 flex space-x-2">
                    <button id="exportConfigBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Exportar Configuraci�n
                    </button>
                    <button id="importConfigBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Importar Configuraci�n
                    </button>
                    <input type="file" id="importConfigFile" accept=".json" class="hidden">
                </div>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/configuraciones.js"></script>
</body>

</html>
<<<<<<< HEAD=======<!DOCTYPE html>
    <html lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Confirmaci�n de Correo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
        <link href="../librer�as/tailwind.min.css" rel="stylesheet">
        <link href="../css/styles.css" rel="stylesheet">
        <script src="../js/utils/theme-manager.js"></script>
        <script src="../js/ui/theme-toggle.js"></script>
    </head>

    <body class="bg-gray-100 flex items-center justify-center h-screen">
        <div class="container mx-auto p-6 max-w-md bg-white shadow-md rounded-lg text-center">
            <h1 id="statusTitle" class="text-2xl font-bold mb-4 text-blue-600">Verificando tu correo...</h1>
            <p id="statusMessage" class="text-gray-700 mb-6">Por favor, espera un momento mientras procesamos tu
                confirmaci�n.</p>
            <p id="detailsMessage" class="text-gray-600 mb-4"></p>
            <a href="../index.html"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-2 inline-block">
                Ir al Inicio de Sesi�n
            </a>
        </div>
        <script src="../js/ui/mobile-optimizer.js"></script>
        <script type="module">
            import { supabase } from '../js/auth/auth.js';

            const statusTitleEl = document.getElementById('statusTitle');
            const statusMessageEl = document.getElementById('statusMessage');
            const detailsMessageEl = document.getElementById('detailsMessage');

            // Supabase maneja la confirmaci�n del token en el backend antes de redirigir aqu�.
            // Esta p�gina muestra el resultado basado en los par�metros de la URL o el estado de la sesi�n.

            const urlParams = new URLSearchParams(window.location.search);
            const errorDescription = urlParams.get('error_description');
            // const errorCode = urlParams.get('error'); // Podr�as usarlo para errores m�s espec�ficos

            if (errorDescription) {
                statusTitleEl.textContent = 'Error en la Confirmaci�n';
                statusTitleEl.classList.remove('text-blue-600', 'text-green-600');
                statusTitleEl.classList.add('text-red-600');
                statusMessageEl.textContent = 'No pudimos confirmar tu direcci�n de correo electr�nico.';
                detailsMessageEl.textContent = `Detalles: ${decodeURIComponent(errorDescription)}`;
                detailsMessageEl.classList.add('text-red-500');
            } else {
                // Si no hay error en la URL, la confirmaci�n fue procesada por Supabase.
                // Esto puede significar que el correo se confirm� ahora o ya estaba confirmado.
                statusTitleEl.textContent = '¡Correo Verificado!';
                statusTitleEl.classList.remove('text-blue-600', 'text-red-600');
                statusTitleEl.classList.add('text-green-600');
                statusMessageEl.textContent = 'Tu direcci�n de correo electr�nico ha sido verificada exitosamente.';
                detailsMessageEl.textContent = 'Ya puedes cerrar esta ventana e iniciar sesi�n.';

                // onAuthStateChange puede dar feedback adicional si la confirmaci�n tambi�n inicia sesi�n.
                supabase.auth.onAuthStateChange((event, session) => {
                    if (event === 'SIGNED_IN' && session) {
                        detailsMessageEl.textContent = 'Has iniciado sesi�n autom�ticamente. ¡Bienvenido!';
                    } else if (event === 'USER_UPDATED' && session?.user?.email_confirmed_at) {
                        // El correo est� confirmado, el mensaje por defecto ya es apropiado.
                        // Puedes a�adir algo m�s si es necesario.
                    }
                });
            }
        </script>
    </body>

    </html>
    >>>>>>> 1e3239b (feat: A�adir enlace para recuperaci�n de contrase�a en la p�gina de inicio de sesi�n y mejorar
    mensajes de confirmaci�n de correo)
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Producto - Sistema de Gestión de Productos</title>
    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <!-- Cambiamos Quagga por Html5QrCode -->
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../librerías/sweetalert2@11.js"></script>
    <!-- Añadir JsBarcode para códigos de barra -->
    <script src="../librerías/JsBarcode.all.min.js"></script>
    <!-- Añadir jsPDF para generación de PDFs -->
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Consulta de Producto</h1>

    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="consulta" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Consulta de Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">Menú</button>

        <!-- Sistema de pestañas -->
        <div class="mb-4 mt-4">
            <nav class="flex border-b">
                <button id="tab-busqueda" class="tab-button border-b-2 border-blue-500 text-blue-600 px-4 py-2 font-semibold">Búsqueda</button>
                <button id="tab-relaciones" class="tab-button border-b-2 border-transparent text-gray-500 px-4 py-2 font-semibold">Relaciones</button>
            </nav>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-busqueda" class="tab-content">
            <form id="formConsultaProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoConsulta">Código/PLU:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoConsulta" type="text">
                        <button type="button" id="escanearBtnConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear Código de Barras</button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreConsulta">Nombre:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="nombreConsulta" type="text">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaConsulta">Categoría:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="categoriaConsulta" type="text">
                </div>
                <div class="flex items-center justify-between">
                    <button id="buscarConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">Buscar Producto</button>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
        </div>
        <div id="content-relaciones" class="tab-content" style="display:none;">
            <form id="formRelaciones" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoRelacion">Código del producto:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoRelacion" type="text" placeholder="Escanea o ingresa el código o últimos 4 dígitos">
                        <button type="button" id="escanearBtnRelacion" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear</button>
                        <button type="button" id="buscarRelacion" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Buscar Relación</button>
                    </div>
                </div>
            </form>
            <div id="relaciones" class="mt-4"></div>
        </div>

        <!-- Modificamos el contenedor del escáner -->
        <!-- En plantillas/consulta.html -->
        <div id="scanner-container-consulta" class="mt-4" style="display: none;">
            <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
            <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
        </div>

        <!-- Div to hold the barcode -->
        <div id="barcodeContainer" class="mt-4"></div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Búsqueda relacional de productos con pestañas
        document.addEventListener('DOMContentLoaded', function() {
            const codigoConsulta = document.getElementById('codigoConsulta');
            aplicarConversionCodigo(codigoConsulta);
            // Para la pestaña de relaciones
            const codigoRelacion = document.getElementById('codigoRelacion');
            if (codigoRelacion) aplicarConversionCodigo(codigoRelacion);

            // Tabs
            const tabBusqueda = document.getElementById('tab-busqueda');
            const tabRelaciones = document.getElementById('tab-relaciones');
            const contentBusqueda = document.getElementById('content-busqueda');
            const contentRelaciones = document.getElementById('content-relaciones');
            const relacionesDiv = document.getElementById('relaciones');
            let ultimoProducto = null;

            function switchTab(tab) {
                if (tab === 'busqueda') {
                    tabBusqueda.classList.add('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.remove('border-transparent', 'text-gray-500');
                    tabRelaciones.classList.remove('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'block';
                    contentRelaciones.style.display = 'none';
                } else {
                    if (tabRelaciones.disabled) return; // No cambiar si está deshabilitada
                    tabRelaciones.classList.add('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.remove('border-transparent', 'text-gray-500');
                    tabBusqueda.classList.remove('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'none';
                    contentRelaciones.style.display = 'block';
                }
            }
            tabBusqueda.addEventListener('click', () => switchTab('busqueda'));
            tabRelaciones.addEventListener('click', () => switchTab('relaciones'));
            switchTab('busqueda');

            const buscarBtn = document.getElementById('buscarConsulta');
            const resultadosDiv = document.getElementById('resultados');

            buscarBtn.addEventListener('click', async function() {
                resultadosDiv.innerHTML = '';
                ultimoProducto = null;
                const codigoInput = document.getElementById('codigoConsulta').value.trim();
                const nombre = document.getElementById('nombreConsulta').value.trim();
                const categoria = document.getElementById('categoriaConsulta').value.trim();

                // Buscar primero en IndexedDB para obtener el código completo
                function buscarEnIndexedDB(codigo, nombre, categoria) {
                    return new Promise((resolve, reject) => {
                        if (!window.indexedDB) {
                            resolve(null);
                            return;
                        }
                        const request = window.indexedDB.open('InventarioDB', 1);
                        request.onerror = function() { resolve(null); };
                        request.onsuccess = function(event) {
                            const db = event.target.result;
                            const tx = db.transaction(['productos'], 'readonly');
                            const store = tx.objectStore('productos');
                            const allReq = store.getAll();
                            allReq.onsuccess = function(e) {
                                const productos = e.target.result || [];
                                let encontrados = [];
                                if (codigo) {
                                    if (codigo.length === 4) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo.endsWith(codigo));
                                    } else if (codigo.length === 13) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    } else {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    }
                                } else if (nombre || categoria) {
                                    encontrados = productos.filter(p => {
                                        let match = true;
                                        if (nombre) match = match && p.nombre && p.nombre.toLowerCase().includes(nombre.toLowerCase());
                                        if (categoria) match = match && p.categoria && p.categoria.toLowerCase().includes(categoria.toLowerCase());
                                        return match;
                                    });
                                }
                                resolve(encontrados);
                            };
                            allReq.onerror = function() { resolve(null); };
                        };
                    });
                }

                const productosLocal = await buscarEnIndexedDB(codigoInput, nombre, categoria);
                if (!productosLocal || productosLocal.length === 0) {
                    resultadosDiv.innerHTML = '<div class="text-red-600 font-semibold">No se encontraron productos en el dispositivo.</div>';
                    return;
                }

                // Mostrar resultados principales
                productosLocal.forEach((producto, idx) => {
                    let html = `<div class="bg-white rounded shadow p-4 mb-4">
                        <h3 class="text-xl font-bold mb-2">${producto.nombre}</h3>
                        <div><b>Código:</b> ${producto.codigo}</div>
                        <div><b>Categoría:</b> ${producto.categoria}</div>
                        <div><b>Marca:</b> ${producto.marca}</div>
                        <div><b>Unidad:</b> ${producto.unidad}</div>
                    </div>`;
                    resultadosDiv.innerHTML += html;
                    if (idx === 0) ultimoProducto = producto;
                });
            });

            // Lógica independiente para la pestaña de relaciones
            const buscarRelacionBtn = document.getElementById('buscarRelacion');
            if (buscarRelacionBtn) {
                buscarRelacionBtn.addEventListener('click', async function() {
                    relacionesDiv.innerHTML = '';
                    let codigo = document.getElementById('codigoRelacion').value.trim();
                    if (!codigo) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Ingresa un código para buscar relaciones.</div>';
                        return;
                    }
                    // Permitir búsqueda por últimos 4 dígitos
                    if (codigo.length === 4) {
                        // Buscar en Supabase todos los productos cuyo substring(2,5) sea igual a esos 4 dígitos
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        // Traer todos los códigos y filtrar en JS (por compatibilidad universal)
                        const { data: productosTodos } = await supabase.from('productos').select('codigo');
                        const productos4 = (productosTodos || []).filter(p => typeof p.codigo === 'string' && p.codigo.length >= 5 && p.codigo.substring(1,5) === codigo);
                        if (productos4.length > 0) {
                            if (productos4.length > 1) {
                                relacionesDiv.innerHTML = `<div class='mb-2'>Se encontraron varios productos con los dígitos 2-5 <b>${codigo}</b>:</div>`;
                                productos4.forEach(p => {
                                    relacionesDiv.innerHTML += `<button class='bg-blue-100 hover:bg-blue-300 text-blue-800 px-2 py-1 rounded m-1' onclick='document.getElementById("codigoRelacion").value="${p.codigo}";document.getElementById("buscarRelacion").click();return false;'>${p.codigo}</button>`;
                                });
                                return;
                            } else {
                                codigo = productos4[0].codigo;
                                document.getElementById('codigoRelacion').value = codigo;
                            }
                        } else {
                            relacionesDiv.innerHTML = `<div class='text-red-600'>No se encontró ningún producto con los dígitos 2-5 igual a <b>${codigo}</b>.</div>`;
                            return;
                        }
                    }
                    relacionesDiv.innerHTML = '<div class="text-gray-500">Buscando relaciones...</div>';
                    try {
                        const { obtenerRelacionesProductosSupabase, buscarRelacionProducto } = await import('../js/relaciones-productos.js');
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        const relaciones = await obtenerRelacionesProductosSupabase();
                        const resultado = buscarRelacionProducto(codigo, relaciones);
                        // Buscar info del producto consultado
                        let relHtml = `<div class="bg-white rounded shadow p-4 mb-4">
                            <h3 class="text-lg font-bold mb-2">Relaciones para: <span class='font-mono'>${codigo}</span></h3>`;
                        const { data: productoInfo } = await supabase.from('productos').select('*').eq('codigo', codigo);
                        if (productoInfo && productoInfo.length > 0) {
                            const p = productoInfo[0];
                            relHtml += `<div class='mb-2 text-sm text-gray-700'>${p.nombre} | ${p.unidad || ''} | ${p.categoria || ''} | ${p.marca || ''}</div>`;
                        }
                        // Si es principal, mostrar subproductos
                        if (resultado.tipo === 'principal' && resultado.subproductos.length > 0) {
                            // Buscar info de subproductos
                            const { data: subproductosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos);
                            relHtml += `<div class="mt-2"><b>Subproductos relacionados:</b>
                            <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                            resultado.subproductos.forEach(subCodigo => {
                                const sub = subproductosInfo ? subproductosInfo.find(p => p.codigo === subCodigo) : null;
                                if (sub) {
                                    relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                } else {
                                    relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                }
                            });
                            relHtml += '</tbody></table></div>';
                        }
                        // Si es subproducto, mostrar principal y hermanos
                        if (resultado.tipo === 'subproducto' && resultado.principal) {
                            // Buscar info del principal
                            const { data: principalArr } = await supabase.from('productos').select('*').eq('codigo', resultado.principal);
                            if (principalArr && principalArr.length > 0) {
                                const principal = principalArr[0];
                                relHtml += `<div class="mt-4"><b>Producto principal:</b>
                                    <div class="bg-gray-50 rounded p-2 mt-1">
                                        <b>${principal.nombre}</b> (Código: ${principal.codigo})<br>
                                        Categoría: ${principal.categoria} | Marca: ${principal.marca} | Unidad: ${principal.unidad}
                                    </div>
                                </div>`;
                            } else {
                                relHtml += `<div class="mt-4"><b>Producto principal:</b> <span class='text-gray-400'>${resultado.principal} (No encontrado)</span></div>`;
                            }
                            // Mostrar hermanos (otros subproductos)
                            if (resultado.subproductos.length > 1) {
                                const { data: hermanosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos.filter(c => c !== codigo));
                                relHtml += `<div class="mt-2"><b>Otros subproductos relacionados:</b>
                                <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                                resultado.subproductos.forEach(subCodigo => {
                                    if (subCodigo === codigo) return;
                                    const sub = hermanosInfo ? hermanosInfo.find(p => p.codigo === subCodigo) : null;
                                    if (sub) {
                                        relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                    } else {
                                        relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                    }
                                });
                                relHtml += '</tbody></table></div>';
                            }
                        }
                        if (resultado.tipo === 'ninguno') {
                            relHtml += '<div class="mt-2 text-gray-400">Este producto no tiene relaciones registradas.</div>';
                        }
                        relHtml += '</div>';
                        relacionesDiv.innerHTML = relHtml;
                    } catch (e) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Error al consultar relaciones: ' + (e.message || e) + '</div>';
                    }
                });
            }

            // El manejo del botón de escanear ya lo realiza `main.js` (evitamos listeners duplicados).
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#">
    <title>Editar Producto - Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <script src="../librerías/html5-qrcode.min.js"></script>
    <link rel="stylesheet" href="../librerías/tailwind.min.css" />
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">

    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Editar Producto</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Editar Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Pestañas -->
        <div class="mb-6 mt-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-editar-individual"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button active">
                        Edición Individual
                    </button>
                    <button id="tab-editar-tabla"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Edición por Tabla
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-editar-individual" class="tab-content">
            <form id="formEditarProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoEditar">
                        Código/PLU:
                    </label>
                    <div class="flex">
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="codigoEditar" type="text" required />
                        <button type="button" id="escanearBtnEditar"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                            Escanear Código de Barras
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <button id="buscarEditar"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="button">
                        Buscar
                    </button>
                </div>
                <div id="formularioEdicion" style="display: none">
                    <!-- Campo de código editable -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo">
                            Código
                        </label>
                        <input type="text" id="codigoEditado"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreEditar">
                            Nombre:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="nombreEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaEditar">
                            Categoría:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="categoriaEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="marcaEditar">
                            Marca/Proveedor:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="marcaEditar" type="text" required />
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="unidadEditar">
                            Unidad:
                        </label>
                        <input type="text" id="unidadEditar"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="flex items-center justify-between">
                        <button id="guardarCambios"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Guardar Cambios
                        </button>
                        <button id="eliminarProducto"
                            class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Eliminar Producto
                        </button>
                    </div>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
            <div id="scanner-container-editar" class="mt-4" style="display: none">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>
        </div>

        <!-- Pestaña Edición por Tabla -->
        <div id="content-editar-tabla" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Edición por Tabla</h3>
                <form id="formBuscarTabla" class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoBuscarTabla">
                        Buscar por Código de Producto Primario o Subproducto:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="codigoBuscarTabla" type="text" placeholder="Ej: 1234 o 201670000004" required />
                    <button type="submit"
                        class="mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Buscar</button>
                </form>
                <div id="tabla-edicion-resultados"></div>
                <div id="tabla-edicion-resultados"></div>
                <script type="module">
                    import { db, inicializarDB } from '../js/db-operations.js';
                    import { obtenerRelacionesProductosSupabase, buscarRelacionProducto } from '../js/relaciones-productos.js';
                    // Exponer para main.js si se requiere (opcional)
                    window.obtenerRelacionesProductosSupabase = obtenerRelacionesProductosSupabase;
                    window.buscarRelacionProducto = buscarRelacionProducto;

                    // Lógica de búsqueda y edición en tabla
                    document.getElementById('formBuscarTabla').addEventListener('submit', function (e) {
                        e.preventDefault();
                        const codigo = document.getElementById('codigoBuscarTabla').value.trim();
                        const resultadosDiv = document.getElementById('tabla-edicion-resultados');
                        resultadosDiv.innerHTML = `<div class='text-gray-600'>Sincronizando productos y relaciones...</div>`;

                        (async () => {
                            console.log('[DEBUG] db antes de inicializar:', db);
                            let dbReady = db;
                            if (!dbReady) {
                                resultadosDiv.innerHTML = `<div class='text-gray-600'>Inicializando base de datos local...</div>`;
                                try {
                                    await inicializarDB();
                                } catch (err) {
                                    console.error('[DEBUG] Error al inicializarDB:', err);
                                }
                                dbReady = db;
                                console.log('[DEBUG] db después de inicializar:', dbReady);
                            }
                            if (!dbReady) {
                                console.error('[DEBUG] IndexedDB sigue sin inicializar tras inicializarDB.');
                                resultadosDiv.innerHTML = `<div class='text-red-600'>IndexedDB no inicializado.</div>`;
                                return;
                            }
                            // 1. Sincronizar productos desde Supabase a IndexedDB y obtener relaciones
                            Promise.all([
                                importarProductosSupabaseAIndexedDB(dbReady),
                                obtenerRelacionesProductosSupabase()
                            ]).then(([_, relaciones]) => {
                                // 2. Buscar relación en el Map
                                const relacion = buscarRelacionProducto(codigo, relaciones);
                                // 3. Buscar detalles de productos en IndexedDB
                                buscarProductosRelacionadosConMap(dbReady, codigo, relacion, resultadosDiv);
                            }).catch(err => {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al sincronizar: ${err.message || err}`;
                            });
                        })();

                        // --- Función para importar productos de Supabase a IndexedDB ---
                        async function importarProductosSupabaseAIndexedDB(dbInstance) {
                            if (!window.getSupabase) throw new Error('No se encontró getSupabase.');
                            const supabase = await window.getSupabase();
                            const { data: productos, error } = await supabase.from('productos').select('*');
                            if (error) throw error;
                            if (!dbInstance) throw new Error('IndexedDB no inicializado');
                            return new Promise((resolve, reject) => {
                                const transaction = dbInstance.transaction(['productos'], 'readwrite');
                                const objectStore = transaction.objectStore('productos');
                                const clearReq = objectStore.clear();
                                clearReq.onsuccess = function () {
                                    productos.forEach(prod => {
                                        const p = {
                                            codigo: prod.codigo,
                                            nombre: prod.nombre,
                                            categoria: prod.categoria,
                                            marca: prod.marca,
                                            unidad: prod.unidad
                                        };
                                        objectStore.put(p);
                                    });
                                    transaction.oncomplete = resolve;
                                    transaction.onerror = reject;
                                };
                                clearReq.onerror = reject;
                            });
                        }

                        // --- Función para buscar productos relacionados usando el Map de relaciones ---
                        function buscarProductosRelacionadosConMap(dbInstance, codigo, relacion, resultadosDiv) {
                            const transaction = dbInstance.transaction(['productos'], 'readonly');
                            const objectStore = transaction.objectStore('productos');
                            const getAllReq = objectStore.getAll();
                            getAllReq.onsuccess = function (e) {
                                const productos = e.target.result;
                                // Buscar producto exacto (por código completo o 4 dígitos)
                                let producto = productos.find(p => p.codigo === codigo || p.codigo.endsWith(codigo));
                                if (!producto) {
                                    resultadosDiv.innerHTML = `<div class='text-red-600'>No se encontró el producto <b>${codigo}</b>.</div>`;
                                    return;
                                }
                                // Buscar principal y subproductos según el Map
                                let productoPrincipal = null;
                                let subproductos = [];
                                if (relacion.tipo === 'principal') {
                                    productoPrincipal = producto;
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                } else if (relacion.tipo === 'subproducto') {
                                    productoPrincipal = productos.find(p => p.codigo === relacion.principal);
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                }
                                // Mostrar resultados
                                let html = '';
                                // Producto encontrado (si es principal, mostrar botón editar principal)
                                html += `<div class='mb-4'><b>Producto encontrado:</b><br>${producto.codigo} - ${producto.nombre} (${producto.categoria})<br>Marca: ${producto.marca} | Unidad: ${producto.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${producto.codigo}'>Editar</button></div>`;
                                // Si hay producto principal distinto, mostrarlo con botón editar
                                if (productoPrincipal && productoPrincipal.codigo !== producto.codigo) {
                                    html += `<div class='mb-4'><b>Producto Principal:</b><br>${productoPrincipal.codigo} - ${productoPrincipal.nombre} (${productoPrincipal.categoria})<br>Marca: ${productoPrincipal.marca} | Unidad: ${productoPrincipal.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${productoPrincipal.codigo}'>Editar</button></div>`;
                                }
                                if (subproductos.length > 0) {
                                    html += `<div class='mb-2'><b>Subproductos relacionados:</b> <button id='expand-relacionados' class='ml-2 px-2 py-1 bg-blue-200 rounded'>Ver relacionados</button></div><ul class='mb-4' id='lista-relacionados' style='display:none;'>`;
                                    subproductos.forEach(sp => {
                                        html += `<li class='mb-1'>${sp.codigo} - ${sp.nombre} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${sp.codigo}'>Editar</button></li>`;
                                    });
                                    html += '</ul>';
                                }
                                resultadosDiv.innerHTML = html;
                                // Botón para expandir/collapse relacionados
                                const expandBtn = resultadosDiv.querySelector('#expand-relacionados');
                                const listaRelacionados = resultadosDiv.querySelector('#lista-relacionados');
                                if (expandBtn && listaRelacionados) {
                                    expandBtn.addEventListener('click', () => {
                                        listaRelacionados.style.display = listaRelacionados.style.display === 'none' ? 'block' : 'none';
                                        expandBtn.textContent = listaRelacionados.style.display === 'none' ? 'Ver relacionados' : 'Ocultar relacionados';
                                    });
                                }
                                // Agregar listeners a los botones de edición
                                resultadosDiv.querySelectorAll('.edit-btn').forEach(btn => {
                                    btn.addEventListener('click', function () {
                                        const codigoEditar = btn.dataset.codigo;
                                        // Buscar el producto en la lista de productos
                                        const prod = productos.find(p => p.codigo === codigoEditar);
                                        if (!prod) {
                                            Swal.fire('Error', 'No se encontró el producto en la base local.', 'error');
                                            return;
                                        }
                                        // Rellenar el formulario de edición individual
                                        document.getElementById('codigoEditar').value = prod.codigo;
                                        document.getElementById('codigoEditado').value = prod.codigo;
                                        document.getElementById('nombreEditar').value = prod.nombre;
                                        document.getElementById('categoriaEditar').value = prod.categoria;
                                        document.getElementById('marcaEditar').value = prod.marca;
                                        document.getElementById('unidadEditar').value = prod.unidad;
                                        // Mostrar el formulario de edición si está oculto
                                        document.getElementById('formularioEdicion').style.display = '';
                                        // Cambiar a la pestaña de Edición Individual
                                        const tabButtons = document.querySelectorAll('.tab-button');
                                        const tabContents = document.querySelectorAll('.tab-content');
                                        tabButtons.forEach(btn => {
                                            btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                                            btn.classList.add('border-transparent', 'text-gray-500');
                                        });
                                        tabContents.forEach(content => {
                                            content.style.display = 'none';
                                        });
                                        document.getElementById('tab-editar-individual').classList.add('active', 'border-blue-500', 'text-blue-600');
                                        document.getElementById('tab-editar-individual').classList.remove('border-transparent', 'text-gray-500');
                                        document.getElementById('content-editar-individual').style.display = 'block';
                                        // Scroll al formulario de edición
                                        document.getElementById('formEditarProducto').scrollIntoView({ behavior: 'smooth' });
                                    });
                                });
                            };
                            getAllReq.onerror = function () {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al buscar productos en IndexedDB.</div>`;
                            };
                        }
                    });
                </script>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Pestañas
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            function switchTab(targetTab) {
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });
                const activeButton = document.getElementById(`tab-${targetTab}`);
                activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');
                document.getElementById(`content-${targetTab}`).style.display = 'block';
            }
            document.getElementById('tab-editar-individual').addEventListener('click', () => switchTab('editar-individual'));
            document.getElementById('tab-editar-tabla').addEventListener('click', () => switchTab('editar-tabla'));

            // Aplicar conversión de guión a ceros en campos de código
            const codigoEditar = document.getElementById('codigoEditar');
            const codigoEditado = document.getElementById('codigoEditado');
            const codigoBuscarTabla = document.getElementById('codigoBuscarTabla');
            aplicarConversionCodigo(codigoEditar);
            aplicarConversionCodigo(codigoEditado);
            aplicarConversionCodigo(codigoBuscarTabla);


        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link href="../librerías/tailwind.min.css" rel="stylesheet">
    <script src="../librerías/sweetalert2@11.js"></script>
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Inventario</h1>
        <div class="flex items-center space-x-4">
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="inventario" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6 dark-theme-title">Inventario</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Nuevo div para mostrar la ubicación actual -->
        <div class="mb-4 p-4 bg-white shadow-md rounded">
            <h2 class="text-xl font-bold mb-2">Ubicación Actual: <span id="ubicacionActual"></span></h2>
            <button id="cambiarUbicacion" class="bg-yellow-500 text-white px-4 py-2">Cambiar Ubicación</button>
        </div>

        <!-- Pestañas principales de inventario -->
        <div class="mb-6">
            <div class="flex border-b bg-white shadow-sm rounded-t-lg">
                <button id="tabInventarioManual"
                    class="px-6 py-3 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500 font-semibold">
                    📦 Inventario Manual
                </button>
                <button id="tabLotesAvanzado"
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300 font-semibold">
                    🚀 Inventario por Lotes Avanzado
                </button>
            </div>
        </div>

        <!-- Contenido de Inventario Manual -->
        <div id="contenidoInventarioManual" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <!-- Formulario de búsqueda de inventario -->
            <div class="mb-4">
                <label for="codigo" class="block mb-2">Código/PLU:</label>
                <div class="flex">
                    <input type="text" id="codigo" class="border p-2 w-full">
                    <button id="escanearBtn" class="bg-blue-500 text-white px-4 py-2 ml-2">Escanear Código</button>
                </div>
            </div>

            <div class="mb-4">
                <label for="nombreInventario" class="block mb-2">Nombre:</label>
                <input type="text" id="nombreInventario" class="border p-2 w-full">
            </div>

            <div class="mb-4">
                <label for="marcaInventario" class="block mb-2">Marca:</label>
                <input type="text" id="marcaInventario" class="border p-2 w-full">
            </div>

            <button id="buscarInventario" class="bg-green-500 text-white px-4 py-2 mb-4">Buscar Producto</button>

            <div id="resultadosInventario" class="mt-4" style="display: none;">
                <!-- Los resultados de la búsqueda se mostrarán aquí -->
            </div>

            <div id="datosInventario" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
                <!-- Pestañas para productos tipo Kg -->
                <div id="tabsContainer" class="mb-6" style="display: none;">
                    <div class="flex border-b">
                        <button id="tabInventario"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            Inventario Normal
                        </button>
                        <button id="tabLotes"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            Lotes
                        </button>
                    </div>
                </div>

                <!-- Formulario de inventario normal -->
                <div id="formularioInventarioNormal">
                    <div class="mb-4">
                        <label for="codigoProductoInventario" class="block mb-2">Codigo del Producto:</label>
                        <input type="text" id="codigoProductoInventario" class="border p-2 w-full" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="nombreProductoInventario" class="block mb-2">Nombre del Producto:</label>
                        <input type="text" id="nombreProductoInventario" class="border p-2 w-full" readonly>
                    </div>

                    <div class="mb-4">
                        <label for="unidadProducto" class="block mb-2">Unidad:</label>
                        <input type="text" id="unidadProducto" class="border p-2 w-full" readonly>
                        <!-- Mostrar la unidad como texto -->
                    </div>

                    <div class="mb-4">
                        <label for="cantidad" class="block mb-2">Cantidad:</label>
                        <input type="number" id="cantidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-4">
                        <label for="fechaCaducidad" class="block mb-2">Fecha de Caducidad:</label>
                        <input type="date" id="fechaCaducidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-6">
                        <label for="comentarios" class="block mb-2">Comentarios:</label>
                        <textarea id="comentarios" class="border p-2 w-full"></textarea>
                    </div>

                    <div id="botonguardar" class="flex items-center justify-between">
                        <button id="guardarInventario" class="bg-blue-500 text-white px-4 py-2">Guardar
                            Inventario</button>
                    </div>
                    <div id="botonmodificar" class="flex items-center justify-between" style="display: none;">
                        <button id="modificarInventario" class="bg-blue-500 text-white px-4 py-2">Modificar
                            Inventario</button>
                    </div>
                </div>

                <!-- Formulario de escaneo por lotes para productos Kg -->
                <div id="formularioLotes" style="display: none;">
                    <div class="bg-blue-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-bold mb-3 text-blue-800">Información del Producto</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Código:</label>
                                <span id="codigoProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre:</label>
                                <span id="nombreProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Unidad:</label>
                                <span id="unidadProductoLotes" class="text-sm font-semibold text-green-600">Kg</span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoría:</label>
                                <span id="categoriaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Marca:</label>
                                <span id="marcaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label for="precioKilo" class="block text-sm font-medium text-gray-700 mb-2">Precio por Kilo
                            ($):</label>
                        <input type="number" id="precioKilo" step="0.01" min="0"
                            class="border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Ingrese el precio por kilogramo">
                    </div>

                    <div class="text-center">
                        <button id="iniciarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            📱 Iniciar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>

            <div id="mensaje" class="mt-4"></div>

            <div id="scanner-container-inventario" class="mt-4" style="display: none;">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>

            <button id="generarHojaInventario" class="bg-purple-500 text-white px-4 py-2 mt-4">Generar Hoja de
                Inventario</button>
        </div>

        <!-- Contenido de Inventario por Lotes Avanzado -->
        <div id="contenidoLotesAvanzado" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
            <!-- Panel de alerta y configuración -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-yellow-800">Inventario por Lotes Avanzado</h3>
                        <div class="mt-2 text-sm text-yellow-700">
                            <ul class="list-disc list-inside space-y-1">
                                <li>Solo se pueden contar productos con unidad tipo <strong>Kg</strong></li>
                                <li>El escaneo será automático sin necesidad de búsqueda previa</li>
                                <li>Se extraerán automáticamente PLU, peso y precio desde códigos CODE128</li>
                                <li>Los productos se agruparán por productos primarios y subproductos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel de configuración -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-4 text-gray-800">⚙️ Configuración de Escaneo</h3>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="confirmarProductosSimilares"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                        <label for="confirmarProductosSimilares" class="text-sm font-medium text-gray-700">
                            Mostrar ventana de confirmación para productos similares
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="agruparAutomaticamente"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="agruparAutomaticamente" class="text-sm font-medium text-gray-700">
                            Agrupar automáticamente productos con el mismo PLU
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="sonidoConfirmacion"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="sonidoConfirmacion" class="text-sm font-medium text-gray-700">
                            Reproducir sonido de confirmación al escanear
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="relacionarProductos"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="relacionarProductos" class="text-sm font-medium text-gray-700">
                            Relacionar productos (buscar en productos_subproductos)
                        </label>
                    </div>
                </div>
            </div>

            <!-- Botón para iniciar escaneo -->
            <div class="text-center mb-6">
                <button id="iniciarEscaneoLotesAvanzado"
                    class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform hover:scale-105 transition duration-200">
                    🚀 Iniciar Escaneo por Lotes Avanzado
                </button>
            </div>

            <!-- Área de resultados de productos escaneados -->
            <div id="resultadosLotesAvanzado" class="hidden">
                <h3 class="text-lg font-bold mb-4 text-gray-800">📊 Productos Escaneados</h3>
                <div id="contenedorProductosPrimarios" class="space-y-4">
                    <!-- Las tarjetas de productos primarios se mostrarán aquí -->
                </div>

                <!-- Botón para guardar inventario -->
                <div class="text-center mt-6">
                    <button id="guardarInventarioLotesAvanzado"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled>
                        💾 Guardar Inventario
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes Avanzado -->
        <div id="modalEscaneoLotesAvanzado"
            class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
            <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-5xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-900">🚀 Escaneo por Lotes Avanzado</h3>
                        <button id="cerrarModalLotesAvanzado" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscanerAvanzado"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListadoAvanzado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Productos Escaneados (<span id="contadorProductosAvanzado">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscanerAvanzado" class="mb-4">
                        <div id="scanner-container-lotes-avanzado" class="mb-4">
                            <div id="reader-lotes-avanzado" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="accionEscaneoLotesAvanzado"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-bold"
                                style="user-select:none;">
                                Activar escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListadoAvanzado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Nombre</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio/Kg</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Tipo</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoProductosAvanzado">
                                    <!-- Los productos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total productos: <span id="totalProductosAvanzado" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotalAvanzado" class="font-bold">0.000 Kg</span> |
                            Productos primarios: <span id="totalProductosPrimarios" class="font-bold">0</span>
                        </div>
                        <button id="finalizarEscaneoLotesAvanzado"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes Avanzado
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Edición de Producto de Lote -->
        <div id="modalEdicionProductoLote" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 10000;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-md shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">✏️ Editar Producto Escaneado</h3>
                        <button onclick="cerrarModalEdicionProducto()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Información del producto -->
                    <div class="mb-4 p-3 bg-gray-50 rounded">
                        <p class="text-sm"><strong>Producto:</strong> <span id="editProductoNombre" class="font-medium"></span></p>
                        <p class="text-sm"><strong>Código:</strong> <span id="editProductoCodigo" class="font-mono"></span></p>
                        <p class="text-sm"><strong>PLU:</strong> <span id="editProductoPLU" class="font-mono"></span></p>
                        <input type="hidden" id="editProductoId">
                    </div>

                    <!-- Campos editables -->
                    <div class="space-y-4">
                        <!-- Precio por Kilo -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                💰 Precio por Kilo ($)
                            </label>
                            <input type="number" id="editPrecioKilo" step="0.01" min="0.01"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el precio por kilo era diferente al momento de crear la etiqueta
                            </p>
                        </div>

                        <!-- Peso -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                ⚖️ Peso (Kg)
                            </label>
                            <input type="number" id="editPeso" step="0.001" min="0.001"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.000">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el peso calculado no es correcto (recalcula precio automáticamente)
                            </p>
                        </div>

                        <!-- Precio de Porción (solo lectura, se actualiza automáticamente) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                🏷️ Precio de Porción ($)
                            </label>
                            <input type="number" id="editPrecioPorcion" step="0.01" min="0.01" readonly
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                ℹ️ Se calcula automáticamente: Precio/Kg × Peso
                            </p>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="cerrarModalEdicionProducto()"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button onclick="guardarEdicionProducto()"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            💾 Guardar Cambios
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Información de Producto -->
        <div id="modalInfoProducto" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 9999;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">📋 Información del Producto</h3>
                        <button id="cerrarModalInfoProducto" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Contenido del modal -->
                    <div id="contenidoInfoProducto">
                        <!-- Se llenará dinámicamente -->
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button id="cancelarInfoProducto"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button id="guardarInfoProducto"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            Guardar Info
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes (original) -->
        <div id="modalEscaneoLotes" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
            style="display: none;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">Escaneo por Lotes</h3>
                        <button id="cerrarModalLotes" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscaner"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Códigos Escaneados (<span id="contadorCodigos">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscaner" class="mb-4">
                        <div id="scanner-container-lotes" class="mb-4">
                            <div id="reader-lotes" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="pararEscaneoLotes"
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                                Pausar Escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código Completo</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoCodigosEscaneados">
                                    <!-- Los códigos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total de códigos: <span id="totalCodigos" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotal" class="font-bold">0.00 Kg</span> |
                            Valor total porciones: <span id="precioTotalGeneral" class="font-bold">$0.00</span>
                        </div>
                        <button id="finalizarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- tabla de productos en inventario -->
    <div>
        <button id="sync-inventario-down-btn"
            class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Inventario desde Supabase
        </button>
        <button id="sincronizarManual" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Ahora
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4"> Productos en Inventario </h2>
        <div class="overflow-x-auto">
            <table id="estructura-plantilla" class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">Código</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categoría</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Tipo de Cantidad</th>
                        <th class="py-3 px-6 text-left">Cantidad</th>
                        <th class="py-3 px-6 text-left">Fecha de Caducidad</th>
                        <th class="py-3 px-6 text-left">Comentarios</th>
                        <th class="py-3 px-6 text-left">ubicacion</th>
                    </tr>
                </thead>
                <tbody id="estructuraPlantillaBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/scanner/lotes-avanzado.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;

            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);

                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;

                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversión a los campos de código cuando se cargue la página
        document.addEventListener('DOMContentLoaded', function () {
            const codigo = document.getElementById('codigo');
            const codigoProductoInventario = document.getElementById('codigoProductoInventario');

            aplicarConversionCodigo(codigo);
            // Note: codigoProductoInventario es readonly, pero aplicamos por si acaso
            aplicarConversionCodigo(codigoProductoInventario);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Sistema de Gestión de Productos</h1>
        <div class="flex items-center space-x-4">
            <!-- Indicador de estado del backend -->
            <div id="backendStatus" class="px-3 py-1 rounded-full text-sm font-semibold" 
                 title="Estado de conexión con el backend"
                 style="background-color: #fbbf24; color: #78350f;">
                ⏳ Verificando...
            </div>
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t dark-theme-sidebar-footer">
            <button id="logoutBtn" class="w-full bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded dark-theme-button">
                Cerrar Sesión
            </button>
        </div>
    </div>

    <a href="../index.html" class="text-blue-500 hover:underline mb-4 inline-block dark-theme-link">← Regresar</a>
    <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200 dark-theme-menu-toggle">
        Menú
    </button>

    <main class="container mx-auto mt-8">
        <section id="dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div id="consulta" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Consulta de Producto</h2>
                <p class="mb-4 dark-theme-card-text">Busca productos en la base de datos por diferentes criterios.</p>
                <a id="consultaLink" href="./consulta.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Consulta
                    Producto</a>
            </div>

            <div id="editar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Editar Producto</h2>
                <p class="mb-4 dark-theme-card-text">Edita los atributos de los productos existentes en la base de
                    datos.</p>
                <a id="editarLink" href="./editar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Editar
                    Producto</a>
            </div>

            <div id="inventario" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona el inventario de productos con datos adicionales.</p>
                <a id="inventarioLink" href="./inventario.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Inventario</a>
            </div>

            <div id="reporte" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Reporte para Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Genera reportes detallados del inventario de productos.</p>
                <a id="reporteLink" href="./report.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Reporte
                    para Inventario</a>
            </div>

            <div id="agregar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Agregar Productos</h2>
                <p class="mb-4 dark-theme-card-text">Escanea y agrega nuevos productos a la base de datos.</p>
                <a id="agregarLink" href="./agregar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Agregar
                    Productos</a>
            </div>

            <div id="archivos" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Administración de Archivos</h2>
                <p class="mb-4 dark-theme-card-text">Sube o descarga archivos CSV para la base de datos.</p>
                <a id="archivosLink" href="./archivos.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Archivos</a>
            </div>

            <div id="configuraciones" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Configuraciones</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona las configuraciones del sistema, perfil de usuario y
                    preferencias.</p>
                <a id="configuracionesLink" href="./configuraciones.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Configuraciones</a>
            </div>
        </section>
    </main>

    <footer class="bg-blue-600 text-white p-4 mt-8 dark-theme-footer">
        <p class="text-center dark-theme-footer-text">&copy; 2024 Sistema de Gestión de Productos. Todos los derechos
            reservados.</p>
    </footer>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>    <script type="module">
        import { backendStatusMonitor } from '../js/backend-status.js';
        
        // Monitorear estado del backend
        document.addEventListener('DOMContentLoaded', () => {
            const backendStatusEl = document.getElementById('backendStatus');
            
            // Escuchar cambios de estado del backend
            window.addEventListener('backendStatusChanged', (event) => {
                const { available } = event.detail;
                
                if (available) {
                    backendStatusEl.textContent = '🟢 Backend activo';
                    backendStatusEl.style.backgroundColor = '#dcfce7'; // green-100
                    backendStatusEl.style.color = '#166534'; // green-800
                } else {
                    backendStatusEl.textContent = '🔴 Backend no disponible';
                    backendStatusEl.style.backgroundColor = '#fee2e2'; // red-100
                    backendStatusEl.style.color = '#991b1b'; // red-900
                    
                    // Mostrar alerta una sola vez
                    if (!window.backendDownNotified) {
                        setTimeout(() => {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Backend no disponible',
                                text: 'La aplicación funcionará en modo offline. Los cambios se sincronizarán cuando el servidor esté disponible.',
                                allowOutsideClick: false,
                                didOpen: (modal) => {
                                    // Cerrar automáticamente después de 5 segundos
                                    setTimeout(() => {
                                        Swal.close();
                                    }, 5000);
                                }
                            });
                        }, 500);
                        window.backendDownNotified = true;
                    }
                }
            });
            
            // Iniciar monitoreo (cada 30 segundos)
            backendStatusMonitor.startMonitoring(30);
        });
    </script>
    <script type="module">
        import { cerrarSesion } from '../js/auth/auth.js';
        
        // Manejar botón de logout
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    const { value: rememberUser } = await Swal.fire({
                        title: 'Cerrar Sesión',
                        text: '¿Deseas que se recuerde tu usuario para el próximo login?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Sí, recordar usuario',
                        cancelButtonText: 'No, no recordar',
                        allowOutsideClick: false
                    });
                    
                    // Si cancela, no hace nada
                    if (rememberUser === undefined) return;
                    
                    // Llamar función de logout
                    await cerrarSesion(rememberUser === true);
                });
            }
        });
    </script>    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menuToggle');
            const sideMenu = document.getElementById('sideMenu');
            const closeMenu = document.getElementById('closeMenu');
            const menuRoutes = document.getElementById('menuRoutes');
            const routes = [
                { name: 'Consulta de Producto', path: './consulta.html' },
                { name: 'Editar Producto', path: './editar.html' },
                { name: 'Inventario', path: './inventario.html' },
                { name: 'Registro de Entradas', path: './registro-entradas.html' },
                { name: 'Reporte para Inventario', path: './report.html' },
                { name: 'Agregar Productos', path: './agregar.html' },
                { name: 'Administración de Archivos', path: './archivos.html' },
                { name: 'Configuraciones', path: './configuraciones.html' }
            ];

            // Generar las rutas dinámicamente
            routes.forEach(route => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline dark-theme-nav-link">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            // Mostrar el menú
            menuToggle.addEventListener('click', () => {
                sideMenu.classList.remove('-translate-x-full');
            });

            // Ocultar el menú
            closeMenu.addEventListener('click', () => {
                sideMenu.classList.add('-translate-x-full');
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Entradas</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-green-600 text-white p-4 flex justify-between items-center shadow-lg">
        <div class="flex items-center space-x-3">
            <div class="p-2 bg-green-700 rounded-lg">
                📦
            </div>
            <h1 class="text-3xl font-bold tracking-wide">Registro de Entradas</h1>
        </div>
        <div class="flex items-center space-x-6">
            <div id="conexionStatus" class="text-sm flex items-center space-x-2 bg-green-700 px-3 py-1 rounded-full">
                <span class="status-indicator status-success"></span>
                <span>Conectado</span>
            </div>
            <div id="clockDisplay" class="text-sm font-mono bg-green-700 px-3 py-1 rounded-full"></div>
            <div class="text-sm bg-green-700 px-3 py-1 rounded-full">
                <span id="totalEntradas">0</span> entradas registradas
            </div>
        </div>
    </header>
    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform z-50">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>
    <div class="container mx-auto mt-8 p-4">
        <div class="mb-6 flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center space-x-4">
                <h1 class="text-4xl font-bold text-gray-800 flex items-center">
                    📦 Registro de Entradas
                    <span class="ml-3 text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                        Sistema de Gesti�n
                    </span>
                </h1>
            </div>
            <div class="flex items-center space-x-3">
                <a href="./main.html"
                    class="text-green-600 hover:text-green-800 hover:underline font-medium flex items-center space-x-2 transition-colors">
                    <span>←</span>
                    <span>Regresar al Men� Principal</span>
                </a>
                <button id="menuToggle"
                    class="bg-white text-green-600 px-4 py-2 rounded-lg hover:bg-green-50 border-2 border-green-600 font-semibold transition-all hover:shadow-md">
                    📋 Men� de Navegaci�n
                </button>
            </div>
        </div> <!-- Secci�n de b�squeda de productos -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                🔍 Buscar Producto
                <span id="searchStatus" class="ml-3 text-sm"></span>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="ultimaBusqueda"></span>
                </div>
            </h2>

            <div class="grid md:grid-cols-3 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ Buscar por C�digo:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaCodigo"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese c�digo del producto">
                        <button id="buscarPorCodigo"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnCodigoText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 Buscar por Nombre:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaNombre"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese nombre del producto">
                        <button id="buscarPorNombre"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnNombreText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 Buscar por Marca:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaMarca"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese marca del producto">
                        <button id="buscarPorMarca"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnMarcaText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-center">
                <button id="escanearBtn"
                    class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                    <span>📷</span>
                    <span>Escanear C�digo de Barras</span>
                </button>
            </div>

            <!-- Mensaje de b�squeda reciente -->
            <div id="busquedaReciente" class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 rounded"
                style="display: none;">
                <p class="text-sm text-blue-700">
                    <strong>B�squeda reciente:</strong> <span id="textoUltimaBusqueda"></span>
                </p>
            </div>
        </div> <!-- Formulario de datos del producto y entrada -->
        <div id="productForm"
            class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover"
            style="display: none;">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                📦 Datos del Producto
                <div id="productLoadingIndicator" class="ml-3" style="display: none;">
                    <div
                        class="inline-block w-4 h-4 border-2 border-green-500 border-t-transparent rounded-full animate-spin">
                    </div>
                    <span class="ml-2">Cargando informaci�n...</span>
                </div>
                <div class="ml-auto">
                    <span class="text-sm text-gray-500 bg-green-100 px-3 py-1 rounded-full">
                        Producto encontrado ✅
                    </span>
                </div>
            </h2>

            <div id="productInfo"
                class="grid md:grid-cols-2 gap-6 mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border-2 border-green-200 shadow-inner">
                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="codigoProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">C�digo del Producto:</span>
                        </label>
                        <input type="text" id="codigoProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-mono text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="nombreProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📝 <span class="ml-2">Nombre del Producto:</span>
                        </label>
                        <input type="text" id="nombreProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-semibold text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="marcaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏢 <span class="ml-2">Marca:</span>
                        </label>
                        <input type="text" id="marcaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="categoriaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📂 <span class="ml-2">Categor�a:</span>
                        </label>
                        <input type="text" id="categoriaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="unidadProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📏 <span class="ml-2">Unidad de Medida:</span>
                        </label>
                        <input type="text" id="unidadProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <!-- Informaci�n adicional del stock actual -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="text-sm font-semibold text-blue-700 mb-2">📊 Stock Actual</h4>
                        <div class="text-2xl font-bold text-blue-600" id="stockActual">--</div>
                        <div class="text-xs text-blue-500">unidades disponibles</div>
                    </div>
                </div>
            </div>
            <div class="border-t-2 border-gray-200 pt-8">
                <h3 class="text-lg font-semibold mb-6 text-green-600 flex items-center">
                    📝 Datos de la Entrada
                    <span class="ml-3 text-sm text-gray-500 bg-yellow-100 px-3 py-1 rounded-full">
                        * Campos obligatorios
                    </span>
                    <div class="ml-auto text-sm text-gray-400">
                        <span id="fechaActual"></span>
                    </div>
                </h3>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="transform transition-all hover:scale-105">
                        <label for="cantidadEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📊 <span class="ml-2">Cantidad Recibida *:</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="cantidadEntrada"
                                class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg font-semibold"
                                min="0.01" step="0.01" required placeholder="0.00">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <span id="unidadMedida">unidades</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">Ingrese la cantidad exacta recibida</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="fechaEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📅 <span class="ml-2">Fecha de Entrada *:</span>
                        </label>
                        <input type="date" id="fechaEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg"
                            required>
                        <div class="text-xs text-gray-500 mt-1">Fecha en que se recibi� el producto</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="loteEntrada" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">N�mero de Lote:</span>
                        </label>
                        <input type="text" id="loteEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                            placeholder="Opcional">
                        <div class="text-xs text-gray-500 mt-1">N�mero de lote del proveedor</div>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="comentariosEntrada"
                        class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        💬 <span class="ml-2">Comentarios y Observaciones:</span>
                    </label>
                    <textarea id="comentariosEntrada"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                        rows="4"
                        placeholder="Informaci�n adicional: estado del producto, observaciones del proveedor, condiciones especiales..."></textarea>
                </div>

                <div class="flex justify-between items-center bg-gray-50 p-4 rounded-lg">
                    <button id="limpiarFormulario"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>🗑️</span>
                        <span>Limpiar Formulario</span>
                    </button>
                    <button id="registrarEntrada"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnRegistrarText">✅ Registrar Entrada</span>
                    </button>
                </div>

                <!-- Resumen de la entrada -->
                <div id="resumenEntrada" class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded"
                    style="display: none;">
                    <h4 class="font-semibold text-blue-700 mb-2">📋 Resumen de la Entrada:</h4>
                    <div id="textoResumen" class="text-sm text-blue-600"></div>
                </div>
            </div>
        </div> <!-- Filtros y controles -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-blue-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-blue-600 flex items-center">
                🔧 Filtros y Controles del Sistema
                <div id="syncStatus" class="ml-3 text-sm"></div>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="estadoSistema" class="bg-green-100 text-green-700 px-3 py-1 rounded-full">
                        Sistema Operativo
                    </span>
                </div>
            </h2>

            <div class="grid md:grid-cols-4 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="filtroCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ <span class="ml-2">Filtrar por C�digo:</span>
                    </label>
                    <input type="text" id="filtroCodigo"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="C�digo del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 <span class="ml-2">Filtrar por Nombre:</span>
                    </label>
                    <input type="text" id="filtroNombre"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Nombre del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 <span class="ml-2">Filtrar por Marca:</span>
                    </label>
                    <input type="text" id="filtroMarca"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Marca del producto...">
                </div>

                <div class="flex items-end space-x-2">
                    <button id="filtrarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🔍</span>
                        <span>Filtrar</span>
                    </button>
                    <button id="limpiarFiltros"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🗑️</span>
                        <span>Limpiar</span>
                    </button>
                </div>
            </div>

            <!-- Filtros de fecha -->
            <div class="grid md:grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-lg">
                <div>
                    <label for="fechaDesde" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Desde:</span>
                    </label>
                    <input type="date" id="fechaDesde"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div>
                    <label for="fechaHasta" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Hasta:</span>
                    </label>
                    <input type="date" id="fechaHasta"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div class="flex items-end">
                    <button id="filtrarPorFecha"
                        class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all w-full">
                        📊 Filtrar por Fechas
                    </button>
                </div>
            </div>

            <div class="flex flex-wrap gap-4 justify-between items-center">
                <div class="flex flex-wrap gap-3">
                    <button id="sincronizarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnSincText">🔄 Sincronizar con Servidor</span>
                    </button>
                    <button id="generarReporte"
                        class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-3 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>📊</span>
                        <span>Generar Reporte CSV</span>
                    </button>
                    <button id="autoRefresh"
                        class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white px-6 py-3 rounded-lg hover:from-indigo-600 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>⚡</span>
                        <span>Auto-actualizaci�n: OFF</span>
                    </button>
                </div>

                <div class="flex items-center space-x-3 text-sm text-gray-600">
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">�ltima sincronizaci�n:</span>
                        <span id="ultimaSync">--:--</span>
                    </div>
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">Estado:</span>
                        <span id="estadoConexion" class="text-green-600">Conectado</span>
                    </div>
                </div>
            </div>
        </div> <!-- Tabla de entradas -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-purple-500 card-hover">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-purple-600 flex items-center">
                        📋 Historial de Entradas del Sistema
                        <div id="tableLoadingIndicator" class="ml-3" style="display: none;">
                            <div
                                class="inline-block w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin">
                            </div>
                            <span class="ml-2 text-sm">Actualizando datos...</span>
                        </div>
                    </h2>
                    <div class="flex items-center space-x-4 mt-2">
                        <p id="contadorEntradas" class="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                            Total: 0 entradas registradas
                        </p>
                        <div class="text-sm text-gray-500">
                            <span id="rangoFechas">Mostrando todas las entradas</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="refreshTable"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Actualizar tabla">
                        <span>🔄</span>
                        <span class="hidden md:inline">Actualizar</span>
                    </button>
                    <button id="exportVisible"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Exportar datos visibles">
                        <span>📥</span>
                        <span class="hidden md:inline">Exportar</span>
                    </button>
                    <button id="expandirTabla"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Expandir/Contraer tabla">
                        <span>⛶</span>
                        <span class="hidden md:inline">Expandir</span>
                    </button>
                </div>
            </div>

            <!-- Barra de b�squeda r�pida -->
            <div class="mb-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <input type="text" id="busquedaRapida"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                        placeholder="🔍 B�squeda r�pida en la tabla...">
                    <select id="ordenarPor"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="fecha-desc">M�s reciente primero</option>
                        <option value="fecha-asc">M�s antiguo primero</option>
                        <option value="cantidad-desc">Mayor cantidad primero</option>
                        <option value="cantidad-asc">Menor cantidad primero</option>
                        <option value="nombre-asc">Nombre A-Z</option>
                        <option value="nombre-desc">Nombre Z-A</option>
                    </select>
                </div>
                <div class="text-sm text-gray-500">
                    <span id="resultadosBusqueda"></span>
                </div>
            </div>

            <div class="overflow-x-auto shadow-lg rounded-lg">
                <table class="min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg">
                    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('codigo')">
                                <div class="flex items-center space-x-1">
                                    <span>🏷️ C�digo</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('nombre')">
                                <div class="flex items-center space-x-1">
                                    <span>📝 Nombre</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('marca')">
                                <div class="flex items-center space-x-1">
                                    <span>🏢 Marca</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('categoria')">
                                <div class="flex items-center space-x-1">
                                    <span>📂 Categor�a</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('unidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📏 Unidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('cantidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📊 Cantidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('fecha')">
                                <div class="flex items-center space-x-1">
                                    <span>📅 Fecha</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                                💬 Comentarios
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ⚙️ Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tablaEntradasBody" class="bg-white divide-y divide-gray-200">
                        <!-- Las entradas se cargar�n din�micamente aqu� -->
                        <tr class="text-center text-gray-500 bg-gray-50">
                            <td colspan="9" class="px-6 py-8">
                                <div class="flex flex-col items-center space-y-3">
                                    <div class="text-4xl">📦</div>
                                    <div class="text-lg font-medium">No hay entradas registradas</div>
                                    <div class="text-sm">Las entradas aparecer�n aqu� cuando se registren productos
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginaci�n -->
            <div class="mt-6 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-600">Mostrar:</span>
                    <select id="registrosPorPagina" class="border border-gray-200 rounded p-1 text-sm">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="text-sm text-gray-600">registros por p�gina</span>
                </div>
                <div id="paginacion" class="flex items-center space-x-2">
                    <!-- Los controles de paginaci�n se generar�n din�micamente -->
                </div>
            </div>
        </div> <!-- Scanner container -->
        <div id="scanner-container"
            class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 backdrop-blur-sm"
            style="display: none;">
            <div
                class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl border-4 border-green-500 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        📷 <span class="ml-2">Esc�ner de C�digo de Barras</span>
                    </h3>
                    <button id="cerrarEscaner"
                        class="text-red-500 hover:text-red-700 text-2xl font-bold transition-colors transform hover:scale-110">
                        ✕
                    </button>
                </div>

                <div class="mb-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                    <p class="text-sm text-blue-700">
                        <strong>Instrucciones:</strong> Coloque el c�digo de barras dentro del marco verde.
                        El esc�ner detectar� autom�ticamente el c�digo.
                    </p>
                </div>

                <div id="reader" class="w-full mb-6 rounded-lg overflow-hidden border-4 border-green-200 shadow-lg">
                </div>

                <div class="flex space-x-3">
                    <button id="detenerEscaner"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 w-full transition-all transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2">
                        <span>🛑</span>
                        <span>Detener Esc�ner</span>
                    </button>
                </div>

                <!-- Estado del esc�ner -->
                <div id="estadoEscaner" class="mt-4 text-center text-sm text-gray-600">
                    <div class="flex items-center justify-center space-x-2">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span>Esc�ner activo - Listo para escanear</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../librer�as/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script src="../js/utils/extension-conflict-detector.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script type="module" src="../js/core/registro-entradas-operations.js"></script>
    <script type="module">
        import { inicializarRegistroEntradas } from '../js/registro-entradas-operations.js';
        import { inicializarDB } from '../js/db-operations.js';
        import { toggleEscaner } from '../js/scanner.js';        // Inicializar cuando el DOM est� cargado
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Inicializar base de datos principal
                await inicializarDB();

                // Inicializar p�gina de registro de entradas
                await inicializarRegistroEntradas();

                // Configurar esc�ner
                const escanearBtn = document.getElementById('escanearBtn');
                if (escanearBtn) {
                    escanearBtn.addEventListener('click', () => {
                        toggleEscaner('busquedaCodigo', 'scanner-container');
                    });
                }

                const cerrarEscaner = document.getElementById('cerrarEscaner');
                const detenerEscaner = document.getElementById('detenerEscaner');

                if (cerrarEscaner) {
                    cerrarEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                if (detenerEscaner) {
                    detenerEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                // Inicializar funcionalidades din�micas
                initializeDynamicFeatures();

                console.log('P�gina de registro de entradas inicializada correctamente');

            } catch (error) {
                console.error('Error al inicializar p�gina de registro de entradas:', error);
            }
        });        // Funcionalidades din�micas
        function initializeDynamicFeatures() {
            // Reloj en tiempo real
            updateClock();
            setInterval(updateClock, 1000);

            // Estado de conexi�n
            updateConnectionStatus();
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);

            // Auto-actualizaci�n
            setupAutoRefresh();

            // Efectos de carga
            setupLoadingEffects();

            // Animaciones de entrada
            setupEntranceAnimations();

            // Notificaciones din�micas
            setupDynamicNotifications();

            // Configurar fecha actual
            setupCurrentDate();

            // B�squeda r�pida en tabla
            setupQuickSearch();

            // Autocompletado
            setupAutoComplete();

            // Atajos de teclado
            setupKeyboardShortcuts();

            // Validaciones en tiempo real
            setupRealTimeValidation();
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            const clockDisplay = document.getElementById('clockDisplay');
            if (clockDisplay) {
                clockDisplay.innerHTML = `${timeString}<br><span class="text-xs">${dateString}</span>`;
            }

            // Actualizar fecha actual en el resumen
            const fechaActual = document.getElementById('fechaActual');
            if (fechaActual) {
                fechaActual.textContent = `Hoy: ${dateString}`;
            }
        }

        function updateConnectionStatus() {
            const statusElement = document.getElementById('conexionStatus');
            const estadoConexion = document.getElementById('estadoConexion');

            if (statusElement || estadoConexion) {
                const isOnline = navigator.onLine;
                const status = isOnline
                    ? '<span class="status-indicator status-success"></span>Conectado'
                    : '<span class="status-indicator status-error"></span>Sin conexi�n';

                if (statusElement) statusElement.innerHTML = status;
                if (estadoConexion) {
                    estadoConexion.textContent = isOnline ? 'Conectado' : 'Sin conexi�n';
                    estadoConexion.className = isOnline ? 'text-green-600' : 'text-red-600';
                }

                // Actualizar estado del sistema
                const estadoSistema = document.getElementById('estadoSistema');
                if (estadoSistema) {
                    if (isOnline) {
                        estadoSistema.className = 'bg-green-100 text-green-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Operativo';
                    } else {
                        estadoSistema.className = 'bg-red-100 text-red-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Offline';
                    }
                }
            }
        }

        function setupCurrentDate() {
            const fechaEntrada = document.getElementById('fechaEntrada');
            if (fechaEntrada && !fechaEntrada.value) {
                const today = new Date().toISOString().split('T')[0];
                fechaEntrada.value = today;
            }
        }

        function setupQuickSearch() {
            const busquedaRapida = document.getElementById('busquedaRapida');
            if (busquedaRapida) {
                busquedaRapida.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#tablaEntradasBody tr');
                    let visibleCount = 0;

                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        const isVisible = text.includes(searchTerm);
                        row.style.display = isVisible ? '' : 'none';
                        if (isVisible && !row.classList.contains('text-center')) visibleCount++;
                    });

                    // Actualizar contador de resultados
                    const resultados = document.getElementById('resultadosBusqueda');
                    if (resultados) {
                        resultados.textContent = searchTerm ?
                            `${visibleCount} resultado${visibleCount !== 1 ? 's' : ''} encontrado${visibleCount !== 1 ? 's' : ''}` :
                            '';
                    }
                });
            }
        }

        function setupAutoComplete() {
            // Autocompletado para campos de b�squeda
            const campos = ['busquedaCodigo', 'busquedaNombre', 'busquedaMarca'];
            campos.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.addEventListener('input', debounce((e) => {
                        // Aqu� se implementar�a la l�gica de autocompletado
                        showAutoCompleteHint(campo, e.target.value);
                    }, 300));
                }
            });
        }

        function showAutoCompleteHint(element, value) {
            if (value.length < 2) return;

            // Simular sugerencias (en producci�n vendr�a de la base de datos)
            const hints = ['Producto A', 'Producto B', 'Marca X', 'Marca Y'];
            const matchingHints = hints.filter(hint =>
                hint.toLowerCase().includes(value.toLowerCase())
            );

            // Mostrar hint visual
            if (matchingHints.length > 0) {
                element.title = `Sugerencia: ${matchingHints[0]}`;
                element.style.borderColor = '#10B981';
            } else {
                element.title = '';
                element.style.borderColor = '';
            }
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl + F para buscar
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    const busquedaRapida = document.getElementById('busquedaRapida');
                    if (busquedaRapida) {
                        busquedaRapida.focus();
                        busquedaRapida.select();
                    }
                }

                // Ctrl + S para sincronizar
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    const sincBtn = document.getElementById('sincronizarEntradas');
                    if (sincBtn) sincBtn.click();
                }

                // Ctrl + R para actualizar tabla
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    const refreshBtn = document.getElementById('refreshTable');
                    if (refreshBtn) refreshBtn.click();
                }

                // ESC para cerrar modales
                if (e.key === 'Escape') {
                    const scanner = document.getElementById('scanner-container');
                    if (scanner && scanner.style.display !== 'none') {
                        scanner.style.display = 'none';
                    }
                }
            });
        }

        function setupRealTimeValidation() {
            const cantidadInput = document.getElementById('cantidadEntrada');
            if (cantidadInput) {
                cantidadInput.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    const isValid = value > 0;

                    if (isValid) {
                        e.target.classList.remove('border-red-500');
                        e.target.classList.add('border-green-500');
                        updateEntryPreview();
                    } else {
                        e.target.classList.remove('border-green-500');
                        e.target.classList.add('border-red-500');
                    }
                });
            }

            // Validaci�n de fecha
            const fechaInput = document.getElementById('fechaEntrada');
            if (fechaInput) {
                fechaInput.addEventListener('change', (e) => {
                    const selectedDate = new Date(e.target.value);
                    const today = new Date();
                    const maxDate = new Date();
                    maxDate.setDate(today.getDate() + 30); // M�ximo 30 d�as en el futuro

                    if (selectedDate > maxDate) {
                        e.target.classList.add('border-yellow-500');
                        showToast('⚠️ La fecha seleccionada est� muy lejos en el futuro', 'warning');
                    } else {
                        e.target.classList.remove('border-yellow-500');
                        updateEntryPreview();
                    }
                });
            }
        }

        function updateEntryPreview() {
            const codigo = document.getElementById('codigoProducto')?.value;
            const nombre = document.getElementById('nombreProducto')?.value;
            const cantidad = document.getElementById('cantidadEntrada')?.value;
            const fecha = document.getElementById('fechaEntrada')?.value;
            const unidad = document.getElementById('unidadProducto')?.value;

            if (codigo && nombre && cantidad && fecha) {
                const resumen = document.getElementById('resumenEntrada');
                const textoResumen = document.getElementById('textoResumen');

                if (resumen && textoResumen) {
                    textoResumen.innerHTML = `
                        <strong>${nombre}</strong> (${codigo})<br>
                        Cantidad: <strong>${cantidad} ${unidad || 'unidades'}</strong><br>
                        Fecha: <strong>${new Date(fecha).toLocaleDateString('es-ES')}</strong>
                    `;
                    resumen.style.display = 'block';
                }
            }
        }

        // Funci�n auxiliar para debounce
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Funci�n para mostrar mensajes toast
        function showToast(message, type = 'info') {
            // Implementaci�n simple de toast
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-500' :
                    type === 'warning' ? 'bg-yellow-500' :
                        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                } text-white`;
            toast.textContent = message;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Funci�n para ordenar tabla
        function sortTable(column) {
            console.log(`Ordenando por: ${column}`);
            // Aqu� se implementar�a la l�gica de ordenamiento
        } function setupAutoRefresh() {
            let autoRefreshEnabled = false;
            let autoRefreshInterval;

            const autoRefreshBtn = document.getElementById('autoRefresh');
            if (autoRefreshBtn) {
                autoRefreshBtn.addEventListener('click', () => {
                    autoRefreshEnabled = !autoRefreshEnabled;

                    if (autoRefreshEnabled) {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: ON</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');

                        autoRefreshInterval = setInterval(() => {
                            refreshTableData();
                            updateLastSyncTime();
                        }, 30000); // Cada 30 segundos

                        showToast('✅ Auto-actualizaci�n activada', 'success');
                    } else {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: OFF</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');

                        if (autoRefreshInterval) {
                            clearInterval(autoRefreshInterval);
                        }
                        showToast('⏸️ Auto-actualizaci�n desactivada', 'info');
                    }
                });
            }
        }

        function updateLastSyncTime() {
            const ultimaSync = document.getElementById('ultimaSync');
            if (ultimaSync) {
                const now = new Date();
                ultimaSync.textContent = now.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function setupLoadingEffects() {
            // Interceptar clicks en botones de b�squeda
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        const textId = btnId.replace('buscar', 'btn') + 'Text';
                        showButtonLoading(btn, textId, '🔍 Buscando...');

                        // Simular b�squeda exitosa
                        setTimeout(() => {
                            hideButtonLoading(btn, textId, '🔍 Buscar');
                            updateSearchHistory(btnId);
                        }, 2000);
                    });
                }
            });

            // Interceptar registro de entrada
            const registrarBtn = document.getElementById('registrarEntrada');
            if (registrarBtn) {
                registrarBtn.addEventListener('click', () => {
                    showButtonLoading(registrarBtn, 'btnRegistrarText', '⏳ Registrando entrada...');

                    setTimeout(() => {
                        hideButtonLoading(registrarBtn, 'btnRegistrarText', '✅ Registrar Entrada');
                        showToast('✅ Entrada registrada exitosamente', 'success');
                        updateEntryCounter();
                    }, 3000);
                });
            }

            // Interceptar sincronizaci�n
            const sincBtn = document.getElementById('sincronizarEntradas');
            if (sincBtn) {
                sincBtn.addEventListener('click', () => {
                    showButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizando con servidor...');

                    setTimeout(() => {
                        hideButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizar con Servidor');
                        showToast('✅ Sincronizaci�n completada', 'success');
                        updateLastSyncTime();
                    }, 4000);
                });
            }

            // Interceptar actualizaci�n de tabla
            const refreshBtn = document.getElementById('refreshTable');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    const indicator = document.getElementById('tableLoadingIndicator');
                    if (indicator) {
                        indicator.style.display = 'block';
                        setTimeout(() => {
                            indicator.style.display = 'none';
                            showToast('🔄 Tabla actualizada', 'info');
                        }, 2000);
                    }
                });
            }
        }

        function updateSearchHistory(searchType) {
            const busquedaReciente = document.getElementById('busquedaReciente');
            const textoUltimaBusqueda = document.getElementById('textoUltimaBusqueda');

            if (busquedaReciente && textoUltimaBusqueda) {
                const tipoTexto = {
                    'buscarPorCodigo': 'B�squeda por c�digo',
                    'buscarPorNombre': 'B�squeda por nombre',
                    'buscarPorMarca': 'B�squeda por marca'
                };

                const now = new Date().toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                textoUltimaBusqueda.textContent = `${tipoTexto[searchType]} a las ${now}`;
                busquedaReciente.style.display = 'block';

                // Ocultar despu�s de 10 segundos
                setTimeout(() => {
                    busquedaReciente.style.display = 'none';
                }, 10000);
            }
        }

        function updateEntryCounter() {
            const contador = document.getElementById('contadorEntradas');
            const totalEntradas = document.getElementById('totalEntradas');

            if (contador) {
                const currentCount = parseInt(contador.textContent.match(/\d+/) || [0])[0];
                const newCount = currentCount + 1;
                contador.textContent = `Total: ${newCount} entradas registradas`;

                // Animaci�n del contador
                contador.classList.add('animate-pulse');
                setTimeout(() => {
                    contador.classList.remove('animate-pulse');
                }, 1000);
            }

            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                totalEntradas.textContent = currentCount + 1;
            }
        }

        function showButtonLoading(button, textElementId = null, loadingText = 'Cargando...') {
            button.disabled = true;
            button.classList.add('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
                }
            } else {
                button.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
            }
        }

        function hideButtonLoading(button, textElementId = null, originalText = 'Buscar') {
            button.disabled = false;
            button.classList.remove('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.textContent = originalText;
                }
            } else {
                button.textContent = originalText;
            }
        } function setupEntranceAnimations() {
            // Animar elementos cuando aparecen
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-fade-in-up');

                        // A�adir un peque�o retraso para elementos consecutivos
                        const siblings = Array.from(entry.target.parentElement.children);
                        const index = siblings.indexOf(entry.target);
                        entry.target.style.animationDelay = `${index * 0.1}s`;
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            // Observar todas las tarjetas
            document.querySelectorAll('.card-hover').forEach(card => {
                observer.observe(card);
            });

            // Animaciones para botones al hacer hover
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('mouseenter', () => {
                    if (!button.disabled) {
                        button.style.transform = 'translateY(-2px)';
                        button.style.boxShadow = '0 10px 25px rgba(0,0,0,0.2)';
                    }
                });

                button.addEventListener('mouseleave', () => {
                    button.style.transform = 'translateY(0)';
                    button.style.boxShadow = '';
                });
            });

            // Animaci�n de aparecer para modales
            const scanner = document.getElementById('scanner-container');
            if (scanner) {
                const originalDisplay = scanner.style.display;
                scanner.addEventListener('click', (e) => {
                    if (e.target === scanner) {
                        // Cerrar al hacer click fuera del modal
                        hideModal(scanner);
                    }
                });
            }
        }

        function showModal(modal) {
            modal.style.display = 'flex';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.transition = 'all 0.3s ease';
                modal.style.opacity = '1';
                modal.style.transform = 'scale(1)';
            }, 10);
        }

        function hideModal(modal) {
            modal.style.transition = 'all 0.3s ease';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function setupDynamicNotifications() {
            // Mostrar formulario solo cuando se selecciona un producto
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        setTimeout(() => {
                            const productForm = document.getElementById('productForm');
                            const codigoProducto = document.getElementById('codigoProducto');

                            if (productForm && codigoProducto && codigoProducto.value) {
                                // Mostrar formulario con animaci�n
                                productForm.style.display = 'block';
                                productForm.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });

                                // Animaci�n de aparici�n
                                productForm.style.opacity = '0';
                                productForm.style.transform = 'translateY(30px)';

                                setTimeout(() => {
                                    productForm.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                                    productForm.style.opacity = '1';
                                    productForm.style.transform = 'translateY(0)';

                                    // Destacar el formulario brevemente
                                    productForm.classList.add('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    setTimeout(() => {
                                        productForm.classList.remove('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    }, 2000);
                                }, 100);

                                // Actualizar stock actual (simulado)
                                updateStockDisplay();

                                // Focus en el primer campo editable
                                const cantidadInput = document.getElementById('cantidadEntrada');
                                if (cantidadInput) {
                                    setTimeout(() => cantidadInput.focus(), 800);
                                }
                            }
                        }, 500);
                    });
                }
            });

            // Feedback visual en inputs con animaciones mejoradas
            document.querySelectorAll('input, textarea, select').forEach(input => {
                input.addEventListener('focus', (e) => {
                    e.target.style.transform = 'scale(1.02)';
                    e.target.style.transition = 'transform 0.2s ease';

                    // A�adir indicador de foco
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '#10B981';
                        label.style.transform = 'scale(1.05)';
                        label.style.transition = 'all 0.2s ease';
                    }
                });

                input.addEventListener('blur', (e) => {
                    e.target.style.transform = 'scale(1)';

                    // Restaurar label
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '';
                        label.style.transform = 'scale(1)';
                    }
                });

                // Validaci�n visual en tiempo real
                if (input.type === 'number') {
                    input.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        if (value > 0) {
                            e.target.style.borderColor = '#10B981';
                            e.target.style.backgroundColor = '#F0FDF4';
                        } else if (e.target.value) {
                            e.target.style.borderColor = '#EF4444';
                            e.target.style.backgroundColor = '#FEF2F2';
                        } else {
                            e.target.style.borderColor = '';
                            e.target.style.backgroundColor = '';
                        }
                    });
                }
            });

            // Animaciones para las filas de la tabla
            setupTableRowAnimations();

            // Notificaciones de estado del sistema
            setupSystemStatusNotifications();
        }

        function updateStockDisplay() {
            const stockActual = document.getElementById('stockActual');
            if (stockActual) {
                // Simular datos de stock
                const stock = Math.floor(Math.random() * 500) + 10;
                stockActual.textContent = stock;

                // Animaci�n del contador
                stockActual.style.transform = 'scale(1.2)';
                stockActual.style.transition = 'transform 0.3s ease';

                setTimeout(() => {
                    stockActual.style.transform = 'scale(1)';
                }, 300);

                // Color basado en el stock
                if (stock < 50) {
                    stockActual.className = 'text-2xl font-bold text-red-600';
                    stockActual.parentElement.className = 'bg-red-50 p-4 rounded-lg border border-red-200';
                } else if (stock < 100) {
                    stockActual.className = 'text-2xl font-bold text-yellow-600';
                    stockActual.parentElement.className = 'bg-yellow-50 p-4 rounded-lg border border-yellow-200';
                } else {
                    stockActual.className = 'text-2xl font-bold text-green-600';
                    stockActual.parentElement.className = 'bg-green-50 p-4 rounded-lg border border-green-200';
                }
            }
        }

        function setupTableRowAnimations() {
            // Observador para filas de tabla
            const tableObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeName === 'TR' && !node.classList.contains('text-center')) {
                                // Animar nueva fila
                                node.style.opacity = '0';
                                node.style.transform = 'translateX(-20px)';

                                setTimeout(() => {
                                    node.style.transition = 'all 0.5s ease';
                                    node.style.opacity = '1';
                                    node.style.transform = 'translateX(0)';
                                }, 100);

                                // Efectos hover mejorados
                                node.addEventListener('mouseenter', () => {
                                    node.style.backgroundColor = '#F0FDF4';
                                    node.style.transform = 'scale(1.01)';
                                    node.style.transition = 'all 0.2s ease';
                                    node.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
                                });

                                node.addEventListener('mouseleave', () => {
                                    node.style.backgroundColor = '';
                                    node.style.transform = 'scale(1)';
                                    node.style.boxShadow = '';
                                });
                            }
                        });
                    }
                });
            });

            const tableBody = document.getElementById('tablaEntradasBody');
            if (tableBody) {
                tableObserver.observe(tableBody, { childList: true });
            }
        }

        function setupSystemStatusNotifications() {
            // Notificaciones peri�dicas de estado
            setInterval(() => {
                if (Math.random() < 0.1) { // 10% de probabilidad cada minuto
                    const messages = [
                        '✅ Sistema funcionando correctamente',
                        '📊 Base de datos sincronizada',
                        '🔄 Datos actualizados autom�ticamente',
                        '📈 Rendimiento �ptimo del sistema'
                    ];

                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    showToast(randomMessage, 'success');
                }
            }, 60000); // Cada minuto
        } function refreshTableData() {
            const indicator = document.getElementById('tableLoadingIndicator');
            if (indicator) {
                indicator.style.display = 'block';

                // Simular carga de datos
                setTimeout(() => {
                    indicator.style.display = 'none';
                    updateLastSyncTime();

                    // Actualizar contador si hay datos
                    const tbody = document.getElementById('tablaEntradasBody');
                    if (tbody) {
                        const rows = tbody.querySelectorAll('tr:not(.text-center)');
                        const contador = document.getElementById('contadorEntradas');
                        if (contador) {
                            contador.textContent = `Total: ${rows.length} entradas registradas`;
                        }
                    }
                }, 2000);
            }

            console.log('Actualizando datos de la tabla...');
        }

        // Efectos adicionales para las filas de la tabla
        function addTableRowEffects() {
            document.querySelectorAll('#tablaEntradasBody tr:not(.text-center)').forEach(row => {
                // Eliminar eventos anteriores para evitar duplicados
                row.removeEventListener('mouseenter', handleRowHover);
                row.removeEventListener('mouseleave', handleRowLeave);

                // A�adir nuevos eventos
                row.addEventListener('mouseenter', handleRowHover);
                row.addEventListener('mouseleave', handleRowLeave);
            });
        }

        function handleRowHover(e) {
            e.target.style.backgroundColor = '#F0FDF4';
            e.target.style.transform = 'scale(1.01)';
            e.target.style.transition = 'all 0.2s ease';
            e.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        }

        function handleRowLeave(e) {
            e.target.style.backgroundColor = '';
            e.target.style.transform = 'scale(1)';
            e.target.style.boxShadow = '';
        }

        // Inicializar mejoras adicionales al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                addTableRowEffects();
                initializeAdditionalFeatures();
            }, 1000);
        });

        // Caracter�sticas adicionales
        function initializeAdditionalFeatures() {
            // Configurar filtros de fecha inteligentes
            setupIntelligentDateFilters();

            // Configurar exportaci�n mejorada
            setupEnhancedExport();

            // Configurar modo expandido de tabla
            setupTableExpandMode();

            // Configurar estad�sticas en tiempo real
            setupRealTimeStats();
        }

        function setupIntelligentDateFilters() {
            const filtrarPorFecha = document.getElementById('filtrarPorFecha');
            if (filtrarPorFecha) {
                filtrarPorFecha.addEventListener('click', () => {
                    const fechaDesde = document.getElementById('fechaDesde').value;
                    const fechaHasta = document.getElementById('fechaHasta').value;

                    if (fechaDesde && fechaHasta) {
                        const rangoFechas = document.getElementById('rangoFechas');
                        if (rangoFechas) {
                            const desde = new Date(fechaDesde).toLocaleDateString('es-ES');
                            const hasta = new Date(fechaHasta).toLocaleDateString('es-ES');
                            rangoFechas.textContent = `Mostrando entradas del ${desde} al ${hasta}`;
                        }
                        showToast(`📅 Filtro aplicado: ${fechaDesde} a ${fechaHasta}`, 'info');
                    } else {
                        showToast('⚠️ Seleccione ambas fechas para filtrar', 'warning');
                    }
                });
            }
        }

        function setupEnhancedExport() {
            const exportBtn = document.getElementById('exportVisible');
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    showToast('📥 Preparando exportaci�n...', 'info');

                    setTimeout(() => {
                        showToast('✅ Datos exportados exitosamente', 'success');
                    }, 2000);
                });
            }
        }

        function setupTableExpandMode() {
            const expandBtn = document.getElementById('expandirTabla');
            let isExpanded = false;

            if (expandBtn) {
                expandBtn.addEventListener('click', () => {
                    const tableContainer = expandBtn.closest('.bg-white');

                    if (!isExpanded) {
                        tableContainer.classList.add('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Contraer</span>';
                        isExpanded = true;
                        showToast('⛶ Tabla expandida', 'info');
                    } else {
                        tableContainer.classList.remove('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Expandir</span>';
                        isExpanded = false;
                        showToast('⛶ Tabla contra�da', 'info');
                    }
                });
            }
        }

        function setupRealTimeStats() {
            // Actualizar estad�sticas cada 30 segundos
            setInterval(() => {
                updateSystemStats();
            }, 30000);

            // Actualizaci�n inicial
            updateSystemStats();
        }

        function updateSystemStats() {
            // Simular actualizaci�n de estad�sticas
            const totalEntradas = document.getElementById('totalEntradas');
            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                if (Math.random() < 0.3) { // 30% de probabilidad de incremento
                    totalEntradas.textContent = currentCount + Math.floor(Math.random() * 3) + 1;
                }
            }
        }

        // CSS para animaciones adicionales
        const additionalStyles = `
            <style>
                .animate-fade-in-up {
                    animation: fadeInUp 0.6s ease-out forwards;
                }
                
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(30px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .status-indicator {
                    display: inline-block;
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    margin-right: 6px;
                }
                
                .status-success {
                    background-color: #10B981;
                    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
                }
                
                .status-error {
                    background-color: #EF4444;
                    box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
                }
                
                .card-hover {
                    transition: all 0.3s ease;
                }
                
                .card-hover:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                }
                
                .loading-spinner {
                    border: 2px solid #f3f3f3;
                    border-top: 2px solid #3498db;
                    border-radius: 50%;
                    width: 16px;
                    height: 16px;
                    animation: spin 1s linear infinite;
                }
                
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                
                /* Efectos de hover mejorados */
                button:not(:disabled):hover {
                    transform: translateY(-1px) !important;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                }
                
                input:focus, textarea:focus, select:focus {
                    transform: scale(1.01);
                    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
                }
                
                /* Animaciones para modales */
                .modal-enter {
                    animation: modalEnter 0.3s ease-out forwards;
                }
                
                @keyframes modalEnter {
                    from {
                        opacity: 0;
                        transform: scale(0.9);
                    }
                    to {
                        opacity: 1;
                        transform: scale(1);
                    }
                }
                
                /* Efectos de tabla mejorados */
                table th {
                    position: relative;
                    overflow: hidden;
                }
                
                table th:hover::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    animation: shimmer 1.5s ease-in-out;
                }
                
                @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
            </style>
        `;

        // A�adir estilos al head
        document.head.insertAdjacentHTML('beforeend', additionalStyles);

        // Llamar despu�s de cargar datos en la tabla
        window.addEventListener('load', () => {
            setTimeout(addTableRowEffects, 1000);
        });

        // Funci�n para convertir gui�n a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Funci�n para aplicar la conversi�n a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversi�n a los campos de c�digo cuando se cargue la p�gina
        document.addEventListener('DOMContentLoaded', function() {
            const busquedaCodigo = document.getElementById('busquedaCodigo');
            const codigoProducto = document.getElementById('codigoProducto');
            const filtroCodigo = document.getElementById('filtroCodigo');
            
            aplicarConversionCodigo(busquedaCodigo);
            aplicarConversionCodigo(codigoProducto);
            aplicarConversionCodigo(filtroCodigo);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Preconteo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <script src="../librer�as/JsBarcode.all.min.js"></script>
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>

    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    </script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-xl font-bold">Reporte de Preconteo</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <nav class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-xl font-bold">GestorInventory</h1>
            <a href="./main.html" class="hover:underline">Regresar</a>
            <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
                Men�
            </button>
        </div>
    </nav>

    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold text-center mb-6">Generador de Reportes de Preconteo</h1>

        <div class="mb-6 bg-white p-4 rounded shadow">
            <div class="mb-4">
                <label class="block font-semibold mb-2">Selecciona una o varias �reas:</label>
                <div id="areasContainer" class="grid grid-cols-2 md:grid-cols-3 gap-2 border rounded p-3">
                    <!-- Las �reas se cargar�n din�micamente como checkboxes -->
                    <div class="flex items-center">
                        <input type="checkbox" id="area-todas" value="todas" class="areaCheckbox mr-2" checked>
                        <label for="area-todas">Todas las �reas</label>
                    </div>
                </div>
                <div class="mt-2 text-right">
                    <button id="aplicarFiltroBtn" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">
                        Aplicar filtro
                    </button>
                </div>
            </div>

            <div id="loadingIndicator" class="hidden">
                <div class="flex items-center justify-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                    <span class="ml-2">Cargando productos...</span>
                </div>
            </div>

            <div id="productosList" class="mt-4">
                <h2 class="text-xl font-semibold mb-2">Lista de productos:</h2>
                <ul id="productosContainer" class="list-decimal pl-6 space-y-1">
                    <!-- Los productos se cargar�n din�micamente -->
                </ul>
            </div>
        </div>

        <div class="text-center">
            <button id="generarReporteBtn"
                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded">
                GENERAR REPORTE DE PRECONTEO
            </button>
        </div>

        <!-- Contenedor invisible para generar c�digos de barras -->
        <div id="barcodeContainer" class="hidden"></div>
    </div>

    <!-- Cargar nuestro script principal despu�s de asegurarnos que las dependencias est�n cargadas -->
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/reports/rep.js"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Recuperar Contraseña</h1>
            
            <form id="formPasswordReset" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Correo Electrónico</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="tu@email.com"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Enviar Enlace de Recuperación
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Recordaste tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restablecer Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Restablecer Contraseña</h1>
            
            <form id="formResetPassword" class="space-y-4">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Nueva Contraseña</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Ingresa tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-300 mb-2">Confirmar Contraseña</label>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        name="confirmPassword" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Confirma tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Restablecer Contraseña
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Ya tienes tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }

        // Manejar reset de contraseña
        document.addEventListener('DOMContentLoaded', async () => {
            const formResetPassword = document.getElementById('formResetPassword');
            
            if (formResetPassword) {
                formResetPassword.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    // Validar que las contraseñas coincidan
                    if (password !== confirmPassword) {
                        alert('Las contraseñas no coinciden');
                        return;
                    }
                    
                    // Validar longitud mínima
                    if (password.length < 6) {
                        alert('La contraseña debe tener al menos 6 caracteres');
                        return;
                    }

                    try {
                        // Obtener el hash del enlace de reseteo de la URL
                        const hash = window.location.hash;
                        
                        if (!hash) {
                            alert('Enlace de recuperación inválido');
                            return;
                        }

                        // Esperar a que Supabase esté disponible
                        let attempts = 0;
                        while (!window.supabase && attempts < 50) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }

                        if (!window.supabase) {
                            alert('Error: No se pudo cargar Supabase');
                            return;
                        }

                        const { error } = await window.supabase.auth.updateUser({
                            password: password
                        });

                        if (error) {
                            alert('Error al actualizar contraseña: ' + error.message);
                            return;
                        }

                        alert('Contraseña actualizada correctamente');
                        window.location.href = '../index.html';
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al restablecer contraseña');
                    }
                });
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesti�n de Archivos - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css" />
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css" />
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Gesti�n de Archivos</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">
                Cerrar
            </button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <div id="archivos" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Gesti�n de Archivos</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Men�
        </button>

        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">
                    Cargar Archivo CSV:
                </label>
                <input type="file" id="csvFile" accept=".csv"
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />
                <div class="mb-4">
                    <button id="descargarCSV"
                        class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                        Exportar Datos a CSV
                    </button>
                </div>
                <div class="mb-4">
                    <button id="resetearBaseDatos"
                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                        Resetear Base de Datos
                    </button>
                </div>
            </div>
        </div>

        <button class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded" id="sync-down-btn">
            Sincronizar en Bajada
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4">Base de Datos Actual</h2>
        <div class="overflow-x-auto">
            <table class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">C�digo</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categor�a</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Unidad</th>
                    </tr>
                </thead>
                <tbody id="databaseBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const menuToggle = document.getElementById("menuToggle");
            const sideMenu = document.getElementById("sideMenu");
            const closeMenu = document.getElementById("closeMenu");
            const menuRoutes = document.getElementById("menuRoutes");

            const routes = [
                { name: "Consulta de Producto", path: "./consulta.html" },
                { name: "Editar Producto", path: "./editar.html" },
                { name: "Inventario", path: "./inventario.html" },
                { name: "Reporte para Inventario", path: "./report.html" },
                { name: "Agregar Productos", path: "./agregar.html" }
            ];

            routes.forEach((route) => {
                const li = document.createElement("li");
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            menuToggle.addEventListener("click", () => {
                sideMenu.classList.remove("-translate-x-full");
            });

            closeMenu.addEventListener("click", () => {
                sideMenu.classList.add("-translate-x-full");
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Nuevo Producto - Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Agregar Nuevo Producto</h1>

    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Agregar Nuevo Producto</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Pestañas -->
        <div class="mb-6 mt-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-individual"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button active">
                        Producto Individual
                    </button>
                    <button id="tab-tabla"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Agregado por Tabla
                    </button>
                    <button id="tab-csv"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Carga por CSV
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenido de Pestañas -->

        <!-- Pestaña Individual (formulario original) -->
        <div id="content-individual" class="tab-content">
            <form id="formAgregarProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo">
                        Código/PLU:
                    </label>
                    <div class="flex">
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            placeholder="Codigo" id="codigoAgregar" type="text" required>
                        <button type="button" id="escanearBtnAgregar"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                            Escanear Código
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nombre">
                        Nombre:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="nombre" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="categoria">
                        Categoría:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="categoria" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="marca">
                        Marca/Proveedor:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="marca" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="marca">
                        Unidad:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="unidad" type="text" required>
                </div>

                <!-- Campo para producto primario (aparece solo cuando unidad es Kg) -->
                <div id="producto-primario-container" class="mb-4" style="display: none;">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-3">
                        <div class="flex items-center mb-2">
                            <svg class="w-5 h-5 text-yellow-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                    clip-rule="evenodd"></path>
                            </svg>
                            <span class="text-yellow-800 font-medium text-sm">Nota importante:</span>
                        </div>
                        <p class="text-yellow-700 text-sm">
                            Si el producto es un subproducto y cuenta con un producto primario,
                            ingresa el código del producto primario en el campo de abajo.
                        </p>
                    </div>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="producto-primario">
                        Código del Producto Primario (opcional):
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="producto-primario" type="text" placeholder="Codigo del Producto Primario">
                </div>
                <div class="flex items-center justify-between">
                    <button
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="submit">
                        Agregar Producto
                    </button>
                </div>
            </form>
        </div>

        <!-- Pestaña Tabla (nueva funcionalidad) -->
        <div id="content-tabla" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <!-- Sección Producto Primario -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">Producto Primario</h3>

                    <!-- Campo código producto primario -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo-primario">
                            Código de Producto Primario:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            placeholder="Ingrese código del producto primario" id="codigo-primario" type="text"
                            required>
                    </div>

                    <!-- Información del producto primario -->
                    <div id="info-producto-primario" class="grid grid-cols-1 md:grid-cols-2 gap-4"
                        style="display: none;">
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Nombre:</label>
                            <input id="primario-nombre"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Categoría:</label>
                            <input id="primario-categoria"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Marca/Proveedor:</label>
                            <input id="primario-marca"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Unidad:</label>
                            <input id="primario-unidad"
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type="text" required>
                        </div>
                    </div>
                </div>

                <!-- Sección Subproductos -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">Subproductos</h3>
                        <button id="agregar-fila-btn"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                            style="display: none;">
                            + Agregar Nueva Fila
                        </button>
                    </div>

                    <div id="subproductos-container" class="space-y-4">
                        <!-- Las filas de subproductos se generarán dinámicamente -->
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="flex justify-between items-center pt-6 border-t">
                    <button id="limpiar-tabla-btn"
                        class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                        Limpiar Todo
                    </button>
                    <button id="guardar-tabla-btn"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
                        style="display: none;">
                        Guardar Tabla de Productos
                    </button>
                </div>
            </div>
        </div>


        <!-- Pestaña CSV -->
        <div id="content-csv" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Carga Masiva por CSV</h3>
                <form id="csv-upload-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">Selecciona archivo
                            CSV:</label>
                        <input type="file" id="csvFile" accept=".csv"
                            class="block w-full text-sm text-gray-700 border border-gray-300 rounded py-2 px-3"
                            required />
                    </div>
                    <button type="submit"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Cargar y
                        Previsualizar</button>
                </form>
                <div id="csv-preview" class="mt-6" style="display:none;">
                    <h4 class="text-lg font-semibold mb-2">Vista previa de datos</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200" id="csv-table"></table>
                    </div>
                    <button id="csv-upload-confirm"
                        class="mt-4 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Subir al
                        sistema</button>
                </div>
                <div id="csv-error" class="mt-4 text-red-600 font-semibold"></div>
            </div>
        </div>

        <div id="mensaje" class="mt-4"></div>

        <div id="scanner-container-agregar" class="mt-4" style="display: none;">
            <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
            <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script type="module" src="../js/ui/tabla-productos.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            // Reemplazar cada guión (-) con 6 ceros (000000)
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;

            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);

                // Solo actualizar si hay diferencia (para evitar bucles infinitos)
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;

                    // Ajustar posición del cursor
                    // Si se agregaron caracteres, mover el cursor proporcionalmente
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            // También aplicar en blur para asegurar conversión final
            input.addEventListener('blur', function (e) {
                const valorConvertido = convertirGuionACeros(e.target.value);
                e.target.value = valorConvertido;
            });
        }

        // Hacer la función disponible globalmente para tabla-productos.js
        window.aplicarConversionCodigoAInput = aplicarConversionCodigo;

        // Script para pestañas
        document.addEventListener('DOMContentLoaded', function () {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            function switchTab(targetTab) {
                // Remover clase activa de todos los botones
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });

                // Ocultar todo el contenido
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });

                // Activar pestaña seleccionada
                const activeButton = document.getElementById(`tab-${targetTab}`);
                activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');

                // Mostrar contenido correspondiente
                document.getElementById(`content-${targetTab}`).style.display = 'block';
            }

            // Event listeners para los botones de pestañas
            document.getElementById('tab-individual').addEventListener('click', () => switchTab('individual'));
            document.getElementById('tab-tabla').addEventListener('click', () => switchTab('tabla'));
            document.getElementById('tab-csv').addEventListener('click', () => switchTab('csv'));
            // CSV: Lógica de carga y validación
            const csvForm = document.getElementById('csv-upload-form');
            const csvFileInput = document.getElementById('csvFile');
            const csvPreview = document.getElementById('csv-preview');
            const csvTable = document.getElementById('csv-table');
            const csvError = document.getElementById('csv-error');
            const csvUploadConfirm = document.getElementById('csv-upload-confirm');
            let csvData = [];

            function parseCSV(text) {
                const lines = text.trim().split(/\r?\n/);
                const headers = lines[0].split(',').map(h => h.trim());
                const rows = lines.slice(1).map(line => {
                    // Soporta campos con comas entre comillas
                    const regex = /(?:"([^"]*)")|([^,]+)/g;
                    let match, arr = [];
                    let i = 0;
                    while ((match = regex.exec(line)) !== null) {
                        arr.push(match[1] !== undefined ? match[1] : match[2]);
                        i++;
                    }
                    // Si no hay comillas, fallback split normal
                    if (arr.length === 0) arr = line.split(',');
                    return arr.map(x => x ? x.trim() : '');
                });
                return { headers, rows };
            }

            function validateHeaders(headers) {
                const required = ['Codigo', 'Nombre', 'Categoria', 'Marca', 'Unidad'];
                return required.every(h => headers.includes(h));
            }

            csvForm.addEventListener('submit', function (e) {
                e.preventDefault();
                csvError.textContent = '';
                csvPreview.style.display = 'none';
                csvTable.innerHTML = '';
                csvData = [];
                const file = csvFileInput.files[0];
                if (!file) {
                    csvError.textContent = 'Selecciona un archivo CSV.';
                    return;
                }
                const reader = new FileReader();
                reader.onload = function (evt) {
                    const text = evt.target.result;
                    const { headers, rows } = parseCSV(text);
                    if (!validateHeaders(headers)) {
                        csvError.textContent = 'El archivo debe contener los campos: Codigo, Nombre, Categoria, Marca y Unidad.';
                        return;
                    }
                    // Mostrar tabla
                    let html = '<thead><tr>' + headers.map(h => `<th class="px-2 py-1 border">${h}</th>`).join('') + '</tr></thead><tbody>';
                    rows.forEach(row => {
                        html += '<tr>' + row.map(cell => `<td class="px-2 py-1 border">${cell}</td>`).join('') + '</tr>';
                    });
                    html += '</tbody>';
                    csvTable.innerHTML = html;
                    csvPreview.style.display = 'block';
                    csvData = rows.map(row => {
                        let obj = {};
                        headers.forEach((h, i) => obj[h] = row[i]);
                        return obj;
                    });
                };
                reader.readAsText(file);
            });

            csvUploadConfirm.addEventListener('click', function () {
                if (!csvData.length) {
                    csvError.textContent = 'No hay datos para subir.';
                    return;
                }
                // Lógica real para subir a Supabase, omitiendo los que ya existen y agregando usuario_id
                (async () => {
                    try {
                        if (!window.getSupabase) throw new Error('No se encontró getSupabase.');
                        const supabase = await window.getSupabase();
                        // Obtener usuario_id y categoria_id de localStorage
                        const userId = localStorage.getItem('usuario_id');
                        const categoriaId = localStorage.getItem('categoria_id');
                        if (!userId) throw new Error('No se pudo obtener el usuario autenticado.');
                        if (!categoriaId) throw new Error('No se pudo obtener la categoría del usuario.');
                        // 1. Obtener todos los códigos existentes en Supabase
                        const { data: existentes, error: errorExist } = await supabase.from('productos').select('codigo');
                        if (errorExist) throw errorExist;
                        const codigosExistentes = new Set((existentes || []).map(p => p.codigo));
                        // 2. Filtrar productos nuevos
                        const nuevos = csvData.filter(prod => !codigosExistentes.has(prod.Codigo));
                        let omitidos = csvData.length - nuevos.length;
                        // 3. Insertar los nuevos
                        let insertados = 0;
                        if (nuevos.length > 0) {
                            // Mapear campos a los nombres de la tabla e incluir usuario_id y categoria_id
                            const productosInsertar = nuevos.map(prod => ({
                                codigo: prod.Codigo,
                                nombre: prod.Nombre,
                                categoria: prod.Categoria,
                                marca: prod.Marca,
                                unidad: prod.Unidad,
                                usuario_id: userId,
                                categoria_id: categoriaId
                            }));
                            const { error: errorInsert } = await supabase.from('productos').insert(productosInsertar);
                            if (errorInsert) throw errorInsert;
                            insertados = productosInsertar.length;
                        }
                        Swal.fire({
                            icon: 'success',
                            title: 'Carga completada',
                            html: `<b>${insertados}</b> productos agregados.<br><b>${omitidos}</b> productos ya existían y fueron omitidos.`
                        });
                        csvPreview.style.display = 'none';
                        csvTable.innerHTML = '';
                        csvData = [];
                    } catch (err) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error al subir productos',
                            text: err.message || err
                        });
                    }
                })();
            });

            // Aplicar conversión de guión a ceros en campos de código
            // Pestaña Individual
            const codigoIndividual = document.getElementById('codigoAgregar');
            const productoPrimarioIndividual = document.getElementById('producto-primario');

            aplicarConversionCodigo(codigoIndividual);
            aplicarConversionCodigo(productoPrimarioIndividual);

            // Pestaña Tabla
            const codigoPrimarioTabla = document.getElementById('codigo-primario');
            aplicarConversionCodigo(codigoPrimarioTabla);

            // Para los subproductos en la tabla (se aplicará dinámicamente cuando se creen)

            // Inicializar funcionalidad de tabla directamente aquí como backup
            setTimeout(() => {
                try {
                    const limpiarBtn = document.getElementById('limpiar-tabla-btn');
                    if (limpiarBtn) {
                        limpiarBtn.addEventListener('click', function () {
                            console.log('Click en limpiar tabla');
                            if (confirm('¿Está seguro de que desea limpiar todos los datos?')) {
                                document.getElementById('codigo-primario').value = '';
                                document.getElementById('info-producto-primario').style.display = 'none';
                                document.getElementById('subproductos-container').innerHTML = '';
                                document.getElementById('agregar-fila-btn').style.display = 'none';
                                document.getElementById('guardar-tabla-btn').style.display = 'none';
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error en backup de inicialización:', error);
                }
            }, 1000);

            // Script original para mostrar/ocultar el campo de producto primario
            const unidadInput = document.getElementById('unidad');
            const productoPrimarioContainer = document.getElementById('producto-primario-container');
            const form = document.getElementById('formAgregarProducto');

            function toggleProductoPrimario() {
                if (unidadInput && productoPrimarioContainer) {
                    const unidad = unidadInput.value.toLowerCase().trim();
                    if (unidad === 'kg') {
                        productoPrimarioContainer.style.display = 'block';
                    } else {
                        productoPrimarioContainer.style.display = 'none';
                        // Limpiar el campo si se oculta
                        const productoPrimarioInput = document.getElementById('producto-primario');
                        if (productoPrimarioInput) {
                            productoPrimarioInput.value = '';
                        }
                    }
                }
            }

            // Agregar event listener al campo unidad
            if (unidadInput) {
                unidadInput.addEventListener('input', toggleProductoPrimario);
                unidadInput.addEventListener('change', toggleProductoPrimario);
            }

            // Ocultar el campo cuando se resetee el formulario
            if (form) {
                form.addEventListener('reset', function () {
                    setTimeout(() => {
                        if (productoPrimarioContainer) {
                            productoPrimarioContainer.style.display = 'none';
                        }
                    }, 10); // Pequeño delay para asegurar que el reset se complete
                });
            }
        });
    </script>
    <style>
        .tab-button.active {
            border-color: #3b82f6;
            color: #2563eb;
        }

        .subproducto-row {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            background-color: #f9fafb;
        }

        .campo-readonly {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }

        .producto-existente {
            background-color: #dcfce7;
            border-color: #16a34a;
        }

        .producto-nuevo {
            background-color: #fef3c7;
            border-color: #d97706;
        }
    </style>
</body>

</html>
<!DOCTYPE html>    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesti�n de Archivos - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css" />
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css" />
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Gesti�n de Archivos</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">
                Cerrar
            </button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <div id="archivos" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Gesti�n de Archivos</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Men�
        </button>

        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">
                    Cargar Archivo CSV:
                </label>
                <input type="file" id="csvFile" accept=".csv"
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />
                <div class="mb-4">
                    <button id="descargarCSV"
                        class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                        Exportar Datos a CSV
                    </button>
                </div>
                <div class="mb-4">
                    <button id="resetearBaseDatos"
                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                        Resetear Base de Datos
                    </button>
                </div>
            </div>
        </div>

        <button class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded" id="sync-down-btn">
            Sincronizar en Bajada
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4">Base de Datos Actual</h2>
        <div class="overflow-x-auto">
            <table class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">C�digo</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categor�a</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Unidad</th>
                    </tr>
                </thead>
                <tbody id="databaseBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const menuToggle = document.getElementById("menuToggle");
            const sideMenu = document.getElementById("sideMenu");
            const closeMenu = document.getElementById("closeMenu");
            const menuRoutes = document.getElementById("menuRoutes");

            const routes = [
                { name: "Consulta de Producto", path: "./consulta.html" },
                { name: "Editar Producto", path: "./editar.html" },
                { name: "Inventario", path: "./inventario.html" },
                { name: "Reporte para Inventario", path: "./report.html" },
                { name: "Agregar Productos", path: "./agregar.html" }
            ];

            routes.forEach((route) => {
                const li = document.createElement("li");
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            menuToggle.addEventListener("click", () => {
                sideMenu.classList.remove("-translate-x-full");
            });

            closeMenu.addEventListener("click", () => {
                sideMenu.classList.add("-translate-x-full");
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraciones - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    <script src="../js/utils/theme-debug.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Configuraciones del Sistema</h1>
        <div class="flex items-center space-x-4">
            <span id="userInfo" class="text-sm font-medium"></span>
        </div>
    </header>

    <div class="container mx-auto mt-8 p-4">
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar al Dashboard</a>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Configuraciones de Usuario -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    Configuraciones de Usuario
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cambiar Contrase�a</label>
                        <button id="changePasswordBtn"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Cambiar Contrase�a
                        </button>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Informaci�n del Perfil</label>
                        <div id="profileInfo" class="bg-gray-50 p-4 rounded border">
                            <!-- Se llenar� din�micamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraciones del Sistema -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Configuraciones del Sistema
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tema de la Aplicaci�n</label>
                        <select id="themeSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="light">Claro</option>
                            <option value="dark">Oscuro</option>
                            <option value="auto">Autom�tico</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Idioma</label>
                        <select id="languageSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="es">Espa�ol</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Google Services -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                        </path>
                    </svg>
                    Credenciales de Google
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Drive API Key</label>
                        <div class="relative">
                            <input type="password" id="googleDriveApiKey"
                                class="w-full border border-gray-300 rounded px-3 py-2 pr-12"
                                placeholder="Ingresa tu API Key de Google Drive">
                            <button type="button" id="toggleDriveKey"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Necesaria para acceder a Google Drive desde la aplicaci�n
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Sheets API Key</label>
                        <div class="relative">
                            <input type="password" id="googleSheetsApiKey"
                                class="w-full border border-gray-300 rounded px-3 py-2 pr-12"
                                placeholder="Ingresa tu API Key de Google Sheets">
                            <button type="button" id="toggleSheetsKey"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Necesaria para integraci�n con Google Sheets</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ID de Google Sheets</label>
                        <input type="text" id="googleSheetsId" class="w-full border border-gray-300 rounded px-3 py-2"
                            placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                        <p class="text-xs text-gray-500 mt-1">ID de la hoja de c�lculo de Google donde se sincronizar�n
                            los datos</p>
                    </div>

                    <div class="flex space-x-2">
                        <button id="testGoogleConnection"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Probar Conexi�n
                        </button>
                        <button id="saveGoogleCredentials"
                            class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                            Guardar Credenciales
                        </button>
                        <button id="clearGoogleCredentials"
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                            Limpiar
                        </button>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mt-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">
                                    <strong>Informaci�n:</strong> Para obtener las API Keys, visita la
                                    <a href="https://console.developers.google.com/" target="_blank"
                                        class="underline hover:text-blue-800">
                                        Google Cloud Console
                                    </a> y habilita las APIs de Google Drive y Google Sheets.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Sincronizaci�n -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                        </path>
                    </svg>
                    Sincronizaci�n
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sincronizaci�n Autom�tica</label>
                        <div class="flex items-center">
                            <input type="checkbox" id="autoSyncEnabled" class="mr-2">
                            <span>Habilitar sincronizaci�n autom�tica</span>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Intervalo de Sincronizaci�n
                            (minutos)</label>
                        <input type="number" id="syncInterval" class="border border-gray-300 rounded px-3 py-2 w-full"
                            min="1" max="60" value="5">
                    </div>

                    <div class="flex space-x-2">
                        <button id="manualSyncBtn"
                            class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                            Sincronizar Ahora
                        </button>
                        <button id="resetSyncBtn"
                            class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">
                            Resetear Configuraci�n
                        </button>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Notificaciones -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-5 5v-5zM7 7h10v10H7V7z"></path>
                    </svg>
                    Notificaciones
                </h2>

                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="browserNotifications" class="mr-2">
                        <span>Notificaciones del navegador</span>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="soundNotifications" class="mr-2">
                        <span>Notificaciones sonoras</span>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="lowStockAlerts" class="mr-2">
                        <span>Alertas de stock bajo</span>
                    </div>
                </div>
            </div>

            <!-- Informaci�n del Sistema -->
            <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Informaci�n del Sistema
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">Versi�n de la Aplicaci�n</h3>
                        <p id="appVersion" class="text-lg">1.0.0</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">Estado de Conexi�n</h3>
                        <p id="connectionStatus" class="text-lg">Conectado</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">�ltima Sincronizaci�n</h3>
                        <p id="lastSync" class="text-lg">--</p>
                    </div>
                </div>

                <div class="mt-4 flex space-x-2">
                    <button id="exportConfigBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Exportar Configuraci�n
                    </button>
                    <button id="importConfigBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Importar Configuraci�n
                    </button>
                    <input type="file" id="importConfigFile" accept=".json" class="hidden">
                </div>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/configuraciones.js"></script>
</body>

</html>
<<<<<<< HEAD=======<!DOCTYPE html>
    <html lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Confirmaci�n de Correo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
        <link href="../librer�as/tailwind.min.css" rel="stylesheet">
        <link href="../css/styles.css" rel="stylesheet">
        <script src="../js/utils/theme-manager.js"></script>
        <script src="../js/ui/theme-toggle.js"></script>
    </head>

    <body class="bg-gray-100 flex items-center justify-center h-screen">
        <div class="container mx-auto p-6 max-w-md bg-white shadow-md rounded-lg text-center">
            <h1 id="statusTitle" class="text-2xl font-bold mb-4 text-blue-600">Verificando tu correo...</h1>
            <p id="statusMessage" class="text-gray-700 mb-6">Por favor, espera un momento mientras procesamos tu
                confirmaci�n.</p>
            <p id="detailsMessage" class="text-gray-600 mb-4"></p>
            <a href="../index.html"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-2 inline-block">
                Ir al Inicio de Sesi�n
            </a>
        </div>
        <script src="../js/ui/mobile-optimizer.js"></script>
        <script type="module">
            import { supabase } from '../js/auth/auth.js';

            const statusTitleEl = document.getElementById('statusTitle');
            const statusMessageEl = document.getElementById('statusMessage');
            const detailsMessageEl = document.getElementById('detailsMessage');

            // Supabase maneja la confirmaci�n del token en el backend antes de redirigir aqu�.
            // Esta p�gina muestra el resultado basado en los par�metros de la URL o el estado de la sesi�n.

            const urlParams = new URLSearchParams(window.location.search);
            const errorDescription = urlParams.get('error_description');
            // const errorCode = urlParams.get('error'); // Podr�as usarlo para errores m�s espec�ficos

            if (errorDescription) {
                statusTitleEl.textContent = 'Error en la Confirmaci�n';
                statusTitleEl.classList.remove('text-blue-600', 'text-green-600');
                statusTitleEl.classList.add('text-red-600');
                statusMessageEl.textContent = 'No pudimos confirmar tu direcci�n de correo electr�nico.';
                detailsMessageEl.textContent = `Detalles: ${decodeURIComponent(errorDescription)}`;
                detailsMessageEl.classList.add('text-red-500');
            } else {
                // Si no hay error en la URL, la confirmaci�n fue procesada por Supabase.
                // Esto puede significar que el correo se confirm� ahora o ya estaba confirmado.
                statusTitleEl.textContent = '¡Correo Verificado!';
                statusTitleEl.classList.remove('text-blue-600', 'text-red-600');
                statusTitleEl.classList.add('text-green-600');
                statusMessageEl.textContent = 'Tu direcci�n de correo electr�nico ha sido verificada exitosamente.';
                detailsMessageEl.textContent = 'Ya puedes cerrar esta ventana e iniciar sesi�n.';

                // onAuthStateChange puede dar feedback adicional si la confirmaci�n tambi�n inicia sesi�n.
                supabase.auth.onAuthStateChange((event, session) => {
                    if (event === 'SIGNED_IN' && session) {
                        detailsMessageEl.textContent = 'Has iniciado sesi�n autom�ticamente. ¡Bienvenido!';
                    } else if (event === 'USER_UPDATED' && session?.user?.email_confirmed_at) {
                        // El correo est� confirmado, el mensaje por defecto ya es apropiado.
                        // Puedes a�adir algo m�s si es necesario.
                    }
                });
            }
        </script>
    </body>

    </html>
    >>>>>>> 1e3239b (feat: A�adir enlace para recuperaci�n de contrase�a en la p�gina de inicio de sesi�n y mejorar
    mensajes de confirmaci�n de correo)
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Producto - Sistema de Gestión de Productos</title>
    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <!-- Cambiamos Quagga por Html5QrCode -->
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../librerías/sweetalert2@11.js"></script>
    <!-- Añadir JsBarcode para códigos de barra -->
    <script src="../librerías/JsBarcode.all.min.js"></script>
    <!-- Añadir jsPDF para generación de PDFs -->
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Consulta de Producto</h1>

    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="consulta" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Consulta de Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">Menú</button>

        <!-- Sistema de pestañas -->
        <div class="mb-4 mt-4">
            <nav class="flex border-b">
                <button id="tab-busqueda" class="tab-button border-b-2 border-blue-500 text-blue-600 px-4 py-2 font-semibold">Búsqueda</button>
                <button id="tab-relaciones" class="tab-button border-b-2 border-transparent text-gray-500 px-4 py-2 font-semibold">Relaciones</button>
            </nav>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-busqueda" class="tab-content">
            <form id="formConsultaProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoConsulta">Código/PLU:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoConsulta" type="text">
                        <button type="button" id="escanearBtnConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear Código de Barras</button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreConsulta">Nombre:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="nombreConsulta" type="text">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaConsulta">Categoría:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="categoriaConsulta" type="text">
                </div>
                <div class="flex items-center justify-between">
                    <button id="buscarConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">Buscar Producto</button>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
        </div>
        <div id="content-relaciones" class="tab-content" style="display:none;">
            <form id="formRelaciones" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoRelacion">Código del producto:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoRelacion" type="text" placeholder="Escanea o ingresa el código o últimos 4 dígitos">
                        <button type="button" id="escanearBtnRelacion" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear</button>
                        <button type="button" id="buscarRelacion" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Buscar Relación</button>
                    </div>
                </div>
            </form>
            <div id="relaciones" class="mt-4"></div>
        </div>

        <!-- Modificamos el contenedor del escáner -->
        <!-- En plantillas/consulta.html -->
        <div id="scanner-container-consulta" class="mt-4" style="display: none;">
            <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
            <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
        </div>

        <!-- Div to hold the barcode -->
        <div id="barcodeContainer" class="mt-4"></div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Búsqueda relacional de productos con pestañas
        document.addEventListener('DOMContentLoaded', function() {
            const codigoConsulta = document.getElementById('codigoConsulta');
            aplicarConversionCodigo(codigoConsulta);
            // Para la pestaña de relaciones
            const codigoRelacion = document.getElementById('codigoRelacion');
            if (codigoRelacion) aplicarConversionCodigo(codigoRelacion);

            // Tabs
            const tabBusqueda = document.getElementById('tab-busqueda');
            const tabRelaciones = document.getElementById('tab-relaciones');
            const contentBusqueda = document.getElementById('content-busqueda');
            const contentRelaciones = document.getElementById('content-relaciones');
            const relacionesDiv = document.getElementById('relaciones');
            let ultimoProducto = null;

            function switchTab(tab) {
                if (tab === 'busqueda') {
                    tabBusqueda.classList.add('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.remove('border-transparent', 'text-gray-500');
                    tabRelaciones.classList.remove('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'block';
                    contentRelaciones.style.display = 'none';
                } else {
                    if (tabRelaciones.disabled) return; // No cambiar si está deshabilitada
                    tabRelaciones.classList.add('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.remove('border-transparent', 'text-gray-500');
                    tabBusqueda.classList.remove('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'none';
                    contentRelaciones.style.display = 'block';
                }
            }
            tabBusqueda.addEventListener('click', () => switchTab('busqueda'));
            tabRelaciones.addEventListener('click', () => switchTab('relaciones'));
            switchTab('busqueda');

            const buscarBtn = document.getElementById('buscarConsulta');
            const resultadosDiv = document.getElementById('resultados');

            buscarBtn.addEventListener('click', async function() {
                resultadosDiv.innerHTML = '';
                ultimoProducto = null;
                const codigoInput = document.getElementById('codigoConsulta').value.trim();
                const nombre = document.getElementById('nombreConsulta').value.trim();
                const categoria = document.getElementById('categoriaConsulta').value.trim();

                // Buscar primero en IndexedDB para obtener el código completo
                function buscarEnIndexedDB(codigo, nombre, categoria) {
                    return new Promise((resolve, reject) => {
                        if (!window.indexedDB) {
                            resolve(null);
                            return;
                        }
                        const request = window.indexedDB.open('InventarioDB', 1);
                        request.onerror = function() { resolve(null); };
                        request.onsuccess = function(event) {
                            const db = event.target.result;
                            const tx = db.transaction(['productos'], 'readonly');
                            const store = tx.objectStore('productos');
                            const allReq = store.getAll();
                            allReq.onsuccess = function(e) {
                                const productos = e.target.result || [];
                                let encontrados = [];
                                if (codigo) {
                                    if (codigo.length === 4) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo.endsWith(codigo));
                                    } else if (codigo.length === 13) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    } else {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    }
                                } else if (nombre || categoria) {
                                    encontrados = productos.filter(p => {
                                        let match = true;
                                        if (nombre) match = match && p.nombre && p.nombre.toLowerCase().includes(nombre.toLowerCase());
                                        if (categoria) match = match && p.categoria && p.categoria.toLowerCase().includes(categoria.toLowerCase());
                                        return match;
                                    });
                                }
                                resolve(encontrados);
                            };
                            allReq.onerror = function() { resolve(null); };
                        };
                    });
                }

                const productosLocal = await buscarEnIndexedDB(codigoInput, nombre, categoria);
                if (!productosLocal || productosLocal.length === 0) {
                    resultadosDiv.innerHTML = '<div class="text-red-600 font-semibold">No se encontraron productos en el dispositivo.</div>';
                    return;
                }

                // Mostrar resultados principales
                productosLocal.forEach((producto, idx) => {
                    let html = `<div class="bg-white rounded shadow p-4 mb-4">
                        <h3 class="text-xl font-bold mb-2">${producto.nombre}</h3>
                        <div><b>Código:</b> ${producto.codigo}</div>
                        <div><b>Categoría:</b> ${producto.categoria}</div>
                        <div><b>Marca:</b> ${producto.marca}</div>
                        <div><b>Unidad:</b> ${producto.unidad}</div>
                    </div>`;
                    resultadosDiv.innerHTML += html;
                    if (idx === 0) ultimoProducto = producto;
                });
            });

            // Lógica independiente para la pestaña de relaciones
            const buscarRelacionBtn = document.getElementById('buscarRelacion');
            if (buscarRelacionBtn) {
                buscarRelacionBtn.addEventListener('click', async function() {
                    relacionesDiv.innerHTML = '';
                    let codigo = document.getElementById('codigoRelacion').value.trim();
                    if (!codigo) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Ingresa un código para buscar relaciones.</div>';
                        return;
                    }
                    // Permitir búsqueda por últimos 4 dígitos
                    if (codigo.length === 4) {
                        // Buscar en Supabase todos los productos cuyo substring(2,5) sea igual a esos 4 dígitos
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        // Traer todos los códigos y filtrar en JS (por compatibilidad universal)
                        const { data: productosTodos } = await supabase.from('productos').select('codigo');
                        const productos4 = (productosTodos || []).filter(p => typeof p.codigo === 'string' && p.codigo.length >= 5 && p.codigo.substring(1,5) === codigo);
                        if (productos4.length > 0) {
                            if (productos4.length > 1) {
                                relacionesDiv.innerHTML = `<div class='mb-2'>Se encontraron varios productos con los dígitos 2-5 <b>${codigo}</b>:</div>`;
                                productos4.forEach(p => {
                                    relacionesDiv.innerHTML += `<button class='bg-blue-100 hover:bg-blue-300 text-blue-800 px-2 py-1 rounded m-1' onclick='document.getElementById("codigoRelacion").value="${p.codigo}";document.getElementById("buscarRelacion").click();return false;'>${p.codigo}</button>`;
                                });
                                return;
                            } else {
                                codigo = productos4[0].codigo;
                                document.getElementById('codigoRelacion').value = codigo;
                            }
                        } else {
                            relacionesDiv.innerHTML = `<div class='text-red-600'>No se encontró ningún producto con los dígitos 2-5 igual a <b>${codigo}</b>.</div>`;
                            return;
                        }
                    }
                    relacionesDiv.innerHTML = '<div class="text-gray-500">Buscando relaciones...</div>';
                    try {
                        const { obtenerRelacionesProductosSupabase, buscarRelacionProducto } = await import('../js/relaciones-productos.js');
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        const relaciones = await obtenerRelacionesProductosSupabase();
                        const resultado = buscarRelacionProducto(codigo, relaciones);
                        // Buscar info del producto consultado
                        let relHtml = `<div class="bg-white rounded shadow p-4 mb-4">
                            <h3 class="text-lg font-bold mb-2">Relaciones para: <span class='font-mono'>${codigo}</span></h3>`;
                        const { data: productoInfo } = await supabase.from('productos').select('*').eq('codigo', codigo);
                        if (productoInfo && productoInfo.length > 0) {
                            const p = productoInfo[0];
                            relHtml += `<div class='mb-2 text-sm text-gray-700'>${p.nombre} | ${p.unidad || ''} | ${p.categoria || ''} | ${p.marca || ''}</div>`;
                        }
                        // Si es principal, mostrar subproductos
                        if (resultado.tipo === 'principal' && resultado.subproductos.length > 0) {
                            // Buscar info de subproductos
                            const { data: subproductosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos);
                            relHtml += `<div class="mt-2"><b>Subproductos relacionados:</b>
                            <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                            resultado.subproductos.forEach(subCodigo => {
                                const sub = subproductosInfo ? subproductosInfo.find(p => p.codigo === subCodigo) : null;
                                if (sub) {
                                    relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                } else {
                                    relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                }
                            });
                            relHtml += '</tbody></table></div>';
                        }
                        // Si es subproducto, mostrar principal y hermanos
                        if (resultado.tipo === 'subproducto' && resultado.principal) {
                            // Buscar info del principal
                            const { data: principalArr } = await supabase.from('productos').select('*').eq('codigo', resultado.principal);
                            if (principalArr && principalArr.length > 0) {
                                const principal = principalArr[0];
                                relHtml += `<div class="mt-4"><b>Producto principal:</b>
                                    <div class="bg-gray-50 rounded p-2 mt-1">
                                        <b>${principal.nombre}</b> (Código: ${principal.codigo})<br>
                                        Categoría: ${principal.categoria} | Marca: ${principal.marca} | Unidad: ${principal.unidad}
                                    </div>
                                </div>`;
                            } else {
                                relHtml += `<div class="mt-4"><b>Producto principal:</b> <span class='text-gray-400'>${resultado.principal} (No encontrado)</span></div>`;
                            }
                            // Mostrar hermanos (otros subproductos)
                            if (resultado.subproductos.length > 1) {
                                const { data: hermanosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos.filter(c => c !== codigo));
                                relHtml += `<div class="mt-2"><b>Otros subproductos relacionados:</b>
                                <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                                resultado.subproductos.forEach(subCodigo => {
                                    if (subCodigo === codigo) return;
                                    const sub = hermanosInfo ? hermanosInfo.find(p => p.codigo === subCodigo) : null;
                                    if (sub) {
                                        relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                    } else {
                                        relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                    }
                                });
                                relHtml += '</tbody></table></div>';
                            }
                        }
                        if (resultado.tipo === 'ninguno') {
                            relHtml += '<div class="mt-2 text-gray-400">Este producto no tiene relaciones registradas.</div>';
                        }
                        relHtml += '</div>';
                        relacionesDiv.innerHTML = relHtml;
                    } catch (e) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Error al consultar relaciones: ' + (e.message || e) + '</div>';
                    }
                });
            }

            // El manejo del botón de escanear ya lo realiza `main.js` (evitamos listeners duplicados).
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#">
    <title>Editar Producto - Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <script src="../librerías/html5-qrcode.min.js"></script>
    <link rel="stylesheet" href="../librerías/tailwind.min.css" />
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">

    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Editar Producto</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Editar Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Pestañas -->
        <div class="mb-6 mt-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-editar-individual"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button active">
                        Edición Individual
                    </button>
                    <button id="tab-editar-tabla"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Edición por Tabla
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-editar-individual" class="tab-content">
            <form id="formEditarProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoEditar">
                        Código/PLU:
                    </label>
                    <div class="flex">
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="codigoEditar" type="text" required />
                        <button type="button" id="escanearBtnEditar"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                            Escanear Código de Barras
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <button id="buscarEditar"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="button">
                        Buscar
                    </button>
                </div>
                <div id="formularioEdicion" style="display: none">
                    <!-- Campo de código editable -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo">
                            Código
                        </label>
                        <input type="text" id="codigoEditado"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreEditar">
                            Nombre:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="nombreEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaEditar">
                            Categoría:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="categoriaEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="marcaEditar">
                            Marca/Proveedor:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="marcaEditar" type="text" required />
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="unidadEditar">
                            Unidad:
                        </label>
                        <input type="text" id="unidadEditar"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="flex items-center justify-between">
                        <button id="guardarCambios"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Guardar Cambios
                        </button>
                        <button id="eliminarProducto"
                            class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Eliminar Producto
                        </button>
                    </div>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
            <div id="scanner-container-editar" class="mt-4" style="display: none">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>
        </div>

        <!-- Pestaña Edición por Tabla -->
        <div id="content-editar-tabla" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Edición por Tabla</h3>
                <form id="formBuscarTabla" class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoBuscarTabla">
                        Buscar por Código de Producto Primario o Subproducto:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="codigoBuscarTabla" type="text" placeholder="Ej: 1234 o 201670000004" required />
                    <button type="submit"
                        class="mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Buscar</button>
                </form>
                <div id="tabla-edicion-resultados"></div>
                <div id="tabla-edicion-resultados"></div>
                <script type="module">
                    import { db, inicializarDB } from '../js/db-operations.js';
                    import { obtenerRelacionesProductosSupabase, buscarRelacionProducto } from '../js/relaciones-productos.js';
                    // Exponer para main.js si se requiere (opcional)
                    window.obtenerRelacionesProductosSupabase = obtenerRelacionesProductosSupabase;
                    window.buscarRelacionProducto = buscarRelacionProducto;

                    // Lógica de búsqueda y edición en tabla
                    document.getElementById('formBuscarTabla').addEventListener('submit', function (e) {
                        e.preventDefault();
                        const codigo = document.getElementById('codigoBuscarTabla').value.trim();
                        const resultadosDiv = document.getElementById('tabla-edicion-resultados');
                        resultadosDiv.innerHTML = `<div class='text-gray-600'>Sincronizando productos y relaciones...</div>`;

                        (async () => {
                            console.log('[DEBUG] db antes de inicializar:', db);
                            let dbReady = db;
                            if (!dbReady) {
                                resultadosDiv.innerHTML = `<div class='text-gray-600'>Inicializando base de datos local...</div>`;
                                try {
                                    await inicializarDB();
                                } catch (err) {
                                    console.error('[DEBUG] Error al inicializarDB:', err);
                                }
                                dbReady = db;
                                console.log('[DEBUG] db después de inicializar:', dbReady);
                            }
                            if (!dbReady) {
                                console.error('[DEBUG] IndexedDB sigue sin inicializar tras inicializarDB.');
                                resultadosDiv.innerHTML = `<div class='text-red-600'>IndexedDB no inicializado.</div>`;
                                return;
                            }
                            // 1. Sincronizar productos desde Supabase a IndexedDB y obtener relaciones
                            Promise.all([
                                importarProductosSupabaseAIndexedDB(dbReady),
                                obtenerRelacionesProductosSupabase()
                            ]).then(([_, relaciones]) => {
                                // 2. Buscar relación en el Map
                                const relacion = buscarRelacionProducto(codigo, relaciones);
                                // 3. Buscar detalles de productos en IndexedDB
                                buscarProductosRelacionadosConMap(dbReady, codigo, relacion, resultadosDiv);
                            }).catch(err => {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al sincronizar: ${err.message || err}`;
                            });
                        })();

                        // --- Función para importar productos de Supabase a IndexedDB ---
                        async function importarProductosSupabaseAIndexedDB(dbInstance) {
                            if (!window.getSupabase) throw new Error('No se encontró getSupabase.');
                            const supabase = await window.getSupabase();
                            const { data: productos, error } = await supabase.from('productos').select('*');
                            if (error) throw error;
                            if (!dbInstance) throw new Error('IndexedDB no inicializado');
                            return new Promise((resolve, reject) => {
                                const transaction = dbInstance.transaction(['productos'], 'readwrite');
                                const objectStore = transaction.objectStore('productos');
                                const clearReq = objectStore.clear();
                                clearReq.onsuccess = function () {
                                    productos.forEach(prod => {
                                        const p = {
                                            codigo: prod.codigo,
                                            nombre: prod.nombre,
                                            categoria: prod.categoria,
                                            marca: prod.marca,
                                            unidad: prod.unidad
                                        };
                                        objectStore.put(p);
                                    });
                                    transaction.oncomplete = resolve;
                                    transaction.onerror = reject;
                                };
                                clearReq.onerror = reject;
                            });
                        }

                        // --- Función para buscar productos relacionados usando el Map de relaciones ---
                        function buscarProductosRelacionadosConMap(dbInstance, codigo, relacion, resultadosDiv) {
                            const transaction = dbInstance.transaction(['productos'], 'readonly');
                            const objectStore = transaction.objectStore('productos');
                            const getAllReq = objectStore.getAll();
                            getAllReq.onsuccess = function (e) {
                                const productos = e.target.result;
                                // Buscar producto exacto (por código completo o 4 dígitos)
                                let producto = productos.find(p => p.codigo === codigo || p.codigo.endsWith(codigo));
                                if (!producto) {
                                    resultadosDiv.innerHTML = `<div class='text-red-600'>No se encontró el producto <b>${codigo}</b>.</div>`;
                                    return;
                                }
                                // Buscar principal y subproductos según el Map
                                let productoPrincipal = null;
                                let subproductos = [];
                                if (relacion.tipo === 'principal') {
                                    productoPrincipal = producto;
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                } else if (relacion.tipo === 'subproducto') {
                                    productoPrincipal = productos.find(p => p.codigo === relacion.principal);
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                }
                                // Mostrar resultados
                                let html = '';
                                // Producto encontrado (si es principal, mostrar botón editar principal)
                                html += `<div class='mb-4'><b>Producto encontrado:</b><br>${producto.codigo} - ${producto.nombre} (${producto.categoria})<br>Marca: ${producto.marca} | Unidad: ${producto.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${producto.codigo}'>Editar</button></div>`;
                                // Si hay producto principal distinto, mostrarlo con botón editar
                                if (productoPrincipal && productoPrincipal.codigo !== producto.codigo) {
                                    html += `<div class='mb-4'><b>Producto Principal:</b><br>${productoPrincipal.codigo} - ${productoPrincipal.nombre} (${productoPrincipal.categoria})<br>Marca: ${productoPrincipal.marca} | Unidad: ${productoPrincipal.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${productoPrincipal.codigo}'>Editar</button></div>`;
                                }
                                if (subproductos.length > 0) {
                                    html += `<div class='mb-2'><b>Subproductos relacionados:</b> <button id='expand-relacionados' class='ml-2 px-2 py-1 bg-blue-200 rounded'>Ver relacionados</button></div><ul class='mb-4' id='lista-relacionados' style='display:none;'>`;
                                    subproductos.forEach(sp => {
                                        html += `<li class='mb-1'>${sp.codigo} - ${sp.nombre} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${sp.codigo}'>Editar</button></li>`;
                                    });
                                    html += '</ul>';
                                }
                                resultadosDiv.innerHTML = html;
                                // Botón para expandir/collapse relacionados
                                const expandBtn = resultadosDiv.querySelector('#expand-relacionados');
                                const listaRelacionados = resultadosDiv.querySelector('#lista-relacionados');
                                if (expandBtn && listaRelacionados) {
                                    expandBtn.addEventListener('click', () => {
                                        listaRelacionados.style.display = listaRelacionados.style.display === 'none' ? 'block' : 'none';
                                        expandBtn.textContent = listaRelacionados.style.display === 'none' ? 'Ver relacionados' : 'Ocultar relacionados';
                                    });
                                }
                                // Agregar listeners a los botones de edición
                                resultadosDiv.querySelectorAll('.edit-btn').forEach(btn => {
                                    btn.addEventListener('click', function () {
                                        const codigoEditar = btn.dataset.codigo;
                                        // Buscar el producto en la lista de productos
                                        const prod = productos.find(p => p.codigo === codigoEditar);
                                        if (!prod) {
                                            Swal.fire('Error', 'No se encontró el producto en la base local.', 'error');
                                            return;
                                        }
                                        // Rellenar el formulario de edición individual
                                        document.getElementById('codigoEditar').value = prod.codigo;
                                        document.getElementById('codigoEditado').value = prod.codigo;
                                        document.getElementById('nombreEditar').value = prod.nombre;
                                        document.getElementById('categoriaEditar').value = prod.categoria;
                                        document.getElementById('marcaEditar').value = prod.marca;
                                        document.getElementById('unidadEditar').value = prod.unidad;
                                        // Mostrar el formulario de edición si está oculto
                                        document.getElementById('formularioEdicion').style.display = '';
                                        // Cambiar a la pestaña de Edición Individual
                                        const tabButtons = document.querySelectorAll('.tab-button');
                                        const tabContents = document.querySelectorAll('.tab-content');
                                        tabButtons.forEach(btn => {
                                            btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                                            btn.classList.add('border-transparent', 'text-gray-500');
                                        });
                                        tabContents.forEach(content => {
                                            content.style.display = 'none';
                                        });
                                        document.getElementById('tab-editar-individual').classList.add('active', 'border-blue-500', 'text-blue-600');
                                        document.getElementById('tab-editar-individual').classList.remove('border-transparent', 'text-gray-500');
                                        document.getElementById('content-editar-individual').style.display = 'block';
                                        // Scroll al formulario de edición
                                        document.getElementById('formEditarProducto').scrollIntoView({ behavior: 'smooth' });
                                    });
                                });
                            };
                            getAllReq.onerror = function () {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al buscar productos en IndexedDB.</div>`;
                            };
                        }
                    });
                </script>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Pestañas
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            function switchTab(targetTab) {
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });
                const activeButton = document.getElementById(`tab-${targetTab}`);
                activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');
                document.getElementById(`content-${targetTab}`).style.display = 'block';
            }
            document.getElementById('tab-editar-individual').addEventListener('click', () => switchTab('editar-individual'));
            document.getElementById('tab-editar-tabla').addEventListener('click', () => switchTab('editar-tabla'));

            // Aplicar conversión de guión a ceros en campos de código
            const codigoEditar = document.getElementById('codigoEditar');
            const codigoEditado = document.getElementById('codigoEditado');
            const codigoBuscarTabla = document.getElementById('codigoBuscarTabla');
            aplicarConversionCodigo(codigoEditar);
            aplicarConversionCodigo(codigoEditado);
            aplicarConversionCodigo(codigoBuscarTabla);


        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link href="../librerías/tailwind.min.css" rel="stylesheet">
    <script src="../librerías/sweetalert2@11.js"></script>
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Inventario</h1>
        <div class="flex items-center space-x-4">
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="inventario" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6 dark-theme-title">Inventario</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Nuevo div para mostrar la ubicación actual -->
        <div class="mb-4 p-4 bg-white shadow-md rounded">
            <h2 class="text-xl font-bold mb-2">Ubicación Actual: <span id="ubicacionActual"></span></h2>
            <button id="cambiarUbicacion" class="bg-yellow-500 text-white px-4 py-2">Cambiar Ubicación</button>
        </div>

        <!-- Pestañas principales de inventario -->
        <div class="mb-6">
            <div class="flex border-b bg-white shadow-sm rounded-t-lg">
                <button id="tabInventarioManual"
                    class="px-6 py-3 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500 font-semibold">
                    📦 Inventario Manual
                </button>
                <button id="tabLotesAvanzado"
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300 font-semibold">
                    🚀 Inventario por Lotes Avanzado
                </button>
            </div>
        </div>

        <!-- Contenido de Inventario Manual -->
        <div id="contenidoInventarioManual" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <!-- Formulario de búsqueda de inventario -->
            <div class="mb-4">
                <label for="codigo" class="block mb-2">Código/PLU:</label>
                <div class="flex">
                    <input type="text" id="codigo" class="border p-2 w-full">
                    <button id="escanearBtn" class="bg-blue-500 text-white px-4 py-2 ml-2">Escanear Código</button>
                </div>
            </div>

            <div class="mb-4">
                <label for="nombreInventario" class="block mb-2">Nombre:</label>
                <input type="text" id="nombreInventario" class="border p-2 w-full">
            </div>

            <div class="mb-4">
                <label for="marcaInventario" class="block mb-2">Marca:</label>
                <input type="text" id="marcaInventario" class="border p-2 w-full">
            </div>

            <button id="buscarInventario" class="bg-green-500 text-white px-4 py-2 mb-4">Buscar Producto</button>

            <div id="resultadosInventario" class="mt-4" style="display: none;">
                <!-- Los resultados de la búsqueda se mostrarán aquí -->
            </div>

            <div id="datosInventario" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
                <!-- Pestañas para productos tipo Kg -->
                <div id="tabsContainer" class="mb-6" style="display: none;">
                    <div class="flex border-b">
                        <button id="tabInventario"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            Inventario Normal
                        </button>
                        <button id="tabLotes"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            Lotes
                        </button>
                    </div>
                </div>

                <!-- Formulario de inventario normal -->
                <div id="formularioInventarioNormal">
                    <div class="mb-4">
                        <label for="codigoProductoInventario" class="block mb-2">Codigo del Producto:</label>
                        <input type="text" id="codigoProductoInventario" class="border p-2 w-full" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="nombreProductoInventario" class="block mb-2">Nombre del Producto:</label>
                        <input type="text" id="nombreProductoInventario" class="border p-2 w-full" readonly>
                    </div>

                    <div class="mb-4">
                        <label for="unidadProducto" class="block mb-2">Unidad:</label>
                        <input type="text" id="unidadProducto" class="border p-2 w-full" readonly>
                        <!-- Mostrar la unidad como texto -->
                    </div>

                    <div class="mb-4">
                        <label for="cantidad" class="block mb-2">Cantidad:</label>
                        <input type="number" id="cantidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-4">
                        <label for="fechaCaducidad" class="block mb-2">Fecha de Caducidad:</label>
                        <input type="date" id="fechaCaducidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-6">
                        <label for="comentarios" class="block mb-2">Comentarios:</label>
                        <textarea id="comentarios" class="border p-2 w-full"></textarea>
                    </div>

                    <div id="botonguardar" class="flex items-center justify-between">
                        <button id="guardarInventario" class="bg-blue-500 text-white px-4 py-2">Guardar
                            Inventario</button>
                    </div>
                    <div id="botonmodificar" class="flex items-center justify-between" style="display: none;">
                        <button id="modificarInventario" class="bg-blue-500 text-white px-4 py-2">Modificar
                            Inventario</button>
                    </div>
                </div>

                <!-- Formulario de escaneo por lotes para productos Kg -->
                <div id="formularioLotes" style="display: none;">
                    <div class="bg-blue-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-bold mb-3 text-blue-800">Información del Producto</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Código:</label>
                                <span id="codigoProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre:</label>
                                <span id="nombreProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Unidad:</label>
                                <span id="unidadProductoLotes" class="text-sm font-semibold text-green-600">Kg</span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoría:</label>
                                <span id="categoriaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Marca:</label>
                                <span id="marcaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label for="precioKilo" class="block text-sm font-medium text-gray-700 mb-2">Precio por Kilo
                            ($):</label>
                        <input type="number" id="precioKilo" step="0.01" min="0"
                            class="border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Ingrese el precio por kilogramo">
                    </div>

                    <div class="text-center">
                        <button id="iniciarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            📱 Iniciar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>

            <div id="mensaje" class="mt-4"></div>

            <div id="scanner-container-inventario" class="mt-4" style="display: none;">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>

            <button id="generarHojaInventario" class="bg-purple-500 text-white px-4 py-2 mt-4">Generar Hoja de
                Inventario</button>
        </div>

        <!-- Contenido de Inventario por Lotes Avanzado -->
        <div id="contenidoLotesAvanzado" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
            <!-- Panel de alerta y configuración -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-yellow-800">Inventario por Lotes Avanzado</h3>
                        <div class="mt-2 text-sm text-yellow-700">
                            <ul class="list-disc list-inside space-y-1">
                                <li>Solo se pueden contar productos con unidad tipo <strong>Kg</strong></li>
                                <li>El escaneo será automático sin necesidad de búsqueda previa</li>
                                <li>Se extraerán automáticamente PLU, peso y precio desde códigos CODE128</li>
                                <li>Los productos se agruparán por productos primarios y subproductos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel de configuración -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-4 text-gray-800">⚙️ Configuración de Escaneo</h3>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="confirmarProductosSimilares"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                        <label for="confirmarProductosSimilares" class="text-sm font-medium text-gray-700">
                            Mostrar ventana de confirmación para productos similares
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="agruparAutomaticamente"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="agruparAutomaticamente" class="text-sm font-medium text-gray-700">
                            Agrupar automáticamente productos con el mismo PLU
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="sonidoConfirmacion"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="sonidoConfirmacion" class="text-sm font-medium text-gray-700">
                            Reproducir sonido de confirmación al escanear
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="relacionarProductos"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="relacionarProductos" class="text-sm font-medium text-gray-700">
                            Relacionar productos (buscar en productos_subproductos)
                        </label>
                    </div>
                </div>
            </div>

            <!-- Botón para iniciar escaneo -->
            <div class="text-center mb-6">
                <button id="iniciarEscaneoLotesAvanzado"
                    class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform hover:scale-105 transition duration-200">
                    🚀 Iniciar Escaneo por Lotes Avanzado
                </button>
            </div>

            <!-- Área de resultados de productos escaneados -->
            <div id="resultadosLotesAvanzado" class="hidden">
                <h3 class="text-lg font-bold mb-4 text-gray-800">📊 Productos Escaneados</h3>
                <div id="contenedorProductosPrimarios" class="space-y-4">
                    <!-- Las tarjetas de productos primarios se mostrarán aquí -->
                </div>

                <!-- Botón para guardar inventario -->
                <div class="text-center mt-6">
                    <button id="guardarInventarioLotesAvanzado"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled>
                        💾 Guardar Inventario
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes Avanzado -->
        <div id="modalEscaneoLotesAvanzado"
            class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
            <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-5xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-900">🚀 Escaneo por Lotes Avanzado</h3>
                        <button id="cerrarModalLotesAvanzado" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscanerAvanzado"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListadoAvanzado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Productos Escaneados (<span id="contadorProductosAvanzado">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscanerAvanzado" class="mb-4">
                        <div id="scanner-container-lotes-avanzado" class="mb-4">
                            <div id="reader-lotes-avanzado" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="accionEscaneoLotesAvanzado"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-bold"
                                style="user-select:none;">
                                Activar escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListadoAvanzado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Nombre</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio/Kg</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Tipo</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoProductosAvanzado">
                                    <!-- Los productos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total productos: <span id="totalProductosAvanzado" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotalAvanzado" class="font-bold">0.000 Kg</span> |
                            Productos primarios: <span id="totalProductosPrimarios" class="font-bold">0</span>
                        </div>
                        <button id="finalizarEscaneoLotesAvanzado"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes Avanzado
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Edición de Producto de Lote -->
        <div id="modalEdicionProductoLote" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 10000;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-md shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">✏️ Editar Producto Escaneado</h3>
                        <button onclick="cerrarModalEdicionProducto()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Información del producto -->
                    <div class="mb-4 p-3 bg-gray-50 rounded">
                        <p class="text-sm"><strong>Producto:</strong> <span id="editProductoNombre" class="font-medium"></span></p>
                        <p class="text-sm"><strong>Código:</strong> <span id="editProductoCodigo" class="font-mono"></span></p>
                        <p class="text-sm"><strong>PLU:</strong> <span id="editProductoPLU" class="font-mono"></span></p>
                        <input type="hidden" id="editProductoId">
                    </div>

                    <!-- Campos editables -->
                    <div class="space-y-4">
                        <!-- Precio por Kilo -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                💰 Precio por Kilo ($)
                            </label>
                            <input type="number" id="editPrecioKilo" step="0.01" min="0.01"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el precio por kilo era diferente al momento de crear la etiqueta
                            </p>
                        </div>

                        <!-- Peso -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                ⚖️ Peso (Kg)
                            </label>
                            <input type="number" id="editPeso" step="0.001" min="0.001"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.000">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el peso calculado no es correcto (recalcula precio automáticamente)
                            </p>
                        </div>

                        <!-- Precio de Porción (solo lectura, se actualiza automáticamente) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                🏷️ Precio de Porción ($)
                            </label>
                            <input type="number" id="editPrecioPorcion" step="0.01" min="0.01" readonly
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                ℹ️ Se calcula automáticamente: Precio/Kg × Peso
                            </p>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="cerrarModalEdicionProducto()"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button onclick="guardarEdicionProducto()"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            💾 Guardar Cambios
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Información de Producto -->
        <div id="modalInfoProducto" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 9999;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">📋 Información del Producto</h3>
                        <button id="cerrarModalInfoProducto" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Contenido del modal -->
                    <div id="contenidoInfoProducto">
                        <!-- Se llenará dinámicamente -->
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button id="cancelarInfoProducto"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button id="guardarInfoProducto"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            Guardar Info
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes (original) -->
        <div id="modalEscaneoLotes" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
            style="display: none;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">Escaneo por Lotes</h3>
                        <button id="cerrarModalLotes" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscaner"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Códigos Escaneados (<span id="contadorCodigos">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscaner" class="mb-4">
                        <div id="scanner-container-lotes" class="mb-4">
                            <div id="reader-lotes" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="pararEscaneoLotes"
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                                Pausar Escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código Completo</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoCodigosEscaneados">
                                    <!-- Los códigos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total de códigos: <span id="totalCodigos" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotal" class="font-bold">0.00 Kg</span> |
                            Valor total porciones: <span id="precioTotalGeneral" class="font-bold">$0.00</span>
                        </div>
                        <button id="finalizarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- tabla de productos en inventario -->
    <div>
        <button id="sync-inventario-down-btn"
            class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Inventario desde Supabase
        </button>
        <button id="sincronizarManual" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Ahora
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4"> Productos en Inventario </h2>
        <div class="overflow-x-auto">
            <table id="estructura-plantilla" class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">Código</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categoría</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Tipo de Cantidad</th>
                        <th class="py-3 px-6 text-left">Cantidad</th>
                        <th class="py-3 px-6 text-left">Fecha de Caducidad</th>
                        <th class="py-3 px-6 text-left">Comentarios</th>
                        <th class="py-3 px-6 text-left">ubicacion</th>
                    </tr>
                </thead>
                <tbody id="estructuraPlantillaBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/scanner/lotes-avanzado.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;

            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);

                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;

                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversión a los campos de código cuando se cargue la página
        document.addEventListener('DOMContentLoaded', function () {
            const codigo = document.getElementById('codigo');
            const codigoProductoInventario = document.getElementById('codigoProductoInventario');

            aplicarConversionCodigo(codigo);
            // Note: codigoProductoInventario es readonly, pero aplicamos por si acaso
            aplicarConversionCodigo(codigoProductoInventario);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Sistema de Gestión de Productos</h1>
        <div class="flex items-center space-x-4">
            <!-- Indicador de estado del backend -->
            <div id="backendStatus" class="px-3 py-1 rounded-full text-sm font-semibold" 
                 title="Estado de conexión con el backend"
                 style="background-color: #fbbf24; color: #78350f;">
                ⏳ Verificando...
            </div>
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t dark-theme-sidebar-footer">
            <button id="logoutBtn" class="w-full bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded dark-theme-button">
                Cerrar Sesión
            </button>
        </div>
    </div>

    <a href="../index.html" class="text-blue-500 hover:underline mb-4 inline-block dark-theme-link">← Regresar</a>
    <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200 dark-theme-menu-toggle">
        Menú
    </button>

    <main class="container mx-auto mt-8">
        <section id="dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div id="consulta" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Consulta de Producto</h2>
                <p class="mb-4 dark-theme-card-text">Busca productos en la base de datos por diferentes criterios.</p>
                <a id="consultaLink" href="./consulta.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Consulta
                    Producto</a>
            </div>

            <div id="editar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Editar Producto</h2>
                <p class="mb-4 dark-theme-card-text">Edita los atributos de los productos existentes en la base de
                    datos.</p>
                <a id="editarLink" href="./editar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Editar
                    Producto</a>
            </div>

            <div id="inventario" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona el inventario de productos con datos adicionales.</p>
                <a id="inventarioLink" href="./inventario.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Inventario</a>
            </div>

            <div id="reporte" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Reporte para Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Genera reportes detallados del inventario de productos.</p>
                <a id="reporteLink" href="./report.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Reporte
                    para Inventario</a>
            </div>

            <div id="agregar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Agregar Productos</h2>
                <p class="mb-4 dark-theme-card-text">Escanea y agrega nuevos productos a la base de datos.</p>
                <a id="agregarLink" href="./agregar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Agregar
                    Productos</a>
            </div>

            <div id="archivos" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Administración de Archivos</h2>
                <p class="mb-4 dark-theme-card-text">Sube o descarga archivos CSV para la base de datos.</p>
                <a id="archivosLink" href="./archivos.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Archivos</a>
            </div>

            <div id="configuraciones" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Configuraciones</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona las configuraciones del sistema, perfil de usuario y
                    preferencias.</p>
                <a id="configuracionesLink" href="./configuraciones.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Configuraciones</a>
            </div>
        </section>
    </main>

    <footer class="bg-blue-600 text-white p-4 mt-8 dark-theme-footer">
        <p class="text-center dark-theme-footer-text">&copy; 2024 Sistema de Gestión de Productos. Todos los derechos
            reservados.</p>
    </footer>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>    <script type="module">
        import { backendStatusMonitor } from '../js/backend-status.js';
        
        // Monitorear estado del backend
        document.addEventListener('DOMContentLoaded', () => {
            const backendStatusEl = document.getElementById('backendStatus');
            
            // Escuchar cambios de estado del backend
            window.addEventListener('backendStatusChanged', (event) => {
                const { available } = event.detail;
                
                if (available) {
                    backendStatusEl.textContent = '🟢 Backend activo';
                    backendStatusEl.style.backgroundColor = '#dcfce7'; // green-100
                    backendStatusEl.style.color = '#166534'; // green-800
                } else {
                    backendStatusEl.textContent = '🔴 Backend no disponible';
                    backendStatusEl.style.backgroundColor = '#fee2e2'; // red-100
                    backendStatusEl.style.color = '#991b1b'; // red-900
                    
                    // Mostrar alerta una sola vez
                    if (!window.backendDownNotified) {
                        setTimeout(() => {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Backend no disponible',
                                text: 'La aplicación funcionará en modo offline. Los cambios se sincronizarán cuando el servidor esté disponible.',
                                allowOutsideClick: false,
                                didOpen: (modal) => {
                                    // Cerrar automáticamente después de 5 segundos
                                    setTimeout(() => {
                                        Swal.close();
                                    }, 5000);
                                }
                            });
                        }, 500);
                        window.backendDownNotified = true;
                    }
                }
            });
            
            // Iniciar monitoreo (cada 30 segundos)
            backendStatusMonitor.startMonitoring(30);
        });
    </script>
    <script type="module">
        import { cerrarSesion } from '../js/auth/auth.js';
        
        // Manejar botón de logout
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    const { value: rememberUser } = await Swal.fire({
                        title: 'Cerrar Sesión',
                        text: '¿Deseas que se recuerde tu usuario para el próximo login?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Sí, recordar usuario',
                        cancelButtonText: 'No, no recordar',
                        allowOutsideClick: false
                    });
                    
                    // Si cancela, no hace nada
                    if (rememberUser === undefined) return;
                    
                    // Llamar función de logout
                    await cerrarSesion(rememberUser === true);
                });
            }
        });
    </script>    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menuToggle');
            const sideMenu = document.getElementById('sideMenu');
            const closeMenu = document.getElementById('closeMenu');
            const menuRoutes = document.getElementById('menuRoutes');
            const routes = [
                { name: 'Consulta de Producto', path: './consulta.html' },
                { name: 'Editar Producto', path: './editar.html' },
                { name: 'Inventario', path: './inventario.html' },
                { name: 'Registro de Entradas', path: './registro-entradas.html' },
                { name: 'Reporte para Inventario', path: './report.html' },
                { name: 'Agregar Productos', path: './agregar.html' },
                { name: 'Administración de Archivos', path: './archivos.html' },
                { name: 'Configuraciones', path: './configuraciones.html' }
            ];

            // Generar las rutas dinámicamente
            routes.forEach(route => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline dark-theme-nav-link">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            // Mostrar el menú
            menuToggle.addEventListener('click', () => {
                sideMenu.classList.remove('-translate-x-full');
            });

            // Ocultar el menú
            closeMenu.addEventListener('click', () => {
                sideMenu.classList.add('-translate-x-full');
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Entradas</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-green-600 text-white p-4 flex justify-between items-center shadow-lg">
        <div class="flex items-center space-x-3">
            <div class="p-2 bg-green-700 rounded-lg">
                📦
            </div>
            <h1 class="text-3xl font-bold tracking-wide">Registro de Entradas</h1>
        </div>
        <div class="flex items-center space-x-6">
            <div id="conexionStatus" class="text-sm flex items-center space-x-2 bg-green-700 px-3 py-1 rounded-full">
                <span class="status-indicator status-success"></span>
                <span>Conectado</span>
            </div>
            <div id="clockDisplay" class="text-sm font-mono bg-green-700 px-3 py-1 rounded-full"></div>
            <div class="text-sm bg-green-700 px-3 py-1 rounded-full">
                <span id="totalEntradas">0</span> entradas registradas
            </div>
        </div>
    </header>
    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform z-50">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>
    <div class="container mx-auto mt-8 p-4">
        <div class="mb-6 flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center space-x-4">
                <h1 class="text-4xl font-bold text-gray-800 flex items-center">
                    📦 Registro de Entradas
                    <span class="ml-3 text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                        Sistema de Gesti�n
                    </span>
                </h1>
            </div>
            <div class="flex items-center space-x-3">
                <a href="./main.html"
                    class="text-green-600 hover:text-green-800 hover:underline font-medium flex items-center space-x-2 transition-colors">
                    <span>←</span>
                    <span>Regresar al Men� Principal</span>
                </a>
                <button id="menuToggle"
                    class="bg-white text-green-600 px-4 py-2 rounded-lg hover:bg-green-50 border-2 border-green-600 font-semibold transition-all hover:shadow-md">
                    📋 Men� de Navegaci�n
                </button>
            </div>
        </div> <!-- Secci�n de b�squeda de productos -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                🔍 Buscar Producto
                <span id="searchStatus" class="ml-3 text-sm"></span>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="ultimaBusqueda"></span>
                </div>
            </h2>

            <div class="grid md:grid-cols-3 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ Buscar por C�digo:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaCodigo"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese c�digo del producto">
                        <button id="buscarPorCodigo"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnCodigoText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 Buscar por Nombre:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaNombre"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese nombre del producto">
                        <button id="buscarPorNombre"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnNombreText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 Buscar por Marca:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaMarca"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese marca del producto">
                        <button id="buscarPorMarca"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnMarcaText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-center">
                <button id="escanearBtn"
                    class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                    <span>📷</span>
                    <span>Escanear C�digo de Barras</span>
                </button>
            </div>

            <!-- Mensaje de b�squeda reciente -->
            <div id="busquedaReciente" class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 rounded"
                style="display: none;">
                <p class="text-sm text-blue-700">
                    <strong>B�squeda reciente:</strong> <span id="textoUltimaBusqueda"></span>
                </p>
            </div>
        </div> <!-- Formulario de datos del producto y entrada -->
        <div id="productForm"
            class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover"
            style="display: none;">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                📦 Datos del Producto
                <div id="productLoadingIndicator" class="ml-3" style="display: none;">
                    <div
                        class="inline-block w-4 h-4 border-2 border-green-500 border-t-transparent rounded-full animate-spin">
                    </div>
                    <span class="ml-2">Cargando informaci�n...</span>
                </div>
                <div class="ml-auto">
                    <span class="text-sm text-gray-500 bg-green-100 px-3 py-1 rounded-full">
                        Producto encontrado ✅
                    </span>
                </div>
            </h2>

            <div id="productInfo"
                class="grid md:grid-cols-2 gap-6 mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border-2 border-green-200 shadow-inner">
                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="codigoProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">C�digo del Producto:</span>
                        </label>
                        <input type="text" id="codigoProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-mono text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="nombreProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📝 <span class="ml-2">Nombre del Producto:</span>
                        </label>
                        <input type="text" id="nombreProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-semibold text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="marcaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏢 <span class="ml-2">Marca:</span>
                        </label>
                        <input type="text" id="marcaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="categoriaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📂 <span class="ml-2">Categor�a:</span>
                        </label>
                        <input type="text" id="categoriaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="unidadProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📏 <span class="ml-2">Unidad de Medida:</span>
                        </label>
                        <input type="text" id="unidadProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <!-- Informaci�n adicional del stock actual -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="text-sm font-semibold text-blue-700 mb-2">📊 Stock Actual</h4>
                        <div class="text-2xl font-bold text-blue-600" id="stockActual">--</div>
                        <div class="text-xs text-blue-500">unidades disponibles</div>
                    </div>
                </div>
            </div>
            <div class="border-t-2 border-gray-200 pt-8">
                <h3 class="text-lg font-semibold mb-6 text-green-600 flex items-center">
                    📝 Datos de la Entrada
                    <span class="ml-3 text-sm text-gray-500 bg-yellow-100 px-3 py-1 rounded-full">
                        * Campos obligatorios
                    </span>
                    <div class="ml-auto text-sm text-gray-400">
                        <span id="fechaActual"></span>
                    </div>
                </h3>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="transform transition-all hover:scale-105">
                        <label for="cantidadEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📊 <span class="ml-2">Cantidad Recibida *:</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="cantidadEntrada"
                                class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg font-semibold"
                                min="0.01" step="0.01" required placeholder="0.00">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <span id="unidadMedida">unidades</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">Ingrese la cantidad exacta recibida</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="fechaEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📅 <span class="ml-2">Fecha de Entrada *:</span>
                        </label>
                        <input type="date" id="fechaEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg"
                            required>
                        <div class="text-xs text-gray-500 mt-1">Fecha en que se recibi� el producto</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="loteEntrada" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">N�mero de Lote:</span>
                        </label>
                        <input type="text" id="loteEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                            placeholder="Opcional">
                        <div class="text-xs text-gray-500 mt-1">N�mero de lote del proveedor</div>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="comentariosEntrada"
                        class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        💬 <span class="ml-2">Comentarios y Observaciones:</span>
                    </label>
                    <textarea id="comentariosEntrada"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                        rows="4"
                        placeholder="Informaci�n adicional: estado del producto, observaciones del proveedor, condiciones especiales..."></textarea>
                </div>

                <div class="flex justify-between items-center bg-gray-50 p-4 rounded-lg">
                    <button id="limpiarFormulario"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>🗑️</span>
                        <span>Limpiar Formulario</span>
                    </button>
                    <button id="registrarEntrada"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnRegistrarText">✅ Registrar Entrada</span>
                    </button>
                </div>

                <!-- Resumen de la entrada -->
                <div id="resumenEntrada" class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded"
                    style="display: none;">
                    <h4 class="font-semibold text-blue-700 mb-2">📋 Resumen de la Entrada:</h4>
                    <div id="textoResumen" class="text-sm text-blue-600"></div>
                </div>
            </div>
        </div> <!-- Filtros y controles -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-blue-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-blue-600 flex items-center">
                🔧 Filtros y Controles del Sistema
                <div id="syncStatus" class="ml-3 text-sm"></div>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="estadoSistema" class="bg-green-100 text-green-700 px-3 py-1 rounded-full">
                        Sistema Operativo
                    </span>
                </div>
            </h2>

            <div class="grid md:grid-cols-4 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="filtroCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ <span class="ml-2">Filtrar por C�digo:</span>
                    </label>
                    <input type="text" id="filtroCodigo"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="C�digo del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 <span class="ml-2">Filtrar por Nombre:</span>
                    </label>
                    <input type="text" id="filtroNombre"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Nombre del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 <span class="ml-2">Filtrar por Marca:</span>
                    </label>
                    <input type="text" id="filtroMarca"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Marca del producto...">
                </div>

                <div class="flex items-end space-x-2">
                    <button id="filtrarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🔍</span>
                        <span>Filtrar</span>
                    </button>
                    <button id="limpiarFiltros"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🗑️</span>
                        <span>Limpiar</span>
                    </button>
                </div>
            </div>

            <!-- Filtros de fecha -->
            <div class="grid md:grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-lg">
                <div>
                    <label for="fechaDesde" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Desde:</span>
                    </label>
                    <input type="date" id="fechaDesde"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div>
                    <label for="fechaHasta" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Hasta:</span>
                    </label>
                    <input type="date" id="fechaHasta"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div class="flex items-end">
                    <button id="filtrarPorFecha"
                        class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all w-full">
                        📊 Filtrar por Fechas
                    </button>
                </div>
            </div>

            <div class="flex flex-wrap gap-4 justify-between items-center">
                <div class="flex flex-wrap gap-3">
                    <button id="sincronizarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnSincText">🔄 Sincronizar con Servidor</span>
                    </button>
                    <button id="generarReporte"
                        class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-3 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>📊</span>
                        <span>Generar Reporte CSV</span>
                    </button>
                    <button id="autoRefresh"
                        class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white px-6 py-3 rounded-lg hover:from-indigo-600 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>⚡</span>
                        <span>Auto-actualizaci�n: OFF</span>
                    </button>
                </div>

                <div class="flex items-center space-x-3 text-sm text-gray-600">
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">�ltima sincronizaci�n:</span>
                        <span id="ultimaSync">--:--</span>
                    </div>
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">Estado:</span>
                        <span id="estadoConexion" class="text-green-600">Conectado</span>
                    </div>
                </div>
            </div>
        </div> <!-- Tabla de entradas -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-purple-500 card-hover">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-purple-600 flex items-center">
                        📋 Historial de Entradas del Sistema
                        <div id="tableLoadingIndicator" class="ml-3" style="display: none;">
                            <div
                                class="inline-block w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin">
                            </div>
                            <span class="ml-2 text-sm">Actualizando datos...</span>
                        </div>
                    </h2>
                    <div class="flex items-center space-x-4 mt-2">
                        <p id="contadorEntradas" class="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                            Total: 0 entradas registradas
                        </p>
                        <div class="text-sm text-gray-500">
                            <span id="rangoFechas">Mostrando todas las entradas</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="refreshTable"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Actualizar tabla">
                        <span>🔄</span>
                        <span class="hidden md:inline">Actualizar</span>
                    </button>
                    <button id="exportVisible"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Exportar datos visibles">
                        <span>📥</span>
                        <span class="hidden md:inline">Exportar</span>
                    </button>
                    <button id="expandirTabla"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Expandir/Contraer tabla">
                        <span>⛶</span>
                        <span class="hidden md:inline">Expandir</span>
                    </button>
                </div>
            </div>

            <!-- Barra de b�squeda r�pida -->
            <div class="mb-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <input type="text" id="busquedaRapida"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                        placeholder="🔍 B�squeda r�pida en la tabla...">
                    <select id="ordenarPor"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="fecha-desc">M�s reciente primero</option>
                        <option value="fecha-asc">M�s antiguo primero</option>
                        <option value="cantidad-desc">Mayor cantidad primero</option>
                        <option value="cantidad-asc">Menor cantidad primero</option>
                        <option value="nombre-asc">Nombre A-Z</option>
                        <option value="nombre-desc">Nombre Z-A</option>
                    </select>
                </div>
                <div class="text-sm text-gray-500">
                    <span id="resultadosBusqueda"></span>
                </div>
            </div>

            <div class="overflow-x-auto shadow-lg rounded-lg">
                <table class="min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg">
                    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('codigo')">
                                <div class="flex items-center space-x-1">
                                    <span>🏷️ C�digo</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('nombre')">
                                <div class="flex items-center space-x-1">
                                    <span>📝 Nombre</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('marca')">
                                <div class="flex items-center space-x-1">
                                    <span>🏢 Marca</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('categoria')">
                                <div class="flex items-center space-x-1">
                                    <span>📂 Categor�a</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('unidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📏 Unidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('cantidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📊 Cantidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('fecha')">
                                <div class="flex items-center space-x-1">
                                    <span>📅 Fecha</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                                💬 Comentarios
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ⚙️ Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tablaEntradasBody" class="bg-white divide-y divide-gray-200">
                        <!-- Las entradas se cargar�n din�micamente aqu� -->
                        <tr class="text-center text-gray-500 bg-gray-50">
                            <td colspan="9" class="px-6 py-8">
                                <div class="flex flex-col items-center space-y-3">
                                    <div class="text-4xl">📦</div>
                                    <div class="text-lg font-medium">No hay entradas registradas</div>
                                    <div class="text-sm">Las entradas aparecer�n aqu� cuando se registren productos
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginaci�n -->
            <div class="mt-6 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-600">Mostrar:</span>
                    <select id="registrosPorPagina" class="border border-gray-200 rounded p-1 text-sm">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="text-sm text-gray-600">registros por p�gina</span>
                </div>
                <div id="paginacion" class="flex items-center space-x-2">
                    <!-- Los controles de paginaci�n se generar�n din�micamente -->
                </div>
            </div>
        </div> <!-- Scanner container -->
        <div id="scanner-container"
            class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 backdrop-blur-sm"
            style="display: none;">
            <div
                class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl border-4 border-green-500 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        📷 <span class="ml-2">Esc�ner de C�digo de Barras</span>
                    </h3>
                    <button id="cerrarEscaner"
                        class="text-red-500 hover:text-red-700 text-2xl font-bold transition-colors transform hover:scale-110">
                        ✕
                    </button>
                </div>

                <div class="mb-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                    <p class="text-sm text-blue-700">
                        <strong>Instrucciones:</strong> Coloque el c�digo de barras dentro del marco verde.
                        El esc�ner detectar� autom�ticamente el c�digo.
                    </p>
                </div>

                <div id="reader" class="w-full mb-6 rounded-lg overflow-hidden border-4 border-green-200 shadow-lg">
                </div>

                <div class="flex space-x-3">
                    <button id="detenerEscaner"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 w-full transition-all transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2">
                        <span>🛑</span>
                        <span>Detener Esc�ner</span>
                    </button>
                </div>

                <!-- Estado del esc�ner -->
                <div id="estadoEscaner" class="mt-4 text-center text-sm text-gray-600">
                    <div class="flex items-center justify-center space-x-2">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span>Esc�ner activo - Listo para escanear</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../librer�as/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script src="../js/utils/extension-conflict-detector.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script type="module" src="../js/core/registro-entradas-operations.js"></script>
    <script type="module">
        import { inicializarRegistroEntradas } from '../js/registro-entradas-operations.js';
        import { inicializarDB } from '../js/db-operations.js';
        import { toggleEscaner } from '../js/scanner.js';        // Inicializar cuando el DOM est� cargado
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Inicializar base de datos principal
                await inicializarDB();

                // Inicializar p�gina de registro de entradas
                await inicializarRegistroEntradas();

                // Configurar esc�ner
                const escanearBtn = document.getElementById('escanearBtn');
                if (escanearBtn) {
                    escanearBtn.addEventListener('click', () => {
                        toggleEscaner('busquedaCodigo', 'scanner-container');
                    });
                }

                const cerrarEscaner = document.getElementById('cerrarEscaner');
                const detenerEscaner = document.getElementById('detenerEscaner');

                if (cerrarEscaner) {
                    cerrarEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                if (detenerEscaner) {
                    detenerEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                // Inicializar funcionalidades din�micas
                initializeDynamicFeatures();

                console.log('P�gina de registro de entradas inicializada correctamente');

            } catch (error) {
                console.error('Error al inicializar p�gina de registro de entradas:', error);
            }
        });        // Funcionalidades din�micas
        function initializeDynamicFeatures() {
            // Reloj en tiempo real
            updateClock();
            setInterval(updateClock, 1000);

            // Estado de conexi�n
            updateConnectionStatus();
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);

            // Auto-actualizaci�n
            setupAutoRefresh();

            // Efectos de carga
            setupLoadingEffects();

            // Animaciones de entrada
            setupEntranceAnimations();

            // Notificaciones din�micas
            setupDynamicNotifications();

            // Configurar fecha actual
            setupCurrentDate();

            // B�squeda r�pida en tabla
            setupQuickSearch();

            // Autocompletado
            setupAutoComplete();

            // Atajos de teclado
            setupKeyboardShortcuts();

            // Validaciones en tiempo real
            setupRealTimeValidation();
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            const clockDisplay = document.getElementById('clockDisplay');
            if (clockDisplay) {
                clockDisplay.innerHTML = `${timeString}<br><span class="text-xs">${dateString}</span>`;
            }

            // Actualizar fecha actual en el resumen
            const fechaActual = document.getElementById('fechaActual');
            if (fechaActual) {
                fechaActual.textContent = `Hoy: ${dateString}`;
            }
        }

        function updateConnectionStatus() {
            const statusElement = document.getElementById('conexionStatus');
            const estadoConexion = document.getElementById('estadoConexion');

            if (statusElement || estadoConexion) {
                const isOnline = navigator.onLine;
                const status = isOnline
                    ? '<span class="status-indicator status-success"></span>Conectado'
                    : '<span class="status-indicator status-error"></span>Sin conexi�n';

                if (statusElement) statusElement.innerHTML = status;
                if (estadoConexion) {
                    estadoConexion.textContent = isOnline ? 'Conectado' : 'Sin conexi�n';
                    estadoConexion.className = isOnline ? 'text-green-600' : 'text-red-600';
                }

                // Actualizar estado del sistema
                const estadoSistema = document.getElementById('estadoSistema');
                if (estadoSistema) {
                    if (isOnline) {
                        estadoSistema.className = 'bg-green-100 text-green-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Operativo';
                    } else {
                        estadoSistema.className = 'bg-red-100 text-red-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Offline';
                    }
                }
            }
        }

        function setupCurrentDate() {
            const fechaEntrada = document.getElementById('fechaEntrada');
            if (fechaEntrada && !fechaEntrada.value) {
                const today = new Date().toISOString().split('T')[0];
                fechaEntrada.value = today;
            }
        }

        function setupQuickSearch() {
            const busquedaRapida = document.getElementById('busquedaRapida');
            if (busquedaRapida) {
                busquedaRapida.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#tablaEntradasBody tr');
                    let visibleCount = 0;

                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        const isVisible = text.includes(searchTerm);
                        row.style.display = isVisible ? '' : 'none';
                        if (isVisible && !row.classList.contains('text-center')) visibleCount++;
                    });

                    // Actualizar contador de resultados
                    const resultados = document.getElementById('resultadosBusqueda');
                    if (resultados) {
                        resultados.textContent = searchTerm ?
                            `${visibleCount} resultado${visibleCount !== 1 ? 's' : ''} encontrado${visibleCount !== 1 ? 's' : ''}` :
                            '';
                    }
                });
            }
        }

        function setupAutoComplete() {
            // Autocompletado para campos de b�squeda
            const campos = ['busquedaCodigo', 'busquedaNombre', 'busquedaMarca'];
            campos.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.addEventListener('input', debounce((e) => {
                        // Aqu� se implementar�a la l�gica de autocompletado
                        showAutoCompleteHint(campo, e.target.value);
                    }, 300));
                }
            });
        }

        function showAutoCompleteHint(element, value) {
            if (value.length < 2) return;

            // Simular sugerencias (en producci�n vendr�a de la base de datos)
            const hints = ['Producto A', 'Producto B', 'Marca X', 'Marca Y'];
            const matchingHints = hints.filter(hint =>
                hint.toLowerCase().includes(value.toLowerCase())
            );

            // Mostrar hint visual
            if (matchingHints.length > 0) {
                element.title = `Sugerencia: ${matchingHints[0]}`;
                element.style.borderColor = '#10B981';
            } else {
                element.title = '';
                element.style.borderColor = '';
            }
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl + F para buscar
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    const busquedaRapida = document.getElementById('busquedaRapida');
                    if (busquedaRapida) {
                        busquedaRapida.focus();
                        busquedaRapida.select();
                    }
                }

                // Ctrl + S para sincronizar
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    const sincBtn = document.getElementById('sincronizarEntradas');
                    if (sincBtn) sincBtn.click();
                }

                // Ctrl + R para actualizar tabla
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    const refreshBtn = document.getElementById('refreshTable');
                    if (refreshBtn) refreshBtn.click();
                }

                // ESC para cerrar modales
                if (e.key === 'Escape') {
                    const scanner = document.getElementById('scanner-container');
                    if (scanner && scanner.style.display !== 'none') {
                        scanner.style.display = 'none';
                    }
                }
            });
        }

        function setupRealTimeValidation() {
            const cantidadInput = document.getElementById('cantidadEntrada');
            if (cantidadInput) {
                cantidadInput.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    const isValid = value > 0;

                    if (isValid) {
                        e.target.classList.remove('border-red-500');
                        e.target.classList.add('border-green-500');
                        updateEntryPreview();
                    } else {
                        e.target.classList.remove('border-green-500');
                        e.target.classList.add('border-red-500');
                    }
                });
            }

            // Validaci�n de fecha
            const fechaInput = document.getElementById('fechaEntrada');
            if (fechaInput) {
                fechaInput.addEventListener('change', (e) => {
                    const selectedDate = new Date(e.target.value);
                    const today = new Date();
                    const maxDate = new Date();
                    maxDate.setDate(today.getDate() + 30); // M�ximo 30 d�as en el futuro

                    if (selectedDate > maxDate) {
                        e.target.classList.add('border-yellow-500');
                        showToast('⚠️ La fecha seleccionada est� muy lejos en el futuro', 'warning');
                    } else {
                        e.target.classList.remove('border-yellow-500');
                        updateEntryPreview();
                    }
                });
            }
        }

        function updateEntryPreview() {
            const codigo = document.getElementById('codigoProducto')?.value;
            const nombre = document.getElementById('nombreProducto')?.value;
            const cantidad = document.getElementById('cantidadEntrada')?.value;
            const fecha = document.getElementById('fechaEntrada')?.value;
            const unidad = document.getElementById('unidadProducto')?.value;

            if (codigo && nombre && cantidad && fecha) {
                const resumen = document.getElementById('resumenEntrada');
                const textoResumen = document.getElementById('textoResumen');

                if (resumen && textoResumen) {
                    textoResumen.innerHTML = `
                        <strong>${nombre}</strong> (${codigo})<br>
                        Cantidad: <strong>${cantidad} ${unidad || 'unidades'}</strong><br>
                        Fecha: <strong>${new Date(fecha).toLocaleDateString('es-ES')}</strong>
                    `;
                    resumen.style.display = 'block';
                }
            }
        }

        // Funci�n auxiliar para debounce
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Funci�n para mostrar mensajes toast
        function showToast(message, type = 'info') {
            // Implementaci�n simple de toast
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-500' :
                    type === 'warning' ? 'bg-yellow-500' :
                        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                } text-white`;
            toast.textContent = message;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Funci�n para ordenar tabla
        function sortTable(column) {
            console.log(`Ordenando por: ${column}`);
            // Aqu� se implementar�a la l�gica de ordenamiento
        } function setupAutoRefresh() {
            let autoRefreshEnabled = false;
            let autoRefreshInterval;

            const autoRefreshBtn = document.getElementById('autoRefresh');
            if (autoRefreshBtn) {
                autoRefreshBtn.addEventListener('click', () => {
                    autoRefreshEnabled = !autoRefreshEnabled;

                    if (autoRefreshEnabled) {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: ON</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');

                        autoRefreshInterval = setInterval(() => {
                            refreshTableData();
                            updateLastSyncTime();
                        }, 30000); // Cada 30 segundos

                        showToast('✅ Auto-actualizaci�n activada', 'success');
                    } else {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: OFF</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');

                        if (autoRefreshInterval) {
                            clearInterval(autoRefreshInterval);
                        }
                        showToast('⏸️ Auto-actualizaci�n desactivada', 'info');
                    }
                });
            }
        }

        function updateLastSyncTime() {
            const ultimaSync = document.getElementById('ultimaSync');
            if (ultimaSync) {
                const now = new Date();
                ultimaSync.textContent = now.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function setupLoadingEffects() {
            // Interceptar clicks en botones de b�squeda
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        const textId = btnId.replace('buscar', 'btn') + 'Text';
                        showButtonLoading(btn, textId, '🔍 Buscando...');

                        // Simular b�squeda exitosa
                        setTimeout(() => {
                            hideButtonLoading(btn, textId, '🔍 Buscar');
                            updateSearchHistory(btnId);
                        }, 2000);
                    });
                }
            });

            // Interceptar registro de entrada
            const registrarBtn = document.getElementById('registrarEntrada');
            if (registrarBtn) {
                registrarBtn.addEventListener('click', () => {
                    showButtonLoading(registrarBtn, 'btnRegistrarText', '⏳ Registrando entrada...');

                    setTimeout(() => {
                        hideButtonLoading(registrarBtn, 'btnRegistrarText', '✅ Registrar Entrada');
                        showToast('✅ Entrada registrada exitosamente', 'success');
                        updateEntryCounter();
                    }, 3000);
                });
            }

            // Interceptar sincronizaci�n
            const sincBtn = document.getElementById('sincronizarEntradas');
            if (sincBtn) {
                sincBtn.addEventListener('click', () => {
                    showButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizando con servidor...');

                    setTimeout(() => {
                        hideButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizar con Servidor');
                        showToast('✅ Sincronizaci�n completada', 'success');
                        updateLastSyncTime();
                    }, 4000);
                });
            }

            // Interceptar actualizaci�n de tabla
            const refreshBtn = document.getElementById('refreshTable');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    const indicator = document.getElementById('tableLoadingIndicator');
                    if (indicator) {
                        indicator.style.display = 'block';
                        setTimeout(() => {
                            indicator.style.display = 'none';
                            showToast('🔄 Tabla actualizada', 'info');
                        }, 2000);
                    }
                });
            }
        }

        function updateSearchHistory(searchType) {
            const busquedaReciente = document.getElementById('busquedaReciente');
            const textoUltimaBusqueda = document.getElementById('textoUltimaBusqueda');

            if (busquedaReciente && textoUltimaBusqueda) {
                const tipoTexto = {
                    'buscarPorCodigo': 'B�squeda por c�digo',
                    'buscarPorNombre': 'B�squeda por nombre',
                    'buscarPorMarca': 'B�squeda por marca'
                };

                const now = new Date().toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                textoUltimaBusqueda.textContent = `${tipoTexto[searchType]} a las ${now}`;
                busquedaReciente.style.display = 'block';

                // Ocultar despu�s de 10 segundos
                setTimeout(() => {
                    busquedaReciente.style.display = 'none';
                }, 10000);
            }
        }

        function updateEntryCounter() {
            const contador = document.getElementById('contadorEntradas');
            const totalEntradas = document.getElementById('totalEntradas');

            if (contador) {
                const currentCount = parseInt(contador.textContent.match(/\d+/) || [0])[0];
                const newCount = currentCount + 1;
                contador.textContent = `Total: ${newCount} entradas registradas`;

                // Animaci�n del contador
                contador.classList.add('animate-pulse');
                setTimeout(() => {
                    contador.classList.remove('animate-pulse');
                }, 1000);
            }

            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                totalEntradas.textContent = currentCount + 1;
            }
        }

        function showButtonLoading(button, textElementId = null, loadingText = 'Cargando...') {
            button.disabled = true;
            button.classList.add('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
                }
            } else {
                button.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
            }
        }

        function hideButtonLoading(button, textElementId = null, originalText = 'Buscar') {
            button.disabled = false;
            button.classList.remove('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.textContent = originalText;
                }
            } else {
                button.textContent = originalText;
            }
        } function setupEntranceAnimations() {
            // Animar elementos cuando aparecen
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-fade-in-up');

                        // A�adir un peque�o retraso para elementos consecutivos
                        const siblings = Array.from(entry.target.parentElement.children);
                        const index = siblings.indexOf(entry.target);
                        entry.target.style.animationDelay = `${index * 0.1}s`;
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            // Observar todas las tarjetas
            document.querySelectorAll('.card-hover').forEach(card => {
                observer.observe(card);
            });

            // Animaciones para botones al hacer hover
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('mouseenter', () => {
                    if (!button.disabled) {
                        button.style.transform = 'translateY(-2px)';
                        button.style.boxShadow = '0 10px 25px rgba(0,0,0,0.2)';
                    }
                });

                button.addEventListener('mouseleave', () => {
                    button.style.transform = 'translateY(0)';
                    button.style.boxShadow = '';
                });
            });

            // Animaci�n de aparecer para modales
            const scanner = document.getElementById('scanner-container');
            if (scanner) {
                const originalDisplay = scanner.style.display;
                scanner.addEventListener('click', (e) => {
                    if (e.target === scanner) {
                        // Cerrar al hacer click fuera del modal
                        hideModal(scanner);
                    }
                });
            }
        }

        function showModal(modal) {
            modal.style.display = 'flex';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.transition = 'all 0.3s ease';
                modal.style.opacity = '1';
                modal.style.transform = 'scale(1)';
            }, 10);
        }

        function hideModal(modal) {
            modal.style.transition = 'all 0.3s ease';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function setupDynamicNotifications() {
            // Mostrar formulario solo cuando se selecciona un producto
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        setTimeout(() => {
                            const productForm = document.getElementById('productForm');
                            const codigoProducto = document.getElementById('codigoProducto');

                            if (productForm && codigoProducto && codigoProducto.value) {
                                // Mostrar formulario con animaci�n
                                productForm.style.display = 'block';
                                productForm.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });

                                // Animaci�n de aparici�n
                                productForm.style.opacity = '0';
                                productForm.style.transform = 'translateY(30px)';

                                setTimeout(() => {
                                    productForm.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                                    productForm.style.opacity = '1';
                                    productForm.style.transform = 'translateY(0)';

                                    // Destacar el formulario brevemente
                                    productForm.classList.add('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    setTimeout(() => {
                                        productForm.classList.remove('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    }, 2000);
                                }, 100);

                                // Actualizar stock actual (simulado)
                                updateStockDisplay();

                                // Focus en el primer campo editable
                                const cantidadInput = document.getElementById('cantidadEntrada');
                                if (cantidadInput) {
                                    setTimeout(() => cantidadInput.focus(), 800);
                                }
                            }
                        }, 500);
                    });
                }
            });

            // Feedback visual en inputs con animaciones mejoradas
            document.querySelectorAll('input, textarea, select').forEach(input => {
                input.addEventListener('focus', (e) => {
                    e.target.style.transform = 'scale(1.02)';
                    e.target.style.transition = 'transform 0.2s ease';

                    // A�adir indicador de foco
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '#10B981';
                        label.style.transform = 'scale(1.05)';
                        label.style.transition = 'all 0.2s ease';
                    }
                });

                input.addEventListener('blur', (e) => {
                    e.target.style.transform = 'scale(1)';

                    // Restaurar label
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '';
                        label.style.transform = 'scale(1)';
                    }
                });

                // Validaci�n visual en tiempo real
                if (input.type === 'number') {
                    input.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        if (value > 0) {
                            e.target.style.borderColor = '#10B981';
                            e.target.style.backgroundColor = '#F0FDF4';
                        } else if (e.target.value) {
                            e.target.style.borderColor = '#EF4444';
                            e.target.style.backgroundColor = '#FEF2F2';
                        } else {
                            e.target.style.borderColor = '';
                            e.target.style.backgroundColor = '';
                        }
                    });
                }
            });

            // Animaciones para las filas de la tabla
            setupTableRowAnimations();

            // Notificaciones de estado del sistema
            setupSystemStatusNotifications();
        }

        function updateStockDisplay() {
            const stockActual = document.getElementById('stockActual');
            if (stockActual) {
                // Simular datos de stock
                const stock = Math.floor(Math.random() * 500) + 10;
                stockActual.textContent = stock;

                // Animaci�n del contador
                stockActual.style.transform = 'scale(1.2)';
                stockActual.style.transition = 'transform 0.3s ease';

                setTimeout(() => {
                    stockActual.style.transform = 'scale(1)';
                }, 300);

                // Color basado en el stock
                if (stock < 50) {
                    stockActual.className = 'text-2xl font-bold text-red-600';
                    stockActual.parentElement.className = 'bg-red-50 p-4 rounded-lg border border-red-200';
                } else if (stock < 100) {
                    stockActual.className = 'text-2xl font-bold text-yellow-600';
                    stockActual.parentElement.className = 'bg-yellow-50 p-4 rounded-lg border border-yellow-200';
                } else {
                    stockActual.className = 'text-2xl font-bold text-green-600';
                    stockActual.parentElement.className = 'bg-green-50 p-4 rounded-lg border border-green-200';
                }
            }
        }

        function setupTableRowAnimations() {
            // Observador para filas de tabla
            const tableObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeName === 'TR' && !node.classList.contains('text-center')) {
                                // Animar nueva fila
                                node.style.opacity = '0';
                                node.style.transform = 'translateX(-20px)';

                                setTimeout(() => {
                                    node.style.transition = 'all 0.5s ease';
                                    node.style.opacity = '1';
                                    node.style.transform = 'translateX(0)';
                                }, 100);

                                // Efectos hover mejorados
                                node.addEventListener('mouseenter', () => {
                                    node.style.backgroundColor = '#F0FDF4';
                                    node.style.transform = 'scale(1.01)';
                                    node.style.transition = 'all 0.2s ease';
                                    node.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
                                });

                                node.addEventListener('mouseleave', () => {
                                    node.style.backgroundColor = '';
                                    node.style.transform = 'scale(1)';
                                    node.style.boxShadow = '';
                                });
                            }
                        });
                    }
                });
            });

            const tableBody = document.getElementById('tablaEntradasBody');
            if (tableBody) {
                tableObserver.observe(tableBody, { childList: true });
            }
        }

        function setupSystemStatusNotifications() {
            // Notificaciones peri�dicas de estado
            setInterval(() => {
                if (Math.random() < 0.1) { // 10% de probabilidad cada minuto
                    const messages = [
                        '✅ Sistema funcionando correctamente',
                        '📊 Base de datos sincronizada',
                        '🔄 Datos actualizados autom�ticamente',
                        '📈 Rendimiento �ptimo del sistema'
                    ];

                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    showToast(randomMessage, 'success');
                }
            }, 60000); // Cada minuto
        } function refreshTableData() {
            const indicator = document.getElementById('tableLoadingIndicator');
            if (indicator) {
                indicator.style.display = 'block';

                // Simular carga de datos
                setTimeout(() => {
                    indicator.style.display = 'none';
                    updateLastSyncTime();

                    // Actualizar contador si hay datos
                    const tbody = document.getElementById('tablaEntradasBody');
                    if (tbody) {
                        const rows = tbody.querySelectorAll('tr:not(.text-center)');
                        const contador = document.getElementById('contadorEntradas');
                        if (contador) {
                            contador.textContent = `Total: ${rows.length} entradas registradas`;
                        }
                    }
                }, 2000);
            }

            console.log('Actualizando datos de la tabla...');
        }

        // Efectos adicionales para las filas de la tabla
        function addTableRowEffects() {
            document.querySelectorAll('#tablaEntradasBody tr:not(.text-center)').forEach(row => {
                // Eliminar eventos anteriores para evitar duplicados
                row.removeEventListener('mouseenter', handleRowHover);
                row.removeEventListener('mouseleave', handleRowLeave);

                // A�adir nuevos eventos
                row.addEventListener('mouseenter', handleRowHover);
                row.addEventListener('mouseleave', handleRowLeave);
            });
        }

        function handleRowHover(e) {
            e.target.style.backgroundColor = '#F0FDF4';
            e.target.style.transform = 'scale(1.01)';
            e.target.style.transition = 'all 0.2s ease';
            e.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        }

        function handleRowLeave(e) {
            e.target.style.backgroundColor = '';
            e.target.style.transform = 'scale(1)';
            e.target.style.boxShadow = '';
        }

        // Inicializar mejoras adicionales al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                addTableRowEffects();
                initializeAdditionalFeatures();
            }, 1000);
        });

        // Caracter�sticas adicionales
        function initializeAdditionalFeatures() {
            // Configurar filtros de fecha inteligentes
            setupIntelligentDateFilters();

            // Configurar exportaci�n mejorada
            setupEnhancedExport();

            // Configurar modo expandido de tabla
            setupTableExpandMode();

            // Configurar estad�sticas en tiempo real
            setupRealTimeStats();
        }

        function setupIntelligentDateFilters() {
            const filtrarPorFecha = document.getElementById('filtrarPorFecha');
            if (filtrarPorFecha) {
                filtrarPorFecha.addEventListener('click', () => {
                    const fechaDesde = document.getElementById('fechaDesde').value;
                    const fechaHasta = document.getElementById('fechaHasta').value;

                    if (fechaDesde && fechaHasta) {
                        const rangoFechas = document.getElementById('rangoFechas');
                        if (rangoFechas) {
                            const desde = new Date(fechaDesde).toLocaleDateString('es-ES');
                            const hasta = new Date(fechaHasta).toLocaleDateString('es-ES');
                            rangoFechas.textContent = `Mostrando entradas del ${desde} al ${hasta}`;
                        }
                        showToast(`📅 Filtro aplicado: ${fechaDesde} a ${fechaHasta}`, 'info');
                    } else {
                        showToast('⚠️ Seleccione ambas fechas para filtrar', 'warning');
                    }
                });
            }
        }

        function setupEnhancedExport() {
            const exportBtn = document.getElementById('exportVisible');
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    showToast('📥 Preparando exportaci�n...', 'info');

                    setTimeout(() => {
                        showToast('✅ Datos exportados exitosamente', 'success');
                    }, 2000);
                });
            }
        }

        function setupTableExpandMode() {
            const expandBtn = document.getElementById('expandirTabla');
            let isExpanded = false;

            if (expandBtn) {
                expandBtn.addEventListener('click', () => {
                    const tableContainer = expandBtn.closest('.bg-white');

                    if (!isExpanded) {
                        tableContainer.classList.add('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Contraer</span>';
                        isExpanded = true;
                        showToast('⛶ Tabla expandida', 'info');
                    } else {
                        tableContainer.classList.remove('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Expandir</span>';
                        isExpanded = false;
                        showToast('⛶ Tabla contra�da', 'info');
                    }
                });
            }
        }

        function setupRealTimeStats() {
            // Actualizar estad�sticas cada 30 segundos
            setInterval(() => {
                updateSystemStats();
            }, 30000);

            // Actualizaci�n inicial
            updateSystemStats();
        }

        function updateSystemStats() {
            // Simular actualizaci�n de estad�sticas
            const totalEntradas = document.getElementById('totalEntradas');
            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                if (Math.random() < 0.3) { // 30% de probabilidad de incremento
                    totalEntradas.textContent = currentCount + Math.floor(Math.random() * 3) + 1;
                }
            }
        }

        // CSS para animaciones adicionales
        const additionalStyles = `
            <style>
                .animate-fade-in-up {
                    animation: fadeInUp 0.6s ease-out forwards;
                }
                
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(30px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .status-indicator {
                    display: inline-block;
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    margin-right: 6px;
                }
                
                .status-success {
                    background-color: #10B981;
                    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
                }
                
                .status-error {
                    background-color: #EF4444;
                    box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
                }
                
                .card-hover {
                    transition: all 0.3s ease;
                }
                
                .card-hover:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                }
                
                .loading-spinner {
                    border: 2px solid #f3f3f3;
                    border-top: 2px solid #3498db;
                    border-radius: 50%;
                    width: 16px;
                    height: 16px;
                    animation: spin 1s linear infinite;
                }
                
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                
                /* Efectos de hover mejorados */
                button:not(:disabled):hover {
                    transform: translateY(-1px) !important;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                }
                
                input:focus, textarea:focus, select:focus {
                    transform: scale(1.01);
                    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
                }
                
                /* Animaciones para modales */
                .modal-enter {
                    animation: modalEnter 0.3s ease-out forwards;
                }
                
                @keyframes modalEnter {
                    from {
                        opacity: 0;
                        transform: scale(0.9);
                    }
                    to {
                        opacity: 1;
                        transform: scale(1);
                    }
                }
                
                /* Efectos de tabla mejorados */
                table th {
                    position: relative;
                    overflow: hidden;
                }
                
                table th:hover::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    animation: shimmer 1.5s ease-in-out;
                }
                
                @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
            </style>
        `;

        // A�adir estilos al head
        document.head.insertAdjacentHTML('beforeend', additionalStyles);

        // Llamar despu�s de cargar datos en la tabla
        window.addEventListener('load', () => {
            setTimeout(addTableRowEffects, 1000);
        });

        // Funci�n para convertir gui�n a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Funci�n para aplicar la conversi�n a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversi�n a los campos de c�digo cuando se cargue la p�gina
        document.addEventListener('DOMContentLoaded', function() {
            const busquedaCodigo = document.getElementById('busquedaCodigo');
            const codigoProducto = document.getElementById('codigoProducto');
            const filtroCodigo = document.getElementById('filtroCodigo');
            
            aplicarConversionCodigo(busquedaCodigo);
            aplicarConversionCodigo(codigoProducto);
            aplicarConversionCodigo(filtroCodigo);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Preconteo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <script src="../librer�as/JsBarcode.all.min.js"></script>
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>

    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    </script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-xl font-bold">Reporte de Preconteo</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <nav class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-xl font-bold">GestorInventory</h1>
            <a href="./main.html" class="hover:underline">Regresar</a>
            <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
                Men�
            </button>
        </div>
    </nav>

    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold text-center mb-6">Generador de Reportes de Preconteo</h1>

        <div class="mb-6 bg-white p-4 rounded shadow">
            <div class="mb-4">
                <label class="block font-semibold mb-2">Selecciona una o varias �reas:</label>
                <div id="areasContainer" class="grid grid-cols-2 md:grid-cols-3 gap-2 border rounded p-3">
                    <!-- Las �reas se cargar�n din�micamente como checkboxes -->
                    <div class="flex items-center">
                        <input type="checkbox" id="area-todas" value="todas" class="areaCheckbox mr-2" checked>
                        <label for="area-todas">Todas las �reas</label>
                    </div>
                </div>
                <div class="mt-2 text-right">
                    <button id="aplicarFiltroBtn" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">
                        Aplicar filtro
                    </button>
                </div>
            </div>

            <div id="loadingIndicator" class="hidden">
                <div class="flex items-center justify-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                    <span class="ml-2">Cargando productos...</span>
                </div>
            </div>

            <div id="productosList" class="mt-4">
                <h2 class="text-xl font-semibold mb-2">Lista de productos:</h2>
                <ul id="productosContainer" class="list-decimal pl-6 space-y-1">
                    <!-- Los productos se cargar�n din�micamente -->
                </ul>
            </div>
        </div>

        <div class="text-center">
            <button id="generarReporteBtn"
                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded">
                GENERAR REPORTE DE PRECONTEO
            </button>
        </div>

        <!-- Contenedor invisible para generar c�digos de barras -->
        <div id="barcodeContainer" class="hidden"></div>
    </div>

    <!-- Cargar nuestro script principal despu�s de asegurarnos que las dependencias est�n cargadas -->
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/reports/rep.js"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Recuperar Contraseña</h1>
            
            <form id="formPasswordReset" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Correo Electrónico</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="tu@email.com"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Enviar Enlace de Recuperación
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Recordaste tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restablecer Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Restablecer Contraseña</h1>
            
            <form id="formResetPassword" class="space-y-4">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Nueva Contraseña</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Ingresa tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-300 mb-2">Confirmar Contraseña</label>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        name="confirmPassword" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Confirma tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Restablecer Contraseña
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Ya tienes tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }

        // Manejar reset de contraseña
        document.addEventListener('DOMContentLoaded', async () => {
            const formResetPassword = document.getElementById('formResetPassword');
            
            if (formResetPassword) {
                formResetPassword.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    // Validar que las contraseñas coincidan
                    if (password !== confirmPassword) {
                        alert('Las contraseñas no coinciden');
                        return;
                    }
                    
                    // Validar longitud mínima
                    if (password.length < 6) {
                        alert('La contraseña debe tener al menos 6 caracteres');
                        return;
                    }

                    try {
                        // Obtener el hash del enlace de reseteo de la URL
                        const hash = window.location.hash;
                        
                        if (!hash) {
                            alert('Enlace de recuperación inválido');
                            return;
                        }

                        // Esperar a que Supabase esté disponible
                        let attempts = 0;
                        while (!window.supabase && attempts < 50) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }

                        if (!window.supabase) {
                            alert('Error: No se pudo cargar Supabase');
                            return;
                        }

                        const { error } = await window.supabase.auth.updateUser({
                            password: password
                        });

                        if (error) {
                            alert('Error al actualizar contraseña: ' + error.message);
                            return;
                        }

                        alert('Contraseña actualizada correctamente');
                        window.location.href = '../index.html';
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al restablecer contraseña');
                    }
                });
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesti�n de Archivos - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css" />
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css" />
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Gesti�n de Archivos</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">
                Cerrar
            </button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <div id="archivos" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Gesti�n de Archivos</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Men�
        </button>

        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="csvFile">
                    Cargar Archivo CSV:
                </label>
                <input type="file" id="csvFile" accept=".csv"
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />
                <div class="mb-4">
                    <button id="descargarCSV"
                        class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                        Exportar Datos a CSV
                    </button>
                </div>
                <div class="mb-4">
                    <button id="resetearBaseDatos"
                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                        Resetear Base de Datos
                    </button>
                </div>
            </div>
        </div>

        <button class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded" id="sync-down-btn">
            Sincronizar en Bajada
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4">Base de Datos Actual</h2>
        <div class="overflow-x-auto">
            <table class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">C�digo</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categor�a</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Unidad</th>
                    </tr>
                </thead>
                <tbody id="databaseBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const menuToggle = document.getElementById("menuToggle");
            const sideMenu = document.getElementById("sideMenu");
            const closeMenu = document.getElementById("closeMenu");
            const menuRoutes = document.getElementById("menuRoutes");

            const routes = [
                { name: "Consulta de Producto", path: "./consulta.html" },
                { name: "Editar Producto", path: "./editar.html" },
                { name: "Inventario", path: "./inventario.html" },
                { name: "Reporte para Inventario", path: "./report.html" },
                { name: "Agregar Productos", path: "./agregar.html" }
            ];

            routes.forEach((route) => {
                const li = document.createElement("li");
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            menuToggle.addEventListener("click", () => {
                sideMenu.classList.remove("-translate-x-full");
            });

            closeMenu.addEventListener("click", () => {
                sideMenu.classList.add("-translate-x-full");
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraciones - Sistema de Gesti�n de Productos</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../librer�as/tailwind.min.css">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    <script src="../js/utils/theme-debug.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Configuraciones del Sistema</h1>
        <div class="flex items-center space-x-4">
            <span id="userInfo" class="text-sm font-medium"></span>
        </div>
    </header>

    <div class="container mx-auto mt-8 p-4">
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar al Dashboard</a>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Configuraciones de Usuario -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    Configuraciones de Usuario
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cambiar Contrase�a</label>
                        <button id="changePasswordBtn"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Cambiar Contrase�a
                        </button>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Informaci�n del Perfil</label>
                        <div id="profileInfo" class="bg-gray-50 p-4 rounded border">
                            <!-- Se llenar� din�micamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraciones del Sistema -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Configuraciones del Sistema
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tema de la Aplicaci�n</label>
                        <select id="themeSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="light">Claro</option>
                            <option value="dark">Oscuro</option>
                            <option value="auto">Autom�tico</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Idioma</label>
                        <select id="languageSelect" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="es">Espa�ol</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Google Services -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                        </path>
                    </svg>
                    Credenciales de Google
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Drive API Key</label>
                        <div class="relative">
                            <input type="password" id="googleDriveApiKey"
                                class="w-full border border-gray-300 rounded px-3 py-2 pr-12"
                                placeholder="Ingresa tu API Key de Google Drive">
                            <button type="button" id="toggleDriveKey"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Necesaria para acceder a Google Drive desde la aplicaci�n
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Sheets API Key</label>
                        <div class="relative">
                            <input type="password" id="googleSheetsApiKey"
                                class="w-full border border-gray-300 rounded px-3 py-2 pr-12"
                                placeholder="Ingresa tu API Key de Google Sheets">
                            <button type="button" id="toggleSheetsKey"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Necesaria para integraci�n con Google Sheets</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ID de Google Sheets</label>
                        <input type="text" id="googleSheetsId" class="w-full border border-gray-300 rounded px-3 py-2"
                            placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                        <p class="text-xs text-gray-500 mt-1">ID de la hoja de c�lculo de Google donde se sincronizar�n
                            los datos</p>
                    </div>

                    <div class="flex space-x-2">
                        <button id="testGoogleConnection"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Probar Conexi�n
                        </button>
                        <button id="saveGoogleCredentials"
                            class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                            Guardar Credenciales
                        </button>
                        <button id="clearGoogleCredentials"
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                            Limpiar
                        </button>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mt-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">
                                    <strong>Informaci�n:</strong> Para obtener las API Keys, visita la
                                    <a href="https://console.developers.google.com/" target="_blank"
                                        class="underline hover:text-blue-800">
                                        Google Cloud Console
                                    </a> y habilita las APIs de Google Drive y Google Sheets.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Sincronizaci�n -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                        </path>
                    </svg>
                    Sincronizaci�n
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sincronizaci�n Autom�tica</label>
                        <div class="flex items-center">
                            <input type="checkbox" id="autoSyncEnabled" class="mr-2">
                            <span>Habilitar sincronizaci�n autom�tica</span>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Intervalo de Sincronizaci�n
                            (minutos)</label>
                        <input type="number" id="syncInterval" class="border border-gray-300 rounded px-3 py-2 w-full"
                            min="1" max="60" value="5">
                    </div>

                    <div class="flex space-x-2">
                        <button id="manualSyncBtn"
                            class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                            Sincronizar Ahora
                        </button>
                        <button id="resetSyncBtn"
                            class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">
                            Resetear Configuraci�n
                        </button>
                    </div>
                </div>
            </div>

            <!-- Configuraciones de Notificaciones -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-5 5v-5zM7 7h10v10H7V7z"></path>
                    </svg>
                    Notificaciones
                </h2>

                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="browserNotifications" class="mr-2">
                        <span>Notificaciones del navegador</span>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="soundNotifications" class="mr-2">
                        <span>Notificaciones sonoras</span>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="lowStockAlerts" class="mr-2">
                        <span>Alertas de stock bajo</span>
                    </div>
                </div>
            </div>

            <!-- Informaci�n del Sistema -->
            <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Informaci�n del Sistema
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">Versi�n de la Aplicaci�n</h3>
                        <p id="appVersion" class="text-lg">1.0.0</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">Estado de Conexi�n</h3>
                        <p id="connectionStatus" class="text-lg">Conectado</p>
                    </div>

                    <div class="bg-gray-50 p-4 rounded border">
                        <h3 class="font-semibold text-gray-700">�ltima Sincronizaci�n</h3>
                        <p id="lastSync" class="text-lg">--</p>
                    </div>
                </div>

                <div class="mt-4 flex space-x-2">
                    <button id="exportConfigBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Exportar Configuraci�n
                    </button>
                    <button id="importConfigBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Importar Configuraci�n
                    </button>
                    <input type="file" id="importConfigFile" accept=".json" class="hidden">
                </div>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/configuraciones.js"></script>
</body>

</html>
<<<<<<< HEAD=======<!DOCTYPE html>
    <html lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Confirmaci�n de Correo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
        <link href="../librer�as/tailwind.min.css" rel="stylesheet">
        <link href="../css/styles.css" rel="stylesheet">
        <script src="../js/utils/theme-manager.js"></script>
        <script src="../js/ui/theme-toggle.js"></script>
    </head>

    <body class="bg-gray-100 flex items-center justify-center h-screen">
        <div class="container mx-auto p-6 max-w-md bg-white shadow-md rounded-lg text-center">
            <h1 id="statusTitle" class="text-2xl font-bold mb-4 text-blue-600">Verificando tu correo...</h1>
            <p id="statusMessage" class="text-gray-700 mb-6">Por favor, espera un momento mientras procesamos tu
                confirmaci�n.</p>
            <p id="detailsMessage" class="text-gray-600 mb-4"></p>
            <a href="../index.html"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-2 inline-block">
                Ir al Inicio de Sesi�n
            </a>
        </div>
        <script src="../js/ui/mobile-optimizer.js"></script>
        <script type="module">
            import { supabase } from '../js/auth/auth.js';

            const statusTitleEl = document.getElementById('statusTitle');
            const statusMessageEl = document.getElementById('statusMessage');
            const detailsMessageEl = document.getElementById('detailsMessage');

            // Supabase maneja la confirmaci�n del token en el backend antes de redirigir aqu�.
            // Esta p�gina muestra el resultado basado en los par�metros de la URL o el estado de la sesi�n.

            const urlParams = new URLSearchParams(window.location.search);
            const errorDescription = urlParams.get('error_description');
            // const errorCode = urlParams.get('error'); // Podr�as usarlo para errores m�s espec�ficos

            if (errorDescription) {
                statusTitleEl.textContent = 'Error en la Confirmaci�n';
                statusTitleEl.classList.remove('text-blue-600', 'text-green-600');
                statusTitleEl.classList.add('text-red-600');
                statusMessageEl.textContent = 'No pudimos confirmar tu direcci�n de correo electr�nico.';
                detailsMessageEl.textContent = `Detalles: ${decodeURIComponent(errorDescription)}`;
                detailsMessageEl.classList.add('text-red-500');
            } else {
                // Si no hay error en la URL, la confirmaci�n fue procesada por Supabase.
                // Esto puede significar que el correo se confirm� ahora o ya estaba confirmado.
                statusTitleEl.textContent = '¡Correo Verificado!';
                statusTitleEl.classList.remove('text-blue-600', 'text-red-600');
                statusTitleEl.classList.add('text-green-600');
                statusMessageEl.textContent = 'Tu direcci�n de correo electr�nico ha sido verificada exitosamente.';
                detailsMessageEl.textContent = 'Ya puedes cerrar esta ventana e iniciar sesi�n.';

                // onAuthStateChange puede dar feedback adicional si la confirmaci�n tambi�n inicia sesi�n.
                supabase.auth.onAuthStateChange((event, session) => {
                    if (event === 'SIGNED_IN' && session) {
                        detailsMessageEl.textContent = 'Has iniciado sesi�n autom�ticamente. ¡Bienvenido!';
                    } else if (event === 'USER_UPDATED' && session?.user?.email_confirmed_at) {
                        // El correo est� confirmado, el mensaje por defecto ya es apropiado.
                        // Puedes a�adir algo m�s si es necesario.
                    }
                });
            }
        </script>
    </body>

    </html>
    >>>>>>> 1e3239b (feat: A�adir enlace para recuperaci�n de contrase�a en la p�gina de inicio de sesi�n y mejorar
    mensajes de confirmaci�n de correo)
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Producto - Sistema de Gestión de Productos</title>
    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <!-- Cambiamos Quagga por Html5QrCode -->
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../librerías/sweetalert2@11.js"></script>
    <!-- Añadir JsBarcode para códigos de barra -->
    <script src="../librerías/JsBarcode.all.min.js"></script>
    <!-- Añadir jsPDF para generación de PDFs -->
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Consulta de Producto</h1>

    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="consulta" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Consulta de Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">Menú</button>

        <!-- Sistema de pestañas -->
        <div class="mb-4 mt-4">
            <nav class="flex border-b">
                <button id="tab-busqueda" class="tab-button border-b-2 border-blue-500 text-blue-600 px-4 py-2 font-semibold">Búsqueda</button>
                <button id="tab-relaciones" class="tab-button border-b-2 border-transparent text-gray-500 px-4 py-2 font-semibold">Relaciones</button>
            </nav>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-busqueda" class="tab-content">
            <form id="formConsultaProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoConsulta">Código/PLU:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoConsulta" type="text">
                        <button type="button" id="escanearBtnConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear Código de Barras</button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreConsulta">Nombre:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="nombreConsulta" type="text">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaConsulta">Categoría:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="categoriaConsulta" type="text">
                </div>
                <div class="flex items-center justify-between">
                    <button id="buscarConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">Buscar Producto</button>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
        </div>
        <div id="content-relaciones" class="tab-content" style="display:none;">
            <form id="formRelaciones" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoRelacion">Código del producto:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoRelacion" type="text" placeholder="Escanea o ingresa el código o últimos 4 dígitos">
                        <button type="button" id="escanearBtnRelacion" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear</button>
                        <button type="button" id="buscarRelacion" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Buscar Relación</button>
                    </div>
                </div>
            </form>
            <div id="relaciones" class="mt-4"></div>
        </div>

        <!-- Modificamos el contenedor del escáner -->
        <!-- En plantillas/consulta.html -->
        <div id="scanner-container-consulta" class="mt-4" style="display: none;">
            <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
            <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
        </div>

        <!-- Div to hold the barcode -->
        <div id="barcodeContainer" class="mt-4"></div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Búsqueda relacional de productos con pestañas
        document.addEventListener('DOMContentLoaded', function() {
            const codigoConsulta = document.getElementById('codigoConsulta');
            aplicarConversionCodigo(codigoConsulta);
            // Para la pestaña de relaciones
            const codigoRelacion = document.getElementById('codigoRelacion');
            if (codigoRelacion) aplicarConversionCodigo(codigoRelacion);

            // Tabs
            const tabBusqueda = document.getElementById('tab-busqueda');
            const tabRelaciones = document.getElementById('tab-relaciones');
            const contentBusqueda = document.getElementById('content-busqueda');
            const contentRelaciones = document.getElementById('content-relaciones');
            const relacionesDiv = document.getElementById('relaciones');
            let ultimoProducto = null;

            function switchTab(tab) {
                if (tab === 'busqueda') {
                    tabBusqueda.classList.add('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.remove('border-transparent', 'text-gray-500');
                    tabRelaciones.classList.remove('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'block';
                    contentRelaciones.style.display = 'none';
                } else {
                    if (tabRelaciones.disabled) return; // No cambiar si está deshabilitada
                    tabRelaciones.classList.add('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.remove('border-transparent', 'text-gray-500');
                    tabBusqueda.classList.remove('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'none';
                    contentRelaciones.style.display = 'block';
                }
            }
            tabBusqueda.addEventListener('click', () => switchTab('busqueda'));
            tabRelaciones.addEventListener('click', () => switchTab('relaciones'));
            switchTab('busqueda');

            const buscarBtn = document.getElementById('buscarConsulta');
            const resultadosDiv = document.getElementById('resultados');

            buscarBtn.addEventListener('click', async function() {
                resultadosDiv.innerHTML = '';
                ultimoProducto = null;
                const codigoInput = document.getElementById('codigoConsulta').value.trim();
                const nombre = document.getElementById('nombreConsulta').value.trim();
                const categoria = document.getElementById('categoriaConsulta').value.trim();

                // Buscar primero en IndexedDB para obtener el código completo
                function buscarEnIndexedDB(codigo, nombre, categoria) {
                    return new Promise((resolve, reject) => {
                        if (!window.indexedDB) {
                            resolve(null);
                            return;
                        }
                        const request = window.indexedDB.open('InventarioDB', 1);
                        request.onerror = function() { resolve(null); };
                        request.onsuccess = function(event) {
                            const db = event.target.result;
                            const tx = db.transaction(['productos'], 'readonly');
                            const store = tx.objectStore('productos');
                            const allReq = store.getAll();
                            allReq.onsuccess = function(e) {
                                const productos = e.target.result || [];
                                let encontrados = [];
                                if (codigo) {
                                    if (codigo.length === 4) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo.endsWith(codigo));
                                    } else if (codigo.length === 13) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    } else {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    }
                                } else if (nombre || categoria) {
                                    encontrados = productos.filter(p => {
                                        let match = true;
                                        if (nombre) match = match && p.nombre && p.nombre.toLowerCase().includes(nombre.toLowerCase());
                                        if (categoria) match = match && p.categoria && p.categoria.toLowerCase().includes(categoria.toLowerCase());
                                        return match;
                                    });
                                }
                                resolve(encontrados);
                            };
                            allReq.onerror = function() { resolve(null); };
                        };
                    });
                }

                const productosLocal = await buscarEnIndexedDB(codigoInput, nombre, categoria);
                if (!productosLocal || productosLocal.length === 0) {
                    resultadosDiv.innerHTML = '<div class="text-red-600 font-semibold">No se encontraron productos en el dispositivo.</div>';
                    return;
                }

                // Mostrar resultados principales
                productosLocal.forEach((producto, idx) => {
                    let html = `<div class="bg-white rounded shadow p-4 mb-4">
                        <h3 class="text-xl font-bold mb-2">${producto.nombre}</h3>
                        <div><b>Código:</b> ${producto.codigo}</div>
                        <div><b>Categoría:</b> ${producto.categoria}</div>
                        <div><b>Marca:</b> ${producto.marca}</div>
                        <div><b>Unidad:</b> ${producto.unidad}</div>
                    </div>`;
                    resultadosDiv.innerHTML += html;
                    if (idx === 0) ultimoProducto = producto;
                });
            });

            // Lógica independiente para la pestaña de relaciones
            const buscarRelacionBtn = document.getElementById('buscarRelacion');
            if (buscarRelacionBtn) {
                buscarRelacionBtn.addEventListener('click', async function() {
                    relacionesDiv.innerHTML = '';
                    let codigo = document.getElementById('codigoRelacion').value.trim();
                    if (!codigo) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Ingresa un código para buscar relaciones.</div>';
                        return;
                    }
                    // Permitir búsqueda por últimos 4 dígitos
                    if (codigo.length === 4) {
                        // Buscar en Supabase todos los productos cuyo substring(2,5) sea igual a esos 4 dígitos
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        // Traer todos los códigos y filtrar en JS (por compatibilidad universal)
                        const { data: productosTodos } = await supabase.from('productos').select('codigo');
                        const productos4 = (productosTodos || []).filter(p => typeof p.codigo === 'string' && p.codigo.length >= 5 && p.codigo.substring(1,5) === codigo);
                        if (productos4.length > 0) {
                            if (productos4.length > 1) {
                                relacionesDiv.innerHTML = `<div class='mb-2'>Se encontraron varios productos con los dígitos 2-5 <b>${codigo}</b>:</div>`;
                                productos4.forEach(p => {
                                    relacionesDiv.innerHTML += `<button class='bg-blue-100 hover:bg-blue-300 text-blue-800 px-2 py-1 rounded m-1' onclick='document.getElementById("codigoRelacion").value="${p.codigo}";document.getElementById("buscarRelacion").click();return false;'>${p.codigo}</button>`;
                                });
                                return;
                            } else {
                                codigo = productos4[0].codigo;
                                document.getElementById('codigoRelacion').value = codigo;
                            }
                        } else {
                            relacionesDiv.innerHTML = `<div class='text-red-600'>No se encontró ningún producto con los dígitos 2-5 igual a <b>${codigo}</b>.</div>`;
                            return;
                        }
                    }
                    relacionesDiv.innerHTML = '<div class="text-gray-500">Buscando relaciones...</div>';
                    try {
                        const { obtenerRelacionesProductosSupabase, buscarRelacionProducto } = await import('../js/relaciones-productos.js');
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        const relaciones = await obtenerRelacionesProductosSupabase();
                        const resultado = buscarRelacionProducto(codigo, relaciones);
                        // Buscar info del producto consultado
                        let relHtml = `<div class="bg-white rounded shadow p-4 mb-4">
                            <h3 class="text-lg font-bold mb-2">Relaciones para: <span class='font-mono'>${codigo}</span></h3>`;
                        const { data: productoInfo } = await supabase.from('productos').select('*').eq('codigo', codigo);
                        if (productoInfo && productoInfo.length > 0) {
                            const p = productoInfo[0];
                            relHtml += `<div class='mb-2 text-sm text-gray-700'>${p.nombre} | ${p.unidad || ''} | ${p.categoria || ''} | ${p.marca || ''}</div>`;
                        }
                        // Si es principal, mostrar subproductos
                        if (resultado.tipo === 'principal' && resultado.subproductos.length > 0) {
                            // Buscar info de subproductos
                            const { data: subproductosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos);
                            relHtml += `<div class="mt-2"><b>Subproductos relacionados:</b>
                            <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                            resultado.subproductos.forEach(subCodigo => {
                                const sub = subproductosInfo ? subproductosInfo.find(p => p.codigo === subCodigo) : null;
                                if (sub) {
                                    relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                } else {
                                    relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                }
                            });
                            relHtml += '</tbody></table></div>';
                        }
                        // Si es subproducto, mostrar principal y hermanos
                        if (resultado.tipo === 'subproducto' && resultado.principal) {
                            // Buscar info del principal
                            const { data: principalArr } = await supabase.from('productos').select('*').eq('codigo', resultado.principal);
                            if (principalArr && principalArr.length > 0) {
                                const principal = principalArr[0];
                                relHtml += `<div class="mt-4"><b>Producto principal:</b>
                                    <div class="bg-gray-50 rounded p-2 mt-1">
                                        <b>${principal.nombre}</b> (Código: ${principal.codigo})<br>
                                        Categoría: ${principal.categoria} | Marca: ${principal.marca} | Unidad: ${principal.unidad}
                                    </div>
                                </div>`;
                            } else {
                                relHtml += `<div class="mt-4"><b>Producto principal:</b> <span class='text-gray-400'>${resultado.principal} (No encontrado)</span></div>`;
                            }
                            // Mostrar hermanos (otros subproductos)
                            if (resultado.subproductos.length > 1) {
                                const { data: hermanosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos.filter(c => c !== codigo));
                                relHtml += `<div class="mt-2"><b>Otros subproductos relacionados:</b>
                                <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                                resultado.subproductos.forEach(subCodigo => {
                                    if (subCodigo === codigo) return;
                                    const sub = hermanosInfo ? hermanosInfo.find(p => p.codigo === subCodigo) : null;
                                    if (sub) {
                                        relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                    } else {
                                        relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                    }
                                });
                                relHtml += '</tbody></table></div>';
                            }
                        }
                        if (resultado.tipo === 'ninguno') {
                            relHtml += '<div class="mt-2 text-gray-400">Este producto no tiene relaciones registradas.</div>';
                        }
                        relHtml += '</div>';
                        relacionesDiv.innerHTML = relHtml;
                    } catch (e) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Error al consultar relaciones: ' + (e.message || e) + '</div>';
                    }
                });
            }

            // El manejo del botón de escanear ya lo realiza `main.js` (evitamos listeners duplicados).
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#">
    <title>Editar Producto - Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <script src="../librerías/html5-qrcode.min.js"></script>
    <link rel="stylesheet" href="../librerías/tailwind.min.css" />
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">

    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Editar Producto</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Editar Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Pestañas -->
        <div class="mb-6 mt-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-editar-individual"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button active">
                        Edición Individual
                    </button>
                    <button id="tab-editar-tabla"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Edición por Tabla
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-editar-individual" class="tab-content">
            <form id="formEditarProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoEditar">
                        Código/PLU:
                    </label>
                    <div class="flex">
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="codigoEditar" type="text" required />
                        <button type="button" id="escanearBtnEditar"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                            Escanear Código de Barras
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <button id="buscarEditar"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="button">
                        Buscar
                    </button>
                </div>
                <div id="formularioEdicion" style="display: none">
                    <!-- Campo de código editable -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo">
                            Código
                        </label>
                        <input type="text" id="codigoEditado"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreEditar">
                            Nombre:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="nombreEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaEditar">
                            Categoría:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="categoriaEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="marcaEditar">
                            Marca/Proveedor:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="marcaEditar" type="text" required />
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="unidadEditar">
                            Unidad:
                        </label>
                        <input type="text" id="unidadEditar"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="flex items-center justify-between">
                        <button id="guardarCambios"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Guardar Cambios
                        </button>
                        <button id="eliminarProducto"
                            class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Eliminar Producto
                        </button>
                    </div>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
            <div id="scanner-container-editar" class="mt-4" style="display: none">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>
        </div>

        <!-- Pestaña Edición por Tabla -->
        <div id="content-editar-tabla" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Edición por Tabla</h3>
                <form id="formBuscarTabla" class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoBuscarTabla">
                        Buscar por Código de Producto Primario o Subproducto:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="codigoBuscarTabla" type="text" placeholder="Ej: 1234 o 201670000004" required />
                    <button type="submit"
                        class="mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Buscar</button>
                </form>
                <div id="tabla-edicion-resultados"></div>
                <div id="tabla-edicion-resultados"></div>
                <script type="module">
                    import { db, inicializarDB } from '../js/db-operations.js';
                    import { obtenerRelacionesProductosSupabase, buscarRelacionProducto } from '../js/relaciones-productos.js';
                    // Exponer para main.js si se requiere (opcional)
                    window.obtenerRelacionesProductosSupabase = obtenerRelacionesProductosSupabase;
                    window.buscarRelacionProducto = buscarRelacionProducto;

                    // Lógica de búsqueda y edición en tabla
                    document.getElementById('formBuscarTabla').addEventListener('submit', function (e) {
                        e.preventDefault();
                        const codigo = document.getElementById('codigoBuscarTabla').value.trim();
                        const resultadosDiv = document.getElementById('tabla-edicion-resultados');
                        resultadosDiv.innerHTML = `<div class='text-gray-600'>Sincronizando productos y relaciones...</div>`;

                        (async () => {
                            console.log('[DEBUG] db antes de inicializar:', db);
                            let dbReady = db;
                            if (!dbReady) {
                                resultadosDiv.innerHTML = `<div class='text-gray-600'>Inicializando base de datos local...</div>`;
                                try {
                                    await inicializarDB();
                                } catch (err) {
                                    console.error('[DEBUG] Error al inicializarDB:', err);
                                }
                                dbReady = db;
                                console.log('[DEBUG] db después de inicializar:', dbReady);
                            }
                            if (!dbReady) {
                                console.error('[DEBUG] IndexedDB sigue sin inicializar tras inicializarDB.');
                                resultadosDiv.innerHTML = `<div class='text-red-600'>IndexedDB no inicializado.</div>`;
                                return;
                            }
                            // 1. Sincronizar productos desde Supabase a IndexedDB y obtener relaciones
                            Promise.all([
                                importarProductosSupabaseAIndexedDB(dbReady),
                                obtenerRelacionesProductosSupabase()
                            ]).then(([_, relaciones]) => {
                                // 2. Buscar relación en el Map
                                const relacion = buscarRelacionProducto(codigo, relaciones);
                                // 3. Buscar detalles de productos en IndexedDB
                                buscarProductosRelacionadosConMap(dbReady, codigo, relacion, resultadosDiv);
                            }).catch(err => {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al sincronizar: ${err.message || err}`;
                            });
                        })();

                        // --- Función para importar productos de Supabase a IndexedDB ---
                        async function importarProductosSupabaseAIndexedDB(dbInstance) {
                            if (!window.getSupabase) throw new Error('No se encontró getSupabase.');
                            const supabase = await window.getSupabase();
                            const { data: productos, error } = await supabase.from('productos').select('*');
                            if (error) throw error;
                            if (!dbInstance) throw new Error('IndexedDB no inicializado');
                            return new Promise((resolve, reject) => {
                                const transaction = dbInstance.transaction(['productos'], 'readwrite');
                                const objectStore = transaction.objectStore('productos');
                                const clearReq = objectStore.clear();
                                clearReq.onsuccess = function () {
                                    productos.forEach(prod => {
                                        const p = {
                                            codigo: prod.codigo,
                                            nombre: prod.nombre,
                                            categoria: prod.categoria,
                                            marca: prod.marca,
                                            unidad: prod.unidad
                                        };
                                        objectStore.put(p);
                                    });
                                    transaction.oncomplete = resolve;
                                    transaction.onerror = reject;
                                };
                                clearReq.onerror = reject;
                            });
                        }

                        // --- Función para buscar productos relacionados usando el Map de relaciones ---
                        function buscarProductosRelacionadosConMap(dbInstance, codigo, relacion, resultadosDiv) {
                            const transaction = dbInstance.transaction(['productos'], 'readonly');
                            const objectStore = transaction.objectStore('productos');
                            const getAllReq = objectStore.getAll();
                            getAllReq.onsuccess = function (e) {
                                const productos = e.target.result;
                                // Buscar producto exacto (por código completo o 4 dígitos)
                                let producto = productos.find(p => p.codigo === codigo || p.codigo.endsWith(codigo));
                                if (!producto) {
                                    resultadosDiv.innerHTML = `<div class='text-red-600'>No se encontró el producto <b>${codigo}</b>.</div>`;
                                    return;
                                }
                                // Buscar principal y subproductos según el Map
                                let productoPrincipal = null;
                                let subproductos = [];
                                if (relacion.tipo === 'principal') {
                                    productoPrincipal = producto;
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                } else if (relacion.tipo === 'subproducto') {
                                    productoPrincipal = productos.find(p => p.codigo === relacion.principal);
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                }
                                // Mostrar resultados
                                let html = '';
                                // Producto encontrado (si es principal, mostrar botón editar principal)
                                html += `<div class='mb-4'><b>Producto encontrado:</b><br>${producto.codigo} - ${producto.nombre} (${producto.categoria})<br>Marca: ${producto.marca} | Unidad: ${producto.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${producto.codigo}'>Editar</button></div>`;
                                // Si hay producto principal distinto, mostrarlo con botón editar
                                if (productoPrincipal && productoPrincipal.codigo !== producto.codigo) {
                                    html += `<div class='mb-4'><b>Producto Principal:</b><br>${productoPrincipal.codigo} - ${productoPrincipal.nombre} (${productoPrincipal.categoria})<br>Marca: ${productoPrincipal.marca} | Unidad: ${productoPrincipal.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${productoPrincipal.codigo}'>Editar</button></div>`;
                                }
                                if (subproductos.length > 0) {
                                    html += `<div class='mb-2'><b>Subproductos relacionados:</b> <button id='expand-relacionados' class='ml-2 px-2 py-1 bg-blue-200 rounded'>Ver relacionados</button></div><ul class='mb-4' id='lista-relacionados' style='display:none;'>`;
                                    subproductos.forEach(sp => {
                                        html += `<li class='mb-1'>${sp.codigo} - ${sp.nombre} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${sp.codigo}'>Editar</button></li>`;
                                    });
                                    html += '</ul>';
                                }
                                resultadosDiv.innerHTML = html;
                                // Botón para expandir/collapse relacionados
                                const expandBtn = resultadosDiv.querySelector('#expand-relacionados');
                                const listaRelacionados = resultadosDiv.querySelector('#lista-relacionados');
                                if (expandBtn && listaRelacionados) {
                                    expandBtn.addEventListener('click', () => {
                                        listaRelacionados.style.display = listaRelacionados.style.display === 'none' ? 'block' : 'none';
                                        expandBtn.textContent = listaRelacionados.style.display === 'none' ? 'Ver relacionados' : 'Ocultar relacionados';
                                    });
                                }
                                // Agregar listeners a los botones de edición
                                resultadosDiv.querySelectorAll('.edit-btn').forEach(btn => {
                                    btn.addEventListener('click', function () {
                                        const codigoEditar = btn.dataset.codigo;
                                        // Buscar el producto en la lista de productos
                                        const prod = productos.find(p => p.codigo === codigoEditar);
                                        if (!prod) {
                                            Swal.fire('Error', 'No se encontró el producto en la base local.', 'error');
                                            return;
                                        }
                                        // Rellenar el formulario de edición individual
                                        document.getElementById('codigoEditar').value = prod.codigo;
                                        document.getElementById('codigoEditado').value = prod.codigo;
                                        document.getElementById('nombreEditar').value = prod.nombre;
                                        document.getElementById('categoriaEditar').value = prod.categoria;
                                        document.getElementById('marcaEditar').value = prod.marca;
                                        document.getElementById('unidadEditar').value = prod.unidad;
                                        // Mostrar el formulario de edición si está oculto
                                        document.getElementById('formularioEdicion').style.display = '';
                                        // Cambiar a la pestaña de Edición Individual
                                        const tabButtons = document.querySelectorAll('.tab-button');
                                        const tabContents = document.querySelectorAll('.tab-content');
                                        tabButtons.forEach(btn => {
                                            btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                                            btn.classList.add('border-transparent', 'text-gray-500');
                                        });
                                        tabContents.forEach(content => {
                                            content.style.display = 'none';
                                        });
                                        document.getElementById('tab-editar-individual').classList.add('active', 'border-blue-500', 'text-blue-600');
                                        document.getElementById('tab-editar-individual').classList.remove('border-transparent', 'text-gray-500');
                                        document.getElementById('content-editar-individual').style.display = 'block';
                                        // Scroll al formulario de edición
                                        document.getElementById('formEditarProducto').scrollIntoView({ behavior: 'smooth' });
                                    });
                                });
                            };
                            getAllReq.onerror = function () {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al buscar productos en IndexedDB.</div>`;
                            };
                        }
                    });
                </script>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Pestañas
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            function switchTab(targetTab) {
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });
                const activeButton = document.getElementById(`tab-${targetTab}`);
                activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');
                document.getElementById(`content-${targetTab}`).style.display = 'block';
            }
            document.getElementById('tab-editar-individual').addEventListener('click', () => switchTab('editar-individual'));
            document.getElementById('tab-editar-tabla').addEventListener('click', () => switchTab('editar-tabla'));

            // Aplicar conversión de guión a ceros en campos de código
            const codigoEditar = document.getElementById('codigoEditar');
            const codigoEditado = document.getElementById('codigoEditado');
            const codigoBuscarTabla = document.getElementById('codigoBuscarTabla');
            aplicarConversionCodigo(codigoEditar);
            aplicarConversionCodigo(codigoEditado);
            aplicarConversionCodigo(codigoBuscarTabla);


        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link href="../librerías/tailwind.min.css" rel="stylesheet">
    <script src="../librerías/sweetalert2@11.js"></script>
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Inventario</h1>
        <div class="flex items-center space-x-4">
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="inventario" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6 dark-theme-title">Inventario</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Nuevo div para mostrar la ubicación actual -->
        <div class="mb-4 p-4 bg-white shadow-md rounded">
            <h2 class="text-xl font-bold mb-2">Ubicación Actual: <span id="ubicacionActual"></span></h2>
            <button id="cambiarUbicacion" class="bg-yellow-500 text-white px-4 py-2">Cambiar Ubicación</button>
        </div>

        <!-- Pestañas principales de inventario -->
        <div class="mb-6">
            <div class="flex border-b bg-white shadow-sm rounded-t-lg">
                <button id="tabInventarioManual"
                    class="px-6 py-3 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500 font-semibold">
                    📦 Inventario Manual
                </button>
                <button id="tabLotesAvanzado"
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300 font-semibold">
                    🚀 Inventario por Lotes Avanzado
                </button>
            </div>
        </div>

        <!-- Contenido de Inventario Manual -->
        <div id="contenidoInventarioManual" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <!-- Formulario de búsqueda de inventario -->
            <div class="mb-4">
                <label for="codigo" class="block mb-2">Código/PLU:</label>
                <div class="flex">
                    <input type="text" id="codigo" class="border p-2 w-full">
                    <button id="escanearBtn" class="bg-blue-500 text-white px-4 py-2 ml-2">Escanear Código</button>
                </div>
            </div>

            <div class="mb-4">
                <label for="nombreInventario" class="block mb-2">Nombre:</label>
                <input type="text" id="nombreInventario" class="border p-2 w-full">
            </div>

            <div class="mb-4">
                <label for="marcaInventario" class="block mb-2">Marca:</label>
                <input type="text" id="marcaInventario" class="border p-2 w-full">
            </div>

            <button id="buscarInventario" class="bg-green-500 text-white px-4 py-2 mb-4">Buscar Producto</button>

            <div id="resultadosInventario" class="mt-4" style="display: none;">
                <!-- Los resultados de la búsqueda se mostrarán aquí -->
            </div>

            <div id="datosInventario" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
                <!-- Pestañas para productos tipo Kg -->
                <div id="tabsContainer" class="mb-6" style="display: none;">
                    <div class="flex border-b">
                        <button id="tabInventario"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            Inventario Normal
                        </button>
                        <button id="tabLotes"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            Lotes
                        </button>
                    </div>
                </div>

                <!-- Formulario de inventario normal -->
                <div id="formularioInventarioNormal">
                    <div class="mb-4">
                        <label for="codigoProductoInventario" class="block mb-2">Codigo del Producto:</label>
                        <input type="text" id="codigoProductoInventario" class="border p-2 w-full" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="nombreProductoInventario" class="block mb-2">Nombre del Producto:</label>
                        <input type="text" id="nombreProductoInventario" class="border p-2 w-full" readonly>
                    </div>

                    <div class="mb-4">
                        <label for="unidadProducto" class="block mb-2">Unidad:</label>
                        <input type="text" id="unidadProducto" class="border p-2 w-full" readonly>
                        <!-- Mostrar la unidad como texto -->
                    </div>

                    <div class="mb-4">
                        <label for="cantidad" class="block mb-2">Cantidad:</label>
                        <input type="number" id="cantidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-4">
                        <label for="fechaCaducidad" class="block mb-2">Fecha de Caducidad:</label>
                        <input type="date" id="fechaCaducidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-6">
                        <label for="comentarios" class="block mb-2">Comentarios:</label>
                        <textarea id="comentarios" class="border p-2 w-full"></textarea>
                    </div>

                    <div id="botonguardar" class="flex items-center justify-between">
                        <button id="guardarInventario" class="bg-blue-500 text-white px-4 py-2">Guardar
                            Inventario</button>
                    </div>
                    <div id="botonmodificar" class="flex items-center justify-between" style="display: none;">
                        <button id="modificarInventario" class="bg-blue-500 text-white px-4 py-2">Modificar
                            Inventario</button>
                    </div>
                </div>

                <!-- Formulario de escaneo por lotes para productos Kg -->
                <div id="formularioLotes" style="display: none;">
                    <div class="bg-blue-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-bold mb-3 text-blue-800">Información del Producto</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Código:</label>
                                <span id="codigoProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre:</label>
                                <span id="nombreProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Unidad:</label>
                                <span id="unidadProductoLotes" class="text-sm font-semibold text-green-600">Kg</span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoría:</label>
                                <span id="categoriaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Marca:</label>
                                <span id="marcaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label for="precioKilo" class="block text-sm font-medium text-gray-700 mb-2">Precio por Kilo
                            ($):</label>
                        <input type="number" id="precioKilo" step="0.01" min="0"
                            class="border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Ingrese el precio por kilogramo">
                    </div>

                    <div class="text-center">
                        <button id="iniciarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            📱 Iniciar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>

            <div id="mensaje" class="mt-4"></div>

            <div id="scanner-container-inventario" class="mt-4" style="display: none;">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>

            <button id="generarHojaInventario" class="bg-purple-500 text-white px-4 py-2 mt-4">Generar Hoja de
                Inventario</button>
        </div>

        <!-- Contenido de Inventario por Lotes Avanzado -->
        <div id="contenidoLotesAvanzado" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
            <!-- Panel de alerta y configuración -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-yellow-800">Inventario por Lotes Avanzado</h3>
                        <div class="mt-2 text-sm text-yellow-700">
                            <ul class="list-disc list-inside space-y-1">
                                <li>Solo se pueden contar productos con unidad tipo <strong>Kg</strong></li>
                                <li>El escaneo será automático sin necesidad de búsqueda previa</li>
                                <li>Se extraerán automáticamente PLU, peso y precio desde códigos CODE128</li>
                                <li>Los productos se agruparán por productos primarios y subproductos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel de configuración -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-4 text-gray-800">⚙️ Configuración de Escaneo</h3>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="confirmarProductosSimilares"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                        <label for="confirmarProductosSimilares" class="text-sm font-medium text-gray-700">
                            Mostrar ventana de confirmación para productos similares
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="agruparAutomaticamente"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="agruparAutomaticamente" class="text-sm font-medium text-gray-700">
                            Agrupar automáticamente productos con el mismo PLU
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="sonidoConfirmacion"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="sonidoConfirmacion" class="text-sm font-medium text-gray-700">
                            Reproducir sonido de confirmación al escanear
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="relacionarProductos"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="relacionarProductos" class="text-sm font-medium text-gray-700">
                            Relacionar productos (buscar en productos_subproductos)
                        </label>
                    </div>
                </div>
            </div>

            <!-- Botón para iniciar escaneo -->
            <div class="text-center mb-6">
                <button id="iniciarEscaneoLotesAvanzado"
                    class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform hover:scale-105 transition duration-200">
                    🚀 Iniciar Escaneo por Lotes Avanzado
                </button>
            </div>

            <!-- Área de resultados de productos escaneados -->
            <div id="resultadosLotesAvanzado" class="hidden">
                <h3 class="text-lg font-bold mb-4 text-gray-800">📊 Productos Escaneados</h3>
                <div id="contenedorProductosPrimarios" class="space-y-4">
                    <!-- Las tarjetas de productos primarios se mostrarán aquí -->
                </div>

                <!-- Botón para guardar inventario -->
                <div class="text-center mt-6">
                    <button id="guardarInventarioLotesAvanzado"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled>
                        💾 Guardar Inventario
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes Avanzado -->
        <div id="modalEscaneoLotesAvanzado"
            class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
            <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-5xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-900">🚀 Escaneo por Lotes Avanzado</h3>
                        <button id="cerrarModalLotesAvanzado" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscanerAvanzado"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListadoAvanzado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Productos Escaneados (<span id="contadorProductosAvanzado">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscanerAvanzado" class="mb-4">
                        <div id="scanner-container-lotes-avanzado" class="mb-4">
                            <div id="reader-lotes-avanzado" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="accionEscaneoLotesAvanzado"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-bold"
                                style="user-select:none;">
                                Activar escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListadoAvanzado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Nombre</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio/Kg</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Tipo</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoProductosAvanzado">
                                    <!-- Los productos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total productos: <span id="totalProductosAvanzado" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotalAvanzado" class="font-bold">0.000 Kg</span> |
                            Productos primarios: <span id="totalProductosPrimarios" class="font-bold">0</span>
                        </div>
                        <button id="finalizarEscaneoLotesAvanzado"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes Avanzado
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Edición de Producto de Lote -->
        <div id="modalEdicionProductoLote" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 10000;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-md shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">✏️ Editar Producto Escaneado</h3>
                        <button onclick="cerrarModalEdicionProducto()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Información del producto -->
                    <div class="mb-4 p-3 bg-gray-50 rounded">
                        <p class="text-sm"><strong>Producto:</strong> <span id="editProductoNombre" class="font-medium"></span></p>
                        <p class="text-sm"><strong>Código:</strong> <span id="editProductoCodigo" class="font-mono"></span></p>
                        <p class="text-sm"><strong>PLU:</strong> <span id="editProductoPLU" class="font-mono"></span></p>
                        <input type="hidden" id="editProductoId">
                    </div>

                    <!-- Campos editables -->
                    <div class="space-y-4">
                        <!-- Precio por Kilo -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                💰 Precio por Kilo ($)
                            </label>
                            <input type="number" id="editPrecioKilo" step="0.01" min="0.01"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el precio por kilo era diferente al momento de crear la etiqueta
                            </p>
                        </div>

                        <!-- Peso -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                ⚖️ Peso (Kg)
                            </label>
                            <input type="number" id="editPeso" step="0.001" min="0.001"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.000">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el peso calculado no es correcto (recalcula precio automáticamente)
                            </p>
                        </div>

                        <!-- Precio de Porción (solo lectura, se actualiza automáticamente) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                🏷️ Precio de Porción ($)
                            </label>
                            <input type="number" id="editPrecioPorcion" step="0.01" min="0.01" readonly
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                ℹ️ Se calcula automáticamente: Precio/Kg × Peso
                            </p>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="cerrarModalEdicionProducto()"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button onclick="guardarEdicionProducto()"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            💾 Guardar Cambios
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Información de Producto -->
        <div id="modalInfoProducto" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 9999;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">📋 Información del Producto</h3>
                        <button id="cerrarModalInfoProducto" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Contenido del modal -->
                    <div id="contenidoInfoProducto">
                        <!-- Se llenará dinámicamente -->
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button id="cancelarInfoProducto"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button id="guardarInfoProducto"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            Guardar Info
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes (original) -->
        <div id="modalEscaneoLotes" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
            style="display: none;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">Escaneo por Lotes</h3>
                        <button id="cerrarModalLotes" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscaner"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Códigos Escaneados (<span id="contadorCodigos">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscaner" class="mb-4">
                        <div id="scanner-container-lotes" class="mb-4">
                            <div id="reader-lotes" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="pararEscaneoLotes"
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                                Pausar Escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código Completo</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoCodigosEscaneados">
                                    <!-- Los códigos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total de códigos: <span id="totalCodigos" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotal" class="font-bold">0.00 Kg</span> |
                            Valor total porciones: <span id="precioTotalGeneral" class="font-bold">$0.00</span>
                        </div>
                        <button id="finalizarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- tabla de productos en inventario -->
    <div>
        <button id="sync-inventario-down-btn"
            class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Inventario desde Supabase
        </button>
        <button id="sincronizarManual" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Ahora
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4"> Productos en Inventario </h2>
        <div class="overflow-x-auto">
            <table id="estructura-plantilla" class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">Código</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categoría</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Tipo de Cantidad</th>
                        <th class="py-3 px-6 text-left">Cantidad</th>
                        <th class="py-3 px-6 text-left">Fecha de Caducidad</th>
                        <th class="py-3 px-6 text-left">Comentarios</th>
                        <th class="py-3 px-6 text-left">ubicacion</th>
                    </tr>
                </thead>
                <tbody id="estructuraPlantillaBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/scanner/lotes-avanzado.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;

            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);

                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;

                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversión a los campos de código cuando se cargue la página
        document.addEventListener('DOMContentLoaded', function () {
            const codigo = document.getElementById('codigo');
            const codigoProductoInventario = document.getElementById('codigoProductoInventario');

            aplicarConversionCodigo(codigo);
            // Note: codigoProductoInventario es readonly, pero aplicamos por si acaso
            aplicarConversionCodigo(codigoProductoInventario);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Sistema de Gestión de Productos</h1>
        <div class="flex items-center space-x-4">
            <!-- Indicador de estado del backend -->
            <div id="backendStatus" class="px-3 py-1 rounded-full text-sm font-semibold" 
                 title="Estado de conexión con el backend"
                 style="background-color: #fbbf24; color: #78350f;">
                ⏳ Verificando...
            </div>
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t dark-theme-sidebar-footer">
            <button id="logoutBtn" class="w-full bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded dark-theme-button">
                Cerrar Sesión
            </button>
        </div>
    </div>

    <a href="../index.html" class="text-blue-500 hover:underline mb-4 inline-block dark-theme-link">← Regresar</a>
    <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200 dark-theme-menu-toggle">
        Menú
    </button>

    <main class="container mx-auto mt-8">
        <section id="dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div id="consulta" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Consulta de Producto</h2>
                <p class="mb-4 dark-theme-card-text">Busca productos en la base de datos por diferentes criterios.</p>
                <a id="consultaLink" href="./consulta.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Consulta
                    Producto</a>
            </div>

            <div id="editar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Editar Producto</h2>
                <p class="mb-4 dark-theme-card-text">Edita los atributos de los productos existentes en la base de
                    datos.</p>
                <a id="editarLink" href="./editar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Editar
                    Producto</a>
            </div>

            <div id="inventario" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona el inventario de productos con datos adicionales.</p>
                <a id="inventarioLink" href="./inventario.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Inventario</a>
            </div>

            <div id="reporte" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Reporte para Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Genera reportes detallados del inventario de productos.</p>
                <a id="reporteLink" href="./report.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Reporte
                    para Inventario</a>
            </div>

            <div id="agregar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Agregar Productos</h2>
                <p class="mb-4 dark-theme-card-text">Escanea y agrega nuevos productos a la base de datos.</p>
                <a id="agregarLink" href="./agregar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Agregar
                    Productos</a>
            </div>

            <div id="archivos" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Administración de Archivos</h2>
                <p class="mb-4 dark-theme-card-text">Sube o descarga archivos CSV para la base de datos.</p>
                <a id="archivosLink" href="./archivos.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Archivos</a>
            </div>

            <div id="configuraciones" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Configuraciones</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona las configuraciones del sistema, perfil de usuario y
                    preferencias.</p>
                <a id="configuracionesLink" href="./configuraciones.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Configuraciones</a>
            </div>
        </section>
    </main>

    <footer class="bg-blue-600 text-white p-4 mt-8 dark-theme-footer">
        <p class="text-center dark-theme-footer-text">&copy; 2024 Sistema de Gestión de Productos. Todos los derechos
            reservados.</p>
    </footer>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>    <script type="module">
        import { backendStatusMonitor } from '../js/backend-status.js';
        
        // Monitorear estado del backend
        document.addEventListener('DOMContentLoaded', () => {
            const backendStatusEl = document.getElementById('backendStatus');
            
            // Escuchar cambios de estado del backend
            window.addEventListener('backendStatusChanged', (event) => {
                const { available } = event.detail;
                
                if (available) {
                    backendStatusEl.textContent = '🟢 Backend activo';
                    backendStatusEl.style.backgroundColor = '#dcfce7'; // green-100
                    backendStatusEl.style.color = '#166534'; // green-800
                } else {
                    backendStatusEl.textContent = '🔴 Backend no disponible';
                    backendStatusEl.style.backgroundColor = '#fee2e2'; // red-100
                    backendStatusEl.style.color = '#991b1b'; // red-900
                    
                    // Mostrar alerta una sola vez
                    if (!window.backendDownNotified) {
                        setTimeout(() => {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Backend no disponible',
                                text: 'La aplicación funcionará en modo offline. Los cambios se sincronizarán cuando el servidor esté disponible.',
                                allowOutsideClick: false,
                                didOpen: (modal) => {
                                    // Cerrar automáticamente después de 5 segundos
                                    setTimeout(() => {
                                        Swal.close();
                                    }, 5000);
                                }
                            });
                        }, 500);
                        window.backendDownNotified = true;
                    }
                }
            });
            
            // Iniciar monitoreo (cada 30 segundos)
            backendStatusMonitor.startMonitoring(30);
        });
    </script>
    <script type="module">
        import { cerrarSesion } from '../js/auth/auth.js';
        
        // Manejar botón de logout
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    const { value: rememberUser } = await Swal.fire({
                        title: 'Cerrar Sesión',
                        text: '¿Deseas que se recuerde tu usuario para el próximo login?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Sí, recordar usuario',
                        cancelButtonText: 'No, no recordar',
                        allowOutsideClick: false
                    });
                    
                    // Si cancela, no hace nada
                    if (rememberUser === undefined) return;
                    
                    // Llamar función de logout
                    await cerrarSesion(rememberUser === true);
                });
            }
        });
    </script>    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menuToggle');
            const sideMenu = document.getElementById('sideMenu');
            const closeMenu = document.getElementById('closeMenu');
            const menuRoutes = document.getElementById('menuRoutes');
            const routes = [
                { name: 'Consulta de Producto', path: './consulta.html' },
                { name: 'Editar Producto', path: './editar.html' },
                { name: 'Inventario', path: './inventario.html' },
                { name: 'Registro de Entradas', path: './registro-entradas.html' },
                { name: 'Reporte para Inventario', path: './report.html' },
                { name: 'Agregar Productos', path: './agregar.html' },
                { name: 'Administración de Archivos', path: './archivos.html' },
                { name: 'Configuraciones', path: './configuraciones.html' }
            ];

            // Generar las rutas dinámicamente
            routes.forEach(route => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline dark-theme-nav-link">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            // Mostrar el menú
            menuToggle.addEventListener('click', () => {
                sideMenu.classList.remove('-translate-x-full');
            });

            // Ocultar el menú
            closeMenu.addEventListener('click', () => {
                sideMenu.classList.add('-translate-x-full');
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Entradas</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-green-600 text-white p-4 flex justify-between items-center shadow-lg">
        <div class="flex items-center space-x-3">
            <div class="p-2 bg-green-700 rounded-lg">
                📦
            </div>
            <h1 class="text-3xl font-bold tracking-wide">Registro de Entradas</h1>
        </div>
        <div class="flex items-center space-x-6">
            <div id="conexionStatus" class="text-sm flex items-center space-x-2 bg-green-700 px-3 py-1 rounded-full">
                <span class="status-indicator status-success"></span>
                <span>Conectado</span>
            </div>
            <div id="clockDisplay" class="text-sm font-mono bg-green-700 px-3 py-1 rounded-full"></div>
            <div class="text-sm bg-green-700 px-3 py-1 rounded-full">
                <span id="totalEntradas">0</span> entradas registradas
            </div>
        </div>
    </header>
    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform z-50">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>
    <div class="container mx-auto mt-8 p-4">
        <div class="mb-6 flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center space-x-4">
                <h1 class="text-4xl font-bold text-gray-800 flex items-center">
                    📦 Registro de Entradas
                    <span class="ml-3 text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                        Sistema de Gesti�n
                    </span>
                </h1>
            </div>
            <div class="flex items-center space-x-3">
                <a href="./main.html"
                    class="text-green-600 hover:text-green-800 hover:underline font-medium flex items-center space-x-2 transition-colors">
                    <span>←</span>
                    <span>Regresar al Men� Principal</span>
                </a>
                <button id="menuToggle"
                    class="bg-white text-green-600 px-4 py-2 rounded-lg hover:bg-green-50 border-2 border-green-600 font-semibold transition-all hover:shadow-md">
                    📋 Men� de Navegaci�n
                </button>
            </div>
        </div> <!-- Secci�n de b�squeda de productos -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                🔍 Buscar Producto
                <span id="searchStatus" class="ml-3 text-sm"></span>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="ultimaBusqueda"></span>
                </div>
            </h2>

            <div class="grid md:grid-cols-3 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ Buscar por C�digo:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaCodigo"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese c�digo del producto">
                        <button id="buscarPorCodigo"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnCodigoText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 Buscar por Nombre:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaNombre"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese nombre del producto">
                        <button id="buscarPorNombre"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnNombreText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 Buscar por Marca:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaMarca"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese marca del producto">
                        <button id="buscarPorMarca"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnMarcaText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-center">
                <button id="escanearBtn"
                    class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                    <span>📷</span>
                    <span>Escanear C�digo de Barras</span>
                </button>
            </div>

            <!-- Mensaje de b�squeda reciente -->
            <div id="busquedaReciente" class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 rounded"
                style="display: none;">
                <p class="text-sm text-blue-700">
                    <strong>B�squeda reciente:</strong> <span id="textoUltimaBusqueda"></span>
                </p>
            </div>
        </div> <!-- Formulario de datos del producto y entrada -->
        <div id="productForm"
            class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover"
            style="display: none;">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                📦 Datos del Producto
                <div id="productLoadingIndicator" class="ml-3" style="display: none;">
                    <div
                        class="inline-block w-4 h-4 border-2 border-green-500 border-t-transparent rounded-full animate-spin">
                    </div>
                    <span class="ml-2">Cargando informaci�n...</span>
                </div>
                <div class="ml-auto">
                    <span class="text-sm text-gray-500 bg-green-100 px-3 py-1 rounded-full">
                        Producto encontrado ✅
                    </span>
                </div>
            </h2>

            <div id="productInfo"
                class="grid md:grid-cols-2 gap-6 mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border-2 border-green-200 shadow-inner">
                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="codigoProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">C�digo del Producto:</span>
                        </label>
                        <input type="text" id="codigoProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-mono text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="nombreProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📝 <span class="ml-2">Nombre del Producto:</span>
                        </label>
                        <input type="text" id="nombreProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-semibold text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="marcaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏢 <span class="ml-2">Marca:</span>
                        </label>
                        <input type="text" id="marcaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="categoriaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📂 <span class="ml-2">Categor�a:</span>
                        </label>
                        <input type="text" id="categoriaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="unidadProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📏 <span class="ml-2">Unidad de Medida:</span>
                        </label>
                        <input type="text" id="unidadProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <!-- Informaci�n adicional del stock actual -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="text-sm font-semibold text-blue-700 mb-2">📊 Stock Actual</h4>
                        <div class="text-2xl font-bold text-blue-600" id="stockActual">--</div>
                        <div class="text-xs text-blue-500">unidades disponibles</div>
                    </div>
                </div>
            </div>
            <div class="border-t-2 border-gray-200 pt-8">
                <h3 class="text-lg font-semibold mb-6 text-green-600 flex items-center">
                    📝 Datos de la Entrada
                    <span class="ml-3 text-sm text-gray-500 bg-yellow-100 px-3 py-1 rounded-full">
                        * Campos obligatorios
                    </span>
                    <div class="ml-auto text-sm text-gray-400">
                        <span id="fechaActual"></span>
                    </div>
                </h3>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="transform transition-all hover:scale-105">
                        <label for="cantidadEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📊 <span class="ml-2">Cantidad Recibida *:</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="cantidadEntrada"
                                class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg font-semibold"
                                min="0.01" step="0.01" required placeholder="0.00">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <span id="unidadMedida">unidades</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">Ingrese la cantidad exacta recibida</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="fechaEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📅 <span class="ml-2">Fecha de Entrada *:</span>
                        </label>
                        <input type="date" id="fechaEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg"
                            required>
                        <div class="text-xs text-gray-500 mt-1">Fecha en que se recibi� el producto</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="loteEntrada" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">N�mero de Lote:</span>
                        </label>
                        <input type="text" id="loteEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                            placeholder="Opcional">
                        <div class="text-xs text-gray-500 mt-1">N�mero de lote del proveedor</div>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="comentariosEntrada"
                        class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        💬 <span class="ml-2">Comentarios y Observaciones:</span>
                    </label>
                    <textarea id="comentariosEntrada"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                        rows="4"
                        placeholder="Informaci�n adicional: estado del producto, observaciones del proveedor, condiciones especiales..."></textarea>
                </div>

                <div class="flex justify-between items-center bg-gray-50 p-4 rounded-lg">
                    <button id="limpiarFormulario"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>🗑️</span>
                        <span>Limpiar Formulario</span>
                    </button>
                    <button id="registrarEntrada"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnRegistrarText">✅ Registrar Entrada</span>
                    </button>
                </div>

                <!-- Resumen de la entrada -->
                <div id="resumenEntrada" class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded"
                    style="display: none;">
                    <h4 class="font-semibold text-blue-700 mb-2">📋 Resumen de la Entrada:</h4>
                    <div id="textoResumen" class="text-sm text-blue-600"></div>
                </div>
            </div>
        </div> <!-- Filtros y controles -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-blue-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-blue-600 flex items-center">
                🔧 Filtros y Controles del Sistema
                <div id="syncStatus" class="ml-3 text-sm"></div>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="estadoSistema" class="bg-green-100 text-green-700 px-3 py-1 rounded-full">
                        Sistema Operativo
                    </span>
                </div>
            </h2>

            <div class="grid md:grid-cols-4 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="filtroCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ <span class="ml-2">Filtrar por C�digo:</span>
                    </label>
                    <input type="text" id="filtroCodigo"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="C�digo del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 <span class="ml-2">Filtrar por Nombre:</span>
                    </label>
                    <input type="text" id="filtroNombre"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Nombre del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 <span class="ml-2">Filtrar por Marca:</span>
                    </label>
                    <input type="text" id="filtroMarca"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Marca del producto...">
                </div>

                <div class="flex items-end space-x-2">
                    <button id="filtrarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🔍</span>
                        <span>Filtrar</span>
                    </button>
                    <button id="limpiarFiltros"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🗑️</span>
                        <span>Limpiar</span>
                    </button>
                </div>
            </div>

            <!-- Filtros de fecha -->
            <div class="grid md:grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-lg">
                <div>
                    <label for="fechaDesde" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Desde:</span>
                    </label>
                    <input type="date" id="fechaDesde"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div>
                    <label for="fechaHasta" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Hasta:</span>
                    </label>
                    <input type="date" id="fechaHasta"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div class="flex items-end">
                    <button id="filtrarPorFecha"
                        class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all w-full">
                        📊 Filtrar por Fechas
                    </button>
                </div>
            </div>

            <div class="flex flex-wrap gap-4 justify-between items-center">
                <div class="flex flex-wrap gap-3">
                    <button id="sincronizarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnSincText">🔄 Sincronizar con Servidor</span>
                    </button>
                    <button id="generarReporte"
                        class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-3 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>📊</span>
                        <span>Generar Reporte CSV</span>
                    </button>
                    <button id="autoRefresh"
                        class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white px-6 py-3 rounded-lg hover:from-indigo-600 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>⚡</span>
                        <span>Auto-actualizaci�n: OFF</span>
                    </button>
                </div>

                <div class="flex items-center space-x-3 text-sm text-gray-600">
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">�ltima sincronizaci�n:</span>
                        <span id="ultimaSync">--:--</span>
                    </div>
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">Estado:</span>
                        <span id="estadoConexion" class="text-green-600">Conectado</span>
                    </div>
                </div>
            </div>
        </div> <!-- Tabla de entradas -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-purple-500 card-hover">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-purple-600 flex items-center">
                        📋 Historial de Entradas del Sistema
                        <div id="tableLoadingIndicator" class="ml-3" style="display: none;">
                            <div
                                class="inline-block w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin">
                            </div>
                            <span class="ml-2 text-sm">Actualizando datos...</span>
                        </div>
                    </h2>
                    <div class="flex items-center space-x-4 mt-2">
                        <p id="contadorEntradas" class="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                            Total: 0 entradas registradas
                        </p>
                        <div class="text-sm text-gray-500">
                            <span id="rangoFechas">Mostrando todas las entradas</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="refreshTable"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Actualizar tabla">
                        <span>🔄</span>
                        <span class="hidden md:inline">Actualizar</span>
                    </button>
                    <button id="exportVisible"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Exportar datos visibles">
                        <span>📥</span>
                        <span class="hidden md:inline">Exportar</span>
                    </button>
                    <button id="expandirTabla"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Expandir/Contraer tabla">
                        <span>⛶</span>
                        <span class="hidden md:inline">Expandir</span>
                    </button>
                </div>
            </div>

            <!-- Barra de b�squeda r�pida -->
            <div class="mb-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <input type="text" id="busquedaRapida"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                        placeholder="🔍 B�squeda r�pida en la tabla...">
                    <select id="ordenarPor"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="fecha-desc">M�s reciente primero</option>
                        <option value="fecha-asc">M�s antiguo primero</option>
                        <option value="cantidad-desc">Mayor cantidad primero</option>
                        <option value="cantidad-asc">Menor cantidad primero</option>
                        <option value="nombre-asc">Nombre A-Z</option>
                        <option value="nombre-desc">Nombre Z-A</option>
                    </select>
                </div>
                <div class="text-sm text-gray-500">
                    <span id="resultadosBusqueda"></span>
                </div>
            </div>

            <div class="overflow-x-auto shadow-lg rounded-lg">
                <table class="min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg">
                    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('codigo')">
                                <div class="flex items-center space-x-1">
                                    <span>🏷️ C�digo</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('nombre')">
                                <div class="flex items-center space-x-1">
                                    <span>📝 Nombre</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('marca')">
                                <div class="flex items-center space-x-1">
                                    <span>🏢 Marca</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('categoria')">
                                <div class="flex items-center space-x-1">
                                    <span>📂 Categor�a</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('unidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📏 Unidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('cantidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📊 Cantidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('fecha')">
                                <div class="flex items-center space-x-1">
                                    <span>📅 Fecha</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                                💬 Comentarios
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ⚙️ Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tablaEntradasBody" class="bg-white divide-y divide-gray-200">
                        <!-- Las entradas se cargar�n din�micamente aqu� -->
                        <tr class="text-center text-gray-500 bg-gray-50">
                            <td colspan="9" class="px-6 py-8">
                                <div class="flex flex-col items-center space-y-3">
                                    <div class="text-4xl">📦</div>
                                    <div class="text-lg font-medium">No hay entradas registradas</div>
                                    <div class="text-sm">Las entradas aparecer�n aqu� cuando se registren productos
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginaci�n -->
            <div class="mt-6 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-600">Mostrar:</span>
                    <select id="registrosPorPagina" class="border border-gray-200 rounded p-1 text-sm">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="text-sm text-gray-600">registros por p�gina</span>
                </div>
                <div id="paginacion" class="flex items-center space-x-2">
                    <!-- Los controles de paginaci�n se generar�n din�micamente -->
                </div>
            </div>
        </div> <!-- Scanner container -->
        <div id="scanner-container"
            class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 backdrop-blur-sm"
            style="display: none;">
            <div
                class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl border-4 border-green-500 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        📷 <span class="ml-2">Esc�ner de C�digo de Barras</span>
                    </h3>
                    <button id="cerrarEscaner"
                        class="text-red-500 hover:text-red-700 text-2xl font-bold transition-colors transform hover:scale-110">
                        ✕
                    </button>
                </div>

                <div class="mb-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                    <p class="text-sm text-blue-700">
                        <strong>Instrucciones:</strong> Coloque el c�digo de barras dentro del marco verde.
                        El esc�ner detectar� autom�ticamente el c�digo.
                    </p>
                </div>

                <div id="reader" class="w-full mb-6 rounded-lg overflow-hidden border-4 border-green-200 shadow-lg">
                </div>

                <div class="flex space-x-3">
                    <button id="detenerEscaner"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 w-full transition-all transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2">
                        <span>🛑</span>
                        <span>Detener Esc�ner</span>
                    </button>
                </div>

                <!-- Estado del esc�ner -->
                <div id="estadoEscaner" class="mt-4 text-center text-sm text-gray-600">
                    <div class="flex items-center justify-center space-x-2">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span>Esc�ner activo - Listo para escanear</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../librer�as/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script src="../js/utils/extension-conflict-detector.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script type="module" src="../js/core/registro-entradas-operations.js"></script>
    <script type="module">
        import { inicializarRegistroEntradas } from '../js/registro-entradas-operations.js';
        import { inicializarDB } from '../js/db-operations.js';
        import { toggleEscaner } from '../js/scanner.js';        // Inicializar cuando el DOM est� cargado
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Inicializar base de datos principal
                await inicializarDB();

                // Inicializar p�gina de registro de entradas
                await inicializarRegistroEntradas();

                // Configurar esc�ner
                const escanearBtn = document.getElementById('escanearBtn');
                if (escanearBtn) {
                    escanearBtn.addEventListener('click', () => {
                        toggleEscaner('busquedaCodigo', 'scanner-container');
                    });
                }

                const cerrarEscaner = document.getElementById('cerrarEscaner');
                const detenerEscaner = document.getElementById('detenerEscaner');

                if (cerrarEscaner) {
                    cerrarEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                if (detenerEscaner) {
                    detenerEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                // Inicializar funcionalidades din�micas
                initializeDynamicFeatures();

                console.log('P�gina de registro de entradas inicializada correctamente');

            } catch (error) {
                console.error('Error al inicializar p�gina de registro de entradas:', error);
            }
        });        // Funcionalidades din�micas
        function initializeDynamicFeatures() {
            // Reloj en tiempo real
            updateClock();
            setInterval(updateClock, 1000);

            // Estado de conexi�n
            updateConnectionStatus();
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);

            // Auto-actualizaci�n
            setupAutoRefresh();

            // Efectos de carga
            setupLoadingEffects();

            // Animaciones de entrada
            setupEntranceAnimations();

            // Notificaciones din�micas
            setupDynamicNotifications();

            // Configurar fecha actual
            setupCurrentDate();

            // B�squeda r�pida en tabla
            setupQuickSearch();

            // Autocompletado
            setupAutoComplete();

            // Atajos de teclado
            setupKeyboardShortcuts();

            // Validaciones en tiempo real
            setupRealTimeValidation();
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            const clockDisplay = document.getElementById('clockDisplay');
            if (clockDisplay) {
                clockDisplay.innerHTML = `${timeString}<br><span class="text-xs">${dateString}</span>`;
            }

            // Actualizar fecha actual en el resumen
            const fechaActual = document.getElementById('fechaActual');
            if (fechaActual) {
                fechaActual.textContent = `Hoy: ${dateString}`;
            }
        }

        function updateConnectionStatus() {
            const statusElement = document.getElementById('conexionStatus');
            const estadoConexion = document.getElementById('estadoConexion');

            if (statusElement || estadoConexion) {
                const isOnline = navigator.onLine;
                const status = isOnline
                    ? '<span class="status-indicator status-success"></span>Conectado'
                    : '<span class="status-indicator status-error"></span>Sin conexi�n';

                if (statusElement) statusElement.innerHTML = status;
                if (estadoConexion) {
                    estadoConexion.textContent = isOnline ? 'Conectado' : 'Sin conexi�n';
                    estadoConexion.className = isOnline ? 'text-green-600' : 'text-red-600';
                }

                // Actualizar estado del sistema
                const estadoSistema = document.getElementById('estadoSistema');
                if (estadoSistema) {
                    if (isOnline) {
                        estadoSistema.className = 'bg-green-100 text-green-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Operativo';
                    } else {
                        estadoSistema.className = 'bg-red-100 text-red-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Offline';
                    }
                }
            }
        }

        function setupCurrentDate() {
            const fechaEntrada = document.getElementById('fechaEntrada');
            if (fechaEntrada && !fechaEntrada.value) {
                const today = new Date().toISOString().split('T')[0];
                fechaEntrada.value = today;
            }
        }

        function setupQuickSearch() {
            const busquedaRapida = document.getElementById('busquedaRapida');
            if (busquedaRapida) {
                busquedaRapida.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#tablaEntradasBody tr');
                    let visibleCount = 0;

                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        const isVisible = text.includes(searchTerm);
                        row.style.display = isVisible ? '' : 'none';
                        if (isVisible && !row.classList.contains('text-center')) visibleCount++;
                    });

                    // Actualizar contador de resultados
                    const resultados = document.getElementById('resultadosBusqueda');
                    if (resultados) {
                        resultados.textContent = searchTerm ?
                            `${visibleCount} resultado${visibleCount !== 1 ? 's' : ''} encontrado${visibleCount !== 1 ? 's' : ''}` :
                            '';
                    }
                });
            }
        }

        function setupAutoComplete() {
            // Autocompletado para campos de b�squeda
            const campos = ['busquedaCodigo', 'busquedaNombre', 'busquedaMarca'];
            campos.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.addEventListener('input', debounce((e) => {
                        // Aqu� se implementar�a la l�gica de autocompletado
                        showAutoCompleteHint(campo, e.target.value);
                    }, 300));
                }
            });
        }

        function showAutoCompleteHint(element, value) {
            if (value.length < 2) return;

            // Simular sugerencias (en producci�n vendr�a de la base de datos)
            const hints = ['Producto A', 'Producto B', 'Marca X', 'Marca Y'];
            const matchingHints = hints.filter(hint =>
                hint.toLowerCase().includes(value.toLowerCase())
            );

            // Mostrar hint visual
            if (matchingHints.length > 0) {
                element.title = `Sugerencia: ${matchingHints[0]}`;
                element.style.borderColor = '#10B981';
            } else {
                element.title = '';
                element.style.borderColor = '';
            }
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl + F para buscar
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    const busquedaRapida = document.getElementById('busquedaRapida');
                    if (busquedaRapida) {
                        busquedaRapida.focus();
                        busquedaRapida.select();
                    }
                }

                // Ctrl + S para sincronizar
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    const sincBtn = document.getElementById('sincronizarEntradas');
                    if (sincBtn) sincBtn.click();
                }

                // Ctrl + R para actualizar tabla
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    const refreshBtn = document.getElementById('refreshTable');
                    if (refreshBtn) refreshBtn.click();
                }

                // ESC para cerrar modales
                if (e.key === 'Escape') {
                    const scanner = document.getElementById('scanner-container');
                    if (scanner && scanner.style.display !== 'none') {
                        scanner.style.display = 'none';
                    }
                }
            });
        }

        function setupRealTimeValidation() {
            const cantidadInput = document.getElementById('cantidadEntrada');
            if (cantidadInput) {
                cantidadInput.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    const isValid = value > 0;

                    if (isValid) {
                        e.target.classList.remove('border-red-500');
                        e.target.classList.add('border-green-500');
                        updateEntryPreview();
                    } else {
                        e.target.classList.remove('border-green-500');
                        e.target.classList.add('border-red-500');
                    }
                });
            }

            // Validaci�n de fecha
            const fechaInput = document.getElementById('fechaEntrada');
            if (fechaInput) {
                fechaInput.addEventListener('change', (e) => {
                    const selectedDate = new Date(e.target.value);
                    const today = new Date();
                    const maxDate = new Date();
                    maxDate.setDate(today.getDate() + 30); // M�ximo 30 d�as en el futuro

                    if (selectedDate > maxDate) {
                        e.target.classList.add('border-yellow-500');
                        showToast('⚠️ La fecha seleccionada est� muy lejos en el futuro', 'warning');
                    } else {
                        e.target.classList.remove('border-yellow-500');
                        updateEntryPreview();
                    }
                });
            }
        }

        function updateEntryPreview() {
            const codigo = document.getElementById('codigoProducto')?.value;
            const nombre = document.getElementById('nombreProducto')?.value;
            const cantidad = document.getElementById('cantidadEntrada')?.value;
            const fecha = document.getElementById('fechaEntrada')?.value;
            const unidad = document.getElementById('unidadProducto')?.value;

            if (codigo && nombre && cantidad && fecha) {
                const resumen = document.getElementById('resumenEntrada');
                const textoResumen = document.getElementById('textoResumen');

                if (resumen && textoResumen) {
                    textoResumen.innerHTML = `
                        <strong>${nombre}</strong> (${codigo})<br>
                        Cantidad: <strong>${cantidad} ${unidad || 'unidades'}</strong><br>
                        Fecha: <strong>${new Date(fecha).toLocaleDateString('es-ES')}</strong>
                    `;
                    resumen.style.display = 'block';
                }
            }
        }

        // Funci�n auxiliar para debounce
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Funci�n para mostrar mensajes toast
        function showToast(message, type = 'info') {
            // Implementaci�n simple de toast
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-500' :
                    type === 'warning' ? 'bg-yellow-500' :
                        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                } text-white`;
            toast.textContent = message;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Funci�n para ordenar tabla
        function sortTable(column) {
            console.log(`Ordenando por: ${column}`);
            // Aqu� se implementar�a la l�gica de ordenamiento
        } function setupAutoRefresh() {
            let autoRefreshEnabled = false;
            let autoRefreshInterval;

            const autoRefreshBtn = document.getElementById('autoRefresh');
            if (autoRefreshBtn) {
                autoRefreshBtn.addEventListener('click', () => {
                    autoRefreshEnabled = !autoRefreshEnabled;

                    if (autoRefreshEnabled) {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: ON</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');

                        autoRefreshInterval = setInterval(() => {
                            refreshTableData();
                            updateLastSyncTime();
                        }, 30000); // Cada 30 segundos

                        showToast('✅ Auto-actualizaci�n activada', 'success');
                    } else {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: OFF</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');

                        if (autoRefreshInterval) {
                            clearInterval(autoRefreshInterval);
                        }
                        showToast('⏸️ Auto-actualizaci�n desactivada', 'info');
                    }
                });
            }
        }

        function updateLastSyncTime() {
            const ultimaSync = document.getElementById('ultimaSync');
            if (ultimaSync) {
                const now = new Date();
                ultimaSync.textContent = now.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function setupLoadingEffects() {
            // Interceptar clicks en botones de b�squeda
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        const textId = btnId.replace('buscar', 'btn') + 'Text';
                        showButtonLoading(btn, textId, '🔍 Buscando...');

                        // Simular b�squeda exitosa
                        setTimeout(() => {
                            hideButtonLoading(btn, textId, '🔍 Buscar');
                            updateSearchHistory(btnId);
                        }, 2000);
                    });
                }
            });

            // Interceptar registro de entrada
            const registrarBtn = document.getElementById('registrarEntrada');
            if (registrarBtn) {
                registrarBtn.addEventListener('click', () => {
                    showButtonLoading(registrarBtn, 'btnRegistrarText', '⏳ Registrando entrada...');

                    setTimeout(() => {
                        hideButtonLoading(registrarBtn, 'btnRegistrarText', '✅ Registrar Entrada');
                        showToast('✅ Entrada registrada exitosamente', 'success');
                        updateEntryCounter();
                    }, 3000);
                });
            }

            // Interceptar sincronizaci�n
            const sincBtn = document.getElementById('sincronizarEntradas');
            if (sincBtn) {
                sincBtn.addEventListener('click', () => {
                    showButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizando con servidor...');

                    setTimeout(() => {
                        hideButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizar con Servidor');
                        showToast('✅ Sincronizaci�n completada', 'success');
                        updateLastSyncTime();
                    }, 4000);
                });
            }

            // Interceptar actualizaci�n de tabla
            const refreshBtn = document.getElementById('refreshTable');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    const indicator = document.getElementById('tableLoadingIndicator');
                    if (indicator) {
                        indicator.style.display = 'block';
                        setTimeout(() => {
                            indicator.style.display = 'none';
                            showToast('🔄 Tabla actualizada', 'info');
                        }, 2000);
                    }
                });
            }
        }

        function updateSearchHistory(searchType) {
            const busquedaReciente = document.getElementById('busquedaReciente');
            const textoUltimaBusqueda = document.getElementById('textoUltimaBusqueda');

            if (busquedaReciente && textoUltimaBusqueda) {
                const tipoTexto = {
                    'buscarPorCodigo': 'B�squeda por c�digo',
                    'buscarPorNombre': 'B�squeda por nombre',
                    'buscarPorMarca': 'B�squeda por marca'
                };

                const now = new Date().toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                textoUltimaBusqueda.textContent = `${tipoTexto[searchType]} a las ${now}`;
                busquedaReciente.style.display = 'block';

                // Ocultar despu�s de 10 segundos
                setTimeout(() => {
                    busquedaReciente.style.display = 'none';
                }, 10000);
            }
        }

        function updateEntryCounter() {
            const contador = document.getElementById('contadorEntradas');
            const totalEntradas = document.getElementById('totalEntradas');

            if (contador) {
                const currentCount = parseInt(contador.textContent.match(/\d+/) || [0])[0];
                const newCount = currentCount + 1;
                contador.textContent = `Total: ${newCount} entradas registradas`;

                // Animaci�n del contador
                contador.classList.add('animate-pulse');
                setTimeout(() => {
                    contador.classList.remove('animate-pulse');
                }, 1000);
            }

            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                totalEntradas.textContent = currentCount + 1;
            }
        }

        function showButtonLoading(button, textElementId = null, loadingText = 'Cargando...') {
            button.disabled = true;
            button.classList.add('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
                }
            } else {
                button.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
            }
        }

        function hideButtonLoading(button, textElementId = null, originalText = 'Buscar') {
            button.disabled = false;
            button.classList.remove('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.textContent = originalText;
                }
            } else {
                button.textContent = originalText;
            }
        } function setupEntranceAnimations() {
            // Animar elementos cuando aparecen
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-fade-in-up');

                        // A�adir un peque�o retraso para elementos consecutivos
                        const siblings = Array.from(entry.target.parentElement.children);
                        const index = siblings.indexOf(entry.target);
                        entry.target.style.animationDelay = `${index * 0.1}s`;
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            // Observar todas las tarjetas
            document.querySelectorAll('.card-hover').forEach(card => {
                observer.observe(card);
            });

            // Animaciones para botones al hacer hover
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('mouseenter', () => {
                    if (!button.disabled) {
                        button.style.transform = 'translateY(-2px)';
                        button.style.boxShadow = '0 10px 25px rgba(0,0,0,0.2)';
                    }
                });

                button.addEventListener('mouseleave', () => {
                    button.style.transform = 'translateY(0)';
                    button.style.boxShadow = '';
                });
            });

            // Animaci�n de aparecer para modales
            const scanner = document.getElementById('scanner-container');
            if (scanner) {
                const originalDisplay = scanner.style.display;
                scanner.addEventListener('click', (e) => {
                    if (e.target === scanner) {
                        // Cerrar al hacer click fuera del modal
                        hideModal(scanner);
                    }
                });
            }
        }

        function showModal(modal) {
            modal.style.display = 'flex';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.transition = 'all 0.3s ease';
                modal.style.opacity = '1';
                modal.style.transform = 'scale(1)';
            }, 10);
        }

        function hideModal(modal) {
            modal.style.transition = 'all 0.3s ease';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function setupDynamicNotifications() {
            // Mostrar formulario solo cuando se selecciona un producto
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        setTimeout(() => {
                            const productForm = document.getElementById('productForm');
                            const codigoProducto = document.getElementById('codigoProducto');

                            if (productForm && codigoProducto && codigoProducto.value) {
                                // Mostrar formulario con animaci�n
                                productForm.style.display = 'block';
                                productForm.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });

                                // Animaci�n de aparici�n
                                productForm.style.opacity = '0';
                                productForm.style.transform = 'translateY(30px)';

                                setTimeout(() => {
                                    productForm.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                                    productForm.style.opacity = '1';
                                    productForm.style.transform = 'translateY(0)';

                                    // Destacar el formulario brevemente
                                    productForm.classList.add('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    setTimeout(() => {
                                        productForm.classList.remove('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    }, 2000);
                                }, 100);

                                // Actualizar stock actual (simulado)
                                updateStockDisplay();

                                // Focus en el primer campo editable
                                const cantidadInput = document.getElementById('cantidadEntrada');
                                if (cantidadInput) {
                                    setTimeout(() => cantidadInput.focus(), 800);
                                }
                            }
                        }, 500);
                    });
                }
            });

            // Feedback visual en inputs con animaciones mejoradas
            document.querySelectorAll('input, textarea, select').forEach(input => {
                input.addEventListener('focus', (e) => {
                    e.target.style.transform = 'scale(1.02)';
                    e.target.style.transition = 'transform 0.2s ease';

                    // A�adir indicador de foco
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '#10B981';
                        label.style.transform = 'scale(1.05)';
                        label.style.transition = 'all 0.2s ease';
                    }
                });

                input.addEventListener('blur', (e) => {
                    e.target.style.transform = 'scale(1)';

                    // Restaurar label
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '';
                        label.style.transform = 'scale(1)';
                    }
                });

                // Validaci�n visual en tiempo real
                if (input.type === 'number') {
                    input.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        if (value > 0) {
                            e.target.style.borderColor = '#10B981';
                            e.target.style.backgroundColor = '#F0FDF4';
                        } else if (e.target.value) {
                            e.target.style.borderColor = '#EF4444';
                            e.target.style.backgroundColor = '#FEF2F2';
                        } else {
                            e.target.style.borderColor = '';
                            e.target.style.backgroundColor = '';
                        }
                    });
                }
            });

            // Animaciones para las filas de la tabla
            setupTableRowAnimations();

            // Notificaciones de estado del sistema
            setupSystemStatusNotifications();
        }

        function updateStockDisplay() {
            const stockActual = document.getElementById('stockActual');
            if (stockActual) {
                // Simular datos de stock
                const stock = Math.floor(Math.random() * 500) + 10;
                stockActual.textContent = stock;

                // Animaci�n del contador
                stockActual.style.transform = 'scale(1.2)';
                stockActual.style.transition = 'transform 0.3s ease';

                setTimeout(() => {
                    stockActual.style.transform = 'scale(1)';
                }, 300);

                // Color basado en el stock
                if (stock < 50) {
                    stockActual.className = 'text-2xl font-bold text-red-600';
                    stockActual.parentElement.className = 'bg-red-50 p-4 rounded-lg border border-red-200';
                } else if (stock < 100) {
                    stockActual.className = 'text-2xl font-bold text-yellow-600';
                    stockActual.parentElement.className = 'bg-yellow-50 p-4 rounded-lg border border-yellow-200';
                } else {
                    stockActual.className = 'text-2xl font-bold text-green-600';
                    stockActual.parentElement.className = 'bg-green-50 p-4 rounded-lg border border-green-200';
                }
            }
        }

        function setupTableRowAnimations() {
            // Observador para filas de tabla
            const tableObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeName === 'TR' && !node.classList.contains('text-center')) {
                                // Animar nueva fila
                                node.style.opacity = '0';
                                node.style.transform = 'translateX(-20px)';

                                setTimeout(() => {
                                    node.style.transition = 'all 0.5s ease';
                                    node.style.opacity = '1';
                                    node.style.transform = 'translateX(0)';
                                }, 100);

                                // Efectos hover mejorados
                                node.addEventListener('mouseenter', () => {
                                    node.style.backgroundColor = '#F0FDF4';
                                    node.style.transform = 'scale(1.01)';
                                    node.style.transition = 'all 0.2s ease';
                                    node.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
                                });

                                node.addEventListener('mouseleave', () => {
                                    node.style.backgroundColor = '';
                                    node.style.transform = 'scale(1)';
                                    node.style.boxShadow = '';
                                });
                            }
                        });
                    }
                });
            });

            const tableBody = document.getElementById('tablaEntradasBody');
            if (tableBody) {
                tableObserver.observe(tableBody, { childList: true });
            }
        }

        function setupSystemStatusNotifications() {
            // Notificaciones peri�dicas de estado
            setInterval(() => {
                if (Math.random() < 0.1) { // 10% de probabilidad cada minuto
                    const messages = [
                        '✅ Sistema funcionando correctamente',
                        '📊 Base de datos sincronizada',
                        '🔄 Datos actualizados autom�ticamente',
                        '📈 Rendimiento �ptimo del sistema'
                    ];

                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    showToast(randomMessage, 'success');
                }
            }, 60000); // Cada minuto
        } function refreshTableData() {
            const indicator = document.getElementById('tableLoadingIndicator');
            if (indicator) {
                indicator.style.display = 'block';

                // Simular carga de datos
                setTimeout(() => {
                    indicator.style.display = 'none';
                    updateLastSyncTime();

                    // Actualizar contador si hay datos
                    const tbody = document.getElementById('tablaEntradasBody');
                    if (tbody) {
                        const rows = tbody.querySelectorAll('tr:not(.text-center)');
                        const contador = document.getElementById('contadorEntradas');
                        if (contador) {
                            contador.textContent = `Total: ${rows.length} entradas registradas`;
                        }
                    }
                }, 2000);
            }

            console.log('Actualizando datos de la tabla...');
        }

        // Efectos adicionales para las filas de la tabla
        function addTableRowEffects() {
            document.querySelectorAll('#tablaEntradasBody tr:not(.text-center)').forEach(row => {
                // Eliminar eventos anteriores para evitar duplicados
                row.removeEventListener('mouseenter', handleRowHover);
                row.removeEventListener('mouseleave', handleRowLeave);

                // A�adir nuevos eventos
                row.addEventListener('mouseenter', handleRowHover);
                row.addEventListener('mouseleave', handleRowLeave);
            });
        }

        function handleRowHover(e) {
            e.target.style.backgroundColor = '#F0FDF4';
            e.target.style.transform = 'scale(1.01)';
            e.target.style.transition = 'all 0.2s ease';
            e.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        }

        function handleRowLeave(e) {
            e.target.style.backgroundColor = '';
            e.target.style.transform = 'scale(1)';
            e.target.style.boxShadow = '';
        }

        // Inicializar mejoras adicionales al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                addTableRowEffects();
                initializeAdditionalFeatures();
            }, 1000);
        });

        // Caracter�sticas adicionales
        function initializeAdditionalFeatures() {
            // Configurar filtros de fecha inteligentes
            setupIntelligentDateFilters();

            // Configurar exportaci�n mejorada
            setupEnhancedExport();

            // Configurar modo expandido de tabla
            setupTableExpandMode();

            // Configurar estad�sticas en tiempo real
            setupRealTimeStats();
        }

        function setupIntelligentDateFilters() {
            const filtrarPorFecha = document.getElementById('filtrarPorFecha');
            if (filtrarPorFecha) {
                filtrarPorFecha.addEventListener('click', () => {
                    const fechaDesde = document.getElementById('fechaDesde').value;
                    const fechaHasta = document.getElementById('fechaHasta').value;

                    if (fechaDesde && fechaHasta) {
                        const rangoFechas = document.getElementById('rangoFechas');
                        if (rangoFechas) {
                            const desde = new Date(fechaDesde).toLocaleDateString('es-ES');
                            const hasta = new Date(fechaHasta).toLocaleDateString('es-ES');
                            rangoFechas.textContent = `Mostrando entradas del ${desde} al ${hasta}`;
                        }
                        showToast(`📅 Filtro aplicado: ${fechaDesde} a ${fechaHasta}`, 'info');
                    } else {
                        showToast('⚠️ Seleccione ambas fechas para filtrar', 'warning');
                    }
                });
            }
        }

        function setupEnhancedExport() {
            const exportBtn = document.getElementById('exportVisible');
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    showToast('📥 Preparando exportaci�n...', 'info');

                    setTimeout(() => {
                        showToast('✅ Datos exportados exitosamente', 'success');
                    }, 2000);
                });
            }
        }

        function setupTableExpandMode() {
            const expandBtn = document.getElementById('expandirTabla');
            let isExpanded = false;

            if (expandBtn) {
                expandBtn.addEventListener('click', () => {
                    const tableContainer = expandBtn.closest('.bg-white');

                    if (!isExpanded) {
                        tableContainer.classList.add('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Contraer</span>';
                        isExpanded = true;
                        showToast('⛶ Tabla expandida', 'info');
                    } else {
                        tableContainer.classList.remove('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Expandir</span>';
                        isExpanded = false;
                        showToast('⛶ Tabla contra�da', 'info');
                    }
                });
            }
        }

        function setupRealTimeStats() {
            // Actualizar estad�sticas cada 30 segundos
            setInterval(() => {
                updateSystemStats();
            }, 30000);

            // Actualizaci�n inicial
            updateSystemStats();
        }

        function updateSystemStats() {
            // Simular actualizaci�n de estad�sticas
            const totalEntradas = document.getElementById('totalEntradas');
            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                if (Math.random() < 0.3) { // 30% de probabilidad de incremento
                    totalEntradas.textContent = currentCount + Math.floor(Math.random() * 3) + 1;
                }
            }
        }

        // CSS para animaciones adicionales
        const additionalStyles = `
            <style>
                .animate-fade-in-up {
                    animation: fadeInUp 0.6s ease-out forwards;
                }
                
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(30px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .status-indicator {
                    display: inline-block;
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    margin-right: 6px;
                }
                
                .status-success {
                    background-color: #10B981;
                    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
                }
                
                .status-error {
                    background-color: #EF4444;
                    box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
                }
                
                .card-hover {
                    transition: all 0.3s ease;
                }
                
                .card-hover:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                }
                
                .loading-spinner {
                    border: 2px solid #f3f3f3;
                    border-top: 2px solid #3498db;
                    border-radius: 50%;
                    width: 16px;
                    height: 16px;
                    animation: spin 1s linear infinite;
                }
                
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                
                /* Efectos de hover mejorados */
                button:not(:disabled):hover {
                    transform: translateY(-1px) !important;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                }
                
                input:focus, textarea:focus, select:focus {
                    transform: scale(1.01);
                    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
                }
                
                /* Animaciones para modales */
                .modal-enter {
                    animation: modalEnter 0.3s ease-out forwards;
                }
                
                @keyframes modalEnter {
                    from {
                        opacity: 0;
                        transform: scale(0.9);
                    }
                    to {
                        opacity: 1;
                        transform: scale(1);
                    }
                }
                
                /* Efectos de tabla mejorados */
                table th {
                    position: relative;
                    overflow: hidden;
                }
                
                table th:hover::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    animation: shimmer 1.5s ease-in-out;
                }
                
                @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
            </style>
        `;

        // A�adir estilos al head
        document.head.insertAdjacentHTML('beforeend', additionalStyles);

        // Llamar despu�s de cargar datos en la tabla
        window.addEventListener('load', () => {
            setTimeout(addTableRowEffects, 1000);
        });

        // Funci�n para convertir gui�n a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Funci�n para aplicar la conversi�n a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversi�n a los campos de c�digo cuando se cargue la p�gina
        document.addEventListener('DOMContentLoaded', function() {
            const busquedaCodigo = document.getElementById('busquedaCodigo');
            const codigoProducto = document.getElementById('codigoProducto');
            const filtroCodigo = document.getElementById('filtroCodigo');
            
            aplicarConversionCodigo(busquedaCodigo);
            aplicarConversionCodigo(codigoProducto);
            aplicarConversionCodigo(filtroCodigo);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Preconteo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <script src="../librer�as/JsBarcode.all.min.js"></script>
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>

    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    </script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-xl font-bold">Reporte de Preconteo</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <nav class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-xl font-bold">GestorInventory</h1>
            <a href="./main.html" class="hover:underline">Regresar</a>
            <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
                Men�
            </button>
        </div>
    </nav>

    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold text-center mb-6">Generador de Reportes de Preconteo</h1>

        <div class="mb-6 bg-white p-4 rounded shadow">
            <div class="mb-4">
                <label class="block font-semibold mb-2">Selecciona una o varias �reas:</label>
                <div id="areasContainer" class="grid grid-cols-2 md:grid-cols-3 gap-2 border rounded p-3">
                    <!-- Las �reas se cargar�n din�micamente como checkboxes -->
                    <div class="flex items-center">
                        <input type="checkbox" id="area-todas" value="todas" class="areaCheckbox mr-2" checked>
                        <label for="area-todas">Todas las �reas</label>
                    </div>
                </div>
                <div class="mt-2 text-right">
                    <button id="aplicarFiltroBtn" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">
                        Aplicar filtro
                    </button>
                </div>
            </div>

            <div id="loadingIndicator" class="hidden">
                <div class="flex items-center justify-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                    <span class="ml-2">Cargando productos...</span>
                </div>
            </div>

            <div id="productosList" class="mt-4">
                <h2 class="text-xl font-semibold mb-2">Lista de productos:</h2>
                <ul id="productosContainer" class="list-decimal pl-6 space-y-1">
                    <!-- Los productos se cargar�n din�micamente -->
                </ul>
            </div>
        </div>

        <div class="text-center">
            <button id="generarReporteBtn"
                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded">
                GENERAR REPORTE DE PRECONTEO
            </button>
        </div>

        <!-- Contenedor invisible para generar c�digos de barras -->
        <div id="barcodeContainer" class="hidden"></div>
    </div>

    <!-- Cargar nuestro script principal despu�s de asegurarnos que las dependencias est�n cargadas -->
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/reports/rep.js"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Recuperar Contraseña</h1>
            
            <form id="formPasswordReset" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Correo Electrónico</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="tu@email.com"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Enviar Enlace de Recuperación
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Recordaste tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restablecer Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Restablecer Contraseña</h1>
            
            <form id="formResetPassword" class="space-y-4">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Nueva Contraseña</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Ingresa tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-300 mb-2">Confirmar Contraseña</label>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        name="confirmPassword" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Confirma tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Restablecer Contraseña
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Ya tienes tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }

        // Manejar reset de contraseña
        document.addEventListener('DOMContentLoaded', async () => {
            const formResetPassword = document.getElementById('formResetPassword');
            
            if (formResetPassword) {
                formResetPassword.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    // Validar que las contraseñas coincidan
                    if (password !== confirmPassword) {
                        alert('Las contraseñas no coinciden');
                        return;
                    }
                    
                    // Validar longitud mínima
                    if (password.length < 6) {
                        alert('La contraseña debe tener al menos 6 caracteres');
                        return;
                    }

                    try {
                        // Obtener el hash del enlace de reseteo de la URL
                        const hash = window.location.hash;
                        
                        if (!hash) {
                            alert('Enlace de recuperación inválido');
                            return;
                        }

                        // Esperar a que Supabase esté disponible
                        let attempts = 0;
                        while (!window.supabase && attempts < 50) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }

                        if (!window.supabase) {
                            alert('Error: No se pudo cargar Supabase');
                            return;
                        }

                        const { error } = await window.supabase.auth.updateUser({
                            password: password
                        });

                        if (error) {
                            alert('Error al actualizar contraseña: ' + error.message);
                            return;
                        }

                        alert('Contraseña actualizada correctamente');
                        window.location.href = '../index.html';
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al restablecer contraseña');
                    }
                });
            }
        });
    </script>
</body>
</html>
<<<<<<< HEAD=======<!DOCTYPE html>
    <html lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Confirmaci�n de Correo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
        <link href="../librer�as/tailwind.min.css" rel="stylesheet">
        <link href="../css/styles.css" rel="stylesheet">
        <script src="../js/utils/theme-manager.js"></script>
        <script src="../js/ui/theme-toggle.js"></script>
    </head>

    <body class="bg-gray-100 flex items-center justify-center h-screen">
        <div class="container mx-auto p-6 max-w-md bg-white shadow-md rounded-lg text-center">
            <h1 id="statusTitle" class="text-2xl font-bold mb-4 text-blue-600">Verificando tu correo...</h1>
            <p id="statusMessage" class="text-gray-700 mb-6">Por favor, espera un momento mientras procesamos tu
                confirmaci�n.</p>
            <p id="detailsMessage" class="text-gray-600 mb-4"></p>
            <a href="../index.html"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-2 inline-block">
                Ir al Inicio de Sesi�n
            </a>
        </div>
        <script src="../js/ui/mobile-optimizer.js"></script>
        <script type="module">
            import { supabase } from '../js/auth/auth.js';

            const statusTitleEl = document.getElementById('statusTitle');
            const statusMessageEl = document.getElementById('statusMessage');
            const detailsMessageEl = document.getElementById('detailsMessage');

            // Supabase maneja la confirmaci�n del token en el backend antes de redirigir aqu�.
            // Esta p�gina muestra el resultado basado en los par�metros de la URL o el estado de la sesi�n.

            const urlParams = new URLSearchParams(window.location.search);
            const errorDescription = urlParams.get('error_description');
            // const errorCode = urlParams.get('error'); // Podr�as usarlo para errores m�s espec�ficos

            if (errorDescription) {
                statusTitleEl.textContent = 'Error en la Confirmaci�n';
                statusTitleEl.classList.remove('text-blue-600', 'text-green-600');
                statusTitleEl.classList.add('text-red-600');
                statusMessageEl.textContent = 'No pudimos confirmar tu direcci�n de correo electr�nico.';
                detailsMessageEl.textContent = `Detalles: ${decodeURIComponent(errorDescription)}`;
                detailsMessageEl.classList.add('text-red-500');
            } else {
                // Si no hay error en la URL, la confirmaci�n fue procesada por Supabase.
                // Esto puede significar que el correo se confirm� ahora o ya estaba confirmado.
                statusTitleEl.textContent = '¡Correo Verificado!';
                statusTitleEl.classList.remove('text-blue-600', 'text-red-600');
                statusTitleEl.classList.add('text-green-600');
                statusMessageEl.textContent = 'Tu direcci�n de correo electr�nico ha sido verificada exitosamente.';
                detailsMessageEl.textContent = 'Ya puedes cerrar esta ventana e iniciar sesi�n.';

                // onAuthStateChange puede dar feedback adicional si la confirmaci�n tambi�n inicia sesi�n.
                supabase.auth.onAuthStateChange((event, session) => {
                    if (event === 'SIGNED_IN' && session) {
                        detailsMessageEl.textContent = 'Has iniciado sesi�n autom�ticamente. ¡Bienvenido!';
                    } else if (event === 'USER_UPDATED' && session?.user?.email_confirmed_at) {
                        // El correo est� confirmado, el mensaje por defecto ya es apropiado.
                        // Puedes a�adir algo m�s si es necesario.
                    }
                });
            }
        </script>
    </body>

    </html>
    >>>>>>> 1e3239b (feat: A�adir enlace para recuperaci�n de contrase�a en la p�gina de inicio de sesi�n y mejorar
    mensajes de confirmaci�n de correo)
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Producto - Sistema de Gestión de Productos</title>
    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <!-- Cambiamos Quagga por Html5QrCode -->
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../librerías/sweetalert2@11.js"></script>
    <!-- Añadir JsBarcode para códigos de barra -->
    <script src="../librerías/JsBarcode.all.min.js"></script>
    <!-- Añadir jsPDF para generación de PDFs -->
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Consulta de Producto</h1>

    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="consulta" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Consulta de Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">Menú</button>

        <!-- Sistema de pestañas -->
        <div class="mb-4 mt-4">
            <nav class="flex border-b">
                <button id="tab-busqueda" class="tab-button border-b-2 border-blue-500 text-blue-600 px-4 py-2 font-semibold">Búsqueda</button>
                <button id="tab-relaciones" class="tab-button border-b-2 border-transparent text-gray-500 px-4 py-2 font-semibold">Relaciones</button>
            </nav>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-busqueda" class="tab-content">
            <form id="formConsultaProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoConsulta">Código/PLU:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoConsulta" type="text">
                        <button type="button" id="escanearBtnConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear Código de Barras</button>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreConsulta">Nombre:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="nombreConsulta" type="text">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaConsulta">Categoría:</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="categoriaConsulta" type="text">
                </div>
                <div class="flex items-center justify-between">
                    <button id="buscarConsulta" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">Buscar Producto</button>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
        </div>
        <div id="content-relaciones" class="tab-content" style="display:none;">
            <form id="formRelaciones" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoRelacion">Código del producto:</label>
                    <div class="flex">
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="codigoRelacion" type="text" placeholder="Escanea o ingresa el código o últimos 4 dígitos">
                        <button type="button" id="escanearBtnRelacion" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded ml-2">Escanear</button>
                        <button type="button" id="buscarRelacion" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">Buscar Relación</button>
                    </div>
                </div>
            </form>
            <div id="relaciones" class="mt-4"></div>
        </div>

        <!-- Modificamos el contenedor del escáner -->
        <!-- En plantillas/consulta.html -->
        <div id="scanner-container-consulta" class="mt-4" style="display: none;">
            <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
            <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
        </div>

        <!-- Div to hold the barcode -->
        <div id="barcodeContainer" class="mt-4"></div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Búsqueda relacional de productos con pestañas
        document.addEventListener('DOMContentLoaded', function() {
            const codigoConsulta = document.getElementById('codigoConsulta');
            aplicarConversionCodigo(codigoConsulta);
            // Para la pestaña de relaciones
            const codigoRelacion = document.getElementById('codigoRelacion');
            if (codigoRelacion) aplicarConversionCodigo(codigoRelacion);

            // Tabs
            const tabBusqueda = document.getElementById('tab-busqueda');
            const tabRelaciones = document.getElementById('tab-relaciones');
            const contentBusqueda = document.getElementById('content-busqueda');
            const contentRelaciones = document.getElementById('content-relaciones');
            const relacionesDiv = document.getElementById('relaciones');
            let ultimoProducto = null;

            function switchTab(tab) {
                if (tab === 'busqueda') {
                    tabBusqueda.classList.add('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.remove('border-transparent', 'text-gray-500');
                    tabRelaciones.classList.remove('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'block';
                    contentRelaciones.style.display = 'none';
                } else {
                    if (tabRelaciones.disabled) return; // No cambiar si está deshabilitada
                    tabRelaciones.classList.add('border-blue-500', 'text-blue-600');
                    tabRelaciones.classList.remove('border-transparent', 'text-gray-500');
                    tabBusqueda.classList.remove('border-blue-500', 'text-blue-600');
                    tabBusqueda.classList.add('border-transparent', 'text-gray-500');
                    contentBusqueda.style.display = 'none';
                    contentRelaciones.style.display = 'block';
                }
            }
            tabBusqueda.addEventListener('click', () => switchTab('busqueda'));
            tabRelaciones.addEventListener('click', () => switchTab('relaciones'));
            switchTab('busqueda');

            const buscarBtn = document.getElementById('buscarConsulta');
            const resultadosDiv = document.getElementById('resultados');

            buscarBtn.addEventListener('click', async function() {
                resultadosDiv.innerHTML = '';
                ultimoProducto = null;
                const codigoInput = document.getElementById('codigoConsulta').value.trim();
                const nombre = document.getElementById('nombreConsulta').value.trim();
                const categoria = document.getElementById('categoriaConsulta').value.trim();

                // Buscar primero en IndexedDB para obtener el código completo
                function buscarEnIndexedDB(codigo, nombre, categoria) {
                    return new Promise((resolve, reject) => {
                        if (!window.indexedDB) {
                            resolve(null);
                            return;
                        }
                        const request = window.indexedDB.open('InventarioDB', 1);
                        request.onerror = function() { resolve(null); };
                        request.onsuccess = function(event) {
                            const db = event.target.result;
                            const tx = db.transaction(['productos'], 'readonly');
                            const store = tx.objectStore('productos');
                            const allReq = store.getAll();
                            allReq.onsuccess = function(e) {
                                const productos = e.target.result || [];
                                let encontrados = [];
                                if (codigo) {
                                    if (codigo.length === 4) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo.endsWith(codigo));
                                    } else if (codigo.length === 13) {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    } else {
                                        encontrados = productos.filter(p => p.codigo && p.codigo === codigo);
                                    }
                                } else if (nombre || categoria) {
                                    encontrados = productos.filter(p => {
                                        let match = true;
                                        if (nombre) match = match && p.nombre && p.nombre.toLowerCase().includes(nombre.toLowerCase());
                                        if (categoria) match = match && p.categoria && p.categoria.toLowerCase().includes(categoria.toLowerCase());
                                        return match;
                                    });
                                }
                                resolve(encontrados);
                            };
                            allReq.onerror = function() { resolve(null); };
                        };
                    });
                }

                const productosLocal = await buscarEnIndexedDB(codigoInput, nombre, categoria);
                if (!productosLocal || productosLocal.length === 0) {
                    resultadosDiv.innerHTML = '<div class="text-red-600 font-semibold">No se encontraron productos en el dispositivo.</div>';
                    return;
                }

                // Mostrar resultados principales
                productosLocal.forEach((producto, idx) => {
                    let html = `<div class="bg-white rounded shadow p-4 mb-4">
                        <h3 class="text-xl font-bold mb-2">${producto.nombre}</h3>
                        <div><b>Código:</b> ${producto.codigo}</div>
                        <div><b>Categoría:</b> ${producto.categoria}</div>
                        <div><b>Marca:</b> ${producto.marca}</div>
                        <div><b>Unidad:</b> ${producto.unidad}</div>
                    </div>`;
                    resultadosDiv.innerHTML += html;
                    if (idx === 0) ultimoProducto = producto;
                });
            });

            // Lógica independiente para la pestaña de relaciones
            const buscarRelacionBtn = document.getElementById('buscarRelacion');
            if (buscarRelacionBtn) {
                buscarRelacionBtn.addEventListener('click', async function() {
                    relacionesDiv.innerHTML = '';
                    let codigo = document.getElementById('codigoRelacion').value.trim();
                    if (!codigo) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Ingresa un código para buscar relaciones.</div>';
                        return;
                    }
                    // Permitir búsqueda por últimos 4 dígitos
                    if (codigo.length === 4) {
                        // Buscar en Supabase todos los productos cuyo substring(2,5) sea igual a esos 4 dígitos
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        // Traer todos los códigos y filtrar en JS (por compatibilidad universal)
                        const { data: productosTodos } = await supabase.from('productos').select('codigo');
                        const productos4 = (productosTodos || []).filter(p => typeof p.codigo === 'string' && p.codigo.length >= 5 && p.codigo.substring(1,5) === codigo);
                        if (productos4.length > 0) {
                            if (productos4.length > 1) {
                                relacionesDiv.innerHTML = `<div class='mb-2'>Se encontraron varios productos con los dígitos 2-5 <b>${codigo}</b>:</div>`;
                                productos4.forEach(p => {
                                    relacionesDiv.innerHTML += `<button class='bg-blue-100 hover:bg-blue-300 text-blue-800 px-2 py-1 rounded m-1' onclick='document.getElementById("codigoRelacion").value="${p.codigo}";document.getElementById("buscarRelacion").click();return false;'>${p.codigo}</button>`;
                                });
                                return;
                            } else {
                                codigo = productos4[0].codigo;
                                document.getElementById('codigoRelacion').value = codigo;
                            }
                        } else {
                            relacionesDiv.innerHTML = `<div class='text-red-600'>No se encontró ningún producto con los dígitos 2-5 igual a <b>${codigo}</b>.</div>`;
                            return;
                        }
                    }
                    relacionesDiv.innerHTML = '<div class="text-gray-500">Buscando relaciones...</div>';
                    try {
                        const { obtenerRelacionesProductosSupabase, buscarRelacionProducto } = await import('../js/relaciones-productos.js');
                        let supabase;
                        if (window.getSupabase) {
                            supabase = await window.getSupabase();
                        } else if (window.supabase) {
                            supabase = window.supabase;
                        }
                        const relaciones = await obtenerRelacionesProductosSupabase();
                        const resultado = buscarRelacionProducto(codigo, relaciones);
                        // Buscar info del producto consultado
                        let relHtml = `<div class="bg-white rounded shadow p-4 mb-4">
                            <h3 class="text-lg font-bold mb-2">Relaciones para: <span class='font-mono'>${codigo}</span></h3>`;
                        const { data: productoInfo } = await supabase.from('productos').select('*').eq('codigo', codigo);
                        if (productoInfo && productoInfo.length > 0) {
                            const p = productoInfo[0];
                            relHtml += `<div class='mb-2 text-sm text-gray-700'>${p.nombre} | ${p.unidad || ''} | ${p.categoria || ''} | ${p.marca || ''}</div>`;
                        }
                        // Si es principal, mostrar subproductos
                        if (resultado.tipo === 'principal' && resultado.subproductos.length > 0) {
                            // Buscar info de subproductos
                            const { data: subproductosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos);
                            relHtml += `<div class="mt-2"><b>Subproductos relacionados:</b>
                            <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                            resultado.subproductos.forEach(subCodigo => {
                                const sub = subproductosInfo ? subproductosInfo.find(p => p.codigo === subCodigo) : null;
                                if (sub) {
                                    relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                } else {
                                    relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                }
                            });
                            relHtml += '</tbody></table></div>';
                        }
                        // Si es subproducto, mostrar principal y hermanos
                        if (resultado.tipo === 'subproducto' && resultado.principal) {
                            // Buscar info del principal
                            const { data: principalArr } = await supabase.from('productos').select('*').eq('codigo', resultado.principal);
                            if (principalArr && principalArr.length > 0) {
                                const principal = principalArr[0];
                                relHtml += `<div class="mt-4"><b>Producto principal:</b>
                                    <div class="bg-gray-50 rounded p-2 mt-1">
                                        <b>${principal.nombre}</b> (Código: ${principal.codigo})<br>
                                        Categoría: ${principal.categoria} | Marca: ${principal.marca} | Unidad: ${principal.unidad}
                                    </div>
                                </div>`;
                            } else {
                                relHtml += `<div class="mt-4"><b>Producto principal:</b> <span class='text-gray-400'>${resultado.principal} (No encontrado)</span></div>`;
                            }
                            // Mostrar hermanos (otros subproductos)
                            if (resultado.subproductos.length > 1) {
                                const { data: hermanosInfo } = await supabase.from('productos').select('*').in('codigo', resultado.subproductos.filter(c => c !== codigo));
                                relHtml += `<div class="mt-2"><b>Otros subproductos relacionados:</b>
                                <table class="min-w-full mt-2 border"><thead><tr><th class="border px-2">Código</th><th class="border px-2">Nombre</th><th class="border px-2">Unidad</th></tr></thead><tbody>`;
                                resultado.subproductos.forEach(subCodigo => {
                                    if (subCodigo === codigo) return;
                                    const sub = hermanosInfo ? hermanosInfo.find(p => p.codigo === subCodigo) : null;
                                    if (sub) {
                                        relHtml += `<tr><td class="border px-2">${sub.codigo}</td><td class="border px-2">${sub.nombre}</td><td class="border px-2">${sub.unidad}</td></tr>`;
                                    } else {
                                        relHtml += `<tr><td class="border px-2">${subCodigo}</td><td class="border px-2 text-gray-400" colspan="2">No encontrado</td></tr>`;
                                    }
                                });
                                relHtml += '</tbody></table></div>';
                            }
                        }
                        if (resultado.tipo === 'ninguno') {
                            relHtml += '<div class="mt-2 text-gray-400">Este producto no tiene relaciones registradas.</div>';
                        }
                        relHtml += '</div>';
                        relacionesDiv.innerHTML = relHtml;
                    } catch (e) {
                        relacionesDiv.innerHTML = '<div class="text-red-600">Error al consultar relaciones: ' + (e.message || e) + '</div>';
                    }
                });
            }

            // El manejo del botón de escanear ya lo realiza `main.js` (evitamos listeners duplicados).
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#">
    <title>Editar Producto - Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <script src="../librerías/html5-qrcode.min.js"></script>
    <link rel="stylesheet" href="../librerías/tailwind.min.css" />
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">

    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-3xl font-bold">Editar Producto</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6">Editar Producto</h1>
        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Pestañas -->
        <div class="mb-6 mt-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-editar-individual"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button active">
                        Edición Individual
                    </button>
                    <button id="tab-editar-tabla"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm tab-button">
                        Edición por Tabla
                    </button>
                </nav>
            </div>
        </div>

        <!-- Contenido de pestañas -->
        <div id="content-editar-individual" class="tab-content">
            <form id="formEditarProducto" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoEditar">
                        Código/PLU:
                    </label>
                    <div class="flex">
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="codigoEditar" type="text" required />
                        <button type="button" id="escanearBtnEditar"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                            Escanear Código de Barras
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <button id="buscarEditar"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="button">
                        Buscar
                    </button>
                </div>
                <div id="formularioEdicion" style="display: none">
                    <!-- Campo de código editable -->
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="codigo">
                            Código
                        </label>
                        <input type="text" id="codigoEditado"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="nombreEditar">
                            Nombre:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="nombreEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="categoriaEditar">
                            Categoría:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="categoriaEditar" type="text" required />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="marcaEditar">
                            Marca/Proveedor:
                        </label>
                        <input
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            id="marcaEditar" type="text" required />
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="unidadEditar">
                            Unidad:
                        </label>
                        <input type="text" id="unidadEditar"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required />
                    </div>
                    <div class="flex items-center justify-between">
                        <button id="guardarCambios"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Guardar Cambios
                        </button>
                        <button id="eliminarProducto"
                            class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">
                            Eliminar Producto
                        </button>
                    </div>
                </div>
            </form>
            <div id="resultados" class="mt-4"></div>
            <div id="scanner-container-editar" class="mt-4" style="display: none">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>
        </div>

        <!-- Pestaña Edición por Tabla -->
        <div id="content-editar-tabla" class="tab-content" style="display: none;">
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">Edición por Tabla</h3>
                <form id="formBuscarTabla" class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="codigoBuscarTabla">
                        Buscar por Código de Producto Primario o Subproducto:
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="codigoBuscarTabla" type="text" placeholder="Ej: 1234 o 201670000004" required />
                    <button type="submit"
                        class="mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Buscar</button>
                </form>
                <div id="tabla-edicion-resultados"></div>
                <div id="tabla-edicion-resultados"></div>
                <script type="module">
                    import { db, inicializarDB } from '../js/db-operations.js';
                    import { obtenerRelacionesProductosSupabase, buscarRelacionProducto } from '../js/relaciones-productos.js';
                    // Exponer para main.js si se requiere (opcional)
                    window.obtenerRelacionesProductosSupabase = obtenerRelacionesProductosSupabase;
                    window.buscarRelacionProducto = buscarRelacionProducto;

                    // Lógica de búsqueda y edición en tabla
                    document.getElementById('formBuscarTabla').addEventListener('submit', function (e) {
                        e.preventDefault();
                        const codigo = document.getElementById('codigoBuscarTabla').value.trim();
                        const resultadosDiv = document.getElementById('tabla-edicion-resultados');
                        resultadosDiv.innerHTML = `<div class='text-gray-600'>Sincronizando productos y relaciones...</div>`;

                        (async () => {
                            console.log('[DEBUG] db antes de inicializar:', db);
                            let dbReady = db;
                            if (!dbReady) {
                                resultadosDiv.innerHTML = `<div class='text-gray-600'>Inicializando base de datos local...</div>`;
                                try {
                                    await inicializarDB();
                                } catch (err) {
                                    console.error('[DEBUG] Error al inicializarDB:', err);
                                }
                                dbReady = db;
                                console.log('[DEBUG] db después de inicializar:', dbReady);
                            }
                            if (!dbReady) {
                                console.error('[DEBUG] IndexedDB sigue sin inicializar tras inicializarDB.');
                                resultadosDiv.innerHTML = `<div class='text-red-600'>IndexedDB no inicializado.</div>`;
                                return;
                            }
                            // 1. Sincronizar productos desde Supabase a IndexedDB y obtener relaciones
                            Promise.all([
                                importarProductosSupabaseAIndexedDB(dbReady),
                                obtenerRelacionesProductosSupabase()
                            ]).then(([_, relaciones]) => {
                                // 2. Buscar relación en el Map
                                const relacion = buscarRelacionProducto(codigo, relaciones);
                                // 3. Buscar detalles de productos en IndexedDB
                                buscarProductosRelacionadosConMap(dbReady, codigo, relacion, resultadosDiv);
                            }).catch(err => {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al sincronizar: ${err.message || err}`;
                            });
                        })();

                        // --- Función para importar productos de Supabase a IndexedDB ---
                        async function importarProductosSupabaseAIndexedDB(dbInstance) {
                            if (!window.getSupabase) throw new Error('No se encontró getSupabase.');
                            const supabase = await window.getSupabase();
                            const { data: productos, error } = await supabase.from('productos').select('*');
                            if (error) throw error;
                            if (!dbInstance) throw new Error('IndexedDB no inicializado');
                            return new Promise((resolve, reject) => {
                                const transaction = dbInstance.transaction(['productos'], 'readwrite');
                                const objectStore = transaction.objectStore('productos');
                                const clearReq = objectStore.clear();
                                clearReq.onsuccess = function () {
                                    productos.forEach(prod => {
                                        const p = {
                                            codigo: prod.codigo,
                                            nombre: prod.nombre,
                                            categoria: prod.categoria,
                                            marca: prod.marca,
                                            unidad: prod.unidad
                                        };
                                        objectStore.put(p);
                                    });
                                    transaction.oncomplete = resolve;
                                    transaction.onerror = reject;
                                };
                                clearReq.onerror = reject;
                            });
                        }

                        // --- Función para buscar productos relacionados usando el Map de relaciones ---
                        function buscarProductosRelacionadosConMap(dbInstance, codigo, relacion, resultadosDiv) {
                            const transaction = dbInstance.transaction(['productos'], 'readonly');
                            const objectStore = transaction.objectStore('productos');
                            const getAllReq = objectStore.getAll();
                            getAllReq.onsuccess = function (e) {
                                const productos = e.target.result;
                                // Buscar producto exacto (por código completo o 4 dígitos)
                                let producto = productos.find(p => p.codigo === codigo || p.codigo.endsWith(codigo));
                                if (!producto) {
                                    resultadosDiv.innerHTML = `<div class='text-red-600'>No se encontró el producto <b>${codigo}</b>.</div>`;
                                    return;
                                }
                                // Buscar principal y subproductos según el Map
                                let productoPrincipal = null;
                                let subproductos = [];
                                if (relacion.tipo === 'principal') {
                                    productoPrincipal = producto;
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                } else if (relacion.tipo === 'subproducto') {
                                    productoPrincipal = productos.find(p => p.codigo === relacion.principal);
                                    subproductos = relacion.subproductos.map(cod => productos.find(p => p.codigo === cod)).filter(Boolean);
                                }
                                // Mostrar resultados
                                let html = '';
                                // Producto encontrado (si es principal, mostrar botón editar principal)
                                html += `<div class='mb-4'><b>Producto encontrado:</b><br>${producto.codigo} - ${producto.nombre} (${producto.categoria})<br>Marca: ${producto.marca} | Unidad: ${producto.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${producto.codigo}'>Editar</button></div>`;
                                // Si hay producto principal distinto, mostrarlo con botón editar
                                if (productoPrincipal && productoPrincipal.codigo !== producto.codigo) {
                                    html += `<div class='mb-4'><b>Producto Principal:</b><br>${productoPrincipal.codigo} - ${productoPrincipal.nombre} (${productoPrincipal.categoria})<br>Marca: ${productoPrincipal.marca} | Unidad: ${productoPrincipal.unidad} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${productoPrincipal.codigo}'>Editar</button></div>`;
                                }
                                if (subproductos.length > 0) {
                                    html += `<div class='mb-2'><b>Subproductos relacionados:</b> <button id='expand-relacionados' class='ml-2 px-2 py-1 bg-blue-200 rounded'>Ver relacionados</button></div><ul class='mb-4' id='lista-relacionados' style='display:none;'>`;
                                    subproductos.forEach(sp => {
                                        html += `<li class='mb-1'>${sp.codigo} - ${sp.nombre} <button class='ml-2 px-2 py-1 bg-yellow-200 rounded edit-btn' data-codigo='${sp.codigo}'>Editar</button></li>`;
                                    });
                                    html += '</ul>';
                                }
                                resultadosDiv.innerHTML = html;
                                // Botón para expandir/collapse relacionados
                                const expandBtn = resultadosDiv.querySelector('#expand-relacionados');
                                const listaRelacionados = resultadosDiv.querySelector('#lista-relacionados');
                                if (expandBtn && listaRelacionados) {
                                    expandBtn.addEventListener('click', () => {
                                        listaRelacionados.style.display = listaRelacionados.style.display === 'none' ? 'block' : 'none';
                                        expandBtn.textContent = listaRelacionados.style.display === 'none' ? 'Ver relacionados' : 'Ocultar relacionados';
                                    });
                                }
                                // Agregar listeners a los botones de edición
                                resultadosDiv.querySelectorAll('.edit-btn').forEach(btn => {
                                    btn.addEventListener('click', function () {
                                        const codigoEditar = btn.dataset.codigo;
                                        // Buscar el producto en la lista de productos
                                        const prod = productos.find(p => p.codigo === codigoEditar);
                                        if (!prod) {
                                            Swal.fire('Error', 'No se encontró el producto en la base local.', 'error');
                                            return;
                                        }
                                        // Rellenar el formulario de edición individual
                                        document.getElementById('codigoEditar').value = prod.codigo;
                                        document.getElementById('codigoEditado').value = prod.codigo;
                                        document.getElementById('nombreEditar').value = prod.nombre;
                                        document.getElementById('categoriaEditar').value = prod.categoria;
                                        document.getElementById('marcaEditar').value = prod.marca;
                                        document.getElementById('unidadEditar').value = prod.unidad;
                                        // Mostrar el formulario de edición si está oculto
                                        document.getElementById('formularioEdicion').style.display = '';
                                        // Cambiar a la pestaña de Edición Individual
                                        const tabButtons = document.querySelectorAll('.tab-button');
                                        const tabContents = document.querySelectorAll('.tab-content');
                                        tabButtons.forEach(btn => {
                                            btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                                            btn.classList.add('border-transparent', 'text-gray-500');
                                        });
                                        tabContents.forEach(content => {
                                            content.style.display = 'none';
                                        });
                                        document.getElementById('tab-editar-individual').classList.add('active', 'border-blue-500', 'text-blue-600');
                                        document.getElementById('tab-editar-individual').classList.remove('border-transparent', 'text-gray-500');
                                        document.getElementById('content-editar-individual').style.display = 'block';
                                        // Scroll al formulario de edición
                                        document.getElementById('formEditarProducto').scrollIntoView({ behavior: 'smooth' });
                                    });
                                });
                            };
                            getAllReq.onerror = function () {
                                resultadosDiv.innerHTML = `<div class='text-red-600'>Error al buscar productos en IndexedDB.</div>`;
                            };
                        }
                    });
                </script>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });
            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Pestañas
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            function switchTab(targetTab) {
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });
                const activeButton = document.getElementById(`tab-${targetTab}`);
                activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');
                document.getElementById(`content-${targetTab}`).style.display = 'block';
            }
            document.getElementById('tab-editar-individual').addEventListener('click', () => switchTab('editar-individual'));
            document.getElementById('tab-editar-tabla').addEventListener('click', () => switchTab('editar-tabla'));

            // Aplicar conversión de guión a ceros en campos de código
            const codigoEditar = document.getElementById('codigoEditar');
            const codigoEditado = document.getElementById('codigoEditado');
            const codigoBuscarTabla = document.getElementById('codigoBuscarTabla');
            aplicarConversionCodigo(codigoEditar);
            aplicarConversionCodigo(codigoEditado);
            aplicarConversionCodigo(codigoBuscarTabla);


        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link href="../librerías/tailwind.min.css" rel="stylesheet">
    <script src="../librerías/sweetalert2@11.js"></script>
    <script src="../librerías/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Inventario</h1>
        <div class="flex items-center space-x-4">
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
    </div>

    <div id="inventario" class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-bold mb-6 dark-theme-title">Inventario</h1>

        <a href="./main.html" class="text-blue-500 hover:underline mb-4 inline-block">← Regresar</a>
        <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
            Menú
        </button>

        <!-- Nuevo div para mostrar la ubicación actual -->
        <div class="mb-4 p-4 bg-white shadow-md rounded">
            <h2 class="text-xl font-bold mb-2">Ubicación Actual: <span id="ubicacionActual"></span></h2>
            <button id="cambiarUbicacion" class="bg-yellow-500 text-white px-4 py-2">Cambiar Ubicación</button>
        </div>

        <!-- Pestañas principales de inventario -->
        <div class="mb-6">
            <div class="flex border-b bg-white shadow-sm rounded-t-lg">
                <button id="tabInventarioManual"
                    class="px-6 py-3 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500 font-semibold">
                    📦 Inventario Manual
                </button>
                <button id="tabLotesAvanzado"
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300 font-semibold">
                    🚀 Inventario por Lotes Avanzado
                </button>
            </div>
        </div>

        <!-- Contenido de Inventario Manual -->
        <div id="contenidoInventarioManual" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <!-- Formulario de búsqueda de inventario -->
            <div class="mb-4">
                <label for="codigo" class="block mb-2">Código/PLU:</label>
                <div class="flex">
                    <input type="text" id="codigo" class="border p-2 w-full">
                    <button id="escanearBtn" class="bg-blue-500 text-white px-4 py-2 ml-2">Escanear Código</button>
                </div>
            </div>

            <div class="mb-4">
                <label for="nombreInventario" class="block mb-2">Nombre:</label>
                <input type="text" id="nombreInventario" class="border p-2 w-full">
            </div>

            <div class="mb-4">
                <label for="marcaInventario" class="block mb-2">Marca:</label>
                <input type="text" id="marcaInventario" class="border p-2 w-full">
            </div>

            <button id="buscarInventario" class="bg-green-500 text-white px-4 py-2 mb-4">Buscar Producto</button>

            <div id="resultadosInventario" class="mt-4" style="display: none;">
                <!-- Los resultados de la búsqueda se mostrarán aquí -->
            </div>

            <div id="datosInventario" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
                <!-- Pestañas para productos tipo Kg -->
                <div id="tabsContainer" class="mb-6" style="display: none;">
                    <div class="flex border-b">
                        <button id="tabInventario"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            Inventario Normal
                        </button>
                        <button id="tabLotes"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            Lotes
                        </button>
                    </div>
                </div>

                <!-- Formulario de inventario normal -->
                <div id="formularioInventarioNormal">
                    <div class="mb-4">
                        <label for="codigoProductoInventario" class="block mb-2">Codigo del Producto:</label>
                        <input type="text" id="codigoProductoInventario" class="border p-2 w-full" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="nombreProductoInventario" class="block mb-2">Nombre del Producto:</label>
                        <input type="text" id="nombreProductoInventario" class="border p-2 w-full" readonly>
                    </div>

                    <div class="mb-4">
                        <label for="unidadProducto" class="block mb-2">Unidad:</label>
                        <input type="text" id="unidadProducto" class="border p-2 w-full" readonly>
                        <!-- Mostrar la unidad como texto -->
                    </div>

                    <div class="mb-4">
                        <label for="cantidad" class="block mb-2">Cantidad:</label>
                        <input type="number" id="cantidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-4">
                        <label for="fechaCaducidad" class="block mb-2">Fecha de Caducidad:</label>
                        <input type="date" id="fechaCaducidad" class="border p-2 w-full">
                    </div>

                    <div class="mb-6">
                        <label for="comentarios" class="block mb-2">Comentarios:</label>
                        <textarea id="comentarios" class="border p-2 w-full"></textarea>
                    </div>

                    <div id="botonguardar" class="flex items-center justify-between">
                        <button id="guardarInventario" class="bg-blue-500 text-white px-4 py-2">Guardar
                            Inventario</button>
                    </div>
                    <div id="botonmodificar" class="flex items-center justify-between" style="display: none;">
                        <button id="modificarInventario" class="bg-blue-500 text-white px-4 py-2">Modificar
                            Inventario</button>
                    </div>
                </div>

                <!-- Formulario de escaneo por lotes para productos Kg -->
                <div id="formularioLotes" style="display: none;">
                    <div class="bg-blue-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-bold mb-3 text-blue-800">Información del Producto</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Código:</label>
                                <span id="codigoProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre:</label>
                                <span id="nombreProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Unidad:</label>
                                <span id="unidadProductoLotes" class="text-sm font-semibold text-green-600">Kg</span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoría:</label>
                                <span id="categoriaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Marca:</label>
                                <span id="marcaProductoLotes" class="text-sm font-semibold"></span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label for="precioKilo" class="block text-sm font-medium text-gray-700 mb-2">Precio por Kilo
                            ($):</label>
                        <input type="number" id="precioKilo" step="0.01" min="0"
                            class="border border-gray-300 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Ingrese el precio por kilogramo">
                    </div>

                    <div class="text-center">
                        <button id="iniciarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            📱 Iniciar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>

            <div id="mensaje" class="mt-4"></div>

            <div id="scanner-container-inventario" class="mt-4" style="display: none;">
                <div id="reader-consulta" class="w-full max-w-lg mx-auto"></div>
                <button id="cerrarEscanerConsulta" class="...">Cerrar Escáner</button>
            </div>

            <button id="generarHojaInventario" class="bg-purple-500 text-white px-4 py-2 mt-4">Generar Hoja de
                Inventario</button>
        </div>

        <!-- Contenido de Inventario por Lotes Avanzado -->
        <div id="contenidoLotesAvanzado" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
            <!-- Panel de alerta y configuración -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-yellow-800">Inventario por Lotes Avanzado</h3>
                        <div class="mt-2 text-sm text-yellow-700">
                            <ul class="list-disc list-inside space-y-1">
                                <li>Solo se pueden contar productos con unidad tipo <strong>Kg</strong></li>
                                <li>El escaneo será automático sin necesidad de búsqueda previa</li>
                                <li>Se extraerán automáticamente PLU, peso y precio desde códigos CODE128</li>
                                <li>Los productos se agruparán por productos primarios y subproductos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panel de configuración -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold mb-4 text-gray-800">⚙️ Configuración de Escaneo</h3>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="confirmarProductosSimilares"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                        <label for="confirmarProductosSimilares" class="text-sm font-medium text-gray-700">
                            Mostrar ventana de confirmación para productos similares
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="agruparAutomaticamente"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="agruparAutomaticamente" class="text-sm font-medium text-gray-700">
                            Agrupar automáticamente productos con el mismo PLU
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="sonidoConfirmacion"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="sonidoConfirmacion" class="text-sm font-medium text-gray-700">
                            Reproducir sonido de confirmación al escanear
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="relacionarProductos"
                            class="mr-3 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                            checked>
                        <label for="relacionarProductos" class="text-sm font-medium text-gray-700">
                            Relacionar productos (buscar en productos_subproductos)
                        </label>
                    </div>
                </div>
            </div>

            <!-- Botón para iniciar escaneo -->
            <div class="text-center mb-6">
                <button id="iniciarEscaneoLotesAvanzado"
                    class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform hover:scale-105 transition duration-200">
                    🚀 Iniciar Escaneo por Lotes Avanzado
                </button>
            </div>

            <!-- Área de resultados de productos escaneados -->
            <div id="resultadosLotesAvanzado" class="hidden">
                <h3 class="text-lg font-bold mb-4 text-gray-800">📊 Productos Escaneados</h3>
                <div id="contenedorProductosPrimarios" class="space-y-4">
                    <!-- Las tarjetas de productos primarios se mostrarán aquí -->
                </div>

                <!-- Botón para guardar inventario -->
                <div class="text-center mt-6">
                    <button id="guardarInventarioLotesAvanzado"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled>
                        💾 Guardar Inventario
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes Avanzado -->
        <div id="modalEscaneoLotesAvanzado"
            class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
            <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-5xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-900">🚀 Escaneo por Lotes Avanzado</h3>
                        <button id="cerrarModalLotesAvanzado" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscanerAvanzado"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListadoAvanzado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Productos Escaneados (<span id="contadorProductosAvanzado">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscanerAvanzado" class="mb-4">
                        <div id="scanner-container-lotes-avanzado" class="mb-4">
                            <div id="reader-lotes-avanzado" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="accionEscaneoLotesAvanzado"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-bold"
                                style="user-select:none;">
                                Activar escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListadoAvanzado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Nombre</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio/Kg</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Tipo</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoProductosAvanzado">
                                    <!-- Los productos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total productos: <span id="totalProductosAvanzado" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotalAvanzado" class="font-bold">0.000 Kg</span> |
                            Productos primarios: <span id="totalProductosPrimarios" class="font-bold">0</span>
                        </div>
                        <button id="finalizarEscaneoLotesAvanzado"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes Avanzado
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Edición de Producto de Lote -->
        <div id="modalEdicionProductoLote" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 10000;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-md shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">✏️ Editar Producto Escaneado</h3>
                        <button onclick="cerrarModalEdicionProducto()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Información del producto -->
                    <div class="mb-4 p-3 bg-gray-50 rounded">
                        <p class="text-sm"><strong>Producto:</strong> <span id="editProductoNombre" class="font-medium"></span></p>
                        <p class="text-sm"><strong>Código:</strong> <span id="editProductoCodigo" class="font-mono"></span></p>
                        <p class="text-sm"><strong>PLU:</strong> <span id="editProductoPLU" class="font-mono"></span></p>
                        <input type="hidden" id="editProductoId">
                    </div>

                    <!-- Campos editables -->
                    <div class="space-y-4">
                        <!-- Precio por Kilo -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                💰 Precio por Kilo ($)
                            </label>
                            <input type="number" id="editPrecioKilo" step="0.01" min="0.01"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el precio por kilo era diferente al momento de crear la etiqueta
                            </p>
                        </div>

                        <!-- Peso -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                ⚖️ Peso (Kg)
                            </label>
                            <input type="number" id="editPeso" step="0.001" min="0.001"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="0.000">
                            <p class="text-xs text-gray-500 mt-1">
                                💡 Modifica si el peso calculado no es correcto (recalcula precio automáticamente)
                            </p>
                        </div>

                        <!-- Precio de Porción (solo lectura, se actualiza automáticamente) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                🏷️ Precio de Porción ($)
                            </label>
                            <input type="number" id="editPrecioPorcion" step="0.01" min="0.01" readonly
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed"
                                placeholder="0.00">
                            <p class="text-xs text-gray-500 mt-1">
                                ℹ️ Se calcula automáticamente: Precio/Kg × Peso
                            </p>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="cerrarModalEdicionProducto()"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button onclick="guardarEdicionProducto()"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            💾 Guardar Cambios
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Información de Producto -->
        <div id="modalInfoProducto" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            style="display: none; z-index: 9999;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">📋 Información del Producto</h3>
                        <button id="cerrarModalInfoProducto" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Contenido del modal -->
                    <div id="contenidoInfoProducto">
                        <!-- Se llenará dinámicamente -->
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button id="cancelarInfoProducto"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button id="guardarInfoProducto"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            Guardar Info
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Escaneo por Lotes (original) -->
        <div id="modalEscaneoLotes" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
            style="display: none;">
            <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <!-- Header del modal -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">Escaneo por Lotes</h3>
                        <button id="cerrarModalLotes" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                        </button>
                    </div>

                    <!-- Pestañas del modal -->
                    <div class="flex border-b mb-4">
                        <button id="tabEscaner"
                            class="px-4 py-2 bg-blue-500 text-white rounded-t-lg border-b-2 border-blue-500">
                            📱 Escáner
                        </button>
                        <button id="tabListado"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-t-lg ml-2 hover:bg-gray-300">
                            📋 Códigos Escaneados (<span id="contadorCodigos">0</span>)
                        </button>
                    </div>

                    <!-- Contenido del escáner -->
                    <div id="contenidoEscaner" class="mb-4">
                        <div id="scanner-container-lotes" class="mb-4">
                            <div id="reader-lotes" class="w-full max-w-lg mx-auto"></div>
                        </div>
                        <div class="text-center">
                            <button id="pararEscaneoLotes"
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                                Pausar Escáner
                            </button>
                        </div>
                    </div>

                    <!-- Contenido del listado -->
                    <div id="contenidoListado" style="display: none;">
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full bg-white shadow-md rounded">
                                <thead class="bg-gray-200">
                                    <tr>
                                        <th class="py-2 px-4 text-left">#</th>
                                        <th class="py-2 px-4 text-left">Código Completo</th>
                                        <th class="py-2 px-4 text-left">PLU</th>
                                        <th class="py-2 px-4 text-left">Peso (Kg)</th>
                                        <th class="py-2 px-4 text-left">Precio Porción</th>
                                        <th class="py-2 px-4 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listadoCodigosEscaneados">
                                    <!-- Los códigos escaneados aparecerán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer del modal -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Total de códigos: <span id="totalCodigos" class="font-bold">0</span> |
                            Peso total: <span id="pesoTotal" class="font-bold">0.00 Kg</span> |
                            Valor total porciones: <span id="precioTotalGeneral" class="font-bold">$0.00</span>
                        </div>
                        <button id="finalizarEscaneoLotes"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded disabled:bg-gray-300 disabled:cursor-not-allowed"
                            disabled>
                            ✅ Finalizar Escaneo por Lotes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- tabla de productos en inventario -->
    <div>
        <button id="sync-inventario-down-btn"
            class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Inventario desde Supabase
        </button>
        <button id="sincronizarManual" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Sincronizar Ahora
        </button>
        <h2 class="text-2xl font-bold mt-8 mb-4"> Productos en Inventario </h2>
        <div class="overflow-x-auto">
            <table id="estructura-plantilla" class="table-auto w-full bg-white shadow-md rounded">
                <thead>
                    <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left">Código</th>
                        <th class="py-3 px-6 text-left">Nombre</th>
                        <th class="py-3 px-6 text-left">Categoría</th>
                        <th class="py-3 px-6 text-left">Marca</th>
                        <th class="py-3 px-6 text-left">Tipo de Cantidad</th>
                        <th class="py-3 px-6 text-left">Cantidad</th>
                        <th class="py-3 px-6 text-left">Fecha de Caducidad</th>
                        <th class="py-3 px-6 text-left">Comentarios</th>
                        <th class="py-3 px-6 text-left">ubicacion</th>
                    </tr>
                </thead>
                <tbody id="estructuraPlantillaBody" class="text-gray-600 text-sm font-light">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>
    <script src="../librerías/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script type="module" src="../js/scanner/lotes-avanzado.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script>
        // Función para convertir guión a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Función para aplicar la conversión a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;

            input.addEventListener('input', function (e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);

                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;

                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function (e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversión a los campos de código cuando se cargue la página
        document.addEventListener('DOMContentLoaded', function () {
            const codigo = document.getElementById('codigo');
            const codigoProductoInventario = document.getElementById('codigoProductoInventario');

            aplicarConversionCodigo(codigo);
            // Note: codigoProductoInventario es readonly, pero aplicamos por si acaso
            aplicarConversionCodigo(codigoProductoInventario);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Productos</title>

    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">

    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <script src="../librerías/sweetalert2@11.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100 dark-theme-body">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center dark-theme-header">
        <h1 class="text-3xl font-bold dark-theme-title">Sistema de Gestión de Productos</h1>
        <div class="flex items-center space-x-4">
            <!-- Indicador de estado del backend -->
            <div id="backendStatus" class="px-3 py-1 rounded-full text-sm font-semibold" 
                 title="Estado de conexión con el backend"
                 style="background-color: #fbbf24; color: #78350f;">
                ⏳ Verificando...
            </div>
            <!-- Botón de alternar tema -->
            <button id="themeToggleBtn" class="p-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition-colors"
                title="Alternar tema">
                <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
            </button>
        </div>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform dark-theme-sidebar">
        <div class="p-4 border-b dark-theme-sidebar-header">
            <h2 class="text-xl font-bold dark-theme-title">Menú de Navegación</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2 dark-theme-close-btn">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2 dark-theme-nav-list">
            <!-- Las rutas se generarán dinámicamente -->
        </ul>
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t dark-theme-sidebar-footer">
            <button id="logoutBtn" class="w-full bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded dark-theme-button">
                Cerrar Sesión
            </button>
        </div>
    </div>

    <a href="../index.html" class="text-blue-500 hover:underline mb-4 inline-block dark-theme-link">← Regresar</a>
    <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200 dark-theme-menu-toggle">
        Menú
    </button>

    <main class="container mx-auto mt-8">
        <section id="dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div id="consulta" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Consulta de Producto</h2>
                <p class="mb-4 dark-theme-card-text">Busca productos en la base de datos por diferentes criterios.</p>
                <a id="consultaLink" href="./consulta.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Consulta
                    Producto</a>
            </div>

            <div id="editar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Editar Producto</h2>
                <p class="mb-4 dark-theme-card-text">Edita los atributos de los productos existentes en la base de
                    datos.</p>
                <a id="editarLink" href="./editar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Editar
                    Producto</a>
            </div>

            <div id="inventario" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona el inventario de productos con datos adicionales.</p>
                <a id="inventarioLink" href="./inventario.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Inventario</a>
            </div>

            <div id="reporte" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Reporte para Inventario</h2>
                <p class="mb-4 dark-theme-card-text">Genera reportes detallados del inventario de productos.</p>
                <a id="reporteLink" href="./report.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Reporte
                    para Inventario</a>
            </div>

            <div id="agregar" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Agregar Productos</h2>
                <p class="mb-4 dark-theme-card-text">Escanea y agrega nuevos productos a la base de datos.</p>
                <a id="agregarLink" href="./agregar.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a Agregar
                    Productos</a>
            </div>

            <div id="archivos" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Administración de Archivos</h2>
                <p class="mb-4 dark-theme-card-text">Sube o descarga archivos CSV para la base de datos.</p>
                <a id="archivosLink" href="./archivos.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Archivos</a>
            </div>

            <div id="configuraciones" class="bg-white p-6 rounded-lg shadow-md dark-theme-card">
                <h2 class="text-2xl font-semibold mb-4 dark-theme-card-title">Configuraciones</h2>
                <p class="mb-4 dark-theme-card-text">Gestiona las configuraciones del sistema, perfil de usuario y
                    preferencias.</p>
                <a id="configuracionesLink" href="./configuraciones.html"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 dark-theme-button">Ir a
                    Configuraciones</a>
            </div>
        </section>
    </main>

    <footer class="bg-blue-600 text-white p-4 mt-8 dark-theme-footer">
        <p class="text-center dark-theme-footer-text">&copy; 2024 Sistema de Gestión de Productos. Todos los derechos
            reservados.</p>
    </footer>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/core/main.js"></script>    <script type="module">
        import { backendStatusMonitor } from '../js/backend-status.js';
        
        // Monitorear estado del backend
        document.addEventListener('DOMContentLoaded', () => {
            const backendStatusEl = document.getElementById('backendStatus');
            
            // Escuchar cambios de estado del backend
            window.addEventListener('backendStatusChanged', (event) => {
                const { available } = event.detail;
                
                if (available) {
                    backendStatusEl.textContent = '🟢 Backend activo';
                    backendStatusEl.style.backgroundColor = '#dcfce7'; // green-100
                    backendStatusEl.style.color = '#166534'; // green-800
                } else {
                    backendStatusEl.textContent = '🔴 Backend no disponible';
                    backendStatusEl.style.backgroundColor = '#fee2e2'; // red-100
                    backendStatusEl.style.color = '#991b1b'; // red-900
                    
                    // Mostrar alerta una sola vez
                    if (!window.backendDownNotified) {
                        setTimeout(() => {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Backend no disponible',
                                text: 'La aplicación funcionará en modo offline. Los cambios se sincronizarán cuando el servidor esté disponible.',
                                allowOutsideClick: false,
                                didOpen: (modal) => {
                                    // Cerrar automáticamente después de 5 segundos
                                    setTimeout(() => {
                                        Swal.close();
                                    }, 5000);
                                }
                            });
                        }, 500);
                        window.backendDownNotified = true;
                    }
                }
            });
            
            // Iniciar monitoreo (cada 30 segundos)
            backendStatusMonitor.startMonitoring(30);
        });
    </script>
    <script type="module">
        import { cerrarSesion } from '../js/auth/auth.js';
        
        // Manejar botón de logout
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    const { value: rememberUser } = await Swal.fire({
                        title: 'Cerrar Sesión',
                        text: '¿Deseas que se recuerde tu usuario para el próximo login?',
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Sí, recordar usuario',
                        cancelButtonText: 'No, no recordar',
                        allowOutsideClick: false
                    });
                    
                    // Si cancela, no hace nada
                    if (rememberUser === undefined) return;
                    
                    // Llamar función de logout
                    await cerrarSesion(rememberUser === true);
                });
            }
        });
    </script>    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menuToggle');
            const sideMenu = document.getElementById('sideMenu');
            const closeMenu = document.getElementById('closeMenu');
            const menuRoutes = document.getElementById('menuRoutes');
            const routes = [
                { name: 'Consulta de Producto', path: './consulta.html' },
                { name: 'Editar Producto', path: './editar.html' },
                { name: 'Inventario', path: './inventario.html' },
                { name: 'Registro de Entradas', path: './registro-entradas.html' },
                { name: 'Reporte para Inventario', path: './report.html' },
                { name: 'Agregar Productos', path: './agregar.html' },
                { name: 'Administración de Archivos', path: './archivos.html' },
                { name: 'Configuraciones', path: './configuraciones.html' }
            ];

            // Generar las rutas dinámicamente
            routes.forEach(route => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="${route.path}" class="text-blue-500 hover:underline dark-theme-nav-link">${route.name}</a>`;
                menuRoutes.appendChild(li);
            });

            // Mostrar el menú
            menuToggle.addEventListener('click', () => {
                sideMenu.classList.remove('-translate-x-full');
            });

            // Ocultar el menú
            closeMenu.addEventListener('click', () => {
                sideMenu.classList.add('-translate-x-full');
            });
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Entradas</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>
    
    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
</head>

<body class="bg-gray-100">
    <header class="bg-green-600 text-white p-4 flex justify-between items-center shadow-lg">
        <div class="flex items-center space-x-3">
            <div class="p-2 bg-green-700 rounded-lg">
                📦
            </div>
            <h1 class="text-3xl font-bold tracking-wide">Registro de Entradas</h1>
        </div>
        <div class="flex items-center space-x-6">
            <div id="conexionStatus" class="text-sm flex items-center space-x-2 bg-green-700 px-3 py-1 rounded-full">
                <span class="status-indicator status-success"></span>
                <span>Conectado</span>
            </div>
            <div id="clockDisplay" class="text-sm font-mono bg-green-700 px-3 py-1 rounded-full"></div>
            <div class="text-sm bg-green-700 px-3 py-1 rounded-full">
                <span id="totalEntradas">0</span> entradas registradas
            </div>
        </div>
    </header>
    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform z-50">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>
    <div class="container mx-auto mt-8 p-4">
        <div class="mb-6 flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center space-x-4">
                <h1 class="text-4xl font-bold text-gray-800 flex items-center">
                    📦 Registro de Entradas
                    <span class="ml-3 text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                        Sistema de Gesti�n
                    </span>
                </h1>
            </div>
            <div class="flex items-center space-x-3">
                <a href="./main.html"
                    class="text-green-600 hover:text-green-800 hover:underline font-medium flex items-center space-x-2 transition-colors">
                    <span>←</span>
                    <span>Regresar al Men� Principal</span>
                </a>
                <button id="menuToggle"
                    class="bg-white text-green-600 px-4 py-2 rounded-lg hover:bg-green-50 border-2 border-green-600 font-semibold transition-all hover:shadow-md">
                    📋 Men� de Navegaci�n
                </button>
            </div>
        </div> <!-- Secci�n de b�squeda de productos -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                🔍 Buscar Producto
                <span id="searchStatus" class="ml-3 text-sm"></span>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="ultimaBusqueda"></span>
                </div>
            </h2>

            <div class="grid md:grid-cols-3 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ Buscar por C�digo:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaCodigo"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese c�digo del producto">
                        <button id="buscarPorCodigo"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnCodigoText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 Buscar por Nombre:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaNombre"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese nombre del producto">
                        <button id="buscarPorNombre"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnNombreText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="busquedaMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 Buscar por Marca:
                    </label>
                    <div class="flex shadow-md rounded-lg overflow-hidden">
                        <input type="text" id="busquedaMarca"
                            class="flex-1 border-0 p-3 focus:ring-2 focus:ring-green-500 focus:outline-none"
                            placeholder="Ingrese marca del producto">
                        <button id="buscarPorMarca"
                            class="bg-green-500 text-white px-6 py-3 hover:bg-green-600 transition-colors">
                            <span id="btnMarcaText">🔍 Buscar</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-center">
                <button id="escanearBtn"
                    class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                    <span>📷</span>
                    <span>Escanear C�digo de Barras</span>
                </button>
            </div>

            <!-- Mensaje de b�squeda reciente -->
            <div id="busquedaReciente" class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 rounded"
                style="display: none;">
                <p class="text-sm text-blue-700">
                    <strong>B�squeda reciente:</strong> <span id="textoUltimaBusqueda"></span>
                </p>
            </div>
        </div> <!-- Formulario de datos del producto y entrada -->
        <div id="productForm"
            class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-green-500 card-hover"
            style="display: none;">
            <h2 class="text-xl font-bold mb-6 text-green-600 flex items-center">
                📦 Datos del Producto
                <div id="productLoadingIndicator" class="ml-3" style="display: none;">
                    <div
                        class="inline-block w-4 h-4 border-2 border-green-500 border-t-transparent rounded-full animate-spin">
                    </div>
                    <span class="ml-2">Cargando informaci�n...</span>
                </div>
                <div class="ml-auto">
                    <span class="text-sm text-gray-500 bg-green-100 px-3 py-1 rounded-full">
                        Producto encontrado ✅
                    </span>
                </div>
            </h2>

            <div id="productInfo"
                class="grid md:grid-cols-2 gap-6 mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border-2 border-green-200 shadow-inner">
                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="codigoProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">C�digo del Producto:</span>
                        </label>
                        <input type="text" id="codigoProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-mono text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="nombreProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📝 <span class="ml-2">Nombre del Producto:</span>
                        </label>
                        <input type="text" id="nombreProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white font-semibold text-lg rounded-lg shadow-sm"
                            readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="marcaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏢 <span class="ml-2">Marca:</span>
                        </label>
                        <input type="text" id="marcaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="transform transition-all hover:scale-105">
                        <label for="categoriaProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📂 <span class="ml-2">Categor�a:</span>
                        </label>
                        <input type="text" id="categoriaProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="unidadProducto"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📏 <span class="ml-2">Unidad de Medida:</span>
                        </label>
                        <input type="text" id="unidadProducto"
                            class="border-2 border-gray-200 p-3 w-full bg-white rounded-lg shadow-sm" readonly>
                    </div>

                    <!-- Informaci�n adicional del stock actual -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="text-sm font-semibold text-blue-700 mb-2">📊 Stock Actual</h4>
                        <div class="text-2xl font-bold text-blue-600" id="stockActual">--</div>
                        <div class="text-xs text-blue-500">unidades disponibles</div>
                    </div>
                </div>
            </div>
            <div class="border-t-2 border-gray-200 pt-8">
                <h3 class="text-lg font-semibold mb-6 text-green-600 flex items-center">
                    📝 Datos de la Entrada
                    <span class="ml-3 text-sm text-gray-500 bg-yellow-100 px-3 py-1 rounded-full">
                        * Campos obligatorios
                    </span>
                    <div class="ml-auto text-sm text-gray-400">
                        <span id="fechaActual"></span>
                    </div>
                </h3>

                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="transform transition-all hover:scale-105">
                        <label for="cantidadEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📊 <span class="ml-2">Cantidad Recibida *:</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="cantidadEntrada"
                                class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg font-semibold"
                                min="0.01" step="0.01" required placeholder="0.00">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <span id="unidadMedida">unidades</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">Ingrese la cantidad exacta recibida</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="fechaEntrada"
                            class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            📅 <span class="ml-2">Fecha de Entrada *:</span>
                        </label>
                        <input type="date" id="fechaEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm text-lg"
                            required>
                        <div class="text-xs text-gray-500 mt-1">Fecha en que se recibi� el producto</div>
                    </div>

                    <div class="transform transition-all hover:scale-105">
                        <label for="loteEntrada" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                            🏷️ <span class="ml-2">N�mero de Lote:</span>
                        </label>
                        <input type="text" id="loteEntrada"
                            class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                            placeholder="Opcional">
                        <div class="text-xs text-gray-500 mt-1">N�mero de lote del proveedor</div>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="comentariosEntrada"
                        class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        💬 <span class="ml-2">Comentarios y Observaciones:</span>
                    </label>
                    <textarea id="comentariosEntrada"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-green-500 focus:border-green-500 rounded-lg shadow-sm"
                        rows="4"
                        placeholder="Informaci�n adicional: estado del producto, observaciones del proveedor, condiciones especiales..."></textarea>
                </div>

                <div class="flex justify-between items-center bg-gray-50 p-4 rounded-lg">
                    <button id="limpiarFormulario"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>🗑️</span>
                        <span>Limpiar Formulario</span>
                    </button>
                    <button id="registrarEntrada"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-3 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnRegistrarText">✅ Registrar Entrada</span>
                    </button>
                </div>

                <!-- Resumen de la entrada -->
                <div id="resumenEntrada" class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded"
                    style="display: none;">
                    <h4 class="font-semibold text-blue-700 mb-2">📋 Resumen de la Entrada:</h4>
                    <div id="textoResumen" class="text-sm text-blue-600"></div>
                </div>
            </div>
        </div> <!-- Filtros y controles -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-blue-500 card-hover">
            <h2 class="text-xl font-bold mb-6 text-blue-600 flex items-center">
                🔧 Filtros y Controles del Sistema
                <div id="syncStatus" class="ml-3 text-sm"></div>
                <div class="ml-auto text-sm text-gray-500">
                    <span id="estadoSistema" class="bg-green-100 text-green-700 px-3 py-1 rounded-full">
                        Sistema Operativo
                    </span>
                </div>
            </h2>

            <div class="grid md:grid-cols-4 gap-6 mb-6">
                <div class="transform transition-all hover:scale-105">
                    <label for="filtroCodigo" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏷️ <span class="ml-2">Filtrar por C�digo:</span>
                    </label>
                    <input type="text" id="filtroCodigo"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="C�digo del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroNombre" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📝 <span class="ml-2">Filtrar por Nombre:</span>
                    </label>
                    <input type="text" id="filtroNombre"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Nombre del producto...">
                </div>

                <div class="transform transition-all hover:scale-105">
                    <label for="filtroMarca" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        🏢 <span class="ml-2">Filtrar por Marca:</span>
                    </label>
                    <input type="text" id="filtroMarca"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm"
                        placeholder="Marca del producto...">
                </div>

                <div class="flex items-end space-x-2">
                    <button id="filtrarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🔍</span>
                        <span>Filtrar</span>
                    </button>
                    <button id="limpiarFiltros"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1">
                        <span>🗑️</span>
                        <span>Limpiar</span>
                    </button>
                </div>
            </div>

            <!-- Filtros de fecha -->
            <div class="grid md:grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-lg">
                <div>
                    <label for="fechaDesde" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Desde:</span>
                    </label>
                    <input type="date" id="fechaDesde"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div>
                    <label for="fechaHasta" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                        📅 <span class="ml-2">Hasta:</span>
                    </label>
                    <input type="date" id="fechaHasta"
                        class="border-2 border-gray-200 p-3 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg shadow-sm">
                </div>
                <div class="flex items-end">
                    <button id="filtrarPorFecha"
                        class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all w-full">
                        📊 Filtrar por Fechas
                    </button>
                </div>
            </div>

            <div class="flex flex-wrap gap-4 justify-between items-center">
                <div class="flex flex-wrap gap-3">
                    <button id="sincronizarEntradas"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span id="btnSincText">🔄 Sincronizar con Servidor</span>
                    </button>
                    <button id="generarReporte"
                        class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-3 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>📊</span>
                        <span>Generar Reporte CSV</span>
                    </button>
                    <button id="autoRefresh"
                        class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white px-6 py-3 rounded-lg hover:from-indigo-600 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-2">
                        <span>⚡</span>
                        <span>Auto-actualizaci�n: OFF</span>
                    </button>
                </div>

                <div class="flex items-center space-x-3 text-sm text-gray-600">
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">�ltima sincronizaci�n:</span>
                        <span id="ultimaSync">--:--</span>
                    </div>
                    <div class="bg-gray-100 px-3 py-2 rounded-lg">
                        <span class="font-semibold">Estado:</span>
                        <span id="estadoConexion" class="text-green-600">Conectado</span>
                    </div>
                </div>
            </div>
        </div> <!-- Tabla de entradas -->
        <div class="bg-white shadow-xl rounded-lg px-8 pt-6 pb-8 mb-6 border-l-4 border-purple-500 card-hover">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-purple-600 flex items-center">
                        📋 Historial de Entradas del Sistema
                        <div id="tableLoadingIndicator" class="ml-3" style="display: none;">
                            <div
                                class="inline-block w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin">
                            </div>
                            <span class="ml-2 text-sm">Actualizando datos...</span>
                        </div>
                    </h2>
                    <div class="flex items-center space-x-4 mt-2">
                        <p id="contadorEntradas" class="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                            Total: 0 entradas registradas
                        </p>
                        <div class="text-sm text-gray-500">
                            <span id="rangoFechas">Mostrando todas las entradas</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="refreshTable"
                        class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Actualizar tabla">
                        <span>🔄</span>
                        <span class="hidden md:inline">Actualizar</span>
                    </button>
                    <button id="exportVisible"
                        class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Exportar datos visibles">
                        <span>📥</span>
                        <span class="hidden md:inline">Exportar</span>
                    </button>
                    <button id="expandirTabla"
                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg flex items-center space-x-1"
                        title="Expandir/Contraer tabla">
                        <span>⛶</span>
                        <span class="hidden md:inline">Expandir</span>
                    </button>
                </div>
            </div>

            <!-- Barra de b�squeda r�pida -->
            <div class="mb-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <input type="text" id="busquedaRapida"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                        placeholder="🔍 B�squeda r�pida en la tabla...">
                    <select id="ordenarPor"
                        class="border-2 border-gray-200 p-2 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="fecha-desc">M�s reciente primero</option>
                        <option value="fecha-asc">M�s antiguo primero</option>
                        <option value="cantidad-desc">Mayor cantidad primero</option>
                        <option value="cantidad-asc">Menor cantidad primero</option>
                        <option value="nombre-asc">Nombre A-Z</option>
                        <option value="nombre-desc">Nombre Z-A</option>
                    </select>
                </div>
                <div class="text-sm text-gray-500">
                    <span id="resultadosBusqueda"></span>
                </div>
            </div>

            <div class="overflow-x-auto shadow-lg rounded-lg">
                <table class="min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg">
                    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('codigo')">
                                <div class="flex items-center space-x-1">
                                    <span>🏷️ C�digo</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('nombre')">
                                <div class="flex items-center space-x-1">
                                    <span>📝 Nombre</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('marca')">
                                <div class="flex items-center space-x-1">
                                    <span>🏢 Marca</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('categoria')">
                                <div class="flex items-center space-x-1">
                                    <span>📂 Categor�a</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('unidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📏 Unidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('cantidad')">
                                <div class="flex items-center space-x-1">
                                    <span>📊 Cantidad</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-200 transition-colors border-r border-gray-200"
                                onclick="sortTable('fecha')">
                                <div class="flex items-center space-x-1">
                                    <span>📅 Fecha</span>
                                    <span class="sort-indicator">↕️</span>
                                </div>
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                                💬 Comentarios
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ⚙️ Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tablaEntradasBody" class="bg-white divide-y divide-gray-200">
                        <!-- Las entradas se cargar�n din�micamente aqu� -->
                        <tr class="text-center text-gray-500 bg-gray-50">
                            <td colspan="9" class="px-6 py-8">
                                <div class="flex flex-col items-center space-y-3">
                                    <div class="text-4xl">📦</div>
                                    <div class="text-lg font-medium">No hay entradas registradas</div>
                                    <div class="text-sm">Las entradas aparecer�n aqu� cuando se registren productos
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginaci�n -->
            <div class="mt-6 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-600">Mostrar:</span>
                    <select id="registrosPorPagina" class="border border-gray-200 rounded p-1 text-sm">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span class="text-sm text-gray-600">registros por p�gina</span>
                </div>
                <div id="paginacion" class="flex items-center space-x-2">
                    <!-- Los controles de paginaci�n se generar�n din�micamente -->
                </div>
            </div>
        </div> <!-- Scanner container -->
        <div id="scanner-container"
            class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 backdrop-blur-sm"
            style="display: none;">
            <div
                class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl border-4 border-green-500 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        📷 <span class="ml-2">Esc�ner de C�digo de Barras</span>
                    </h3>
                    <button id="cerrarEscaner"
                        class="text-red-500 hover:text-red-700 text-2xl font-bold transition-colors transform hover:scale-110">
                        ✕
                    </button>
                </div>

                <div class="mb-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                    <p class="text-sm text-blue-700">
                        <strong>Instrucciones:</strong> Coloque el c�digo de barras dentro del marco verde.
                        El esc�ner detectar� autom�ticamente el c�digo.
                    </p>
                </div>

                <div id="reader" class="w-full mb-6 rounded-lg overflow-hidden border-4 border-green-200 shadow-lg">
                </div>

                <div class="flex space-x-3">
                    <button id="detenerEscaner"
                        class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 w-full transition-all transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2">
                        <span>🛑</span>
                        <span>Detener Esc�ner</span>
                    </button>
                </div>

                <!-- Estado del esc�ner -->
                <div id="estadoEscaner" class="mt-4 text-center text-sm text-gray-600">
                    <div class="flex items-center justify-center space-x-2">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span>Esc�ner activo - Listo para escanear</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../librer�as/html5-qrcode.min.js"></script>
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script src="../js/ui/table-mobile-optimizer.js"></script>
    <script src="../js/utils/extension-conflict-detector.js"></script>
    <script type="module" src="../js/core/main.js"></script>
    <script type="module" src="../js/core/registro-entradas-operations.js"></script>
    <script type="module">
        import { inicializarRegistroEntradas } from '../js/registro-entradas-operations.js';
        import { inicializarDB } from '../js/db-operations.js';
        import { toggleEscaner } from '../js/scanner.js';        // Inicializar cuando el DOM est� cargado
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Inicializar base de datos principal
                await inicializarDB();

                // Inicializar p�gina de registro de entradas
                await inicializarRegistroEntradas();

                // Configurar esc�ner
                const escanearBtn = document.getElementById('escanearBtn');
                if (escanearBtn) {
                    escanearBtn.addEventListener('click', () => {
                        toggleEscaner('busquedaCodigo', 'scanner-container');
                    });
                }

                const cerrarEscaner = document.getElementById('cerrarEscaner');
                const detenerEscaner = document.getElementById('detenerEscaner');

                if (cerrarEscaner) {
                    cerrarEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                if (detenerEscaner) {
                    detenerEscaner.addEventListener('click', () => {
                        document.getElementById('scanner-container').style.display = 'none';
                    });
                }

                // Inicializar funcionalidades din�micas
                initializeDynamicFeatures();

                console.log('P�gina de registro de entradas inicializada correctamente');

            } catch (error) {
                console.error('Error al inicializar p�gina de registro de entradas:', error);
            }
        });        // Funcionalidades din�micas
        function initializeDynamicFeatures() {
            // Reloj en tiempo real
            updateClock();
            setInterval(updateClock, 1000);

            // Estado de conexi�n
            updateConnectionStatus();
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);

            // Auto-actualizaci�n
            setupAutoRefresh();

            // Efectos de carga
            setupLoadingEffects();

            // Animaciones de entrada
            setupEntranceAnimations();

            // Notificaciones din�micas
            setupDynamicNotifications();

            // Configurar fecha actual
            setupCurrentDate();

            // B�squeda r�pida en tabla
            setupQuickSearch();

            // Autocompletado
            setupAutoComplete();

            // Atajos de teclado
            setupKeyboardShortcuts();

            // Validaciones en tiempo real
            setupRealTimeValidation();
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            const clockDisplay = document.getElementById('clockDisplay');
            if (clockDisplay) {
                clockDisplay.innerHTML = `${timeString}<br><span class="text-xs">${dateString}</span>`;
            }

            // Actualizar fecha actual en el resumen
            const fechaActual = document.getElementById('fechaActual');
            if (fechaActual) {
                fechaActual.textContent = `Hoy: ${dateString}`;
            }
        }

        function updateConnectionStatus() {
            const statusElement = document.getElementById('conexionStatus');
            const estadoConexion = document.getElementById('estadoConexion');

            if (statusElement || estadoConexion) {
                const isOnline = navigator.onLine;
                const status = isOnline
                    ? '<span class="status-indicator status-success"></span>Conectado'
                    : '<span class="status-indicator status-error"></span>Sin conexi�n';

                if (statusElement) statusElement.innerHTML = status;
                if (estadoConexion) {
                    estadoConexion.textContent = isOnline ? 'Conectado' : 'Sin conexi�n';
                    estadoConexion.className = isOnline ? 'text-green-600' : 'text-red-600';
                }

                // Actualizar estado del sistema
                const estadoSistema = document.getElementById('estadoSistema');
                if (estadoSistema) {
                    if (isOnline) {
                        estadoSistema.className = 'bg-green-100 text-green-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Operativo';
                    } else {
                        estadoSistema.className = 'bg-red-100 text-red-700 px-3 py-1 rounded-full';
                        estadoSistema.textContent = 'Sistema Offline';
                    }
                }
            }
        }

        function setupCurrentDate() {
            const fechaEntrada = document.getElementById('fechaEntrada');
            if (fechaEntrada && !fechaEntrada.value) {
                const today = new Date().toISOString().split('T')[0];
                fechaEntrada.value = today;
            }
        }

        function setupQuickSearch() {
            const busquedaRapida = document.getElementById('busquedaRapida');
            if (busquedaRapida) {
                busquedaRapida.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#tablaEntradasBody tr');
                    let visibleCount = 0;

                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        const isVisible = text.includes(searchTerm);
                        row.style.display = isVisible ? '' : 'none';
                        if (isVisible && !row.classList.contains('text-center')) visibleCount++;
                    });

                    // Actualizar contador de resultados
                    const resultados = document.getElementById('resultadosBusqueda');
                    if (resultados) {
                        resultados.textContent = searchTerm ?
                            `${visibleCount} resultado${visibleCount !== 1 ? 's' : ''} encontrado${visibleCount !== 1 ? 's' : ''}` :
                            '';
                    }
                });
            }
        }

        function setupAutoComplete() {
            // Autocompletado para campos de b�squeda
            const campos = ['busquedaCodigo', 'busquedaNombre', 'busquedaMarca'];
            campos.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.addEventListener('input', debounce((e) => {
                        // Aqu� se implementar�a la l�gica de autocompletado
                        showAutoCompleteHint(campo, e.target.value);
                    }, 300));
                }
            });
        }

        function showAutoCompleteHint(element, value) {
            if (value.length < 2) return;

            // Simular sugerencias (en producci�n vendr�a de la base de datos)
            const hints = ['Producto A', 'Producto B', 'Marca X', 'Marca Y'];
            const matchingHints = hints.filter(hint =>
                hint.toLowerCase().includes(value.toLowerCase())
            );

            // Mostrar hint visual
            if (matchingHints.length > 0) {
                element.title = `Sugerencia: ${matchingHints[0]}`;
                element.style.borderColor = '#10B981';
            } else {
                element.title = '';
                element.style.borderColor = '';
            }
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl + F para buscar
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    const busquedaRapida = document.getElementById('busquedaRapida');
                    if (busquedaRapida) {
                        busquedaRapida.focus();
                        busquedaRapida.select();
                    }
                }

                // Ctrl + S para sincronizar
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    const sincBtn = document.getElementById('sincronizarEntradas');
                    if (sincBtn) sincBtn.click();
                }

                // Ctrl + R para actualizar tabla
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    const refreshBtn = document.getElementById('refreshTable');
                    if (refreshBtn) refreshBtn.click();
                }

                // ESC para cerrar modales
                if (e.key === 'Escape') {
                    const scanner = document.getElementById('scanner-container');
                    if (scanner && scanner.style.display !== 'none') {
                        scanner.style.display = 'none';
                    }
                }
            });
        }

        function setupRealTimeValidation() {
            const cantidadInput = document.getElementById('cantidadEntrada');
            if (cantidadInput) {
                cantidadInput.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    const isValid = value > 0;

                    if (isValid) {
                        e.target.classList.remove('border-red-500');
                        e.target.classList.add('border-green-500');
                        updateEntryPreview();
                    } else {
                        e.target.classList.remove('border-green-500');
                        e.target.classList.add('border-red-500');
                    }
                });
            }

            // Validaci�n de fecha
            const fechaInput = document.getElementById('fechaEntrada');
            if (fechaInput) {
                fechaInput.addEventListener('change', (e) => {
                    const selectedDate = new Date(e.target.value);
                    const today = new Date();
                    const maxDate = new Date();
                    maxDate.setDate(today.getDate() + 30); // M�ximo 30 d�as en el futuro

                    if (selectedDate > maxDate) {
                        e.target.classList.add('border-yellow-500');
                        showToast('⚠️ La fecha seleccionada est� muy lejos en el futuro', 'warning');
                    } else {
                        e.target.classList.remove('border-yellow-500');
                        updateEntryPreview();
                    }
                });
            }
        }

        function updateEntryPreview() {
            const codigo = document.getElementById('codigoProducto')?.value;
            const nombre = document.getElementById('nombreProducto')?.value;
            const cantidad = document.getElementById('cantidadEntrada')?.value;
            const fecha = document.getElementById('fechaEntrada')?.value;
            const unidad = document.getElementById('unidadProducto')?.value;

            if (codigo && nombre && cantidad && fecha) {
                const resumen = document.getElementById('resumenEntrada');
                const textoResumen = document.getElementById('textoResumen');

                if (resumen && textoResumen) {
                    textoResumen.innerHTML = `
                        <strong>${nombre}</strong> (${codigo})<br>
                        Cantidad: <strong>${cantidad} ${unidad || 'unidades'}</strong><br>
                        Fecha: <strong>${new Date(fecha).toLocaleDateString('es-ES')}</strong>
                    `;
                    resumen.style.display = 'block';
                }
            }
        }

        // Funci�n auxiliar para debounce
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Funci�n para mostrar mensajes toast
        function showToast(message, type = 'info') {
            // Implementaci�n simple de toast
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-500' :
                    type === 'warning' ? 'bg-yellow-500' :
                        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                } text-white`;
            toast.textContent = message;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Funci�n para ordenar tabla
        function sortTable(column) {
            console.log(`Ordenando por: ${column}`);
            // Aqu� se implementar�a la l�gica de ordenamiento
        } function setupAutoRefresh() {
            let autoRefreshEnabled = false;
            let autoRefreshInterval;

            const autoRefreshBtn = document.getElementById('autoRefresh');
            if (autoRefreshBtn) {
                autoRefreshBtn.addEventListener('click', () => {
                    autoRefreshEnabled = !autoRefreshEnabled;

                    if (autoRefreshEnabled) {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: ON</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');

                        autoRefreshInterval = setInterval(() => {
                            refreshTableData();
                            updateLastSyncTime();
                        }, 30000); // Cada 30 segundos

                        showToast('✅ Auto-actualizaci�n activada', 'success');
                    } else {
                        autoRefreshBtn.innerHTML = '<span>⚡</span><span>Auto-actualizaci�n: OFF</span>';
                        autoRefreshBtn.classList.remove('bg-gradient-to-r', 'from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
                        autoRefreshBtn.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-indigo-600', 'hover:from-indigo-600', 'hover:to-indigo-700');

                        if (autoRefreshInterval) {
                            clearInterval(autoRefreshInterval);
                        }
                        showToast('⏸️ Auto-actualizaci�n desactivada', 'info');
                    }
                });
            }
        }

        function updateLastSyncTime() {
            const ultimaSync = document.getElementById('ultimaSync');
            if (ultimaSync) {
                const now = new Date();
                ultimaSync.textContent = now.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function setupLoadingEffects() {
            // Interceptar clicks en botones de b�squeda
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        const textId = btnId.replace('buscar', 'btn') + 'Text';
                        showButtonLoading(btn, textId, '🔍 Buscando...');

                        // Simular b�squeda exitosa
                        setTimeout(() => {
                            hideButtonLoading(btn, textId, '🔍 Buscar');
                            updateSearchHistory(btnId);
                        }, 2000);
                    });
                }
            });

            // Interceptar registro de entrada
            const registrarBtn = document.getElementById('registrarEntrada');
            if (registrarBtn) {
                registrarBtn.addEventListener('click', () => {
                    showButtonLoading(registrarBtn, 'btnRegistrarText', '⏳ Registrando entrada...');

                    setTimeout(() => {
                        hideButtonLoading(registrarBtn, 'btnRegistrarText', '✅ Registrar Entrada');
                        showToast('✅ Entrada registrada exitosamente', 'success');
                        updateEntryCounter();
                    }, 3000);
                });
            }

            // Interceptar sincronizaci�n
            const sincBtn = document.getElementById('sincronizarEntradas');
            if (sincBtn) {
                sincBtn.addEventListener('click', () => {
                    showButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizando con servidor...');

                    setTimeout(() => {
                        hideButtonLoading(sincBtn, 'btnSincText', '🔄 Sincronizar con Servidor');
                        showToast('✅ Sincronizaci�n completada', 'success');
                        updateLastSyncTime();
                    }, 4000);
                });
            }

            // Interceptar actualizaci�n de tabla
            const refreshBtn = document.getElementById('refreshTable');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    const indicator = document.getElementById('tableLoadingIndicator');
                    if (indicator) {
                        indicator.style.display = 'block';
                        setTimeout(() => {
                            indicator.style.display = 'none';
                            showToast('🔄 Tabla actualizada', 'info');
                        }, 2000);
                    }
                });
            }
        }

        function updateSearchHistory(searchType) {
            const busquedaReciente = document.getElementById('busquedaReciente');
            const textoUltimaBusqueda = document.getElementById('textoUltimaBusqueda');

            if (busquedaReciente && textoUltimaBusqueda) {
                const tipoTexto = {
                    'buscarPorCodigo': 'B�squeda por c�digo',
                    'buscarPorNombre': 'B�squeda por nombre',
                    'buscarPorMarca': 'B�squeda por marca'
                };

                const now = new Date().toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                textoUltimaBusqueda.textContent = `${tipoTexto[searchType]} a las ${now}`;
                busquedaReciente.style.display = 'block';

                // Ocultar despu�s de 10 segundos
                setTimeout(() => {
                    busquedaReciente.style.display = 'none';
                }, 10000);
            }
        }

        function updateEntryCounter() {
            const contador = document.getElementById('contadorEntradas');
            const totalEntradas = document.getElementById('totalEntradas');

            if (contador) {
                const currentCount = parseInt(contador.textContent.match(/\d+/) || [0])[0];
                const newCount = currentCount + 1;
                contador.textContent = `Total: ${newCount} entradas registradas`;

                // Animaci�n del contador
                contador.classList.add('animate-pulse');
                setTimeout(() => {
                    contador.classList.remove('animate-pulse');
                }, 1000);
            }

            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                totalEntradas.textContent = currentCount + 1;
            }
        }

        function showButtonLoading(button, textElementId = null, loadingText = 'Cargando...') {
            button.disabled = true;
            button.classList.add('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
                }
            } else {
                button.innerHTML = `<div class="loading-spinner inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>${loadingText}`;
            }
        }

        function hideButtonLoading(button, textElementId = null, originalText = 'Buscar') {
            button.disabled = false;
            button.classList.remove('opacity-75', 'cursor-not-allowed');

            if (textElementId) {
                const textElement = document.getElementById(textElementId);
                if (textElement) {
                    textElement.textContent = originalText;
                }
            } else {
                button.textContent = originalText;
            }
        } function setupEntranceAnimations() {
            // Animar elementos cuando aparecen
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-fade-in-up');

                        // A�adir un peque�o retraso para elementos consecutivos
                        const siblings = Array.from(entry.target.parentElement.children);
                        const index = siblings.indexOf(entry.target);
                        entry.target.style.animationDelay = `${index * 0.1}s`;
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            // Observar todas las tarjetas
            document.querySelectorAll('.card-hover').forEach(card => {
                observer.observe(card);
            });

            // Animaciones para botones al hacer hover
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('mouseenter', () => {
                    if (!button.disabled) {
                        button.style.transform = 'translateY(-2px)';
                        button.style.boxShadow = '0 10px 25px rgba(0,0,0,0.2)';
                    }
                });

                button.addEventListener('mouseleave', () => {
                    button.style.transform = 'translateY(0)';
                    button.style.boxShadow = '';
                });
            });

            // Animaci�n de aparecer para modales
            const scanner = document.getElementById('scanner-container');
            if (scanner) {
                const originalDisplay = scanner.style.display;
                scanner.addEventListener('click', (e) => {
                    if (e.target === scanner) {
                        // Cerrar al hacer click fuera del modal
                        hideModal(scanner);
                    }
                });
            }
        }

        function showModal(modal) {
            modal.style.display = 'flex';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.transition = 'all 0.3s ease';
                modal.style.opacity = '1';
                modal.style.transform = 'scale(1)';
            }, 10);
        }

        function hideModal(modal) {
            modal.style.transition = 'all 0.3s ease';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';

            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function setupDynamicNotifications() {
            // Mostrar formulario solo cuando se selecciona un producto
            ['buscarPorCodigo', 'buscarPorNombre', 'buscarPorMarca'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        setTimeout(() => {
                            const productForm = document.getElementById('productForm');
                            const codigoProducto = document.getElementById('codigoProducto');

                            if (productForm && codigoProducto && codigoProducto.value) {
                                // Mostrar formulario con animaci�n
                                productForm.style.display = 'block';
                                productForm.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });

                                // Animaci�n de aparici�n
                                productForm.style.opacity = '0';
                                productForm.style.transform = 'translateY(30px)';

                                setTimeout(() => {
                                    productForm.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                                    productForm.style.opacity = '1';
                                    productForm.style.transform = 'translateY(0)';

                                    // Destacar el formulario brevemente
                                    productForm.classList.add('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    setTimeout(() => {
                                        productForm.classList.remove('ring-4', 'ring-green-300', 'ring-opacity-50');
                                    }, 2000);
                                }, 100);

                                // Actualizar stock actual (simulado)
                                updateStockDisplay();

                                // Focus en el primer campo editable
                                const cantidadInput = document.getElementById('cantidadEntrada');
                                if (cantidadInput) {
                                    setTimeout(() => cantidadInput.focus(), 800);
                                }
                            }
                        }, 500);
                    });
                }
            });

            // Feedback visual en inputs con animaciones mejoradas
            document.querySelectorAll('input, textarea, select').forEach(input => {
                input.addEventListener('focus', (e) => {
                    e.target.style.transform = 'scale(1.02)';
                    e.target.style.transition = 'transform 0.2s ease';

                    // A�adir indicador de foco
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '#10B981';
                        label.style.transform = 'scale(1.05)';
                        label.style.transition = 'all 0.2s ease';
                    }
                });

                input.addEventListener('blur', (e) => {
                    e.target.style.transform = 'scale(1)';

                    // Restaurar label
                    const label = e.target.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.style.color = '';
                        label.style.transform = 'scale(1)';
                    }
                });

                // Validaci�n visual en tiempo real
                if (input.type === 'number') {
                    input.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        if (value > 0) {
                            e.target.style.borderColor = '#10B981';
                            e.target.style.backgroundColor = '#F0FDF4';
                        } else if (e.target.value) {
                            e.target.style.borderColor = '#EF4444';
                            e.target.style.backgroundColor = '#FEF2F2';
                        } else {
                            e.target.style.borderColor = '';
                            e.target.style.backgroundColor = '';
                        }
                    });
                }
            });

            // Animaciones para las filas de la tabla
            setupTableRowAnimations();

            // Notificaciones de estado del sistema
            setupSystemStatusNotifications();
        }

        function updateStockDisplay() {
            const stockActual = document.getElementById('stockActual');
            if (stockActual) {
                // Simular datos de stock
                const stock = Math.floor(Math.random() * 500) + 10;
                stockActual.textContent = stock;

                // Animaci�n del contador
                stockActual.style.transform = 'scale(1.2)';
                stockActual.style.transition = 'transform 0.3s ease';

                setTimeout(() => {
                    stockActual.style.transform = 'scale(1)';
                }, 300);

                // Color basado en el stock
                if (stock < 50) {
                    stockActual.className = 'text-2xl font-bold text-red-600';
                    stockActual.parentElement.className = 'bg-red-50 p-4 rounded-lg border border-red-200';
                } else if (stock < 100) {
                    stockActual.className = 'text-2xl font-bold text-yellow-600';
                    stockActual.parentElement.className = 'bg-yellow-50 p-4 rounded-lg border border-yellow-200';
                } else {
                    stockActual.className = 'text-2xl font-bold text-green-600';
                    stockActual.parentElement.className = 'bg-green-50 p-4 rounded-lg border border-green-200';
                }
            }
        }

        function setupTableRowAnimations() {
            // Observador para filas de tabla
            const tableObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeName === 'TR' && !node.classList.contains('text-center')) {
                                // Animar nueva fila
                                node.style.opacity = '0';
                                node.style.transform = 'translateX(-20px)';

                                setTimeout(() => {
                                    node.style.transition = 'all 0.5s ease';
                                    node.style.opacity = '1';
                                    node.style.transform = 'translateX(0)';
                                }, 100);

                                // Efectos hover mejorados
                                node.addEventListener('mouseenter', () => {
                                    node.style.backgroundColor = '#F0FDF4';
                                    node.style.transform = 'scale(1.01)';
                                    node.style.transition = 'all 0.2s ease';
                                    node.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
                                });

                                node.addEventListener('mouseleave', () => {
                                    node.style.backgroundColor = '';
                                    node.style.transform = 'scale(1)';
                                    node.style.boxShadow = '';
                                });
                            }
                        });
                    }
                });
            });

            const tableBody = document.getElementById('tablaEntradasBody');
            if (tableBody) {
                tableObserver.observe(tableBody, { childList: true });
            }
        }

        function setupSystemStatusNotifications() {
            // Notificaciones peri�dicas de estado
            setInterval(() => {
                if (Math.random() < 0.1) { // 10% de probabilidad cada minuto
                    const messages = [
                        '✅ Sistema funcionando correctamente',
                        '📊 Base de datos sincronizada',
                        '🔄 Datos actualizados autom�ticamente',
                        '📈 Rendimiento �ptimo del sistema'
                    ];

                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    showToast(randomMessage, 'success');
                }
            }, 60000); // Cada minuto
        } function refreshTableData() {
            const indicator = document.getElementById('tableLoadingIndicator');
            if (indicator) {
                indicator.style.display = 'block';

                // Simular carga de datos
                setTimeout(() => {
                    indicator.style.display = 'none';
                    updateLastSyncTime();

                    // Actualizar contador si hay datos
                    const tbody = document.getElementById('tablaEntradasBody');
                    if (tbody) {
                        const rows = tbody.querySelectorAll('tr:not(.text-center)');
                        const contador = document.getElementById('contadorEntradas');
                        if (contador) {
                            contador.textContent = `Total: ${rows.length} entradas registradas`;
                        }
                    }
                }, 2000);
            }

            console.log('Actualizando datos de la tabla...');
        }

        // Efectos adicionales para las filas de la tabla
        function addTableRowEffects() {
            document.querySelectorAll('#tablaEntradasBody tr:not(.text-center)').forEach(row => {
                // Eliminar eventos anteriores para evitar duplicados
                row.removeEventListener('mouseenter', handleRowHover);
                row.removeEventListener('mouseleave', handleRowLeave);

                // A�adir nuevos eventos
                row.addEventListener('mouseenter', handleRowHover);
                row.addEventListener('mouseleave', handleRowLeave);
            });
        }

        function handleRowHover(e) {
            e.target.style.backgroundColor = '#F0FDF4';
            e.target.style.transform = 'scale(1.01)';
            e.target.style.transition = 'all 0.2s ease';
            e.target.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        }

        function handleRowLeave(e) {
            e.target.style.backgroundColor = '';
            e.target.style.transform = 'scale(1)';
            e.target.style.boxShadow = '';
        }

        // Inicializar mejoras adicionales al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                addTableRowEffects();
                initializeAdditionalFeatures();
            }, 1000);
        });

        // Caracter�sticas adicionales
        function initializeAdditionalFeatures() {
            // Configurar filtros de fecha inteligentes
            setupIntelligentDateFilters();

            // Configurar exportaci�n mejorada
            setupEnhancedExport();

            // Configurar modo expandido de tabla
            setupTableExpandMode();

            // Configurar estad�sticas en tiempo real
            setupRealTimeStats();
        }

        function setupIntelligentDateFilters() {
            const filtrarPorFecha = document.getElementById('filtrarPorFecha');
            if (filtrarPorFecha) {
                filtrarPorFecha.addEventListener('click', () => {
                    const fechaDesde = document.getElementById('fechaDesde').value;
                    const fechaHasta = document.getElementById('fechaHasta').value;

                    if (fechaDesde && fechaHasta) {
                        const rangoFechas = document.getElementById('rangoFechas');
                        if (rangoFechas) {
                            const desde = new Date(fechaDesde).toLocaleDateString('es-ES');
                            const hasta = new Date(fechaHasta).toLocaleDateString('es-ES');
                            rangoFechas.textContent = `Mostrando entradas del ${desde} al ${hasta}`;
                        }
                        showToast(`📅 Filtro aplicado: ${fechaDesde} a ${fechaHasta}`, 'info');
                    } else {
                        showToast('⚠️ Seleccione ambas fechas para filtrar', 'warning');
                    }
                });
            }
        }

        function setupEnhancedExport() {
            const exportBtn = document.getElementById('exportVisible');
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    showToast('📥 Preparando exportaci�n...', 'info');

                    setTimeout(() => {
                        showToast('✅ Datos exportados exitosamente', 'success');
                    }, 2000);
                });
            }
        }

        function setupTableExpandMode() {
            const expandBtn = document.getElementById('expandirTabla');
            let isExpanded = false;

            if (expandBtn) {
                expandBtn.addEventListener('click', () => {
                    const tableContainer = expandBtn.closest('.bg-white');

                    if (!isExpanded) {
                        tableContainer.classList.add('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Contraer</span>';
                        isExpanded = true;
                        showToast('⛶ Tabla expandida', 'info');
                    } else {
                        tableContainer.classList.remove('fixed', 'inset-4', 'z-40', 'overflow-auto');
                        expandBtn.innerHTML = '<span>⛶</span><span class="hidden md:inline">Expandir</span>';
                        isExpanded = false;
                        showToast('⛶ Tabla contra�da', 'info');
                    }
                });
            }
        }

        function setupRealTimeStats() {
            // Actualizar estad�sticas cada 30 segundos
            setInterval(() => {
                updateSystemStats();
            }, 30000);

            // Actualizaci�n inicial
            updateSystemStats();
        }

        function updateSystemStats() {
            // Simular actualizaci�n de estad�sticas
            const totalEntradas = document.getElementById('totalEntradas');
            if (totalEntradas) {
                const currentCount = parseInt(totalEntradas.textContent || 0);
                if (Math.random() < 0.3) { // 30% de probabilidad de incremento
                    totalEntradas.textContent = currentCount + Math.floor(Math.random() * 3) + 1;
                }
            }
        }

        // CSS para animaciones adicionales
        const additionalStyles = `
            <style>
                .animate-fade-in-up {
                    animation: fadeInUp 0.6s ease-out forwards;
                }
                
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(30px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .status-indicator {
                    display: inline-block;
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    margin-right: 6px;
                }
                
                .status-success {
                    background-color: #10B981;
                    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
                }
                
                .status-error {
                    background-color: #EF4444;
                    box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
                }
                
                .card-hover {
                    transition: all 0.3s ease;
                }
                
                .card-hover:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                }
                
                .loading-spinner {
                    border: 2px solid #f3f3f3;
                    border-top: 2px solid #3498db;
                    border-radius: 50%;
                    width: 16px;
                    height: 16px;
                    animation: spin 1s linear infinite;
                }
                
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                
                /* Efectos de hover mejorados */
                button:not(:disabled):hover {
                    transform: translateY(-1px) !important;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                }
                
                input:focus, textarea:focus, select:focus {
                    transform: scale(1.01);
                    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
                }
                
                /* Animaciones para modales */
                .modal-enter {
                    animation: modalEnter 0.3s ease-out forwards;
                }
                
                @keyframes modalEnter {
                    from {
                        opacity: 0;
                        transform: scale(0.9);
                    }
                    to {
                        opacity: 1;
                        transform: scale(1);
                    }
                }
                
                /* Efectos de tabla mejorados */
                table th {
                    position: relative;
                    overflow: hidden;
                }
                
                table th:hover::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    animation: shimmer 1.5s ease-in-out;
                }
                
                @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
            </style>
        `;

        // A�adir estilos al head
        document.head.insertAdjacentHTML('beforeend', additionalStyles);

        // Llamar despu�s de cargar datos en la tabla
        window.addEventListener('load', () => {
            setTimeout(addTableRowEffects, 1000);
        });

        // Funci�n para convertir gui�n a 6 ceros
        function convertirGuionACeros(valor) {
            return valor.replace(/-/g, '000000');
        }

        // Funci�n para aplicar la conversi�n a un input
        function aplicarConversionCodigo(input) {
            if (!input) return;
            
            input.addEventListener('input', function(e) {
                const valorOriginal = e.target.value;
                const valorConvertido = convertirGuionACeros(valorOriginal);
                
                if (valorOriginal !== valorConvertido) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = valorConvertido;
                    
                    const diferencia = valorConvertido.length - valorOriginal.length;
                    const nuevaPosicion = Math.min(cursorPos + diferencia, valorConvertido.length);
                    e.target.setSelectionRange(nuevaPosicion, nuevaPosicion);
                }
            });

            input.addEventListener('blur', function(e) {
                e.target.value = convertirGuionACeros(e.target.value);
            });
        }

        // Aplicar conversi�n a los campos de c�digo cuando se cargue la p�gina
        document.addEventListener('DOMContentLoaded', function() {
            const busquedaCodigo = document.getElementById('busquedaCodigo');
            const codigoProducto = document.getElementById('codigoProducto');
            const filtroCodigo = document.getElementById('filtroCodigo');
            
            aplicarConversionCodigo(busquedaCodigo);
            aplicarConversionCodigo(codigoProducto);
            aplicarConversionCodigo(filtroCodigo);
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Preconteo</title>    
    <!-- Favicon y iconos -->
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/logo.svg">
    
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link href="../librer�as/tailwind.min.css" rel="stylesheet">
    <script src="../librer�as/sweetalert2@11.js"></script>
    <script src="../librer�as/jspdf.umd.min.js"></script>
    <script src="../librer�as/JsBarcode.all.min.js"></script>
    <script src="../js/utils/theme-manager.js"></script>
    <script src="../js/ui/theme-toggle.js"></script>

    <!-- Cargar Supabase como script tradicional -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    </script>
</head>

<body class="bg-gray-100">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
        <h1 class="text-xl font-bold">Reporte de Preconteo</h1>
    </header>

    <div id="sideMenu"
        class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform">
        <div class="p-4 border-b">
            <h2 class="text-xl font-bold">Men� de Navegaci�n</h2>
            <button id="closeMenu" class="text-red-500 hover:underline mt-2">Cerrar</button>
        </div>
        <ul id="menuRoutes" class="p-4 space-y-2">
            <!-- Las rutas se generar�n din�micamente -->
        </ul>
    </div>

    <nav class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-xl font-bold">GestorInventory</h1>
            <a href="./main.html" class="hover:underline">Regresar</a>
            <button id="menuToggle" class="bg-white text-blue-600 px-4 py-2 rounded hover:bg-gray-200">
                Men�
            </button>
        </div>
    </nav>

    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold text-center mb-6">Generador de Reportes de Preconteo</h1>

        <div class="mb-6 bg-white p-4 rounded shadow">
            <div class="mb-4">
                <label class="block font-semibold mb-2">Selecciona una o varias �reas:</label>
                <div id="areasContainer" class="grid grid-cols-2 md:grid-cols-3 gap-2 border rounded p-3">
                    <!-- Las �reas se cargar�n din�micamente como checkboxes -->
                    <div class="flex items-center">
                        <input type="checkbox" id="area-todas" value="todas" class="areaCheckbox mr-2" checked>
                        <label for="area-todas">Todas las �reas</label>
                    </div>
                </div>
                <div class="mt-2 text-right">
                    <button id="aplicarFiltroBtn" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">
                        Aplicar filtro
                    </button>
                </div>
            </div>

            <div id="loadingIndicator" class="hidden">
                <div class="flex items-center justify-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                    <span class="ml-2">Cargando productos...</span>
                </div>
            </div>

            <div id="productosList" class="mt-4">
                <h2 class="text-xl font-semibold mb-2">Lista de productos:</h2>
                <ul id="productosContainer" class="list-decimal pl-6 space-y-1">
                    <!-- Los productos se cargar�n din�micamente -->
                </ul>
            </div>
        </div>

        <div class="text-center">
            <button id="generarReporteBtn"
                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded">
                GENERAR REPORTE DE PRECONTEO
            </button>
        </div>

        <!-- Contenedor invisible para generar c�digos de barras -->
        <div id="barcodeContainer" class="hidden"></div>
    </div>

    <!-- Cargar nuestro script principal despu�s de asegurarnos que las dependencias est�n cargadas -->
    <script src="../js/ui/mobile-optimizer.js"></script>
    <script type="module" src="../js/reports/rep.js"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Recuperar Contraseña</h1>
            
            <form id="formPasswordReset" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Correo Electrónico</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="tu@email.com"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Enviar Enlace de Recuperación
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Recordaste tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restablecer Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Restablecer Contraseña</h1>
            
            <form id="formResetPassword" class="space-y-4">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Nueva Contraseña</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Ingresa tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-300 mb-2">Confirmar Contraseña</label>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        name="confirmPassword" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Confirma tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Restablecer Contraseña
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Ya tienes tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }

        // Manejar reset de contraseña
        document.addEventListener('DOMContentLoaded', async () => {
            const formResetPassword = document.getElementById('formResetPassword');
            
            if (formResetPassword) {
                formResetPassword.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    // Validar que las contraseñas coincidan
                    if (password !== confirmPassword) {
                        alert('Las contraseñas no coinciden');
                        return;
                    }
                    
                    // Validar longitud mínima
                    if (password.length < 6) {
                        alert('La contraseña debe tener al menos 6 caracteres');
                        return;
                    }

                    try {
                        // Obtener el hash del enlace de reseteo de la URL
                        const hash = window.location.hash;
                        
                        if (!hash) {
                            alert('Enlace de recuperación inválido');
                            return;
                        }

                        // Esperar a que Supabase esté disponible
                        let attempts = 0;
                        while (!window.supabase && attempts < 50) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }

                        if (!window.supabase) {
                            alert('Error: No se pudo cargar Supabase');
                            return;
                        }

                        const { error } = await window.supabase.auth.updateUser({
                            password: password
                        });

                        if (error) {
                            alert('Error al actualizar contraseña: ' + error.message);
                            return;
                        }

                        alert('Contraseña actualizada correctamente');
                        window.location.href = '../index.html';
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al restablecer contraseña');
                    }
                });
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Recuperar Contraseña</h1>
            
            <form id="formPasswordReset" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-300 mb-2">Correo Electrónico</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="tu@email.com"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Enviar Enlace de Recuperación
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Recordaste tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restablecer Contraseña - Gestor Inventory</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/mobile-components.css">
    <link rel="stylesheet" href="../librerías/tailwind.min.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
</head>
<body class="dark-theme">
    <div class="min-h-screen flex items-center justify-center bg-gray-900">
        <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-700">
            <h1 class="text-2xl font-bold mb-6 text-white text-center">Restablecer Contraseña</h1>
            
            <form id="formResetPassword" class="space-y-4">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Nueva Contraseña</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Ingresa tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-300 mb-2">Confirmar Contraseña</label>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        name="confirmPassword" 
                        required 
                        class="w-full px-4 py-2 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Confirma tu nueva contraseña"
                        minlength="6"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
                >
                    Restablecer Contraseña
                </button>
            </form>

            <div id="mensaje" class="mt-4 text-center"></div>

            <div class="mt-6 text-center">
                <p class="text-gray-400">¿Ya tienes tu contraseña?</p>
                <a href="../index.html" class="text-indigo-400 hover:text-indigo-300 font-medium">Volver al inicio de sesión</a>
            </div>
        </div>
    </div>

    <script src="../js/ui/mobile-optimizer.js"></script>
    <!-- Cargar Supabase como script tradicional antes de auth.js -->
    <script async src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.40.0/dist/umd/supabase.js"></script>
    <script type="module" src="../js/auth/auth.js"></script>
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    const swPath = isLocalhost ? '/service-worker.js' : '/GestorInventory-Frontend/service-worker.js';
                    await navigator.serviceWorker.register(swPath);
                } catch (error) {
                    console.error('Error al registrar Service Worker:', error);
                }
            });
        }

        // Manejar reset de contraseña
        document.addEventListener('DOMContentLoaded', async () => {
            const formResetPassword = document.getElementById('formResetPassword');
            
            if (formResetPassword) {
                formResetPassword.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    // Validar que las contraseñas coincidan
                    if (password !== confirmPassword) {
                        alert('Las contraseñas no coinciden');
                        return;
                    }
                    
                    // Validar longitud mínima
                    if (password.length < 6) {
                        alert('La contraseña debe tener al menos 6 caracteres');
                        return;
                    }

                    try {
                        // Obtener el hash del enlace de reseteo de la URL
                        const hash = window.location.hash;
                        
                        if (!hash) {
                            alert('Enlace de recuperación inválido');
                            return;
                        }

                        // Esperar a que Supabase esté disponible
                        let attempts = 0;
                        while (!window.supabase && attempts < 50) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }

                        if (!window.supabase) {
                            alert('Error: No se pudo cargar Supabase');
                            return;
                        }

                        const { error } = await window.supabase.auth.updateUser({
                            password: password
                        });

                        if (error) {
                            alert('Error al actualizar contraseña: ' + error.message);
                            return;
                        }

                        alert('Contraseña actualizada correctamente');
                        window.location.href = '../index.html';
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al restablecer contraseña');
                    }
                });
            }
        });
    </script>
</body>
</html>


