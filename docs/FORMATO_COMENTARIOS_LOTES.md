

# üìù Formato de Comentarios - Inventario por Lotes Avanzado

## üéØ Formato Implementado

### **Estructura del Comentario:**
```
Escaneo por lotes - [cantidad] c√≥digos - Valor total: $[total] - Precio/Kg: $[promedio] - Detalles: Lote 1: [peso]kg - $[precio] (PLU: [plu]); Lote 2: [peso]kg - $[precio] (PLU: [plu])
```

### **Ejemplo Real:**
```
Escaneo por lotes - 2 c√≥digos - Valor total: $1206.83 - Precio/Kg: $478.90 - Detalles: Lote 1: 1.920kg - $919.49 (PLU: 2630); Lote 2: 0.600kg - $287.34 (PLU: 2630)
```

## üìä Componentes del Formato

### **1. Informaci√≥n General**
- `Escaneo por lotes` - Identificador del tipo de inventario
- `[cantidad] c√≥digos` - N√∫mero total de productos escaneados

### **2. Totales Calculados**
- `Valor total: $[total]` - Suma de todos los precios de las porciones
- `Precio/Kg: $[promedio]` - Precio promedio por kilogramo (total valor √∑ total peso)

### **3. Detalles por Lote**
- `Lote [n]: [peso]kg - $[precio] (PLU: [plu])` - Informaci√≥n individual de cada producto escaneado
- Separados por punto y coma (`;`) para f√°cil lectura

## üîß C√°lculos Autom√°ticos

### **Valores Calculados:**
1. **Total de c√≥digos:** `grupo.subproductos.length`
2. **Valor total:** `suma de todos los precioPorcion`
3. **Precio promedio por kg:** `totalValor √∑ totalPeso`
4. **Peso individual:** `producto.peso.toFixed(3)`
5. **Precio individual:** `producto.precioPorcion.toFixed(2)`

### **Funci√≥n Implementada:**
```javascript
function generarComentariosDetallados(grupo, ubicacionNombre, fechaEscaneo) {
    // Calcular totales
    let totalProductos = grupo.subproductos.length;
    let totalPeso = grupo.pesoTotal;
    let totalValor = grupo.subproductos.reduce((sum, prod) => sum + prod.precioPorcion, 0);
    let precioPromedioKg = totalValor / totalPeso;

    // Generar detalles de cada producto escaneado
    let detalles = grupo.subproductos.map((producto, index) => {
        return `Lote ${index + 1}: ${producto.peso.toFixed(3)}kg - $${producto.precioPorcion.toFixed(2)} (PLU: ${producto.plu})`;
    }).join('; ');

    // Formato conciso y directo
    const comentarios = `Escaneo por lotes - ${totalProductos} c√≥digos - Valor total: $${totalValor.toFixed(2)} - Precio/Kg: $${precioPromedioKg.toFixed(2)} - Detalles: ${detalles}`;

    return comentarios;
}
```

## ‚úÖ Ventajas del Formato

### **Conciso y Directo**
- ‚úÖ Toda la informaci√≥n en una sola l√≠nea
- ‚úÖ F√°cil lectura y comprensi√≥n
- ‚úÖ Formato estructurado y consistente

### **Informaci√≥n Completa**
- ‚úÖ Cantidad total de productos
- ‚úÖ Valor econ√≥mico total
- ‚úÖ Precio promedio por kilogramo
- ‚úÖ Detalle individual de cada lote
- ‚úÖ PLU de cada producto para trazabilidad

### **Optimizado para Base de Datos**
- ‚úÖ Formato compacto para almacenamiento
- ‚úÖ Parsing f√°cil si se necesita extraer datos
- ‚úÖ Legible tanto para humanos como para sistemas

## üìã Otros Campos del Inventario

### **Datos Adicionales Guardados:**
- **Fecha de Caducidad:** 15 d√≠as desde la fecha de escaneo
- **Lote:** `lotes-{timestamp}` para identificaci√≥n √∫nica
- **Unidad:** `Kg` (productos tipo kilogramo)
- **Cantidad:** Peso total acumulado de todos los productos
- **√Årea:** ID del √°rea donde se realiz√≥ el escaneo
- **Usuario:** ID del usuario que realiz√≥ el inventario

## üéØ Resultado Final

El sistema ahora genera comentarios en el formato exacto solicitado:

```
Escaneo por lotes - 2 c√≥digos - Valor total: $1206.83 - Precio/Kg: $478.90 - Detalles: Lote 1: 1.920kg - $919.49 (PLU: 2630); Lote 2: 0.600kg - $287.34 (PLU: 2630)
```

Este formato es:
- ‚úÖ **Conciso** - Una sola l√≠nea con toda la informaci√≥n
- ‚úÖ **Completo** - Incluye todos los datos relevantes
- ‚úÖ **Consistente** - Mismo formato para todos los inventarios
- ‚úÖ **Legible** - F√°cil de leer y entender
- ‚úÖ **Funcional** - Contiene toda la informaci√≥n necesaria para auditor√≠as
